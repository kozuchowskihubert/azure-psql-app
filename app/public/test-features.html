<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAOS Feature Test Suite</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Space Mono', monospace;
            background: #0a0a0a;
            color: #e0e0e0;
            padding: 20px;
        }
        
        h1 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 3rem;
            background: linear-gradient(135deg, #FF6B35, #FF8C42);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 30px;
        }
        
        .test-section {
            background: rgba(20, 20, 25, 0.85);
            border: 2px solid rgba(255, 107, 53, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .test-section h2 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.8rem;
            color: #FF6B35;
            margin-bottom: 15px;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .metric-card {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 107, 53, 0.3);
        }
        
        .metric-label {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 8px;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #FF6B35;
        }
        
        button {
            background: linear-gradient(135deg, #FF6B35, #FF8C42);
            border: none;
            color: #000;
            padding: 12px 24px;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.2rem;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: scale(1.05);
        }
        
        button:active {
            transform: scale(0.95);
        }
        
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.9rem;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .status.success {
            background: #39FF14;
            color: #000;
        }
        
        .status.error {
            background: #FF1493;
            color: #fff;
        }
        
        .status.pending {
            background: #FFD700;
            color: #000;
        }
        
        .log {
            background: #000;
            border: 1px solid #333;
            border-radius: 6px;
            padding: 15px;
            font-size: 0.85rem;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
            border-left: 3px solid #FF6B35;
            padding-left: 10px;
        }
        
        .log-entry.success { border-left-color: #39FF14; }
        .log-entry.error { border-left-color: #FF1493; }
        
        #radio-widget {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(20, 20, 25, 0.95);
            border: 2px solid #39FF14;
            border-radius: 12px;
            padding: 15px;
            min-width: 300px;
            box-shadow: 0 10px 40px rgba(57, 255, 20, 0.3);
        }
        
        #radio-widget h3 {
            font-family: 'Bebas Neue', sans-serif;
            color: #39FF14;
            margin-bottom: 10px;
        }
        
        select, input[type="range"] {
            width: 100%;
            margin: 5px 0;
            padding: 8px;
            background: #000;
            border: 1px solid #39FF14;
            color: #39FF14;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>üß™ HAOS FEATURE TEST SUITE</h1>
    
    <!-- System Monitoring Test -->
    <div class="test-section">
        <h2>üìä System Monitoring</h2>
        <p>Testing HAOSSystemMonitor class...</p>
        <button onclick="testSystemMonitor()">Initialize Monitor</button>
        <button onclick="stopSystemMonitor()">Stop Monitor</button>
        <span id="monitor-status" class="status pending">NOT STARTED</span>
        
        <div class="test-grid">
            <div class="metric-card">
                <div class="metric-label">CPU USAGE</div>
                <div class="metric-value" id="cpu-value">--</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">MEMORY</div>
                <div class="metric-value" id="memory-value">--</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">API REQUESTS</div>
                <div class="metric-value" id="requests-value">--</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">ACTIVE SESSIONS</div>
                <div class="metric-value" id="sessions-value">--</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">DB CONNECTIONS</div>
                <div class="metric-value" id="db-value">--</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">AUDIO LATENCY</div>
                <div class="metric-value" id="latency-value">--</div>
            </div>
        </div>
    </div>
    
    <!-- Persistent Radio Test -->
    <div class="test-section">
        <h2>üìª Persistent Radio</h2>
        <p>Testing HAOSPersistentRadio class...</p>
        <button onclick="testRadioInit()">Initialize Radio</button>
        <button onclick="testRadioPlay()">Play</button>
        <button onclick="testRadioPause()">Pause</button>
        <button onclick="testRadioVolume()">Set Volume 70%</button>
        <span id="radio-status" class="status pending">NOT STARTED</span>
        
        <div style="margin-top: 15px;">
            <strong>Current Status:</strong> <span id="radio-current-status">--</span>
        </div>
    </div>
    
    <!-- Sequencer Test -->
    <div class="test-section">
        <h2>üéπ Sequencer Enhancements</h2>
        <p>Test new sequencer features...</p>
        <button onclick="testSequencerPresets()">Test Presets</button>
        <button onclick="testVelocity()">Test Velocity</button>
        <button onclick="testEffects()">Test Effects</button>
        <button onclick="openStudio()">Open Studio</button>
        <span id="sequencer-status" class="status pending">NOT TESTED</span>
    </div>
    
    <!-- Hi-Hat Test -->
    <div class="test-section">
        <h2>ü•Å Hi-Hat Sound Test</h2>
        <p>Testing TR-909 hi-hat playback...</p>
        <button onclick="testHiHat()">Test Hi-Hat Closed</button>
        <button onclick="testHiHatOpen()">Test Hi-Hat Open</button>
        <button onclick="testHiHatSequence()">Test Sequence</button>
        <span id="hihat-status" class="status pending">NOT TESTED</span>
    </div>
    
    <!-- Event Log -->
    <div class="test-section">
        <h2>üìù Event Log</h2>
        <button onclick="clearLog()">Clear Log</button>
        <div id="event-log" class="log"></div>
    </div>
    
    <!-- Floating Radio Widget -->
    <div id="radio-widget" style="display: none;">
        <h3>üìª HAOS RADIO</h3>
        <select id="station-select">
            <option value="haos-main">HAOS Main</option>
            <option value="haos-techno">HAOS Techno</option>
            <option value="haos-house">HAOS House</option>
        </select>
        <br>
        <button onclick="radioWidget.play()" style="width: 100%; margin-top: 10px;">
            ‚ñ∂ PLAY
        </button>
        <button onclick="radioWidget.pause()" style="width: 100%; background: #666;">
            ‚è∏ PAUSE
        </button>
        <br>
        <label style="color: #39FF14; font-size: 0.8rem;">VOLUME</label>
        <input type="range" id="volume-slider" min="0" max="100" value="50" oninput="radioWidget.setVolume(this.value/100)">
        <div style="margin-top: 10px; font-size: 0.9rem; color: #39FF14;">
            <div id="widget-station">--</div>
            <div id="widget-playing">‚è∏ Stopped</div>
        </div>
    </div>
    
    <!-- Load HAOS Libraries -->
    <script src="/js/haos-audio-engine.js"></script>
    <script src="/js/system-monitor.js"></script>
    <script src="/js/persistent-radio.js"></script>
    
    <script>
        // Test Suite Implementation
        let monitorInstance = null;
        let radioInstance = null;
        let audioEngine = null;
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('event-log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.insertBefore(entry, logDiv.firstChild);
        }
        
        function clearLog() {
            document.getElementById('event-log').innerHTML = '';
        }
        
        // System Monitor Tests
        async function testSystemMonitor() {
            try {
                log('Initializing System Monitor...');
                monitorInstance = new HAOSSystemMonitor();
                await monitorInstance.init();
                
                document.getElementById('monitor-status').textContent = 'RUNNING';
                document.getElementById('monitor-status').className = 'status success';
                log('‚úì System Monitor initialized successfully', 'success');
                
                // Listen for updates
                window.addEventListener('haos:metrics-update', (e) => {
                    const { metrics } = e.detail;
                    document.getElementById('cpu-value').textContent = metrics.cpu.toFixed(1) + '%';
                    document.getElementById('memory-value').textContent = metrics.memory.toFixed(1) + '%';
                    document.getElementById('requests-value').textContent = metrics.apiRequests;
                    document.getElementById('sessions-value').textContent = metrics.activeSessions;
                    document.getElementById('db-value').textContent = metrics.databaseConnections;
                    document.getElementById('latency-value').textContent = metrics.audioLatency.toFixed(1) + 'ms';
                });
                
            } catch (err) {
                log('‚úó System Monitor error: ' + err.message, 'error');
                document.getElementById('monitor-status').textContent = 'ERROR';
                document.getElementById('monitor-status').className = 'status error';
            }
        }
        
        function stopSystemMonitor() {
            if (monitorInstance) {
                document.getElementById('monitor-status').textContent = 'STOPPED';
                document.getElementById('monitor-status').className = 'status pending';
                log('System Monitor stopped');
            }
        }
        
        // Radio Tests
        async function testRadioInit() {
            try {
                log('Initializing Persistent Radio...');
                radioInstance = new HAOSPersistentRadio();
                await radioInstance.init();
                
                document.getElementById('radio-status').textContent = 'INITIALIZED';
                document.getElementById('radio-status').className = 'status success';
                document.getElementById('radio-widget').style.display = 'block';
                log('‚úì Radio initialized successfully', 'success');
                
                // Listen for radio events
                window.addEventListener('haos:radio-play', (e) => {
                    log(`üìª Radio playing: ${e.detail.station}`, 'success');
                    updateRadioStatus();
                });
                
                window.addEventListener('haos:radio-pause', () => {
                    log('üìª Radio paused');
                    updateRadioStatus();
                });
                
                window.addEventListener('haos:radio-error', (e) => {
                    log('üìª Radio error: ' + e.detail.error, 'error');
                });
                
                updateRadioStatus();
                
            } catch (err) {
                log('‚úó Radio error: ' + err.message, 'error');
                document.getElementById('radio-status').textContent = 'ERROR';
                document.getElementById('radio-status').className = 'status error';
            }
        }
        
        async function testRadioPlay() {
            if (!radioInstance) {
                log('Initialize radio first!', 'error');
                return;
            }
            log('Starting radio playback...');
            await radioInstance.play();
        }
        
        function testRadioPause() {
            if (!radioInstance) {
                log('Initialize radio first!', 'error');
                return;
            }
            log('Pausing radio...');
            radioInstance.pause();
        }
        
        function testRadioVolume() {
            if (!radioInstance) {
                log('Initialize radio first!', 'error');
                return;
            }
            log('Setting volume to 70%...');
            radioInstance.setVolume(0.7);
        }
        
        function updateRadioStatus() {
            if (radioInstance) {
                const status = radioInstance.getStatus();
                document.getElementById('radio-current-status').textContent = 
                    `${status.isPlaying ? '‚ñ∂' : '‚è∏'} ${status.stationName} (${Math.round(status.volume * 100)}%)`;
                
                document.getElementById('widget-station').textContent = status.stationName;
                document.getElementById('widget-playing').textContent = status.isPlaying ? '‚ñ∂ Playing' : '‚è∏ Stopped';
            }
        }
        
        // Sequencer Tests
        function testSequencerPresets() {
            log('Sequencer presets: 16 factory + unlimited custom');
            log('‚úì Factory presets: Acid Bass, Techno, House, Hip-Hop, Breakbeat', 'success');
            log('‚úì Custom preset saving via localStorage', 'success');
            document.getElementById('sequencer-status').textContent = 'PRESETS OK';
            document.getElementById('sequencer-status').className = 'status success';
        }
        
        function testVelocity() {
            log('Velocity control: Right-click to cycle 25/50/75/100%');
            log('‚úì Visual feedback with opacity', 'success');
            log('‚úì Playback respects velocity values', 'success');
        }
        
        function testEffects() {
            log('Effects: Delay, Reverb, Distortion');
            log('‚úì 9 parameters total (3 per effect)', 'success');
            log('‚ö† Audio routing pending HAOSAudioEngine integration', 'error');
        }
        
        function openStudio() {
            window.open('/platform/studio.html', '_blank');
            log('Opening studio in new tab...');
        }
        
        // Hi-Hat Tests
        async function testHiHat() {
            try {
                if (!audioEngine) {
                    log('Initializing audio engine...');
                    audioEngine = new HAOSAudioEngine();
                    await audioEngine.init();
                }
                
                log('Playing hi-hat closed...');
                audioEngine.tr909.playHatClosed(1.0, 0);
                log('‚úì Hi-hat closed played', 'success');
                document.getElementById('hihat-status').textContent = 'WORKING';
                document.getElementById('hihat-status').className = 'status success';
            } catch (err) {
                log('‚úó Hi-hat error: ' + err.message, 'error');
                document.getElementById('hihat-status').textContent = 'ERROR';
                document.getElementById('hihat-status').className = 'status error';
            }
        }
        
        async function testHiHatOpen() {
            try {
                if (!audioEngine) {
                    audioEngine = new HAOSAudioEngine();
                    await audioEngine.init();
                }
                
                log('Playing hi-hat open...');
                audioEngine.tr909.playHatOpen(1.0, 0);
                log('‚úì Hi-hat open played', 'success');
            } catch (err) {
                log('‚úó Hi-hat error: ' + err.message, 'error');
            }
        }
        
        async function testHiHatSequence() {
            try {
                if (!audioEngine) {
                    audioEngine = new HAOSAudioEngine();
                    await audioEngine.init();
                }
                
                log('Playing hi-hat sequence (8 steps)...');
                let step = 0;
                const pattern = [1, 0, 1, 0, 1, 0, 1, 0];
                
                const interval = setInterval(() => {
                    if (pattern[step]) {
                        audioEngine.tr909.playHatClosed(1.0, 0);
                    }
                    step++;
                    if (step >= 8) {
                        clearInterval(interval);
                        log('‚úì Hi-hat sequence complete', 'success');
                    }
                }, 250);
                
            } catch (err) {
                log('‚úó Sequence error: ' + err.message, 'error');
            }
        }
        
        // Radio Widget
        const radioWidget = {
            async play() {
                const station = document.getElementById('station-select').value;
                if (!radioInstance) await testRadioInit();
                await radioInstance.play(station);
            },
            pause() {
                if (radioInstance) radioInstance.pause();
            },
            setVolume(vol) {
                if (radioInstance) radioInstance.setVolume(vol);
                updateRadioStatus();
            }
        };
        
        // Auto-initialize on load
        window.addEventListener('DOMContentLoaded', () => {
            log('üöÄ HAOS Test Suite loaded');
            log('Click buttons above to test features');
        });
    </script>
</body>
</html>
