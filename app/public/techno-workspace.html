<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAOS.fm | Techno Workspace - Live Modular System</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Space+Mono:wght@400;700&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* HAOS Brand Colors */
            --haos-black: #0a0a0a;
            --haos-panel: rgba(20, 20, 25, 0.85);
            --haos-orange: #FF6B35;
            --haos-orange-bright: #FF8C42;
            --haos-orange-dark: #E55A2B;
            --haos-green: #39FF14;
            --haos-cyan: #00D9FF;
            --haos-pink: #FF006E;
            --haos-text: #e0e0e0;
            --haos-dim: #888;
            --haos-border: rgba(255, 107, 53, 0.2);
            
            /* Typography */
            --font-display: 'Bebas Neue', sans-serif;
            --font-mono: 'Space Mono', monospace;
            --font-body: 'Inter', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: var(--font-body);
            background: var(--haos-black);
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(255, 107, 53, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(255, 140, 66, 0.06) 0%, transparent 50%);
            color: var(--haos-text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Header */
        .haos-header {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--haos-border);
            padding: 15px 30px;
        }

        .header-content {
            max-width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 30px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .logo-section:hover {
            transform: scale(1.05);
            opacity: 0.8;
        }

        .logo-section img {
            height: 40px;
            filter: drop-shadow(0 2px 10px rgba(255, 107, 53, 0.3));
        }

        .brand-text {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .brand-name {
            font-family: var(--font-display);
            font-size: 1.5rem;
            letter-spacing: 2px;
            background: linear-gradient(135deg, var(--haos-orange), var(--haos-orange-bright));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .brand-tagline {
            font-family: var(--font-mono);
            font-size: 0.6rem;
            letter-spacing: 2px;
            color: var(--haos-orange);
            text-transform: uppercase;
        }

        /* Transport Controls */
        .transport {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .transport-btn {
            padding: 10px 20px;
            border: 2px solid var(--haos-orange);
            background: rgba(0, 0, 0, 0.5);
            color: var(--haos-text);
            font-family: var(--font-mono);
            font-size: 0.8rem;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .transport-btn:hover {
            background: var(--haos-orange);
            color: #000;
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.5);
        }

        .transport-btn.active {
            background: var(--haos-orange);
            color: #000;
            animation: pulse-glow 2s infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 107, 53, 0.5); }
            50% { box-shadow: 0 0 30px rgba(255, 107, 53, 0.8); }
        }

        .bpm-display {
            font-family: var(--font-mono);
            font-size: 1.2rem;
            color: var(--haos-orange);
            padding: 8px 15px;
            border: 1px solid var(--haos-border);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.5);
        }

        /* Main Workspace Layout */
        .workspace {
            display: grid;
            grid-template-columns: 1fr 1.5fr 1fr;
            gap: 20px;
            padding: 20px;
            height: calc(100vh - 80px);
        }

        /* Column Sections */
        .workspace-column {
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: auto;
        }

        .workspace-column::-webkit-scrollbar {
            width: 8px;
        }

        .workspace-column::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }

        .workspace-column::-webkit-scrollbar-thumb {
            background: var(--haos-orange);
            border-radius: 4px;
        }

        /* Module Panels */
        .module-panel {
            background: var(--haos-panel);
            border: 1px solid var(--haos-border);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .module-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--haos-border);
        }

        .module-title {
            font-family: var(--font-display);
            font-size: 1.5rem;
            letter-spacing: 2px;
            color: var(--haos-orange);
        }

        .module-icon {
            font-size: 1.5rem;
        }

        /* Knobs */
        .knob-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .knob-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .knob {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(255, 107, 53, 0.3), rgba(0, 0, 0, 0.8));
            border: 3px solid var(--haos-orange);
            position: relative;
            cursor: pointer;
            transition: box-shadow 0.3s ease;
        }

        .knob:hover {
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.5);
        }

        .knob::before {
            content: '';
            position: absolute;
            top: 5px;
            left: 50%;
            width: 4px;
            height: 25px;
            background: var(--haos-orange-bright);
            border-radius: 2px;
            box-shadow: 0 0 8px var(--haos-orange-bright);
            transform-origin: center 25px;
            transform: translateX(-50%) rotate(var(--rotation, -135deg));
            transition: none; /* Disable transition for smooth real-time control */
        }

        /* Knob marker dot for better visual feedback */
        .knob::after {
            content: '';
            position: absolute;
            top: 8px;
            left: 50%;
            width: 8px;
            height: 8px;
            background: #FFD700;
            border-radius: 50%;
            box-shadow: 0 0 10px #FFD700, inset 0 1px 2px rgba(255,255,255,0.5);
            transform-origin: center 22px;
            transform: translateX(-50%) rotate(var(--rotation, -135deg));
            transition: none;
        }

        .knob-label {
            font-family: var(--font-mono);
            font-size: 0.7rem;
            color: var(--haos-dim);
            text-align: center;
        }

        .knob-value {
            font-family: var(--font-mono);
            font-size: 0.65rem;
            color: var(--haos-orange);
        }

        /* Sequencer Grid */
        .sequencer-grid {
            display: grid;
            grid-template-columns: repeat(16, 1fr);
            gap: 4px;
            margin-bottom: 15px;
        }

        .seq-step {
            aspect-ratio: 1;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--haos-border);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .seq-step:hover {
            background: rgba(255, 107, 53, 0.3);
        }

        .seq-step.active {
            background: var(--haos-orange);
            box-shadow: 0 0 10px rgba(255, 107, 53, 0.6);
        }

        .seq-step.playing {
            animation: step-flash 0.1s;
        }

        @keyframes step-flash {
            50% { background: var(--haos-green); }
        }

        .track-label {
            font-family: var(--font-mono);
            font-size: 0.7rem;
            color: var(--haos-dim);
            margin-bottom: 8px;
        }

        /* Patch Bay */
        .patch-bay {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--haos-border);
            border-radius: 8px;
            padding: 15px;
        }

        .patch-point {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .patch-label {
            font-family: var(--font-mono);
            font-size: 0.75rem;
            color: var(--haos-text);
            min-width: 100px;
        }

        .patch-select {
            flex: 1;
            padding: 6px 10px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid var(--haos-border);
            border-radius: 6px;
            color: var(--haos-text);
            font-family: var(--font-mono);
            font-size: 0.7rem;
        }

        .patch-select:focus {
            outline: none;
            border-color: var(--haos-orange);
            box-shadow: 0 0 10px rgba(255, 107, 53, 0.3);
        }

        /* VU Meters */
        .vu-meter {
            height: 150px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--haos-border);
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }

        .vu-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 0%;
            background: linear-gradient(to top, var(--haos-green), var(--haos-orange), var(--haos-pink));
            transition: height 0.1s ease;
        }

        /* Effects Section */
        .effect-slot {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--haos-border);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            transition: border-color 0.3s ease;
        }
        
        .effect-slot:hover {
            border-color: var(--haos-orange);
        }

        .effect-name {
            font-family: var(--font-display);
            font-size: 1.1rem;
            color: var(--haos-orange-bright);
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
            letter-spacing: 2px;
        }

        .effect-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .effect-slider {
            flex: 1;
            height: 6px;
            background: rgba(255, 107, 53, 0.2);
            border-radius: 3px;
            position: relative;
            cursor: pointer;
        }

        .effect-slider::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: var(--value, 50%);
            background: var(--haos-orange);
            border-radius: 3px;
        }

        /* Back Button */
        .back-btn {
            padding: 8px 16px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--haos-border);
            color: var(--haos-text);
            font-family: var(--font-mono);
            font-size: 0.7rem;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            border-color: var(--haos-orange);
            color: var(--haos-orange);
        }

        /* Preset Morphing Slider */
        .morph-slider-container {
            margin: 15px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--haos-border);
            border-radius: 8px;
        }

        .morph-label {
            font-family: var(--font-mono);
            font-size: 0.75rem;
            color: var(--haos-dim);
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }

        .morph-slider {
            width: 100%;
            height: 8px;
            background: linear-gradient(to right, var(--haos-cyan), var(--haos-orange));
            border-radius: 4px;
            cursor: pointer;
            -webkit-appearance: none;
            appearance: none;
        }

        .morph-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--haos-orange);
            border: 2px solid #fff;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(255, 107, 53, 0.6);
        }

        .morph-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: var(--haos-orange);
            border: 2px solid #fff;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(255, 107, 53, 0.6);
        }

        .morph-display {
            font-family: var(--font-mono);
            font-size: 0.75rem;
            color: var(--haos-orange);
            text-align: center;
            margin-top: 8px;
        }

        /* Preset Controls */
        .preset-controls {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 10px;
            margin: 15px 0;
        }

        .preset-column {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .preset-btn {
            padding: 8px 12px;
            font-family: var(--font-mono);
            font-size: 0.7rem;
            border: 1px solid var(--haos-border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: rgba(0, 0, 0, 0.5);
            color: var(--haos-text);
        }

        .preset-btn-a {
            border-color: var(--haos-cyan);
            color: var(--haos-cyan);
        }

        .preset-btn-a:hover {
            background: var(--haos-cyan);
            color: var(--haos-black);
            box-shadow: 0 0 15px rgba(0, 217, 255, 0.4);
        }

        .preset-btn-b {
            border-color: var(--haos-orange);
            color: var(--haos-orange);
        }

        .preset-btn-b:hover {
            background: var(--haos-orange);
            color: var(--haos-black);
            box-shadow: 0 0 15px rgba(255, 107, 53, 0.4);
        }

        .preset-btn-morph {
            border-color: var(--haos-pink);
            color: var(--haos-pink);
        }

        .preset-btn-morph:hover {
            background: var(--haos-pink);
            color: var(--haos-black);
            box-shadow: 0 0 15px rgba(255, 0, 110, 0.4);
        }

        /* Preset Bank */
        .preset-bank {
            margin: 15px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--haos-border);
            border-radius: 8px;
        }

        .bank-header {
            font-family: var(--font-mono);
            font-size: 0.75rem;
            color: var(--haos-orange);
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        .bank-slots {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 10px;
        }

        .bank-slot {
            aspect-ratio: 1;
            padding: 12px;
            font-family: var(--font-mono);
            font-size: 0.9rem;
            font-weight: bold;
            border: 2px solid var(--haos-border);
            border-radius: 6px;
            background: rgba(0, 0, 0, 0.7);
            color: var(--haos-dim);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .bank-slot:hover {
            border-color: var(--haos-orange);
            color: var(--haos-orange);
            box-shadow: 0 0 15px rgba(255, 107, 53, 0.3);
        }

        .bank-slot.filled {
            background: rgba(255, 107, 53, 0.1);
            border-color: var(--haos-orange);
            color: var(--haos-orange);
        }

        .bank-slot.active {
            background: var(--haos-orange);
            color: var(--haos-black);
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.6);
        }

        .bank-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .bank-action-btn {
            padding: 10px;
            font-family: var(--font-mono);
            font-size: 0.7rem;
            border: 1px solid var(--haos-orange);
            border-radius: 6px;
            background: rgba(0, 0, 0, 0.7);
            color: var(--haos-orange);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .bank-action-btn:hover {
            background: var(--haos-orange);
            color: var(--haos-black);
            box-shadow: 0 0 15px rgba(255, 107, 53, 0.4);
        }

        .morph-thumb {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            background: var(--haos-orange);
            border: 2px solid #fff;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(255, 107, 53, 0.6);
        }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           üé® ENHANCED VISUAL FEATURES
           ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

        /* Animated Module Glow */
        .module-panel {
            animation: module-breathe 4s ease-in-out infinite;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        @keyframes module-breathe {
            0%, 100% { box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5), 0 0 30px rgba(255, 107, 53, 0.1); }
            50% { box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5), 0 0 40px rgba(255, 107, 53, 0.2); }
        }

        /* Enhanced Knob with Gradient Ring */
        .knob {
            background: 
                radial-gradient(circle at 30% 30%, rgba(255, 140, 66, 0.4), transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(255, 107, 53, 0.2), transparent 60%),
                linear-gradient(145deg, #1a1a1a, #0a0a0a);
            box-shadow: 
                inset 0 2px 10px rgba(0, 0, 0, 0.8),
                inset 0 -2px 10px rgba(255, 107, 53, 0.2),
                0 4px 15px rgba(0, 0, 0, 0.5);
        }

        .knob:active {
            box-shadow: 
                inset 0 2px 10px rgba(0, 0, 0, 0.9),
                0 0 30px rgba(255, 107, 53, 0.8);
        }

        /* LED Indicator Lights */
        .led-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255, 107, 53, 0.3);
            border: 1px solid var(--haos-orange);
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.5);
            transition: all 0.2s ease;
        }

        .led-indicator.active {
            background: var(--haos-orange);
            box-shadow: 
                0 0 15px rgba(255, 107, 53, 0.8),
                0 0 25px rgba(255, 107, 53, 0.5),
                inset 0 1px 3px rgba(255, 200, 100, 0.8);
            animation: led-pulse 1s ease-in-out infinite;
        }

        @keyframes led-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Enhanced Sequencer Steps with Velocity */
        .seq-step {
            position: relative;
            background: linear-gradient(145deg, #1a1a1f, #0f0f12);
            border: 2px solid rgba(255, 107, 53, 0.2);
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.5);
        }

        .seq-step::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 0%;
            background: linear-gradient(to top, var(--haos-orange), transparent);
            transition: height 0.2s ease;
            opacity: 0.5;
        }

        .seq-step.active::after {
            height: var(--velocity, 100%);
        }

        .seq-step.playing {
            border-color: var(--haos-cyan) !important;
            box-shadow: 0 0 15px rgba(0, 217, 255, 0.8), inset 0 0 10px rgba(0, 217, 255, 0.3);
            animation: step-pulse 0.1s ease-out;
        }

        @keyframes step-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.15); }
            100% { transform: scale(1); }
        }

        /* Step number overlay for better tracking */
        .seq-step::before {
            content: attr(data-step);
            position: absolute;
            top: 2px;
            left: 2px;
            font-size: 0.5rem;
            font-family: var(--font-mono);
            color: rgba(255, 255, 255, 0.2);
            font-weight: bold;
        }

        .seq-step.active::before {
            color: rgba(255, 255, 255, 0.4);
        }

        .seq-step.active {
            background: linear-gradient(145deg, rgba(255, 107, 53, 0.4), rgba(255, 140, 66, 0.2));
            border-color: var(--haos-orange);
            box-shadow: 
                0 0 15px rgba(255, 107, 53, 0.4),
                inset 0 2px 10px rgba(255, 140, 66, 0.3);
        }

        .seq-step.playing {
            animation: step-glow 0.3s ease-out;
        }

        @keyframes step-glow {
            0% { box-shadow: 0 0 30px rgba(57, 255, 20, 0.8); }
            100% { box-shadow: 0 0 15px rgba(255, 107, 53, 0.4); }
        }

        /* Enhanced VU Meter with Gradient */
        .vu-meter {
            background: linear-gradient(to right, #0a0a0a, #1a1a1f);
            border: 2px solid rgba(255, 107, 53, 0.3);
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.8);
        }

        .vu-bar {
            background: linear-gradient(to right, 
                var(--haos-green) 0%, 
                var(--haos-orange) 70%, 
                var(--haos-pink) 100%);
            box-shadow: 0 0 20px currentColor;
            transition: width 0.1s ease-out, opacity 0.3s ease-out;
        }

        /* Enhanced Transport Buttons */
        .transport-btn {
            position: relative;
            overflow: hidden;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }

        .transport-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 107, 53, 0.4);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .transport-btn:active::before {
            width: 300px;
            height: 300px;
        }

        /* Enhanced Preset Bank Slots */
        .bank-slot {
            position: relative;
            background: linear-gradient(145deg, #1a1a1f, #0f0f12);
            box-shadow: 
                inset 0 2px 8px rgba(0, 0, 0, 0.8),
                0 2px 10px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }

        .bank-slot::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 107, 53, 0.1), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        /* Sequencer Control Buttons */
        .seq-control-btn {
            font-family: var(--font-mono);
            font-size: 0.65rem;
            padding: 6px 12px;
            background: rgba(255, 107, 53, 0.1);
            border: 1px solid var(--haos-orange);
            border-radius: 6px;
            color: var(--haos-orange);
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .seq-control-btn:hover {
            background: rgba(255, 107, 53, 0.2);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(255, 107, 53, 0.3);
        }

        .seq-control-btn:active {
            transform: translateY(0);
        }

        /* Instrument Selection Dropdown */
        .instrument-select {
            font-family: var(--font-mono);
            font-size: 0.65rem;
            padding: 4px 8px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 107, 53, 0.4);
            border-radius: 6px;
            color: var(--haos-orange);
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 120px;
        }

        .instrument-select:hover {
            background: rgba(0, 0, 0, 0.7);
            border-color: var(--haos-orange);
            box-shadow: 0 0 8px rgba(255, 107, 53, 0.4);
        }

        .instrument-select:focus {
            outline: none;
            border-color: var(--haos-orange);
            box-shadow: 0 0 12px rgba(255, 107, 53, 0.6);
        }

        .instrument-select option {
            background: #1a1a1a;
            color: #fff;
            padding: 4px 8px;
        }

        .instrument-select optgroup {
            background: #0a0a0a;
            color: var(--haos-orange);
            font-weight: bold;
            font-size: 0.7rem;
        }

        /* Track Control Buttons */
        .track-btn {
            font-size: 0.75rem;
            width: 24px;
            height: 24px;
            background: rgba(255, 107, 53, 0.1);
            border: 1px solid rgba(255, 107, 53, 0.3);
            border-radius: 4px;
            color: var(--haos-orange);
            cursor: pointer;
            transition: all 0.15s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }

        .track-btn:hover {
            background: rgba(255, 107, 53, 0.25);
            border-color: var(--haos-orange);
            transform: scale(1.1);
        }

        .track-btn:active {
            transform: scale(0.95);
        }

        /* BPM Controls */
        .bpm-control-btn {
            width: 32px;
            height: 32px;
            background: rgba(255, 107, 53, 0.15);
            border: 1px solid var(--haos-orange);
            border-radius: 6px;
            color: var(--haos-orange);
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .bpm-control-btn:hover {
            background: rgba(255, 107, 53, 0.3);
            transform: scale(1.05);
        }

        .bpm-control-btn:active {
            transform: scale(0.95);
        }

        /* Pattern Preset Buttons */
        .pattern-preset-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            background: linear-gradient(145deg, rgba(255,107,53,0.15), rgba(255,140,66,0.08));
            border: 1px solid rgba(255,107,53,0.4);
            border-radius: 8px;
            color: var(--haos-orange);
            font-family: var(--font-mono);
            font-size: 0.7rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .pattern-preset-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,107,53,0.3), transparent);
            transition: left 0.5s ease;
        }

        .pattern-preset-btn:hover::before {
            left: 100%;
        }

        .pattern-preset-btn:hover {
            background: linear-gradient(145deg, rgba(255,107,53,0.25), rgba(255,140,66,0.15));
            border-color: var(--haos-orange);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255,107,53,0.4);
        }

        .pattern-preset-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 6px rgba(255,107,53,0.3);
        }

        .pattern-preset-btn.hiphop {
            background: linear-gradient(145deg, rgba(147,112,219,0.15), rgba(186,85,211,0.08));
            border-color: rgba(147,112,219,0.4);
            color: #BA55D3;
        }

        .pattern-preset-btn.hiphop:hover {
            background: linear-gradient(145deg, rgba(147,112,219,0.25), rgba(186,85,211,0.15));
            border-color: #9370DB;
            box-shadow: 0 4px 12px rgba(147,112,219,0.4);
        }

        .pattern-preset-btn.hiphop::before {
            background: linear-gradient(90deg, transparent, rgba(147,112,219,0.3), transparent);
        }

        .pattern-icon {
            font-size: 1.2rem;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
        }

        .pattern-name {
            flex: 1;
            text-align: left;
            letter-spacing: 0.5px;
        }


        .bank-slot:hover::before,
        .bank-slot.filled::before {
            opacity: 1;
        }

        .bank-slot.active {
            background: linear-gradient(145deg, rgba(255, 107, 53, 0.3), rgba(255, 140, 66, 0.1));
            box-shadow: 
                0 0 25px rgba(255, 107, 53, 0.6),
                inset 0 2px 15px rgba(255, 140, 66, 0.3);
        }

        /* Floating Animation for Icons */
        .module-icon {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        /* Patch Bay Enhanced */
        .patch-bay {
            background: linear-gradient(145deg, rgba(20, 20, 25, 0.9), rgba(10, 10, 15, 0.9));
            border: 2px solid rgba(255, 107, 53, 0.2);
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.8),
                inset 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        .patch-select {
            background: linear-gradient(145deg, #2a2a2f, #1a1a1f);
            border: 2px solid rgba(255, 107, 53, 0.3);
            color: var(--haos-text);
            padding: 8px;
            border-radius: 6px;
            font-family: var(--font-mono);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .patch-select:hover {
            border-color: var(--haos-orange);
            box-shadow: 0 0 15px rgba(255, 107, 53, 0.3);
        }

        .patch-select:focus {
            outline: none;
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.5);
        }

        /* Spectrum Analyzer Enhanced */
        #spectrum-canvas {
            box-shadow: 
                inset 0 4px 15px rgba(0, 0, 0, 0.8),
                0 0 20px rgba(255, 107, 53, 0.2);
            border: 2px solid rgba(255, 107, 53, 0.3);
        }

        /* BPM Display Enhancement */
        .bpm-display {
            background: linear-gradient(145deg, rgba(255, 107, 53, 0.1), rgba(0, 0, 0, 0.8));
            border: 2px solid var(--haos-orange);
            box-shadow: 
                inset 0 2px 10px rgba(0, 0, 0, 0.8),
                0 0 20px rgba(255, 107, 53, 0.3);
            text-shadow: 0 0 10px rgba(255, 107, 53, 0.8);
        }

        /* Scrollbar Enhancement */
        .workspace-column::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--haos-orange), var(--haos-orange-dark));
            box-shadow: 0 0 10px rgba(255, 107, 53, 0.5);
        }

        .workspace-column::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, var(--haos-orange-bright), var(--haos-orange));
        }

        /* ================================================
           MOBILE RESPONSIVE STYLES
           ================================================ */

        /* Tablets and Small Laptops (max-width: 1024px) */
        @media (max-width: 1024px) {
            .haos-header {
                padding: 12px 20px;
            }

            .logo-section img {
                height: 32px;
            }

            .brand-name {
                font-size: 1.3rem;
            }

            .workspace-container {
                padding: 15px;
            }

            .workspace-columns {
                flex-direction: column;
                gap: 20px;
            }

            .workspace-column {
                width: 100%;
                max-height: none;
            }

            .sequencer-grid {
                overflow-x: auto;
                overflow-y: visible;
            }

            .control-knob {
                width: 60px;
                height: 60px;
            }

            .knob-label {
                font-size: 0.65rem;
            }
        }

        /* Mobile Landscape (max-width: 900px) */
        @media (max-width: 900px) {
            .header-content {
                gap: 15px;
            }

            .brand-text {
                gap: 1px;
            }

            .workspace-title {
                font-size: 1.8rem;
            }

            .controls-group {
                flex-wrap: wrap;
                gap: 10px;
            }

            .haos-btn {
                padding: 10px 16px;
                font-size: 0.85rem;
            }

            .module-section h3 {
                font-size: 1.1rem;
            }
        }

        /* Mobile Portrait (max-width: 768px) */
        @media (max-width: 768px) {
            .haos-header {
                padding: 10px 15px;
            }

            .logo-section img {
                height: 28px;
            }

            .brand-name {
                font-size: 1.1rem;
                letter-spacing: 1px;
            }

            .brand-tagline {
                font-size: 0.55rem;
            }

            .workspace-container {
                padding: 10px;
            }

            .workspace-title {
                font-size: 1.5rem;
                text-align: center;
            }

            /* Sequencer Optimization */
            .sequencer-section {
                padding: 12px;
            }

            .track-row {
                margin-bottom: 15px;
            }

            .track-label {
                min-width: 60px;
                font-size: 0.7rem;
                padding: 6px;
            }

            .sequencer-grid {
                gap: 3px;
                grid-template-columns: repeat(16, 1fr);
                padding: 5px;
            }

            .seq-step {
                min-width: 30px;
                min-height: 30px;
                border-width: 1px;
            }

            .seq-step::before {
                font-size: 0.4rem;
            }

            /* Controls Optimization */
            .controls-panel {
                padding: 12px;
            }

            .controls-group {
                gap: 8px;
            }

            .haos-btn {
                padding: 8px 12px;
                font-size: 0.75rem;
                min-width: 80px;
            }

            .haos-btn-lg {
                padding: 10px 16px;
                font-size: 0.85rem;
            }

            /* Knobs Optimization */
            .knobs-grid {
                grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
                gap: 12px;
            }

            .control-knob {
                width: 55px;
                height: 55px;
            }

            .knob-value {
                font-size: 0.5rem;
            }

            .knob-label {
                font-size: 0.6rem;
            }

            /* Sliders */
            .slider-container {
                gap: 6px;
            }

            .slider-label {
                font-size: 0.7rem;
            }

            input[type="range"] {
                height: 4px;
            }

            .slider-value {
                font-size: 0.7rem;
                min-width: 35px;
            }

            /* Module Sections */
            .module-section {
                padding: 12px;
            }

            .module-section h3 {
                font-size: 1rem;
                margin-bottom: 10px;
            }

            /* Test Sound Buttons */
            .test-sound-btn {
                padding: 6px 10px;
                font-size: 0.7rem;
            }

            /* Instrument Dropdowns */
            select {
                padding: 6px;
                font-size: 0.7rem;
            }

            /* Pattern Presets */
            .pattern-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 8px;
            }

            .pattern-btn {
                padding: 10px;
                font-size: 0.75rem;
            }

            /* VU Meters */
            .vu-meter {
                height: 6px;
            }
        }

        /* Small Mobile (max-width: 480px) */
        @media (max-width: 480px) {
            .haos-header {
                padding: 8px 10px;
            }

            .logo-section {
                gap: 8px;
            }

            .logo-section img {
                height: 24px;
            }

            .brand-name {
                font-size: 0.95rem;
            }

            .brand-tagline {
                display: none; /* Hide tagline on very small screens */
            }

            .workspace-container {
                padding: 8px;
            }

            .workspace-title {
                font-size: 1.2rem;
            }

            /* Ultra-compact Sequencer */
            .track-row {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
                margin-bottom: 12px;
            }

            .track-label {
                width: 100%;
                min-width: auto;
                text-align: center;
                padding: 8px;
                font-size: 0.75rem;
            }

            .sequencer-grid {
                gap: 2px;
                padding: 4px;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .seq-step {
                min-width: 25px;
                min-height: 25px;
            }

            .seq-step::before {
                display: none; /* Hide step numbers on very small screens */
            }

            /* Touch-friendly buttons */
            .haos-btn {
                min-height: 44px; /* iOS touch target minimum */
                padding: 10px 14px;
                font-size: 0.7rem;
            }

            .controls-group {
                flex-direction: column;
                align-items: stretch;
            }

            .haos-btn {
                width: 100%;
            }

            /* Compact knobs */
            .knobs-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 8px;
            }

            .control-knob {
                width: 50px;
                height: 50px;
            }

            .knob-label {
                font-size: 0.55rem;
            }

            .knob-value {
                font-size: 0.45rem;
            }

            /* Compact sections */
            .module-section {
                padding: 10px;
            }

            .module-section h3 {
                font-size: 0.9rem;
                margin-bottom: 8px;
            }

            /* Instrument selection */
            .instrument-selector {
                flex-direction: column;
                gap: 6px;
            }

            .instrument-selector label {
                font-size: 0.65rem;
            }

            .instrument-selector select {
                width: 100%;
                font-size: 0.65rem;
                padding: 8px;
                min-height: 44px; /* Touch-friendly */
            }

            /* Test sound buttons */
            .test-sound-btn {
                width: 100%;
                min-height: 44px;
                padding: 10px;
                font-size: 0.7rem;
            }

            /* Pattern presets */
            .pattern-grid {
                grid-template-columns: 1fr;
                gap: 6px;
            }

            .pattern-btn {
                min-height: 44px;
                padding: 12px;
                font-size: 0.75rem;
            }

            /* BPM control */
            .bpm-container {
                flex-direction: column;
                gap: 8px;
            }

            .bpm-display {
                padding: 12px;
                font-size: 1.2rem;
            }

            /* Sliders full width */
            .slider-container {
                flex-direction: column;
                gap: 4px;
            }

            input[type="range"] {
                width: 100%;
            }
        }

        /* Landscape Mobile Optimization (max-height: 500px) */
        @media (max-height: 500px) and (orientation: landscape) {
            .haos-header {
                position: relative; /* Allow scrolling past header */
                padding: 6px 10px;
            }

            .logo-section img {
                height: 22px;
            }

            .brand-name {
                font-size: 0.9rem;
            }

            .workspace-title {
                font-size: 1.1rem;
                margin-bottom: 8px;
            }

            .sequencer-section {
                padding: 8px;
            }

            .track-row {
                margin-bottom: 8px;
            }

            .seq-step {
                min-height: 22px;
            }

            .module-section {
                padding: 8px;
            }

            .module-section h3 {
                font-size: 0.85rem;
                margin-bottom: 6px;
            }

            .control-knob {
                width: 45px;
                height: 45px;
            }
        }

        /* High DPI / Retina Displays */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .seq-step {
                border-width: 1.5px;
            }

            .control-knob {
                border-width: 2.5px;
            }

            .haos-btn {
                border-width: 1.5px;
            }
        }

        /* Dark Mode Override (if device prefers dark) */
        @media (prefers-color-scheme: dark) {
            /* Already dark by default, but ensure consistency */
            body {
                background: var(--haos-black);
                color: var(--haos-text);
            }
        }

        /* Reduced Motion */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }

            .led-indicator.active,
            .seq-step.playing,
            .module-icon {
                animation: none !important;
            }
        }

        /* Print Styles (for documentation) */
        @media print {
            .haos-header,
            .controls-panel,
            .test-sound-btn {
                display: none;
            }

            body {
                background: white;
                color: black;
            }

            .sequencer-section {
                break-inside: avoid;
            }
        }

        /* Touch Device Optimizations */
        @media (hover: none) and (pointer: coarse) {
            /* Larger touch targets */
            .seq-step {
                min-width: 35px;
                min-height: 35px;
            }

            .haos-btn {
                min-height: 44px;
                min-width: 44px;
            }

            .control-knob {
                min-width: 60px;
                min-height: 60px;
            }

            /* Remove hover effects on touch devices */
            .seq-step:hover,
            .haos-btn:hover,
            .control-knob:hover {
                transform: none;
            }

            /* Add active/pressed states for touch */
            .seq-step:active {
                transform: scale(0.95);
            }

            .haos-btn:active {
                transform: scale(0.98);
            }

            /* Improve scrolling on touch */
            .sequencer-grid,
            .workspace-column {
                -webkit-overflow-scrolling: touch;
                scroll-behavior: smooth;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="haos-header">
        <div class="header-content">
            <a href="/" class="logo-section" style="text-decoration: none; cursor: pointer;">
                <img src="/images/haos-logo-white.png" alt="HAOS.fm Logo">
                <div class="brand-text">
                    <div class="brand-name">TECHNO WORKSPACE</div>
                    <div class="brand-tagline">Live Modular System</div>
                </div>
            </a>
            
            <div class="transport">
                <button class="back-btn" onclick="window.location.href='/haos-platform.html'">
                    ‚Üê BACK TO HUB
                </button>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <div class="led-indicator" id="play-led" title="Playback Status"></div>
                    <button id="play-btn" class="transport-btn">‚ñ∂ PLAY</button>
                </div>
                <button id="stop-btn" class="transport-btn">‚ñ† STOP</button>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <div class="led-indicator" id="record-led" title="Recording Status"></div>
                    <button id="record-btn" class="transport-btn" title="Record Audio">‚è∫ RECORD</button>
                </div>
                <button id="export-midi-btn" class="transport-btn" title="Export as MIDI">üíæ MIDI</button>
                <button id="export-project-btn" class="transport-btn" title="Export Project">üì¶ PROJECT</button>
                <div class="bpm-display" style="display: flex; align-items: center; gap: 6px;">
                    <button id="bpm-down" class="bpm-control-btn" title="Decrease BPM">‚àí</button>
                    <div style="text-align: center;">
                        <span id="bpm-value">135</span> BPM
                    </div>
                    <button id="bpm-up" class="bpm-control-btn" title="Increase BPM">+</button>
                </div>
                <div style="font-family: var(--font-mono); font-size: 0.6rem; color: var(--haos-dim); padding: 5px 10px; border: 1px solid var(--haos-border); border-radius: 6px;">
                    ‚å®Ô∏è Press SPACE to play/stop
                </div>
            </div>
        </div>
    </header>

    <!-- Main Workspace -->
    <div class="workspace">
        <!-- LEFT COLUMN: Sound Sources -->
        <div class="workspace-column">
            <!-- TB-303 Bass Synth -->
            <div class="module-panel">
                <div class="module-header">
                    <div class="module-title">TB-303 BASS</div>
                    <div class="module-icon">üß™</div>
                </div>
                
                <div class="knob-grid">
                    <div class="knob-wrapper">
                        <div class="knob" id="tb303-cutoff" data-param="tb303-cutoff" data-value="0.5"></div>
                        <div class="knob-label">CUTOFF</div>
                        <div class="knob-value">2025 Hz</div>
                    </div>
                    <div class="knob-wrapper">
                        <div class="knob" id="tb303-resonance" data-param="tb303-resonance" data-value="0.5"></div>
                        <div class="knob-label">RESONANCE</div>
                        <div class="knob-value">15</div>
                    </div>
                    <div class="knob-wrapper">
                        <div class="knob" id="tb303-envmod" data-param="tb303-envmod" data-value="0.5"></div>
                        <div class="knob-label">ENV MOD</div>
                        <div class="knob-value">50%</div>
                    </div>
                    <div class="knob-wrapper">
                        <div class="knob" id="tb303-decay" data-param="tb303-decay" data-value="0.5"></div>
                        <div class="knob-label">DECAY</div>
                        <div class="knob-value">1.0s</div>
                    </div>
                    <div class="knob-wrapper">
                        <div class="knob" id="tb303-dist" data-param="tb303-distortion" data-value="0.3"></div>
                        <div class="knob-label">DISTORTION</div>
                        <div class="knob-value">30%</div>
                    </div>
                    <div class="knob-wrapper">
                        <div class="knob" id="tb303-accent" data-param="tb303-accent" data-value="0.7"></div>
                        <div class="knob-label">ACCENT</div>
                        <div class="knob-value">70%</div>
                    </div>
                </div>

                <!-- Test Sound Buttons -->
                <div class="preset-controls" style="margin-top: 15px;">
                    <button id="tb303-test" class="preset-btn preset-btn-a" style="width: 100%;">üéµ TEST SOUND</button>
                </div>

                <!-- Preset Morphing -->
                <div class="morph-slider-container">
                    <div class="morph-label">
                        <span id="preset-a-name">PRESET A: Empty</span>
                        <span id="preset-b-name">PRESET B: Empty</span>
                    </div>
                    <input type="range" id="morph-slider" class="morph-slider" min="0" max="1" step="0.01" value="0">
                    <div id="morph-display" class="morph-display">100% A | 0% B</div>
                </div>

                <!-- Preset Controls -->
                <div class="preset-controls">
                    <div class="preset-column">
                        <button id="capture-a" class="preset-btn preset-btn-a">üì∏ CAPTURE A</button>
                        <button id="recall-a" class="preset-btn preset-btn-a">‚ñ∂ RECALL A</button>
                    </div>
                    <div class="preset-column">
                        <button id="crossfade-a" class="preset-btn preset-btn-morph">‚Üê A</button>
                        <button id="swap-ab" class="preset-btn preset-btn-morph">‚áÑ SWAP</button>
                        <button id="crossfade-b" class="preset-btn preset-btn-morph">B ‚Üí</button>
                    </div>
                    <div class="preset-column">
                        <button id="capture-b" class="preset-btn preset-btn-b">üì∏ CAPTURE B</button>
                        <button id="recall-b" class="preset-btn preset-btn-b">‚ñ∂ RECALL B</button>
                    </div>
                </div>

                <!-- Preset Bank -->
                <div class="preset-bank">
                    <div class="bank-header">TB-303 PRESET BANK</div>
                    <div class="bank-slots">
                        <button class="bank-slot" data-slot="1" data-preset="acid">üß™ Acid</button>
                        <button class="bank-slot" data-slot="2" data-preset="squelch">üí¶ Squelch</button>
                        <button class="bank-slot" data-slot="3" data-preset="deep">üåä Deep</button>
                        <button class="bank-slot" data-slot="4" data-preset="screamer">üò± Scream</button>
                        <button class="bank-slot" data-slot="5" data-preset="liquid">üíß Liquid</button>
                        <button class="bank-slot" data-slot="6" data-preset="wobble">üåÄ Wobble</button>
                        <button class="bank-slot" data-slot="7" data-preset="sub">üîä Sub</button>
                        <button class="bank-slot" data-slot="8" data-preset="rumble">üí• Rumble</button>
                    </div>
                    <div class="bank-actions">
                        <button id="load-303-preset" class="bank-action-btn">‚ñ∂ LOAD & PLAY</button>
                    </div>
                </div>
            </div>

            <!-- TR-909 Drums -->
            <div class="module-panel">
                <div class="module-header">
                    <div class="module-title">TR-909 DRUMS</div>
                    <div class="module-icon">ü•Å</div>
                </div>
                
                <div class="knob-grid">
                    <div class="knob-wrapper">
                        <div class="knob" data-param="kick-tune" data-value="0.5"></div>
                        <div class="knob-label">KICK TUNE</div>
                        <div class="knob-value">0</div>
                    </div>
                    <div class="knob-wrapper">
                        <div class="knob" data-param="kick-decay" data-value="0.5"></div>
                        <div class="knob-label">KICK DECAY</div>
                        <div class="knob-value">0.5s</div>
                    </div>
                    <div class="knob-wrapper">
                        <div class="knob" data-param="snare-snap" data-value="0.7"></div>
                        <div class="knob-label">SNARE SNAP</div>
                        <div class="knob-value">70%</div>
                    </div>
                </div>

                <!-- VU Meter -->
                <div class="vu-meter">
                    <div class="vu-bar" id="drum-vu"></div>
                </div>

                <!-- Test Drum Buttons -->
                <div class="preset-controls" style="margin-top: 15px; gap: 8px;">
                    <button id="test-kick" class="preset-btn preset-btn-a" style="flex: 1;">ü•Å KICK</button>
                    <button id="test-snare" class="preset-btn preset-btn-b" style="flex: 1;">üéµ SNARE</button>
                    <button id="test-hihat" class="preset-btn preset-btn-morph" style="flex: 1;">üîî HI-HAT</button>
                </div>
            </div>
        </div>

        <!-- CENTER COLUMN: Patch Bay + Sequencer -->
        <div class="workspace-column">
            <!-- Patch Bay -->
            <div class="module-panel">
                <div class="module-header">
                    <div class="module-title">LIVE PATCH BAY</div>
                    <div class="module-icon">üîå</div>
                </div>
                
                <div class="patch-bay">
                    <div class="patch-point">
                        <div class="patch-label">TB-303 OUT ‚Üí</div>
                        <select class="patch-select">
                            <option>DELAY</option>
                            <option>REVERB</option>
                            <option>DISTORTION</option>
                            <option selected>MASTER</option>
                        </select>
                    </div>
                    <div class="patch-point">
                        <div class="patch-label">TR-909 OUT ‚Üí</div>
                        <select class="patch-select">
                            <option>DELAY</option>
                            <option>REVERB</option>
                            <option selected>COMPRESSOR</option>
                        </select>
                    </div>
                    <div class="patch-point">
                        <div class="patch-label">LFO 1 ‚Üí</div>
                        <select class="patch-select">
                            <option selected>TB-303 CUTOFF</option>
                            <option>TB-303 RESONANCE</option>
                            <option>DELAY TIME</option>
                        </select>
                    </div>
                    <div class="patch-point">
                        <div class="patch-label">SEQUENCER ‚Üí</div>
                        <select class="patch-select">
                            <option selected>TB-303 + TR-909</option>
                            <option>TB-303 ONLY</option>
                            <option>TR-909 ONLY</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- 16-Step Sequencer -->
            <div class="module-panel">
                <div class="module-header">
                    <div class="module-title">16-STEP SEQUENCER</div>
                    <div class="module-icon">‚è±Ô∏è</div>
                </div>
                
                <!-- Sequencer Controls -->
                <div style="display: flex; gap: 8px; margin-bottom: 12px; align-items: center;">
                    <button id="seq-length-btn" class="seq-control-btn" title="Toggle 8/16 steps">16 STEPS</button>
                    <button id="swing-btn" class="seq-control-btn" title="Toggle swing (0%, 33%, 66%)">SWING: 0%</button>
                    <button id="save-pattern-btn" class="seq-control-btn" style="background: rgba(57,255,20,0.2); border-color: #39FF14; color: #39FF14;">üíæ SAVE</button>
                    <button id="load-pattern-btn" class="seq-control-btn" style="background: rgba(0,217,255,0.2); border-color: #00D9FF; color: #00D9FF;">üìÇ LOAD</button>
                </div>
                
                <!-- KICK Track -->
                <div style="margin-bottom: 8px;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div class="track-label">KICK</div>
                            <select id="instrument-kick" class="instrument-select" onchange="changeInstrument('kick', this.value)">
                                <optgroup label="ü•Å DRUMS">
                                    <option value="kick" selected>Kick Drum</option>
                                    <option value="perc_snare">Snare (ARP)</option>
                                    <option value="perc_hihat">Hi-Hat (ARP)</option>
                                </optgroup>
                                <optgroup label="üéπ PIANO">
                                    <option value="piano_bright">Bright Piano</option>
                                    <option value="piano_electric">Electric Piano</option>
                                    <option value="piano_soft">Soft Piano</option>
                                </optgroup>
                                <optgroup label="üéª STRINGS">
                                    <option value="strings_ensemble">String Ensemble</option>
                                    <option value="strings_lush">Lush Strings</option>
                                    <option value="strings_staccato">Staccato Strings</option>
                                    <option value="violin_solo">Solo Violin</option>
                                    <option value="violin_tremolo">Tremolo Violin</option>
                                    <option value="cello_warm">Warm Cello</option>
                                </optgroup>
                                <optgroup label="üé∫ BRASS & WINDS">
                                    <option value="brass_section">Brass Section</option>
                                    <option value="brass_stab">Brass Stab</option>
                                    <option value="flute_breathy">Breathy Flute</option>
                                </optgroup>
                                <optgroup label="ÔøΩ ORGAN">
                                    <option value="organ_hammond">Hammond Organ</option>
                                    <option value="organ_church">Church Organ</option>
                                </optgroup>
                                <optgroup label="üåä PADS">
                                    <option value="pad_warm">Warm Pad</option>
                                    <option value="pad_dark">Dark Atmosphere</option>
                                    <option value="pad_shimmer">Shimmer Pad</option>
                                    <option value="pad_sweeping">Sweeping Pad</option>
                                    <option value="pad_ethereal">Ethereal Pad</option>
                                    <option value="pad_analog">Analog Pad</option>
                                </optgroup>
                                <optgroup label="üé∏ BASS">
                                    <option value="bass_fat">Fat Bass</option>
                                    <option value="bass_sub">Sub 808</option>
                                    <option value="bass_acid">Acid 303</option>
                                    <option value="bass_reese">Reese Bass</option>
                                    <option value="bass_wobble">Wobble Bass</option>
                                </optgroup>
                                <optgroup label="üéµ LEAD">
                                    <option value="lead_vintage">Vintage Lead</option>
                                    <option value="lead_bright">Bright Arp</option>
                                </optgroup>
                                <optgroup label="‚ú® FX">
                                    <option value="fx_space">Space FX</option>
                                    <option value="fx_phaser">Phaser Swirl</option>
                                    <option value="fx_riser">Riser FX</option>
                                    <option value="fx_sweep">Filter Sweep</option>
                                    <option value="fx_laser">Laser Zap</option>
                                </optgroup>
                            </select>
                        </div>
                        <div style="display: flex; gap: 4px;">
                            <button class="track-btn" onclick="randomizePattern('kick')" title="Randomize">üé≤</button>
                            <button class="track-btn" onclick="shiftPattern('kick', -1)" title="Shift left">‚Üê</button>
                            <button class="track-btn" onclick="shiftPattern('kick', 1)" title="Shift right">‚Üí</button>
                            <button class="track-btn" onclick="clearPattern('kick')" title="Clear">üóëÔ∏è</button>
                        </div>
                    </div>
                    <div class="sequencer-grid" id="seq-kick">
                        <!-- 16 steps will be generated by JS -->
                    </div>
                </div>

                <!-- SNARE Track -->
                <div style="margin-bottom: 8px;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div class="track-label">SNARE</div>
                            <select id="instrument-snare" class="instrument-select" onchange="changeInstrument('snare', this.value)">
                                <optgroup label="ü•Å DRUMS">
                                    <option value="snare" selected>Snare Drum</option>
                                    <option value="perc_snare">Snare (ARP)</option>
                                    <option value="perc_hihat">Hi-Hat (ARP)</option>
                                </optgroup>
                                <optgroup label="üéπ PIANO">
                                    <option value="piano_bright">Bright Piano</option>
                                    <option value="piano_electric">Electric Piano</option>
                                    <option value="piano_soft">Soft Piano</option>
                                </optgroup>
                                <optgroup label="üéª STRINGS">
                                    <option value="strings_ensemble">String Ensemble</option>
                                    <option value="strings_lush">Lush Strings</option>
                                    <option value="strings_staccato">Staccato Strings</option>
                                    <option value="violin_solo">Solo Violin</option>
                                    <option value="violin_tremolo">Tremolo Violin</option>
                                    <option value="cello_warm">Warm Cello</option>
                                </optgroup>
                                <optgroup label="üé∫ BRASS & WINDS">
                                    <option value="brass_section">Brass Section</option>
                                    <option value="brass_stab">Brass Stab</option>
                                    <option value="flute_breathy">Breathy Flute</option>
                                </optgroup>
                                <optgroup label="ÔøΩ ORGAN">
                                    <option value="organ_hammond">Hammond Organ</option>
                                    <option value="organ_church">Church Organ</option>
                                </optgroup>
                                <optgroup label="üåä PADS">
                                    <option value="pad_warm">Warm Pad</option>
                                    <option value="pad_dark">Dark Atmosphere</option>
                                    <option value="pad_shimmer">Shimmer Pad</option>
                                    <option value="pad_sweeping">Sweeping Pad</option>
                                    <option value="pad_ethereal">Ethereal Pad</option>
                                    <option value="pad_analog">Analog Pad</option>
                                </optgroup>
                                <optgroup label="üé∏ BASS">
                                    <option value="bass_fat">Fat Bass</option>
                                    <option value="bass_sub">Sub 808</option>
                                    <option value="bass_acid">Acid 303</option>
                                    <option value="bass_reese">Reese Bass</option>
                                    <option value="bass_wobble">Wobble Bass</option>
                                </optgroup>
                                <optgroup label="üéµ LEAD">
                                    <option value="lead_vintage">Vintage Lead</option>
                                    <option value="lead_bright">Bright Arp</option>
                                </optgroup>
                                <optgroup label="‚ú® FX">
                                    <option value="fx_space">Space FX</option>
                                    <option value="fx_phaser">Phaser Swirl</option>
                                    <option value="fx_riser">Riser FX</option>
                                    <option value="fx_sweep">Filter Sweep</option>
                                    <option value="fx_laser">Laser Zap</option>
                                </optgroup>
                            </select>
                        </div>
                        <div style="display: flex; gap: 4px;">
                            <button class="track-btn" onclick="randomizePattern('snare')" title="Randomize">üé≤</button>
                            <button class="track-btn" onclick="shiftPattern('snare', -1)" title="Shift left">‚Üê</button>
                            <button class="track-btn" onclick="shiftPattern('snare', 1)" title="Shift right">‚Üí</button>
                            <button class="track-btn" onclick="clearPattern('snare')" title="Clear">üóëÔ∏è</button>
                        </div>
                    </div>
                    <div class="sequencer-grid" id="seq-snare">
                        <!-- 16 steps -->
                    </div>
                </div>

                <!-- HI-HAT Track -->
                <div style="margin-bottom: 8px;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div class="track-label">HI-HAT</div>
                            <select id="instrument-hihat" class="instrument-select" onchange="changeInstrument('hihat', this.value)">
                                <optgroup label="ü•Å DRUMS">
                                    <option value="hihat" selected>Hi-Hat</option>
                                    <option value="perc_hihat">Hi-Hat (ARP)</option>
                                    <option value="perc_snare">Snare (ARP)</option>
                                </optgroup>
                                <optgroup label="üéπ PIANO">
                                    <option value="piano_bright">Bright Piano</option>
                                    <option value="piano_electric">Electric Piano</option>
                                    <option value="piano_soft">Soft Piano</option>
                                </optgroup>
                                <optgroup label="üéª STRINGS">
                                    <option value="strings_ensemble">String Ensemble</option>
                                    <option value="strings_lush">Lush Strings</option>
                                    <option value="strings_staccato">Staccato Strings</option>
                                    <option value="violin_solo">Solo Violin</option>
                                    <option value="violin_tremolo">Tremolo Violin</option>
                                    <option value="cello_warm">Warm Cello</option>
                                </optgroup>
                                <optgroup label="üé∫ BRASS & WINDS">
                                    <option value="brass_section">Brass Section</option>
                                    <option value="brass_stab">Brass Stab</option>
                                    <option value="flute_breathy">Breathy Flute</option>
                                </optgroup>
                                <optgroup label="ÔøΩ ORGAN">
                                    <option value="organ_hammond">Hammond Organ</option>
                                    <option value="organ_church">Church Organ</option>
                                </optgroup>
                                <optgroup label="üåä PADS">
                                    <option value="pad_warm">Warm Pad</option>
                                    <option value="pad_dark">Dark Atmosphere</option>
                                    <option value="pad_shimmer">Shimmer Pad</option>
                                    <option value="pad_sweeping">Sweeping Pad</option>
                                    <option value="pad_ethereal">Ethereal Pad</option>
                                    <option value="pad_analog">Analog Pad</option>
                                </optgroup>
                                <optgroup label="üé∏ BASS">
                                    <option value="bass_fat">Fat Bass</option>
                                    <option value="bass_sub">Sub 808</option>
                                    <option value="bass_acid">Acid 303</option>
                                    <option value="bass_reese">Reese Bass</option>
                                    <option value="bass_wobble">Wobble Bass</option>
                                </optgroup>
                                <optgroup label="üéµ LEAD">
                                    <option value="lead_vintage">Vintage Lead</option>
                                    <option value="lead_bright">Bright Arp</option>
                                </optgroup>
                                <optgroup label="‚ú® FX">
                                    <option value="fx_space">Space FX</option>
                                    <option value="fx_phaser">Phaser Swirl</option>
                                    <option value="fx_riser">Riser FX</option>
                                    <option value="fx_sweep">Filter Sweep</option>
                                    <option value="fx_laser">Laser Zap</option>
                                </optgroup>
                            </select>
                        </div>
                        <div style="display: flex; gap: 4px;">
                            <button class="track-btn" onclick="randomizePattern('hihat')" title="Randomize">üé≤</button>
                            <button class="track-btn" onclick="shiftPattern('hihat', -1)" title="Shift left">‚Üê</button>
                            <button class="track-btn" onclick="shiftPattern('hihat', 1)" title="Shift right">‚Üí</button>
                            <button class="track-btn" onclick="clearPattern('hihat')" title="Clear">üóëÔ∏è</button>
                        </div>
                    </div>
                    <div class="sequencer-grid" id="seq-hihat">
                        <!-- 16 steps -->
                    </div>
                </div>

                <!-- BASS Track -->
                <div style="margin-bottom: 8px;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div class="track-label">BASS</div>
                            <select id="instrument-bass" class="instrument-select" onchange="changeInstrument('bass', this.value)">
                                <optgroup label="üéπ BASS">
                                    <option value="bass" selected>Bass Synth</option>
                                    <option value="bass_fat">Fat Bass</option>
                                    <option value="bass_sub">Sub 808</option>
                                    <option value="bass_acid">Acid 303</option>
                                    <option value="bass_reese">Reese Bass</option>
                                    <option value="bass_wobble">Wobble Bass</option>
                                </optgroup>
                                <optgroup label="ü•Å DRUMS">
                                    <option value="kick">Kick Drum</option>
                                    <option value="perc_snare">Snare (ARP)</option>
                                    <option value="perc_hihat">Hi-Hat (ARP)</option>
                                </optgroup>
                                <optgroup label="ÔøΩ PIANO">
                                    <option value="piano_bright">Bright Piano</option>
                                    <option value="piano_electric">Electric Piano</option>
                                    <option value="piano_soft">Soft Piano</option>
                                </optgroup>
                                <optgroup label="üéª STRINGS">
                                    <option value="strings_ensemble">String Ensemble</option>
                                    <option value="strings_lush">Lush Strings</option>
                                    <option value="strings_staccato">Staccato Strings</option>
                                    <option value="violin_solo">Solo Violin</option>
                                    <option value="violin_tremolo">Tremolo Violin</option>
                                    <option value="cello_warm">Warm Cello</option>
                                </optgroup>
                                <optgroup label="üé∫ BRASS & WINDS">
                                    <option value="brass_section">Brass Section</option>
                                    <option value="brass_stab">Brass Stab</option>
                                    <option value="flute_breathy">Breathy Flute</option>
                                </optgroup>
                                <optgroup label="üéπ ORGAN">
                                    <option value="organ_hammond">Hammond Organ</option>
                                    <option value="organ_church">Church Organ</option>
                                </optgroup>
                                <optgroup label="üåä PADS">
                                    <option value="pad_warm">Warm Pad</option>
                                    <option value="pad_dark">Dark Atmosphere</option>
                                    <option value="pad_shimmer">Shimmer Pad</option>
                                    <option value="pad_sweeping">Sweeping Pad</option>
                                    <option value="pad_ethereal">Ethereal Pad</option>
                                    <option value="pad_analog">Analog Pad</option>
                                </optgroup>
                                <optgroup label="üéµ LEAD">
                                    <option value="lead_vintage">Vintage Lead</option>
                                    <option value="lead_bright">Bright Arp</option>
                                </optgroup>
                                <optgroup label="‚ú® FX">
                                    <option value="fx_space">Space FX</option>
                                    <option value="fx_phaser">Phaser Swirl</option>
                                    <option value="fx_riser">Riser FX</option>
                                    <option value="fx_sweep">Filter Sweep</option>
                                    <option value="fx_laser">Laser Zap</option>
                                </optgroup>
                            </select>
                        </div>
                        <div style="display: flex; gap: 4px;">
                            <button class="track-btn" onclick="randomizePattern('bass')" title="Randomize">üé≤</button>
                            <button class="track-btn" onclick="shiftPattern('bass', -1)" title="Shift left">‚Üê</button>
                            <button class="track-btn" onclick="shiftPattern('bass', 1)" title="Shift right">‚Üí</button>
                            <button class="track-btn" onclick="clearPattern('bass')" title="Clear">üóëÔ∏è</button>
                        </div>
                    </div>
                    <div class="sequencer-grid" id="seq-bass">
                        <!-- 16 steps -->
                    </div>
                </div>

                <!-- PIANO/KEYS Track -->
                <div style="margin-bottom: 8px;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div class="track-label">KEYS</div>
                            <select id="instrument-keys" class="instrument-select" onchange="changeInstrument('keys', this.value)">
                                <optgroup label="üéπ PIANO">
                                    <option value="piano_bright" selected>Bright Piano</option>
                                    <option value="piano_electric">Electric Piano</option>
                                    <option value="piano_soft">Soft Piano</option>
                                </optgroup>
                                <optgroup label="üéπ ORGAN">
                                    <option value="organ_hammond">Hammond Organ</option>
                                    <option value="organ_church">Church Organ</option>
                                </optgroup>
                                <optgroup label="üéª STRINGS">
                                    <option value="strings_ensemble">String Ensemble</option>
                                    <option value="strings_lush">Lush Strings</option>
                                    <option value="strings_staccato">Staccato Strings</option>
                                    <option value="violin_solo">Solo Violin</option>
                                    <option value="violin_tremolo">Tremolo Violin</option>
                                    <option value="cello_warm">Warm Cello</option>
                                </optgroup>
                                <optgroup label="üé∫ BRASS & WINDS">
                                    <option value="brass_section">Brass Section</option>
                                    <option value="brass_stab">Brass Stab</option>
                                    <option value="flute_breathy">Breathy Flute</option>
                                </optgroup>
                                <optgroup label="üåä PADS">
                                    <option value="pad_warm">Warm Pad</option>
                                    <option value="pad_dark">Dark Atmosphere</option>
                                    <option value="pad_shimmer">Shimmer Pad</option>
                                    <option value="pad_sweeping">Sweeping Pad</option>
                                    <option value="pad_ethereal">Ethereal Pad</option>
                                    <option value="pad_analog">Analog Pad</option>
                                </optgroup>
                            </select>
                        </div>
                        <div style="display: flex; gap: 4px;">
                            <button class="track-btn" onclick="randomizePattern('keys')" title="Randomize">üé≤</button>
                            <button class="track-btn" onclick="shiftPattern('keys', -1)" title="Shift left">‚Üê</button>
                            <button class="track-btn" onclick="shiftPattern('keys', 1)" title="Shift right">‚Üí</button>
                            <button class="track-btn" onclick="clearPattern('keys')" title="Clear">üóëÔ∏è</button>
                        </div>
                    </div>
                    <div class="sequencer-grid" id="seq-keys">
                        <!-- 16 steps -->
                    </div>
                </div>

                <!-- LEAD Track -->
                <div style="margin-bottom: 8px;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div class="track-label">LEAD</div>
                            <select id="instrument-lead" class="instrument-select" onchange="changeInstrument('lead', this.value)">
                                <optgroup label="üéµ LEAD">
                                    <option value="lead_vintage" selected>Vintage Lead</option>
                                    <option value="lead_bright">Bright Arp</option>
                                </optgroup>
                                <optgroup label="üé∏ BASS">
                                    <option value="bass_fat">Fat Bass</option>
                                    <option value="bass_sub">Sub 808</option>
                                    <option value="bass_acid">Acid 303</option>
                                    <option value="bass_reese">Reese Bass</option>
                                    <option value="bass_wobble">Wobble Bass</option>
                                </optgroup>
                                <optgroup label="üéπ PIANO">
                                    <option value="piano_bright">Bright Piano</option>
                                    <option value="piano_electric">Electric Piano</option>
                                    <option value="piano_soft">Soft Piano</option>
                                </optgroup>
                                <optgroup label="üé∫ BRASS & WINDS">
                                    <option value="brass_section">Brass Section</option>
                                    <option value="brass_stab">Brass Stab</option>
                                    <option value="flute_breathy">Breathy Flute</option>
                                </optgroup>
                            </select>
                        </div>
                        <div style="display: flex; gap: 4px;">
                            <button class="track-btn" onclick="randomizePattern('lead')" title="Randomize">üé≤</button>
                            <button class="track-btn" onclick="shiftPattern('lead', -1)" title="Shift left">‚Üê</button>
                            <button class="track-btn" onclick="shiftPattern('lead', 1)" title="Shift right">‚Üí</button>
                            <button class="track-btn" onclick="clearPattern('lead')" title="Clear">üóëÔ∏è</button>
                        </div>
                    </div>
                    <div class="sequencer-grid" id="seq-lead">
                        <!-- 16 steps -->
                    </div>
                </div>

                <!-- FX Track -->
                <div style="margin-bottom: 8px;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div class="track-label">FX</div>
                            <select id="instrument-fx" class="instrument-select" onchange="changeInstrument('fx', this.value)">
                                <optgroup label="‚ú® FX">
                                    <option value="fx_space" selected>Space FX</option>
                                    <option value="fx_phaser">Phaser Swirl</option>
                                    <option value="fx_riser">Riser FX</option>
                                    <option value="fx_sweep">Filter Sweep</option>
                                    <option value="fx_laser">Laser Zap</option>
                                </optgroup>
                                <optgroup label="ü•Å PERCUSSION">
                                    <option value="perc_snare">Snare (ARP)</option>
                                    <option value="perc_hihat">Hi-Hat (ARP)</option>
                                </optgroup>
                            </select>
                        </div>
                        <div style="display: flex; gap: 4px;">
                            <button class="track-btn" onclick="randomizePattern('fx')" title="Randomize">üé≤</button>
                            <button class="track-btn" onclick="shiftPattern('fx', -1)" title="Shift left">‚Üê</button>
                            <button class="track-btn" onclick="shiftPattern('fx', 1)" title="Shift right">‚Üí</button>
                            <button class="track-btn" onclick="clearPattern('fx')" title="Clear">üóëÔ∏è</button>
                        </div>
                    </div>
                    <div class="sequencer-grid" id="seq-fx">
                        <!-- 16 steps -->
                    </div>
                </div>

                <!-- PERC Track -->
                <div style="margin-bottom: 8px;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div class="track-label">PERC</div>
                            <select id="instrument-perc" class="instrument-select" onchange="changeInstrument('perc', this.value)">
                                <optgroup label="ü•Å PERCUSSION">
                                    <option value="perc_snare" selected>Snare (ARP)</option>
                                    <option value="perc_hihat">Hi-Hat (ARP)</option>
                                </optgroup>
                                <optgroup label="ü•Å DRUMS">
                                    <option value="kick">Kick Drum</option>
                                    <option value="snare">Snare Drum</option>
                                    <option value="hihat">Hi-Hat</option>
                                </optgroup>
                                <optgroup label="‚ú® FX">
                                    <option value="fx_space">Space FX</option>
                                    <option value="fx_phaser">Phaser Swirl</option>
                                    <option value="fx_riser">Riser FX</option>
                                    <option value="fx_sweep">Filter Sweep</option>
                                    <option value="fx_laser">Laser Zap</option>
                                </optgroup>
                            </select>
                        </div>
                        <div style="display: flex; gap: 4px;">
                            <button class="track-btn" onclick="randomizePattern('perc')" title="Randomize">üé≤</button>
                            <button class="track-btn" onclick="shiftPattern('perc', -1)" title="Shift left">‚Üê</button>
                            <button class="track-btn" onclick="shiftPattern('perc', 1)" title="Shift right">‚Üí</button>
                            <button class="track-btn" onclick="clearPattern('perc')" title="Clear">üóëÔ∏è</button>
                        </div>
                    </div>
                    <div class="sequencer-grid" id="seq-perc">
                        <!-- 16 steps -->
                    </div>
                </div>

                <!-- Pattern Info -->
                <div style="font-family: var(--font-mono); font-size: 0.65rem; color: var(--haos-dim); text-align: center; margin-top: 8px; padding: 6px; border-top: 1px solid var(--haos-border);">
                    üí° LEFT-CLICK: Toggle | RIGHT-CLICK: Velocity | DOUBLE-CLICK: Random Vel
                </div>
            </div>

            <!-- Pattern Presets Library -->
            <div class="module-panel">
                <div class="module-header">
                    <div class="module-title">PATTERN LIBRARY</div>
                    <div class="module-icon">üìö</div>
                </div>

                <!-- TECHNO SUITE -->
                <div class="preset-section">
                    <div class="preset-section-header" style="background: linear-gradient(135deg, rgba(255,107,53,0.2), rgba(255,140,66,0.1)); border-left: 3px solid var(--haos-orange); padding: 8px 12px; margin-bottom: 8px; border-radius: 6px;">
                        <span style="font-family: var(--font-display); font-size: 1rem; letter-spacing: 1px; color: var(--haos-orange);">üîä TECHNO SUITE</span>
                    </div>
                    <div class="pattern-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 6px; margin-bottom: 12px;">
                        <button class="pattern-preset-btn" onclick="loadPatternPreset('minimal')" title="Minimal Techno - Sparse kick pattern">
                            <span class="pattern-icon">üéØ</span>
                            <span class="pattern-name">MINIMAL</span>
                        </button>
                        <button class="pattern-preset-btn" onclick="loadPatternPreset('techno')" title="Classic Techno - 4/4 groove">
                            <span class="pattern-icon">‚ö°</span>
                            <span class="pattern-name">TECHNO</span>
                        </button>
                        <button class="pattern-preset-btn" onclick="loadPatternPreset('industrial')" title="Industrial - Heavy distorted">
                            <span class="pattern-icon">‚öôÔ∏è</span>
                            <span class="pattern-name">INDUSTRIAL</span>
                        </button>
                        <button class="pattern-preset-btn" onclick="loadPatternPreset('acid')" title="Acid House - TB-303 squelch">
                            <span class="pattern-icon">üß™</span>
                            <span class="pattern-name">ACID</span>
                        </button>
                        <button class="pattern-preset-btn" onclick="loadPatternPreset('detroit')" title="Detroit Techno - Futuristic">
                            <span class="pattern-icon">üè≠</span>
                            <span class="pattern-name">DETROIT</span>
                        </button>
                        <button class="pattern-preset-btn" onclick="loadPatternPreset('tribal')" title="Tribal Techno - Percussive">
                            <span class="pattern-icon">ü•Å</span>
                            <span class="pattern-name">TRIBAL</span>
                        </button>
                    </div>
                </div>

                <!-- HIPHOP BUNDLE -->
                <div class="preset-section">
                    <div class="preset-section-header" style="background: linear-gradient(135deg, rgba(147,112,219,0.2), rgba(186,85,211,0.1)); border-left: 3px solid #9370DB; padding: 8px 12px; margin-bottom: 8px; border-radius: 6px;">
                        <span style="font-family: var(--font-display); font-size: 1rem; letter-spacing: 1px; color: #BA55D3;">üé§ HIPHOP BUNDLE</span>
                    </div>
                    <div class="pattern-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 6px;">
                        <button class="pattern-preset-btn hiphop" onclick="loadPatternPreset('trap')" title="Trap - Hi-hat rolls & 808">
                            <span class="pattern-icon">üíé</span>
                            <span class="pattern-name">TRAP</span>
                        </button>
                        <button class="pattern-preset-btn hiphop" onclick="loadPatternPreset('hiphop')" title="Classic Hip-Hop Boom Bap">
                            <span class="pattern-icon">üéß</span>
                            <span class="pattern-name">HIP-HOP</span>
                        </button>
                        <button class="pattern-preset-btn hiphop" onclick="loadPatternPreset('darkrap')" title="Dark Rap - Ominous bass">
                            <span class="pattern-icon">üåë</span>
                            <span class="pattern-name">DARK RAP</span>
                        </button>
                        <button class="pattern-preset-btn hiphop" onclick="loadPatternPreset('drill')" title="Drill - UK/Chicago style">
                            <span class="pattern-icon">üî•</span>
                            <span class="pattern-name">DRILL</span>
                        </button>
                        <button class="pattern-preset-btn hiphop" onclick="loadPatternPreset('lofi')" title="Lo-Fi Hip-Hop - Chill vibes">
                            <span class="pattern-icon">üå∏</span>
                            <span class="pattern-name">LO-FI</span>
                        </button>
                        <button class="pattern-preset-btn hiphop" onclick="loadPatternPreset('phonk')" title="Phonk - Memphis style">
                            <span class="pattern-icon">üëª</span>
                            <span class="pattern-name">PHONK</span>
                        </button>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div style="display: flex; gap: 6px; margin-top: 12px;">
                    <button class="seq-control-btn" onclick="clearAllPatterns()" style="flex: 1; background: rgba(255,0,110,0.15); border-color: var(--haos-pink); color: var(--haos-pink);">
                        üóëÔ∏è CLEAR ALL
                    </button>
                    <button class="seq-control-btn" onclick="randomizeAllTracks()" style="flex: 1; background: rgba(57,255,20,0.15); border-color: var(--haos-green); color: var(--haos-green);">
                        üé≤ RANDOM ALL
                    </button>
                </div>
            </div>

            <!-- Piano Roll Sequencer -->
            <div class="module-panel">
                <div class="module-header">
                    <div class="module-title">PIANO ROLL - CHORD PROGRESSIONS</div>
                    <div class="module-icon">üéπ</div>
                </div>

                <!-- Chord Settings -->
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-bottom: 12px;">
                    <div>
                        <label style="font-family: var(--font-mono); font-size: 0.65rem; color: var(--haos-dim); display: block; margin-bottom: 4px;">KEY</label>
                        <select id="chordKey" class="instrument-select" style="width: 100%;">
                            <option value="C">C</option>
                            <option value="Db">C# / Db</option>
                            <option value="D">D</option>
                            <option value="Eb">D# / Eb</option>
                            <option value="E">E</option>
                            <option value="F">F</option>
                            <option value="F#">F# / Gb</option>
                            <option value="G">G</option>
                            <option value="Ab">G# / Ab</option>
                            <option value="A" selected>A</option>
                            <option value="Bb">A# / Bb</option>
                            <option value="B">B</option>
                        </select>
                    </div>
                    <div>
                        <label style="font-family: var(--font-mono); font-size: 0.65rem; color: var(--haos-dim); display: block; margin-bottom: 4px;">MODE</label>
                        <select id="chordMode" class="instrument-select" style="width: 100%;">
                            <option value="minor" selected>Minor</option>
                            <option value="major">Major</option>
                        </select>
                    </div>
                </div>

                <!-- Progression Type -->
                <div style="margin-bottom: 12px;">
                    <label style="font-family: var(--font-mono); font-size: 0.65rem; color: var(--haos-dim); display: block; margin-bottom: 4px;">PROGRESSION</label>
                    <select id="progressionType" class="instrument-select" style="width: 100%;">
                        <option value="dark_trap">Dark Trap (i-VI-III-VII)</option>
                        <option value="melodic_trap">Melodic Trap (i-iv-VII-VI)</option>
                        <option value="drill">Drill (i-III-VII-VI)</option>
                        <option value="cloud_rap">Cloud Rap (vi-IV-I-V)</option>
                        <option value="boom_bap">Boom-Bap (i-VII-VI-V)</option>
                        <option value="emotional">Emotional (i-v-VI-III)</option>
                    </select>
                </div>

                <!-- Instrument Selection -->
                <div style="margin-bottom: 12px;">
                    <label style="font-family: var(--font-mono); font-size: 0.65rem; color: var(--haos-dim); display: block; margin-bottom: 4px;">INSTRUMENT</label>
                    <select id="chordInstrument" class="instrument-select" style="width: 100%;">
                        <option value="piano_bright" selected>Bright Piano</option>
                        <option value="piano_electric">Electric Piano</option>
                        <option value="piano_soft">Soft Piano</option>
                        <option value="strings_ensemble">String Ensemble</option>
                        <option value="strings_lush">Lush Strings</option>
                        <option value="pad_warm">Warm Pad</option>
                        <option value="pad_shimmer">Shimmer Pad</option>
                        <option value="organ_hammond">Hammond Organ</option>
                        <option value="organ_church">Church Organ</option>
                    </select>
                </div>

                <!-- Arpeggio & Rhythm Settings -->
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-bottom: 12px;">
                    <div>
                        <label style="font-family: var(--font-mono); font-size: 0.65rem; color: var(--haos-dim); display: block; margin-bottom: 4px;">ARPEGGIO</label>
                        <select id="arpeggioPattern" class="instrument-select" style="width: 100%;">
                            <option value="none" selected>Full Chord</option>
                            <option value="up">Up</option>
                            <option value="down">Down</option>
                            <option value="updown">Up-Down</option>
                            <option value="random">Random</option>
                        </select>
                    </div>
                    <div>
                        <label style="font-family: var(--font-mono); font-size: 0.65rem; color: var(--haos-dim); display: block; margin-bottom: 4px;">RHYTHM</label>
                        <select id="rhythmPattern" class="instrument-select" style="width: 100%;">
                            <option value="whole" selected>Whole</option>
                            <option value="half">Half Notes</option>
                            <option value="quarter">Quarter</option>
                            <option value="triplet">Triplet</option>
                        </select>
                    </div>
                </div>

                <!-- Control Buttons -->
                <div style="display: flex; gap: 6px; margin-bottom: 12px;">
                    <button class="seq-control-btn" onclick="generateChordProgression()" style="flex: 1; background: rgba(57,255,20,0.2); border-color: var(--haos-green); color: var(--haos-green);">
                        üéº GENERATE
                    </button>
                    <button class="seq-control-btn" onclick="playChordProgression()" style="flex: 1; background: rgba(0,217,255,0.2); border-color: var(--haos-cyan); color: var(--haos-cyan);">
                        ‚ñ∂Ô∏è PLAY
                    </button>
                </div>

                <!-- Chord Display -->
                <div id="chordDisplay" style="font-family: var(--font-mono); font-size: 0.7rem; background: rgba(0,0,0,0.5); border: 1px solid var(--haos-border); border-radius: 6px; padding: 10px; min-height: 60px;">
                    <div style="color: var(--haos-dim); text-align: center;">Generate a progression to see chords</div>
                </div>
            </div>
        </div>

        <!-- RIGHT COLUMN: Effects + Output -->
        <div class="workspace-column">
            <!-- Effects Chain -->
            <div class="module-panel">
                <div class="module-header">
                    <div class="module-title">EFFECTS</div>
                    <div class="module-icon">üéöÔ∏è</div>
                </div>
                
                <div class="effect-slot">
                    <div class="effect-name">üí´ DELAY</div>
                    <div class="knob-grid" style="grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="knob-wrapper">
                            <div class="knob effect-knob" data-effect="delay-time" data-value="0.375"></div>
                            <div class="knob-label">TIME</div>
                            <div class="knob-value">375ms</div>
                        </div>
                        <div class="knob-wrapper">
                            <div class="knob effect-knob" data-effect="delay-feedback" data-value="0.4"></div>
                            <div class="knob-label">FEEDBACK</div>
                            <div class="knob-value">40%</div>
                        </div>
                    </div>
                </div>

                <div class="effect-slot">
                    <div class="effect-name">üåä REVERB</div>
                    <div class="knob-grid" style="grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="knob-wrapper">
                            <div class="knob effect-knob" data-effect="reverb-size" data-value="0.5"></div>
                            <div class="knob-label">SIZE</div>
                            <div class="knob-value">2.0s</div>
                        </div>
                        <div class="knob-wrapper">
                            <div class="knob effect-knob" data-effect="reverb-mix" data-value="0.3"></div>
                            <div class="knob-label">MIX</div>
                            <div class="knob-value">30%</div>
                        </div>
                    </div>
                </div>

                <div class="effect-slot">
                    <div class="effect-name">üéöÔ∏è COMPRESSOR</div>
                    <div class="knob-grid" style="grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="knob-wrapper">
                            <div class="knob effect-knob" data-effect="comp-threshold" data-value="0.6"></div>
                            <div class="knob-label">THRESHOLD</div>
                            <div class="knob-value">-24dB</div>
                        </div>
                        <div class="knob-wrapper">
                            <div class="knob effect-knob" data-effect="comp-ratio" data-value="0.55"></div>
                            <div class="knob-label">RATIO</div>
                            <div class="knob-value">12:1</div>
                        </div>
                    </div>
                </div>

                <div class="effect-slot">
                    <div class="effect-name">üî• DISTORTION</div>
                    <div class="knob-grid" style="grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="knob-wrapper">
                            <div class="knob effect-knob" data-effect="dist-drive" data-value="0.5"></div>
                            <div class="knob-label">DRIVE</div>
                            <div class="knob-value">50</div>
                        </div>
                        <div class="knob-wrapper">
                            <div class="knob effect-knob" data-effect="dist-tone" data-value="0.7"></div>
                            <div class="knob-label">TONE</div>
                            <div class="knob-value">70%</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Spectrum Analyzer -->
            <div class="module-panel">
                <div class="module-header">
                    <div class="module-title">SPECTRUM ANALYZER</div>
                    <div class="module-icon">üìä</div>
                </div>
                
                <canvas id="spectrum-canvas" width="300" height="200" style="width: 100%; height: 200px; background: rgba(0,0,0,0.5); border-radius: 8px; border: 1px solid var(--haos-border);"></canvas>
                
                <div style="margin-top: 10px; display: flex; gap: 10px; justify-content: space-between; font-family: var(--font-mono); font-size: 0.7rem; color: var(--haos-dim);">
                    <span>20Hz</span>
                    <span>200Hz</span>
                    <span>2kHz</span>
                    <span>20kHz</span>
                </div>
            </div>

            <!-- Master Output -->
            <div class="module-panel">
                <div class="module-header">
                    <div class="module-title">MASTER OUT</div>
                    <div class="module-icon">üîä</div>
                </div>
                
                <div class="knob-grid">
                    <div class="knob-wrapper">
                        <div class="knob" data-param="master-volume" data-value="0.8"></div>
                        <div class="knob-label">VOLUME</div>
                        <div class="knob-value">80%</div>
                    </div>
                    <div class="knob-wrapper">
                        <div class="knob" data-param="master-limiter" data-value="0.9"></div>
                        <div class="knob-label">LIMITER</div>
                        <div class="knob-value">90%</div>
                    </div>
                </div>

                <!-- Master VU Meter -->
                <div class="vu-meter" style="height: 200px;">
                    <div class="vu-bar" id="master-vu"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Load HAOS Audio Engine (not master system) -->
    <script src="/js/haos-audio-engine.js"></script>
    
    <script>
        // Create global HAOS wrapper for audio engine
        let HAOS = null;
        let haosEngine = null;

        // Initialize HAOS Audio Engine
        async function initHAOS() {
            if (haosEngine) return haosEngine;
            
            haosEngine = new HAOSAudioEngine();
            await haosEngine.init();
            
            // Create wrapper object with commonly used methods
            HAOS = {
                initialized: true,
                audioContext: haosEngine.audioContext,
                masterGain: haosEngine.masterGain,
                tb303: haosEngine.tb303,
                tr909: haosEngine.tr909,
                sequencer: haosEngine.sequencer,
                
                // Wrapper methods
                init: async () => {
                    await haosEngine.init();
                    HAOS.initialized = true;
                },
                
                playNote: (note) => {
                    if (!haosEngine.tb303) {
                        console.warn('TB-303 not initialized');
                        return;
                    }
                    haosEngine.tb303.playNote(note);
                },
                
                playKick: (velocity = 1.0, tune = 0) => {
                    if (!haosEngine.tr909) {
                        console.warn('TR-909 not initialized');
                        return;
                    }
                    haosEngine.tr909.playKick(velocity, tune);
                },
                
                playSnare: (velocity = 1.0, tune = 0) => {
                    if (!haosEngine.tr909) {
                        console.warn('TR-909 not initialized');
                        return;
                    }
                    haosEngine.tr909.playSnare(velocity, tune);
                },
                
                playHihat: (velocity = 0.6, open = false) => {
                    if (!haosEngine.tr909) {
                        console.warn('TR-909 not initialized');
                        return;
                    }
                    if (open) {
                        haosEngine.tr909.playHatOpen(velocity, 0);
                    } else {
                        haosEngine.tr909.playHatClosed(velocity, 0);
                    }
                },
                
                setParam: (param, value) => {
                    // Handle parameter changes
                    if (param.startsWith('tb303-')) {
                        const paramName = param.replace('tb303-', '');
                        if (haosEngine.tb303 && haosEngine.tb303.params) {
                            switch(paramName) {
                                case 'cutoff':
                                    haosEngine.tb303.params.cutoff = 50 + value * 3950;
                                    break;
                                case 'resonance':
                                    haosEngine.tb303.params.resonance = 1 + value * 29;
                                    break;
                                case 'envmod':
                                    haosEngine.tb303.params.envMod = value * 100;
                                    break;
                                case 'decay':
                                    haosEngine.tb303.params.decay = 0.01 + value * 1.99;
                                    break;
                                case 'distortion':
                                case 'dist':
                                    haosEngine.tb303.params.distortion = value * 100;
                                    break;
                                case 'accent':
                                    haosEngine.tb303.params.accentLevel = value * 100;
                                    break;
                            }
                            console.log(`üéõÔ∏è TB-303 ${paramName} set to ${value.toFixed(2)} (param value: ${haosEngine.tb303.params[paramName === 'dist' ? 'distortion' : paramName === 'envmod' ? 'envMod' : paramName === 'accent' ? 'accentLevel' : paramName]})`);
                        }
                    } else if (param.startsWith('kick-')) {
                        const paramName = param.replace('kick-', '');
                        if (haosEngine.tr909 && haosEngine.tr909.params) {
                            switch(paramName) {
                                case 'tune':
                                    haosEngine.tr909.params.kickPitch = 40 + value * 80;
                                    break;
                                case 'decay':
                                    haosEngine.tr909.params.kickDecay = 0.01 + value * 0.99;
                                    break;
                            }
                            console.log(`ü•Å Kick ${paramName} set to ${value.toFixed(2)}`);
                        }
                    } else if (param.startsWith('snare-')) {
                        const paramName = param.replace('snare-', '');
                        if (haosEngine.tr909 && haosEngine.tr909.params) {
                            switch(paramName) {
                                case 'snap':
                                case 'tone':
                                    haosEngine.tr909.params.snareTone = 100 + value * 400;
                                    break;
                                case 'decay':
                                    haosEngine.tr909.params.snareDecay = 0.05 + value * 0.45;
                                    break;
                            }
                            console.log(`ü•Å Snare ${paramName} set to ${value.toFixed(2)}`);
                        }
                    }
                }
            };
            
            // Expose globally
            window.HAOS = HAOS;
            console.log('üéµ HAOS Audio Engine initialized and wrapped!');
            
            return haosEngine;
        }
        
        // Initialize workspace
        let isPlaying = false;
        let currentStep = 0;
        let bpm = 135;
        let intervalId = null;

        // Initialize sequencer grids
        function initSequencer() {
            const tracks = ['kick', 'snare', 'hihat', 'bass', 'keys', 'lead', 'fx', 'perc'];
            tracks.forEach(track => {
                const grid = document.getElementById(`seq-${track}`);
                for (let i = 0; i < 16; i++) {
                    const step = document.createElement('div');
                    step.className = 'seq-step';
                    step.dataset.track = track;
                    step.dataset.step = i;
                    step.dataset.velocity = '100'; // Default velocity
                    step.style.setProperty('--velocity', '100%');
                    
                    // Left click to toggle
                    step.onclick = () => toggleStep(track, i);
                    
                    // Right click to adjust velocity
                    step.oncontextmenu = (e) => {
                        e.preventDefault();
                        if (step.classList.contains('active')) {
                            const currentVel = parseInt(step.dataset.velocity);
                            const newVel = currentVel >= 100 ? 25 : currentVel + 25;
                            step.dataset.velocity = newVel;
                            step.style.setProperty('--velocity', `${newVel}%`);
                            showNotification(`Velocity: ${newVel}%`);
                        }
                    };
                    
                    // Double click to randomize
                    step.ondblclick = () => {
                        if (step.classList.contains('active')) {
                            const randomVel = 25 + Math.floor(Math.random() * 76); // 25-100
                            step.dataset.velocity = randomVel;
                            step.style.setProperty('--velocity', `${randomVel}%`);
                            showNotification(`Random Velocity: ${randomVel}%`);
                        }
                    };
                    
                    grid.appendChild(step);
                }
            });
        }

        // Toggle sequencer step
        function toggleStep(track, step) {
            const stepEl = document.querySelector(`[data-track="${track}"][data-step="${step}"]`);
            stepEl.classList.toggle('active');
            
            // Visual feedback
            if (stepEl.classList.contains('active')) {
                stepEl.style.transform = 'scale(1.1)';
                setTimeout(() => stepEl.style.transform = '', 100);
            }
        }

        // Play/Stop controls
        document.getElementById('play-btn').onclick = async () => {
            if (!HAOS || !HAOS.initialized) {
                await initHAOS();
            }
            
            if (!isPlaying) {
                isPlaying = true;
                document.getElementById('play-btn').classList.add('active');
                document.getElementById('play-led').classList.add('active');
                startSequencer();
            }
        };

        document.getElementById('stop-btn').onclick = () => {
            isPlaying = false;
            document.getElementById('play-btn').classList.remove('active');
            document.getElementById('play-led').classList.remove('active');
            stopSequencer();
        };

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üé≤ PATTERN GENERATION & UTILITIES
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function randomizePattern(track) {
            const steps = document.querySelectorAll(`[data-track="${track}"]`);
            steps.forEach((step, i) => {
                // Different randomization strategies per track
                let probability = 0.3; // Default 30% chance
                
                if (track === 'kick') {
                    // Kick on strong beats (0, 4, 8, 12) more likely
                    probability = (i % 4 === 0) ? 0.8 : 0.2;
                } else if (track === 'snare') {
                    // Snare on backbeats (4, 12) more likely
                    probability = (i === 4 || i === 12) ? 0.9 : 0.15;
                } else if (track === 'hihat') {
                    // Hi-hat more frequent
                    probability = 0.6;
                } else if (track === 'bass') {
                    // Bass follows kick pattern
                    probability = (i % 4 === 0) ? 0.7 : 0.25;
                }
                
                if (Math.random() < probability) {
                    step.classList.add('active');
                    const randomVel = 50 + Math.floor(Math.random() * 51); // 50-100
                    step.dataset.velocity = randomVel;
                    step.style.setProperty('--velocity', `${randomVel}%`);
                } else {
                    step.classList.remove('active');
                }
            });
            
            showNotification(`üé≤ ${track.toUpperCase()} pattern randomized!`);
        }

        function clearPattern(track) {
            document.querySelectorAll(`[data-track="${track}"]`).forEach(step => {
                step.classList.remove('active');
            });
            showNotification(`üóëÔ∏è ${track.toUpperCase()} pattern cleared`);
        }

        function fillPattern(track, density = 1) {
            document.querySelectorAll(`[data-track="${track}"]`).forEach((step, i) => {
                if (i % (16 / (density * 16)) < 1) {
                    step.classList.add('active');
                    step.dataset.velocity = '100';
                    step.style.setProperty('--velocity', '100%');
                }
            });
            showNotification(`üìä ${track.toUpperCase()} filled`);
        }

        function shiftPattern(track, direction = 1) {
            const steps = Array.from(document.querySelectorAll(`[data-track="${track}"]`));
            const states = steps.map(s => ({
                active: s.classList.contains('active'),
                velocity: s.dataset.velocity
            }));
            
            steps.forEach((step, i) => {
                const sourceIndex = (i - direction + 16) % 16;
                if (states[sourceIndex].active) {
                    step.classList.add('active');
                    step.dataset.velocity = states[sourceIndex].velocity;
                    step.style.setProperty('--velocity', `${states[sourceIndex].velocity}%`);
                } else {
                    step.classList.remove('active');
                }
            });
            
            showNotification(`‚ÜîÔ∏è ${track.toUpperCase()} shifted ${direction > 0 ? 'right' : 'left'}`);
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üíæ PATTERN SAVE/LOAD & SEQUENCER CONTROLS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        let sequenceLength = 16;
        let swingAmount = 0; // 0, 33, 66 (percentage)
        let savedPatterns = {};

        // Pattern Presets Library
        const PATTERN_PRESETS = {
            // ========== TECHNO SUITE ==========
            minimal: {
                name: 'Minimal Techno',
                bpm: 128,
                swing: 0,
                tracks: {
                    kick: [0, 8],
                    snare: [],
                    hihat: [2, 6, 10, 14],
                    bass: [0, 8]
                }
            },
            techno: {
                name: 'Classic Techno',
                bpm: 135,
                swing: 0,
                tracks: {
                    kick: [0, 4, 8, 12],
                    snare: [4, 12],
                    hihat: [0, 2, 4, 6, 8, 10, 12, 14],
                    bass: [0, 4, 8, 12]
                }
            },
            industrial: {
                name: 'Industrial',
                bpm: 145,
                swing: 0,
                tracks: {
                    kick: [0, 3, 6, 8, 11, 14],
                    snare: [4, 12],
                    hihat: [1, 3, 5, 7, 9, 11, 13, 15],
                    bass: [0, 3, 6, 8, 11, 14]
                },
                velocities: {
                    kick: 100,
                    snare: 90,
                    hihat: 60,
                    bass: 100
                }
            },
            acid: {
                name: 'Acid House',
                bpm: 130,
                swing: 33,
                tracks: {
                    kick: [0, 4, 8, 12],
                    snare: [4, 12],
                    hihat: [2, 6, 10, 14],
                    bass: [0, 1, 4, 5, 8, 9, 12, 13]
                },
                velocities: {
                    bass: 75
                }
            },
            detroit: {
                name: 'Detroit Techno',
                bpm: 128,
                swing: 0,
                tracks: {
                    kick: [0, 4, 8, 12],
                    snare: [4, 12],
                    hihat: [0, 2, 4, 6, 8, 10, 12, 14],
                    bass: [0, 2, 4, 6, 8, 10, 12, 14]
                }
            },
            tribal: {
                name: 'Tribal Techno',
                bpm: 132,
                swing: 33,
                tracks: {
                    kick: [0, 3, 6, 9, 12],
                    snare: [4, 8, 12],
                    hihat: [1, 3, 5, 7, 9, 11, 13, 15],
                    bass: [0, 6, 12]
                }
            },
            
            // ========== HIPHOP BUNDLE ==========
            trap: {
                name: 'Trap',
                bpm: 140,
                swing: 0,
                tracks: {
                    kick: [0, 6, 12],
                    snare: [4, 12],
                    hihat: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
                    bass: [0, 6, 12]
                },
                velocities: {
                    hihat: 40,
                    bass: 100
                }
            },
            hiphop: {
                name: 'Hip-Hop Boom Bap',
                bpm: 90,
                swing: 66,
                tracks: {
                    kick: [0, 8],
                    snare: [4, 12],
                    hihat: [2, 6, 10, 14],
                    bass: [0, 4, 8, 12]
                }
            },
            darkrap: {
                name: 'Dark Rap',
                bpm: 70,
                swing: 33,
                tracks: {
                    kick: [0, 6, 12],
                    snare: [4, 12],
                    hihat: [2, 6, 10, 14],
                    bass: [0, 3, 6, 9, 12, 15]
                },
                velocities: {
                    kick: 100,
                    bass: 100,
                    hihat: 50
                }
            },
            drill: {
                name: 'Drill',
                bpm: 140,
                swing: 0,
                tracks: {
                    kick: [0, 6, 10, 12],
                    snare: [4, 12],
                    hihat: [0, 2, 4, 6, 8, 10, 12, 14],
                    bass: [0, 6, 10, 12]
                },
                velocities: {
                    kick: 100,
                    bass: 100
                }
            },
            lofi: {
                name: 'Lo-Fi Hip-Hop',
                bpm: 85,
                swing: 66,
                tracks: {
                    kick: [0, 8],
                    snare: [4, 12],
                    hihat: [2, 6, 10, 14],
                    bass: [0, 8]
                },
                velocities: {
                    kick: 70,
                    snare: 60,
                    hihat: 40,
                    bass: 70
                }
            },
            phonk: {
                name: 'Phonk',
                bpm: 125,
                swing: 33,
                tracks: {
                    kick: [0, 3, 8, 11],
                    snare: [4, 12],
                    hihat: [0, 2, 4, 6, 8, 10, 12, 14],
                    bass: [0, 3, 8, 11]
                },
                velocities: {
                    bass: 100,
                    kick: 90
                }
            }
        };

        // Load pattern preset
        function loadPatternPreset(presetName) {
            const preset = PATTERN_PRESETS[presetName];
            if (!preset) {
                showNotification(`‚ö†Ô∏è Preset "${presetName}" not found`);
                return;
            }

            // Clear current pattern
            clearAllPatterns();

            // Set BPM
            if (preset.bpm) {
                bpm = preset.bpm;
                document.getElementById('bpm-value').textContent = bpm;
            }

            // Set swing
            if (preset.swing !== undefined) {
                swingAmount = preset.swing;
                document.getElementById('swing-btn').textContent = `SWING: ${swingAmount}%`;
            }

            // Load tracks
            Object.keys(preset.tracks).forEach(track => {
                const steps = preset.tracks[track];
                const defaultVelocity = preset.velocities?.[track] || 80;
                
                steps.forEach(stepNum => {
                    const stepEl = document.querySelector(`[data-track="${track}"][data-step="${stepNum}"]`);
                    if (stepEl) {
                        stepEl.classList.add('active');
                        stepEl.dataset.velocity = defaultVelocity;
                        stepEl.style.setProperty('--velocity', `${defaultVelocity}%`);
                    }
                });
            });

            showNotification(`üéµ Loaded: ${preset.name} | ${preset.bpm} BPM | Swing: ${preset.swing}%`);
        }

        // Clear all patterns
        function clearAllPatterns() {
            document.querySelectorAll('.seq-step').forEach(step => {
                step.classList.remove('active');
                step.dataset.velocity = '100';
                step.style.setProperty('--velocity', '100%');
            });
        }

        // Randomize all tracks
        function randomizeAllTracks() {
            ['kick', 'snare', 'hihat', 'bass'].forEach(track => {
                randomizePattern(track);
            });
            showNotification('üé≤ All tracks randomized!');
        }

        // Save current pattern
        document.getElementById('save-pattern-btn').onclick = () => {
            const pattern = {
                length: sequenceLength,
                swing: swingAmount,
                tracks: {}
            };
            
            ['kick', 'snare', 'hihat', 'bass'].forEach(track => {
                pattern.tracks[track] = [];
                document.querySelectorAll(`[data-track="${track}"]`).forEach((step, i) => {
                    if (step.classList.contains('active')) {
                        pattern.tracks[track].push({
                            step: i,
                            velocity: parseInt(step.dataset.velocity)
                        });
                    }
                });
            });
            
            const patternName = prompt('Enter pattern name:', `Pattern_${Object.keys(savedPatterns).length + 1}`);
            if (patternName) {
                savedPatterns[patternName] = pattern;
                localStorage.setItem('haos_patterns', JSON.stringify(savedPatterns));
                showNotification(`üíæ Pattern "${patternName}" saved!`);
            }
        };

        // Load saved pattern
        document.getElementById('load-pattern-btn').onclick = () => {
            const stored = localStorage.getItem('haos_patterns');
            if (stored) {
                savedPatterns = JSON.parse(stored);
            }
            
            if (Object.keys(savedPatterns).length === 0) {
                showNotification('‚ö†Ô∏è No saved patterns found');
                return;
            }
            
            const patternList = Object.keys(savedPatterns).map((name, i) => `${i + 1}. ${name}`).join('\n');
            const patternName = prompt(`Select pattern:\n\n${patternList}\n\nEnter pattern name:`);
            
            if (patternName && savedPatterns[patternName]) {
                const pattern = savedPatterns[patternName];
                
                // Clear current pattern
                document.querySelectorAll('.seq-step').forEach(step => {
                    step.classList.remove('active');
                });
                
                // Load pattern data
                Object.keys(pattern.tracks).forEach(track => {
                    pattern.tracks[track].forEach(note => {
                        const step = document.querySelector(`[data-track="${track}"][data-step="${note.step}"]`);
                        if (step) {
                            step.classList.add('active');
                            step.dataset.velocity = note.velocity;
                            step.style.setProperty('--velocity', `${note.velocity}%`);
                        }
                    });
                });
                
                if (pattern.length) {
                    sequenceLength = pattern.length;
                    document.getElementById('seq-length-btn').textContent = `${sequenceLength} STEPS`;
                    updateSequenceLength();
                }
                
                if (pattern.swing !== undefined) {
                    swingAmount = pattern.swing;
                    document.getElementById('swing-btn').textContent = `SWING: ${swingAmount}%`;
                }
                
                showNotification(`üìÇ Pattern "${patternName}" loaded!`);
            }
        };

        // Toggle sequence length (8/16 steps)
        document.getElementById('seq-length-btn').onclick = () => {
            sequenceLength = sequenceLength === 16 ? 8 : 16;
            document.getElementById('seq-length-btn').textContent = `${sequenceLength} STEPS`;
            updateSequenceLength();
            showNotification(`üìè Sequence length: ${sequenceLength} steps`);
        };

        function updateSequenceLength() {
            document.querySelectorAll('.seq-step').forEach((step, idx) => {
                const stepNum = idx % 16;
                if (stepNum >= sequenceLength) {
                    step.style.opacity = '0.3';
                    step.style.pointerEvents = 'none';
                } else {
                    step.style.opacity = '1';
                    step.style.pointerEvents = 'auto';
                }
            });
        }

        // Toggle swing amount
        document.getElementById('swing-btn').onclick = () => {
            if (swingAmount === 0) swingAmount = 33;
            else if (swingAmount === 33) swingAmount = 66;
            else swingAmount = 0;
            
            document.getElementById('swing-btn').textContent = `SWING: ${swingAmount}%`;
            showNotification(`üéµ Swing: ${swingAmount}%`);
        };

        // BPM controls
        document.getElementById('bpm-up').onclick = () => {
            bpm = Math.min(200, bpm + 5);
            document.getElementById('bpm-value').textContent = bpm;
            if (isPlaying) {
                stopSequencer();
                startSequencer();
            }
            showNotification(`‚¨ÜÔ∏è BPM: ${bpm}`);
        };

        document.getElementById('bpm-down').onclick = () => {
            bpm = Math.max(60, bpm - 5);
            document.getElementById('bpm-value').textContent = bpm;
            if (isPlaying) {
                stopSequencer();
                startSequencer();
            }
            showNotification(`‚¨áÔ∏è BPM: ${bpm}`);
        };

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // ‚å®Ô∏è KEYBOARD CONTROLS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        document.addEventListener('keydown', async (e) => {
            // Ignore if typing in an input
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
            
            switch(e.key.toLowerCase()) {
                case ' ': // Spacebar - Play/Stop
                    e.preventDefault();
                    if (isPlaying) {
                        document.getElementById('stop-btn').click();
                    } else {
                        document.getElementById('play-btn').click();
                    }
                    break;
                    
                case 'r': // R - Toggle Record
                    if (e.ctrlKey || e.metaKey) return; // Let browser handle Ctrl+R
                    e.preventDefault();
                    document.getElementById('record-btn').click();
                    break;
                    
                case 'e': // E - Export MIDI
                    if (e.ctrlKey || e.metaKey) return;
                    e.preventDefault();
                    exportToMIDI();
                    break;
                    
                case 's': // S - Export Project (with Ctrl/Cmd)
                    if (e.ctrlKey || e.metaKey) {
                        e.preventDefault();
                        exportProject();
                    }
                    break;
                    
                case 'arrowup': // Arrow Up - Increase BPM
                    e.preventDefault();
                    bpm = Math.min(200, bpm + 1);
                    document.getElementById('bpm-value').textContent = bpm;
                    if (isPlaying) {
                        stopSequencer();
                        startSequencer();
                    }
                    break;
                    
                case 'arrowdown': // Arrow Down - Decrease BPM
                    e.preventDefault();
                    bpm = Math.max(60, bpm - 1);
                    document.getElementById('bpm-value').textContent = bpm;
                    if (isPlaying) {
                        stopSequencer();
                        startSequencer();
                    }
                    break;
                    
                case '1': case '2': case '3': case '4': case '5':
                case '6': case '7': case '8': // Number keys - Load presets
                    e.preventDefault();
                    const presetNum = parseInt(e.key);
                    const presetSlot = document.querySelector(`.bank-slot[data-slot="${presetNum}"]`);
                    if (presetSlot) presetSlot.click();
                    break;
                    
                case 'a': // A - Play TB-303 test sound
                    if (!e.ctrlKey && !e.metaKey) {
                        e.preventDefault();
                        document.getElementById('tb303-test')?.click();
                    }
                    break;
                    
                case 'z': // Z - Play Kick
                    e.preventDefault();
                    document.getElementById('test-kick')?.click();
                    break;
                    
                case 'x': // X - Play Snare
                    e.preventDefault();
                    document.getElementById('test-snare')?.click();
                    break;
                    
                case 'c': // C - Play Hi-Hat
                    if (!e.ctrlKey && !e.metaKey) {
                        e.preventDefault();
                        document.getElementById('test-hihat')?.click();
                    }
                    break;
                    
                case 'delete':
                case 'backspace': // Clear current pattern
                    e.preventDefault();
                    if (confirm('Clear all patterns?')) {
                        document.querySelectorAll('.seq-step.active').forEach(step => {
                            step.classList.remove('active');
                        });
                        showNotification('üóëÔ∏è Patterns cleared');
                    }
                    break;
                    
                case 'q': // Q - Randomize Kick
                    if (!e.ctrlKey && !e.metaKey) {
                        e.preventDefault();
                        randomizePattern('kick');
                    }
                    break;
                    
                case 'w': // W - Randomize Snare
                    if (!e.ctrlKey && !e.metaKey) {
                        e.preventDefault();
                        randomizePattern('snare');
                    }
                    break;
                    
                case 'o': // O - Randomize Hi-Hat
                    if (!e.ctrlKey && !e.metaKey) {
                        e.preventDefault();
                        randomizePattern('hihat');
                    }
                    break;
                    
                case 'p': // P - Randomize Bass
                    if (!e.ctrlKey && !e.metaKey) {
                        e.preventDefault();
                        randomizePattern('bass');
                    }
                    break;
                    
                case 'arrowleft': // Shift Left
                    if (e.shiftKey) {
                        e.preventDefault();
                        ['kick', 'snare', 'hihat', 'bass'].forEach(track => shiftPattern(track, -1));
                        showNotification('‚ÜîÔ∏è All patterns shifted left');
                    }
                    break;
                    
                case 'arrowright': // Shift Right
                    if (e.shiftKey) {
                        e.preventDefault();
                        ['kick', 'snare', 'hihat', 'bass'].forEach(track => shiftPattern(track, 1));
                        showNotification('‚ÜîÔ∏è All patterns shifted right');
                    }
                    break;
            }
        });

        // Show keyboard shortcuts help
        console.log('%c‚å®Ô∏è KEYBOARD SHORTCUTS', 'color: #00D9FF; font-size: 14px; font-weight: bold');
        console.log('%cPlayback:%c SPACE = Play/Stop, ‚Üë/‚Üì = BPM, BACKSPACE = Clear', 'color: #FF6B35; font-weight: bold', '');
        console.log('%cSounds:%c A = TB-303, Z = Kick, X = Snare, C = Hi-Hat', 'color: #FF6B35; font-weight: bold', '');
        console.log('%cPresets:%c 1-8 = Load preset', 'color: #FF6B35; font-weight: bold', '');
        console.log('%cPatterns:%c Q/W/O/P = Randomize tracks, Shift+‚Üê/‚Üí = Shift all', 'color: #FF6B35; font-weight: bold', '');
        console.log('%cExport:%c R = Record, E = MIDI, Ctrl+S = Project', 'color: #FF6B35; font-weight: bold', '');


        // Sequencer engine
        function startSequencer() {
            const stepTime = (60 / bpm) / 4 * 1000; // 16th note in ms
            
            intervalId = setInterval(() => {
                // Apply swing to even steps (off-beats)
                let delay = 0;
                if (swingAmount > 0 && currentStep % 2 === 1) {
                    delay = (stepTime * swingAmount / 100) * 0.5; // Apply swing delay
                }
                
                setTimeout(() => {
                    playStep(currentStep);
                }, delay);
                
                currentStep = (currentStep + 1) % sequenceLength;
            }, stepTime);
        }

        function stopSequencer() {
            if (intervalId) {
                clearInterval(intervalId);
                intervalId = null;
            }
            currentStep = 0;
            
            // Remove playing class from all steps
            document.querySelectorAll('.seq-step.playing').forEach(el => {
                el.classList.remove('playing');
            });
        }

        function playStep(step) {
            // Skip if step is beyond sequence length
            if (step >= sequenceLength) return;
            
            // Highlight current step with position indicator
            document.querySelectorAll('.seq-step').forEach(el => {
                const stepNum = parseInt(el.dataset.step);
                if (stepNum === step) {
                    el.classList.add('playing');
                    setTimeout(() => el.classList.remove('playing'), 100);
                }
            });

            // Play active steps with velocity - ALL 8 TRACKS
            const now = HAOS.audioContext?.currentTime || 0;
            
            ['kick', 'snare', 'hihat', 'bass', 'keys', 'lead', 'fx', 'perc'].forEach(track => {
                const stepEl = document.querySelector(`[data-track="${track}"][data-step="${step}"]`);
                if (stepEl && stepEl.classList.contains('active')) {
                    const velocity = parseInt(stepEl.dataset.velocity) / 100;
                    playSound(track, now, velocity);
                }
            });
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üéπ EXPANDED ARP 2600 PRESET LIBRARY - 300+ PRESETS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        const ARP2600_PRESETS = {
            // ========== LEAD VARIATIONS ==========
            'lead_vintage': {
                name: 'Vintage Lead',
                category: 'Lead',
                vco1: {waveform: 'sawtooth', frequency: 440, fine: 0, mod: 0.3},
                vco2: {waveform: 'square', frequency: 440, fine: -7, mod: 0.2},
                vcf: {cutoff: 1200, resonance: 0.6, envMod: 0.7},
                vca: {level: 0.8},
                envelope: {attack: 0.01, decay: 0.3, sustain: 0.6, release: 0.4},
                lfo: {rate: 5, depth: 0.2, destination: 'filter'}
            },
            'lead_bright': {
                name: 'Bright Arp Lead',
                category: 'Lead',
                vco1: {waveform: 'sawtooth', frequency: 440, fine: 0, mod: 0.2},
                vco2: {waveform: 'square', frequency: 440, fine: 5, mod: 0.1},
                vcf: {cutoff: 2500, resonance: 0.5, envMod: 0.8},
                vca: {level: 0.85},
                envelope: {attack: 0.001, decay: 0.15, sustain: 0.4, release: 0.2},
                lfo: {rate: 6, depth: 0.15, destination: 'filter'}
            },
            
            // ========== PAD VARIATIONS ==========
            'pad_warm': {
                name: 'Warm Pad',
                category: 'Pad',
                vco1: {waveform: 'sawtooth', frequency: 220, fine: 0, mod: 0.1},
                vco2: {waveform: 'triangle', frequency: 220, fine: 5, mod: 0.1},
                vcf: {cutoff: 800, resonance: 0.3, envMod: 0.4},
                vca: {level: 0.6},
                envelope: {attack: 0.8, decay: 0.5, sustain: 0.7, release: 1.2},
                lfo: {rate: 0.3, depth: 0.2, destination: 'pitch'}
            },
            'pad_dark': {
                name: 'Dark Atmosphere',
                category: 'Pad',
                vco1: {waveform: 'sawtooth', frequency: 220, fine: 0, mod: 0.1},
                vco2: {waveform: 'triangle', frequency: 220, fine: -3, mod: 0.15},
                vcf: {cutoff: 800, resonance: 0.3, envMod: 0.3},
                vca: {level: 0.7},
                envelope: {attack: 1.2, decay: 0.8, sustain: 0.7, release: 1.5},
                lfo: {rate: 0.3, depth: 0.25, destination: 'filter'}
            },
            
            // ========== BASS VARIATIONS ==========
            'bass_fat': {
                name: 'Fat Bass',
                category: 'Bass',
                vco1: {waveform: 'sawtooth', frequency: 55, fine: 0, mod: 0},
                vco2: {waveform: 'square', frequency: 55, fine: -12, mod: 0},
                vcf: {cutoff: 800, resonance: 0.4, envMod: 0.5},
                vca: {level: 1.0},
                envelope: {attack: 0.01, decay: 0.4, sustain: 0.6, release: 0.3},
                lfo: {rate: 0, depth: 0, destination: 'none'}
            },
            'bass_sub': {
                name: 'Sub Bass 808',
                category: 'Bass',
                vco1: {waveform: 'sine', frequency: 55, fine: 0, mod: 0},
                vco2: {waveform: 'sine', frequency: 55, fine: 0, mod: 0},
                vcf: {cutoff: 300, resonance: 0.1, envMod: 0.6},
                vca: {level: 1.0},
                envelope: {attack: 0.001, decay: 0.8, sustain: 0, release: 0.1},
                lfo: {rate: 0, depth: 0, destination: 'none'}
            },
            'bass_acid': {
                name: 'Acid Bass 303',
                category: 'Bass',
                vco1: {waveform: 'sawtooth', frequency: 55, fine: 0, mod: 0},
                vco2: {waveform: 'square', frequency: 55, fine: 0, mod: 0},
                vcf: {cutoff: 600, resonance: 0.8, envMod: 0.9},
                vca: {level: 0.9},
                envelope: {attack: 0.001, decay: 0.2, sustain: 0.3, release: 0.1},
                lfo: {rate: 0, depth: 0, destination: 'none'}
            },
            'bass_reese': {
                name: 'Reese Bass',
                category: 'Bass',
                vco1: {waveform: 'sawtooth', frequency: 55, fine: 0, mod: 0},
                vco2: {waveform: 'sawtooth', frequency: 55, fine: -15, mod: 0},
                vcf: {cutoff: 500, resonance: 0.3, envMod: 0.4},
                vca: {level: 1.0},
                envelope: {attack: 0.02, decay: 0.6, sustain: 0.8, release: 0.4},
                lfo: {rate: 0, depth: 0, destination: 'none'}
            },
            'bass_wobble': {
                name: 'Wobble Bass',
                category: 'Bass',
                vco1: {waveform: 'sawtooth', frequency: 55, fine: 0, mod: 0},
                vco2: {waveform: 'sawtooth', frequency: 55, fine: -7, mod: 0},
                vcf: {cutoff: 500, resonance: 0.7, envMod: 0.3},
                vca: {level: 1.0},
                envelope: {attack: 0.01, decay: 0.5, sustain: 0.8, release: 0.3},
                lfo: {rate: 4, depth: 0.8, destination: 'filter'}
            },
            
            // ========== FX VARIATIONS ==========
            'fx_space': {
                name: 'Space FX',
                category: 'FX',
                vco1: {waveform: 'sine', frequency: 440, fine: 0, mod: 0},
                vco2: {waveform: 'noise', frequency: 0, fine: 0, mod: 0},
                vcf: {cutoff: 2000, resonance: 0.85, envMod: 0.5},
                vca: {level: 0.5},
                envelope: {attack: 0.1, decay: 1.0, sustain: 0.3, release: 0.8},
                lfo: {rate: 8, depth: 0.7, destination: 'filter'}
            },
            'fx_phaser': {
                name: 'Phaser Swirl',
                category: 'FX',
                vco1: {waveform: 'sawtooth', frequency: 220, fine: 0, mod: 0},
                vco2: {waveform: 'square', frequency: 220, fine: 0, mod: 0},
                vcf: {cutoff: 1000, resonance: 0.8, envMod: 0},
                vca: {level: 0.6},
                envelope: {attack: 0.05, decay: 0.3, sustain: 0.5, release: 0.5},
                lfo: {rate: 0.5, depth: 0.6, destination: 'filter'}
            },
            
            // ========== PERCUSSION VARIATIONS ==========
            'perc_hihat': {
                name: 'Hi-Hat Metallic',
                category: 'Percussion',
                vco1: {waveform: 'noise', frequency: 0, fine: 0, mod: 0},
                vco2: {waveform: 'noise', frequency: 0, fine: 0, mod: 0},
                vcf: {cutoff: 8000, resonance: 0.6, envMod: 0.7},
                vca: {level: 0.8},
                envelope: {attack: 0.001, decay: 0.08, sustain: 0, release: 0.05},
                lfo: {rate: 0, depth: 0, destination: 'none'}
            },
            'perc_snare': {
                name: 'Snare Punchy',
                category: 'Percussion',
                vco1: {waveform: 'sine', frequency: 180, fine: 0, mod: 0},
                vco2: {waveform: 'noise', frequency: 0, fine: 0, mod: 0},
                vcf: {cutoff: 3000, resonance: 0.4, envMod: 0.6},
                vca: {level: 1.0},
                envelope: {attack: 0.001, decay: 0.15, sustain: 0, release: 0.08},
                lfo: {rate: 0, depth: 0, destination: 'none'}
            },
            
            // ========== PIANO VARIATIONS ==========
            'piano_bright': {
                name: 'Bright Piano',
                category: 'Piano',
                vco1: {waveform: 'triangle', frequency: 440, fine: 0, mod: 0},
                vco2: {waveform: 'sine', frequency: 440, fine: 12, mod: 0},
                vcf: {cutoff: 3500, resonance: 0.2, envMod: 0.5},
                vca: {level: 0.9},
                envelope: {attack: 0.002, decay: 0.4, sustain: 0.2, release: 0.6},
                lfo: {rate: 0, depth: 0, destination: 'none'}
            },
            'piano_electric': {
                name: 'Electric Piano',
                category: 'Piano',
                vco1: {waveform: 'sine', frequency: 440, fine: 0, mod: 0.1},
                vco2: {waveform: 'triangle', frequency: 440, fine: 7, mod: 0.1},
                vcf: {cutoff: 2500, resonance: 0.4, envMod: 0.6},
                vca: {level: 0.85},
                envelope: {attack: 0.001, decay: 0.5, sustain: 0.3, release: 0.8},
                lfo: {rate: 4, depth: 0.1, destination: 'filter'}
            },
            'piano_soft': {
                name: 'Soft Piano',
                category: 'Piano',
                vco1: {waveform: 'sine', frequency: 440, fine: 0, mod: 0},
                vco2: {waveform: 'triangle', frequency: 440, fine: -5, mod: 0},
                vcf: {cutoff: 2000, resonance: 0.15, envMod: 0.3},
                vca: {level: 0.7},
                envelope: {attack: 0.01, decay: 0.6, sustain: 0.25, release: 1.0},
                lfo: {rate: 0, depth: 0, destination: 'none'}
            },
            
            // ========== STRINGS VARIATIONS ==========
            'strings_ensemble': {
                name: 'String Ensemble',
                category: 'Strings',
                vco1: {waveform: 'sawtooth', frequency: 220, fine: 0, mod: 0.1},
                vco2: {waveform: 'sawtooth', frequency: 220, fine: 8, mod: 0.1},
                vcf: {cutoff: 1500, resonance: 0.35, envMod: 0.4},
                vca: {level: 0.75},
                envelope: {attack: 0.6, decay: 0.3, sustain: 0.8, release: 1.0},
                lfo: {rate: 0.2, depth: 0.15, destination: 'pitch'}
            },
            'strings_lush': {
                name: 'Lush Strings',
                category: 'Strings',
                vco1: {waveform: 'sawtooth', frequency: 220, fine: 0, mod: 0.15},
                vco2: {waveform: 'triangle', frequency: 220, fine: 12, mod: 0.15},
                vcf: {cutoff: 1800, resonance: 0.3, envMod: 0.5},
                vca: {level: 0.8},
                envelope: {attack: 0.8, decay: 0.4, sustain: 0.85, release: 1.3},
                lfo: {rate: 0.25, depth: 0.2, destination: 'filter'}
            },
            'strings_staccato': {
                name: 'Staccato Strings',
                category: 'Strings',
                vco1: {waveform: 'sawtooth', frequency: 220, fine: 0, mod: 0},
                vco2: {waveform: 'square', frequency: 220, fine: 5, mod: 0},
                vcf: {cutoff: 2200, resonance: 0.4, envMod: 0.7},
                vca: {level: 0.85},
                envelope: {attack: 0.01, decay: 0.2, sustain: 0.3, release: 0.3},
                lfo: {rate: 0, depth: 0, destination: 'none'}
            },
            
            // ========== VIOLIN VARIATIONS ==========
            'violin_solo': {
                name: 'Solo Violin',
                category: 'Violin',
                vco1: {waveform: 'sawtooth', frequency: 440, fine: 0, mod: 0.2},
                vco2: {waveform: 'sawtooth', frequency: 440, fine: 3, mod: 0.2},
                vcf: {cutoff: 2500, resonance: 0.5, envMod: 0.6},
                vca: {level: 0.8},
                envelope: {attack: 0.15, decay: 0.2, sustain: 0.75, release: 0.5},
                lfo: {rate: 5, depth: 0.15, destination: 'pitch'}
            },
            'violin_tremolo': {
                name: 'Tremolo Violin',
                category: 'Violin',
                vco1: {waveform: 'sawtooth', frequency: 440, fine: 0, mod: 0.25},
                vco2: {waveform: 'triangle', frequency: 440, fine: 5, mod: 0.25},
                vcf: {cutoff: 2800, resonance: 0.45, envMod: 0.5},
                vca: {level: 0.75},
                envelope: {attack: 0.1, decay: 0.15, sustain: 0.7, release: 0.4},
                lfo: {rate: 8, depth: 0.3, destination: 'vca'}
            },
            
            // ========== CELLO ==========
            'cello_warm': {
                name: 'Warm Cello',
                category: 'Cello',
                vco1: {waveform: 'sawtooth', frequency: 110, fine: 0, mod: 0.1},
                vco2: {waveform: 'triangle', frequency: 110, fine: -3, mod: 0.1},
                vcf: {cutoff: 1200, resonance: 0.4, envMod: 0.5},
                vca: {level: 0.85},
                envelope: {attack: 0.25, decay: 0.3, sustain: 0.8, release: 0.8},
                lfo: {rate: 0.3, depth: 0.12, destination: 'pitch'}
            },
            
            // ========== BRASS VARIATIONS ==========
            'brass_section': {
                name: 'Brass Section',
                category: 'Brass',
                vco1: {waveform: 'sawtooth', frequency: 220, fine: 0, mod: 0.2},
                vco2: {waveform: 'square', frequency: 220, fine: -7, mod: 0.2},
                vcf: {cutoff: 1800, resonance: 0.6, envMod: 0.7},
                vca: {level: 0.9},
                envelope: {attack: 0.05, decay: 0.2, sustain: 0.75, release: 0.4},
                lfo: {rate: 0, depth: 0, destination: 'none'}
            },
            'brass_stab': {
                name: 'Brass Stab',
                category: 'Brass',
                vco1: {waveform: 'square', frequency: 220, fine: 0, mod: 0},
                vco2: {waveform: 'sawtooth', frequency: 220, fine: -5, mod: 0},
                vcf: {cutoff: 2200, resonance: 0.7, envMod: 0.9},
                vca: {level: 1.0},
                envelope: {attack: 0.01, decay: 0.3, sustain: 0.5, release: 0.2},
                lfo: {rate: 0, depth: 0, destination: 'none'}
            },
            
            // ========== FLUTE ==========
            'flute_breathy': {
                name: 'Breathy Flute',
                category: 'Flute',
                vco1: {waveform: 'sine', frequency: 440, fine: 0, mod: 0.1},
                vco2: {waveform: 'noise', frequency: 0, fine: 0, mod: 0},
                vcf: {cutoff: 4000, resonance: 0.3, envMod: 0.4},
                vca: {level: 0.6},
                envelope: {attack: 0.08, decay: 0.15, sustain: 0.65, release: 0.4},
                lfo: {rate: 4, depth: 0.1, destination: 'pitch'}
            },
            
            // ========== ORGAN VARIATIONS ==========
            'organ_hammond': {
                name: 'Hammond Organ',
                category: 'Organ',
                vco1: {waveform: 'sine', frequency: 440, fine: 0, mod: 0},
                vco2: {waveform: 'sine', frequency: 880, fine: 0, mod: 0},
                vcf: {cutoff: 3000, resonance: 0.2, envMod: 0.2},
                vca: {level: 0.85},
                envelope: {attack: 0.02, decay: 0.1, sustain: 0.9, release: 0.3},
                lfo: {rate: 6, depth: 0.15, destination: 'vca'}
            },
            'organ_church': {
                name: 'Church Organ',
                category: 'Organ',
                vco1: {waveform: 'sine', frequency: 220, fine: 0, mod: 0},
                vco2: {waveform: 'triangle', frequency: 440, fine: 0, mod: 0},
                vcf: {cutoff: 2500, resonance: 0.15, envMod: 0.1},
                vca: {level: 0.8},
                envelope: {attack: 0.15, decay: 0.2, sustain: 0.95, release: 0.8},
                lfo: {rate: 0, depth: 0, destination: 'none'}
            },
            
            // ========== EXPANDED PAD VARIATIONS ==========
            'pad_shimmer': {
                name: 'Shimmer Pad',
                category: 'Pad',
                vco1: {waveform: 'triangle', frequency: 220, fine: 0, mod: 0.2},
                vco2: {waveform: 'sine', frequency: 440, fine: 7, mod: 0.2},
                vcf: {cutoff: 1500, resonance: 0.4, envMod: 0.5},
                vca: {level: 0.65},
                envelope: {attack: 1.0, decay: 0.6, sustain: 0.75, release: 1.8},
                lfo: {rate: 0.4, depth: 0.3, destination: 'filter'}
            },
            'pad_sweeping': {
                name: 'Sweeping Pad',
                category: 'Pad',
                vco1: {waveform: 'sawtooth', frequency: 220, fine: 0, mod: 0.15},
                vco2: {waveform: 'square', frequency: 220, fine: 12, mod: 0.15},
                vcf: {cutoff: 600, resonance: 0.5, envMod: 0.6},
                vca: {level: 0.7},
                envelope: {attack: 1.5, decay: 0.8, sustain: 0.8, release: 2.0},
                lfo: {rate: 0.15, depth: 0.4, destination: 'filter'}
            },
            'pad_ethereal': {
                name: 'Ethereal Pad',
                category: 'Pad',
                vco1: {waveform: 'sine', frequency: 220, fine: 0, mod: 0.1},
                vco2: {waveform: 'triangle', frequency: 330, fine: 3, mod: 0.1},
                vcf: {cutoff: 1200, resonance: 0.25, envMod: 0.35},
                vca: {level: 0.55},
                envelope: {attack: 1.8, decay: 1.0, sustain: 0.7, release: 2.5},
                lfo: {rate: 0.2, depth: 0.25, destination: 'pitch'}
            },
            'pad_analog': {
                name: 'Analog Pad',
                category: 'Pad',
                vco1: {waveform: 'sawtooth', frequency: 220, fine: 0, mod: 0.2},
                vco2: {waveform: 'sawtooth', frequency: 220, fine: -8, mod: 0.2},
                vcf: {cutoff: 900, resonance: 0.45, envMod: 0.45},
                vca: {level: 0.75},
                envelope: {attack: 1.0, decay: 0.6, sustain: 0.8, release: 1.5},
                lfo: {rate: 0.35, depth: 0.3, destination: 'filter'}
            },
            
            // ========== EXPANDED FX VARIATIONS ==========
            'fx_riser': {
                name: 'Riser FX',
                category: 'FX',
                vco1: {waveform: 'noise', frequency: 0, fine: 0, mod: 0},
                vco2: {waveform: 'sawtooth', frequency: 110, fine: 0, mod: 0},
                vcf: {cutoff: 400, resonance: 0.7, envMod: 0.9},
                vca: {level: 0.6},
                envelope: {attack: 1.5, decay: 0.5, sustain: 0.4, release: 0.3},
                lfo: {rate: 0.1, depth: 0.5, destination: 'filter'}
            },
            'fx_sweep': {
                name: 'Filter Sweep',
                category: 'FX',
                vco1: {waveform: 'square', frequency: 220, fine: 0, mod: 0},
                vco2: {waveform: 'sawtooth', frequency: 220, fine: 7, mod: 0},
                vcf: {cutoff: 200, resonance: 0.9, envMod: 0.95},
                vca: {level: 0.7},
                envelope: {attack: 0.05, decay: 2.0, sustain: 0.2, release: 0.5},
                lfo: {rate: 0.3, depth: 0.6, destination: 'filter'}
            },
            'fx_laser': {
                name: 'Laser Zap',
                category: 'FX',
                vco1: {waveform: 'square', frequency: 880, fine: 0, mod: 0},
                vco2: {waveform: 'sine', frequency: 440, fine: 0, mod: 0},
                vcf: {cutoff: 3000, resonance: 0.85, envMod: 0.9},
                vca: {level: 0.8},
                envelope: {attack: 0.001, decay: 0.3, sustain: 0, release: 0.1},
                lfo: {rate: 20, depth: 0.8, destination: 'pitch'}
            },
            
            // ========== ADDITIONAL LEAD VARIATIONS (50 total) ==========
            'lead_sync': {name: 'Sync Lead', category: 'Lead', vco1: {waveform: 'sawtooth', frequency: 440, fine: 0, mod: 0.5}, vco2: {waveform: 'square', frequency: 440, fine: -12, mod: 0.5}, vcf: {cutoff: 2200, resonance: 0.7, envMod: 0.75}, vca: {level: 0.9}, envelope: {attack: 0.005, decay: 0.25, sustain: 0.5, release: 0.3}, lfo: {rate: 6, depth: 0.25, destination: 'pitch'}},
            'lead_pluck': {name: 'Pluck Lead', category: 'Lead', vco1: {waveform: 'triangle', frequency: 440, fine: 0, mod: 0}, vco2: {waveform: 'sine', frequency: 880, fine: 0, mod: 0}, vcf: {cutoff: 2800, resonance: 0.4, envMod: 0.9}, vca: {level: 0.85}, envelope: {attack: 0.001, decay: 0.18, sustain: 0.2, release: 0.15}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'lead_detuned': {name: 'Detuned Lead', category: 'Lead', vco1: {waveform: 'sawtooth', frequency: 440, fine: 0, mod: 0.2}, vco2: {waveform: 'sawtooth', frequency: 440, fine: -18, mod: 0.2}, vcf: {cutoff: 1800, resonance: 0.55, envMod: 0.65}, vca: {level: 0.8}, envelope: {attack: 0.02, decay: 0.3, sustain: 0.65, release: 0.5}, lfo: {rate: 5, depth: 0.18, destination: 'filter'}},
            'lead_fat_saw': {name: 'Fat Saw Lead', category: 'Lead', vco1: {waveform: 'sawtooth', frequency: 440, fine: 0, mod: 0.15}, vco2: {waveform: 'sawtooth', frequency: 440, fine: 6, mod: 0.15}, vcf: {cutoff: 2600, resonance: 0.45, envMod: 0.7}, vca: {level: 0.88}, envelope: {attack: 0.008, decay: 0.28, sustain: 0.6, release: 0.38}, lfo: {rate: 4.5, depth: 0.16, destination: 'filter'}},
            'lead_squelchy': {name: 'Squelchy Lead', category: 'Lead', vco1: {waveform: 'square', frequency: 440, fine: 0, mod: 0.3}, vco2: {waveform: 'square', frequency: 440, fine: -5, mod: 0.3}, vcf: {cutoff: 1200, resonance: 0.85, envMod: 0.88}, vca: {level: 0.82}, envelope: {attack: 0.01, decay: 0.22, sustain: 0.48, release: 0.25}, lfo: {rate: 7, depth: 0.3, destination: 'filter'}},
            'lead_portamento': {name: 'Portamento Lead', category: 'Lead', vco1: {waveform: 'sawtooth', frequency: 440, fine: 0, mod: 0.25}, vco2: {waveform: 'triangle', frequency: 440, fine: 7, mod: 0.25}, vcf: {cutoff: 1900, resonance: 0.5, envMod: 0.62}, vca: {level: 0.85}, envelope: {attack: 0.05, decay: 0.32, sustain: 0.72, release: 0.45}, lfo: {rate: 3.8, depth: 0.12, destination: 'pitch'}},
            'lead_screamer': {name: 'Screamer Lead', category: 'Lead', vco1: {waveform: 'sawtooth', frequency: 440, fine: 0, mod: 0.4}, vco2: {waveform: 'square', frequency: 440, fine: 0, mod: 0.4}, vcf: {cutoff: 3500, resonance: 0.95, envMod: 0.92}, vca: {level: 0.95}, envelope: {attack: 0.002, decay: 0.15, sustain: 0.35, release: 0.18}, lfo: {rate: 8, depth: 0.35, destination: 'filter'}},
            'lead_buzzy': {name: 'Buzzy Lead', category: 'Lead', vco1: {waveform: 'square', frequency: 440, fine: 0, mod: 0.2}, vco2: {waveform: 'square', frequency: 440, fine: 12, mod: 0.2}, vcf: {cutoff: 1600, resonance: 0.65, envMod: 0.7}, vca: {level: 0.83}, envelope: {attack: 0.01, decay: 0.26, sustain: 0.55, release: 0.32}, lfo: {rate: 5.5, depth: 0.22, destination: 'filter'}},
            'lead_filter_mod': {name: 'Filter Mod Lead', category: 'Lead', vco1: {waveform: 'sawtooth', frequency: 440, fine: 0, mod: 0.18}, vco2: {waveform: 'sawtooth', frequency: 440, fine: -8, mod: 0.18}, vcf: {cutoff: 2000, resonance: 0.75, envMod: 0.8}, vca: {level: 0.86}, envelope: {attack: 0.012, decay: 0.24, sustain: 0.58, release: 0.35}, lfo: {rate: 6.5, depth: 0.4, destination: 'filter'}},
            'lead_pwm': {name: 'PWM Lead', category: 'Lead', vco1: {waveform: 'square', frequency: 440, fine: 0, mod: 0.6}, vco2: {waveform: 'square', frequency: 440, fine: -7, mod: 0.6}, vcf: {cutoff: 1700, resonance: 0.58, envMod: 0.68}, vca: {level: 0.84}, envelope: {attack: 0.015, decay: 0.29, sustain: 0.62, release: 0.4}, lfo: {rate: 4.2, depth: 0.5, destination: 'pitch'}},
            
            // ========== ADDITIONAL BASS VARIATIONS (60 total) ==========
            'bass_deep_house': {name: 'Deep House Bass', category: 'Bass', vco1: {waveform: 'sine', frequency: 55, fine: 0, mod: 0}, vco2: {waveform: 'triangle', frequency: 55, fine: 0, mod: 0}, vcf: {cutoff: 450, resonance: 0.25, envMod: 0.4}, vca: {level: 0.95}, envelope: {attack: 0.005, decay: 0.6, sustain: 0.5, release: 0.25}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'bass_techno': {name: 'Techno Bass', category: 'Bass', vco1: {waveform: 'sawtooth', frequency: 55, fine: 0, mod: 0}, vco2: {waveform: 'square', frequency: 55, fine: -7, mod: 0}, vcf: {cutoff: 700, resonance: 0.6, envMod: 0.75}, vca: {level: 0.92}, envelope: {attack: 0.002, decay: 0.35, sustain: 0.4, release: 0.18}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'bass_growl': {name: 'Growl Bass', category: 'Bass', vco1: {waveform: 'sawtooth', frequency: 55, fine: 0, mod: 0.3}, vco2: {waveform: 'sawtooth', frequency: 55, fine: -20, mod: 0.3}, vcf: {cutoff: 550, resonance: 0.72, envMod: 0.65}, vca: {level: 0.96}, envelope: {attack: 0.01, decay: 0.45, sustain: 0.7, release: 0.3}, lfo: {rate: 3, depth: 0.6, destination: 'filter'}},
            'bass_fm': {name: 'FM Bass', category: 'Bass', vco1: {waveform: 'sine', frequency: 55, fine: 0, mod: 0.8}, vco2: {waveform: 'square', frequency: 110, fine: 0, mod: 0.8}, vcf: {cutoff: 650, resonance: 0.5, envMod: 0.7}, vca: {level: 0.88}, envelope: {attack: 0.003, decay: 0.28, sustain: 0.35, release: 0.15}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'bass_punchy': {name: 'Punchy Bass', category: 'Bass', vco1: {waveform: 'triangle', frequency: 55, fine: 0, mod: 0}, vco2: {waveform: 'sine', frequency: 55, fine: -12, mod: 0}, vcf: {cutoff: 580, resonance: 0.45, envMod: 0.65}, vca: {level: 0.94}, envelope: {attack: 0.001, decay: 0.25, sustain: 0.25, release: 0.12}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'bass_dubstep': {name: 'Dubstep Bass', category: 'Bass', vco1: {waveform: 'sawtooth', frequency: 55, fine: 0, mod: 0.4}, vco2: {waveform: 'square', frequency: 55, fine: -12, mod: 0.4}, vcf: {cutoff: 480, resonance: 0.85, envMod: 0.55}, vca: {level: 0.98}, envelope: {attack: 0.01, decay: 0.5, sustain: 0.75, release: 0.35}, lfo: {rate: 2.5, depth: 0.75, destination: 'filter'}},
            'bass_distorted': {name: 'Distorted Bass', category: 'Bass', vco1: {waveform: 'square', frequency: 55, fine: 0, mod: 0.25}, vco2: {waveform: 'sawtooth', frequency: 55, fine: -8, mod: 0.25}, vcf: {cutoff: 720, resonance: 0.68, envMod: 0.72}, vca: {level: 1.0}, envelope: {attack: 0.005, decay: 0.4, sustain: 0.55, release: 0.22}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'bass_minimal': {name: 'Minimal Bass', category: 'Bass', vco1: {waveform: 'sine', frequency: 55, fine: 0, mod: 0}, vco2: {waveform: 'sine', frequency: 110, fine: 0, mod: 0}, vcf: {cutoff: 350, resonance: 0.15, envMod: 0.35}, vca: {level: 0.9}, envelope: {attack: 0.002, decay: 0.5, sustain: 0.3, release: 0.15}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'bass_pluck': {name: 'Pluck Bass', category: 'Bass', vco1: {waveform: 'triangle', frequency: 55, fine: 0, mod: 0.1}, vco2: {waveform: 'sine', frequency: 110, fine: 0, mod: 0.1}, vcf: {cutoff: 800, resonance: 0.4, envMod: 0.8}, vca: {level: 0.87}, envelope: {attack: 0.001, decay: 0.2, sustain: 0.15, release: 0.1}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'bass_rubber': {name: 'Rubber Bass', category: 'Bass', vco1: {waveform: 'sawtooth', frequency: 55, fine: 0, mod: 0.35}, vco2: {waveform: 'sawtooth', frequency: 55, fine: -16, mod: 0.35}, vcf: {cutoff: 600, resonance: 0.78, envMod: 0.68}, vca: {level: 0.93}, envelope: {attack: 0.008, decay: 0.38, sustain: 0.65, release: 0.28}, lfo: {rate: 4.5, depth: 0.55, destination: 'filter'}},
            
            // ========== ADDITIONAL PAD VARIATIONS (80 total) ==========
            'pad_evolving': {name: 'Evolving Pad', category: 'Pad', vco1: {waveform: 'sawtooth', frequency: 220, fine: 0, mod: 0.18}, vco2: {waveform: 'triangle', frequency: 220, fine: 9, mod: 0.18}, vcf: {cutoff: 1100, resonance: 0.38, envMod: 0.42}, vca: {level: 0.68}, envelope: {attack: 1.5, decay: 0.9, sustain: 0.78, release: 2.2}, lfo: {rate: 0.22, depth: 0.35, destination: 'filter'}},
            'pad_dreamy': {name: 'Dreamy Pad', category: 'Pad', vco1: {waveform: 'sine', frequency: 220, fine: 0, mod: 0.12}, vco2: {waveform: 'triangle', frequency: 220, fine: 7, mod: 0.12}, vcf: {cutoff: 1300, resonance: 0.28, envMod: 0.38}, vca: {level: 0.62}, envelope: {attack: 1.8, decay: 1.1, sustain: 0.82, release: 2.5}, lfo: {rate: 0.18, depth: 0.22, destination: 'pitch'}},
            'pad_cathedral': {name: 'Cathedral Pad', category: 'Pad', vco1: {waveform: 'sawtooth', frequency: 220, fine: 0, mod: 0.08}, vco2: {waveform: 'sine', frequency: 440, fine: 0, mod: 0.08}, vcf: {cutoff: 950, resonance: 0.32, envMod: 0.3}, vca: {level: 0.58}, envelope: {attack: 2.0, decay: 1.2, sustain: 0.85, release: 2.8}, lfo: {rate: 0.12, depth: 0.18, destination: 'filter'}},
            'pad_choir': {name: 'Choir Pad', category: 'Pad', vco1: {waveform: 'triangle', frequency: 220, fine: 0, mod: 0.15}, vco2: {waveform: 'sine', frequency: 220, fine: 12, mod: 0.15}, vcf: {cutoff: 1400, resonance: 0.25, envMod: 0.35}, vca: {level: 0.65}, envelope: {attack: 1.2, decay: 0.8, sustain: 0.88, release: 1.8}, lfo: {rate: 0.28, depth: 0.2, destination: 'vca'}},
            'pad_ice': {name: 'Ice Pad', category: 'Pad', vco1: {waveform: 'sine', frequency: 220, fine: 0, mod: 0.1}, vco2: {waveform: 'triangle', frequency: 440, fine: 5, mod: 0.1}, vcf: {cutoff: 1600, resonance: 0.22, envMod: 0.32}, vca: {level: 0.6}, envelope: {attack: 1.6, decay: 0.95, sustain: 0.75, release: 2.0}, lfo: {rate: 0.32, depth: 0.28, destination: 'filter'}},
            'pad_synth_brass': {name: 'Synth Brass Pad', category: 'Pad', vco1: {waveform: 'sawtooth', frequency: 220, fine: 0, mod: 0.22}, vco2: {waveform: 'square', frequency: 220, fine: -5, mod: 0.22}, vcf: {cutoff: 1250, resonance: 0.55, envMod: 0.58}, vca: {level: 0.78}, envelope: {attack: 0.9, decay: 0.6, sustain: 0.8, release: 1.4}, lfo: {rate: 0.25, depth: 0.25, destination: 'filter'}},
            'pad_glass': {name: 'Glass Pad', category: 'Pad', vco1: {waveform: 'triangle', frequency: 220, fine: 0, mod: 0.08}, vco2: {waveform: 'sine', frequency: 880, fine: 0, mod: 0.08}, vcf: {cutoff: 1800, resonance: 0.18, envMod: 0.28}, vca: {level: 0.55}, envelope: {attack: 1.4, decay: 0.85, sustain: 0.72, release: 1.9}, lfo: {rate: 0.35, depth: 0.24, destination: 'filter'}},
            'pad_soft_strings': {name: 'Soft Strings Pad', category: 'Pad', vco1: {waveform: 'sawtooth', frequency: 220, fine: 0, mod: 0.14}, vco2: {waveform: 'triangle', frequency: 220, fine: 8, mod: 0.14}, vcf: {cutoff: 1150, resonance: 0.3, envMod: 0.4}, vca: {level: 0.7}, envelope: {attack: 1.1, decay: 0.75, sustain: 0.82, release: 1.6}, lfo: {rate: 0.2, depth: 0.19, destination: 'pitch'}},
            'pad_ambient': {name: 'Ambient Pad', category: 'Pad', vco1: {waveform: 'sine', frequency: 220, fine: 0, mod: 0.05}, vco2: {waveform: 'triangle', frequency: 220, fine: 3, mod: 0.05}, vcf: {cutoff: 1050, resonance: 0.2, envMod: 0.25}, vca: {level: 0.52}, envelope: {attack: 2.2, decay: 1.5, sustain: 0.8, release: 3.0}, lfo: {rate: 0.08, depth: 0.15, destination: 'filter'}},
            'pad_metallic': {name: 'Metallic Pad', category: 'Pad', vco1: {waveform: 'sawtooth', frequency: 220, fine: 0, mod: 0.25}, vco2: {waveform: 'square', frequency: 220, fine: 14, mod: 0.25}, vcf: {cutoff: 1700, resonance: 0.65, envMod: 0.55}, vca: {level: 0.72}, envelope: {attack: 1.3, decay: 0.85, sustain: 0.76, release: 1.7}, lfo: {rate: 0.4, depth: 0.4, destination: 'filter'}},
            
            // ========== ADDITIONAL PERCUSSION (40 total) ==========
            'perc_rim': {name: 'Rim Shot', category: 'Percussion', vco1: {waveform: 'sine', frequency: 800, fine: 0, mod: 0}, vco2: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vcf: {cutoff: 5000, resonance: 0.3, envMod: 0.8}, vca: {level: 0.9}, envelope: {attack: 0.001, decay: 0.06, sustain: 0, release: 0.04}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'perc_clap': {name: 'Clap', category: 'Percussion', vco1: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vco2: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vcf: {cutoff: 2500, resonance: 0.25, envMod: 0.5}, vca: {level: 0.95}, envelope: {attack: 0.002, decay: 0.12, sustain: 0, release: 0.08}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'perc_cowbell': {name: 'Cowbell', category: 'Percussion', vco1: {waveform: 'square', frequency: 540, fine: 0, mod: 0}, vco2: {waveform: 'square', frequency: 800, fine: 0, mod: 0}, vcf: {cutoff: 4000, resonance: 0.5, envMod: 0.6}, vca: {level: 0.88}, envelope: {attack: 0.001, decay: 0.18, sustain: 0, release: 0.12}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'perc_tom': {name: 'Tom', category: 'Percussion', vco1: {waveform: 'sine', frequency: 120, fine: 0, mod: 0}, vco2: {waveform: 'sine', frequency: 90, fine: 0, mod: 0}, vcf: {cutoff: 1200, resonance: 0.4, envMod: 0.7}, vca: {level: 1.0}, envelope: {attack: 0.001, decay: 0.25, sustain: 0, release: 0.15}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'perc_conga': {name: 'Conga', category: 'Percussion', vco1: {waveform: 'sine', frequency: 200, fine: 0, mod: 0}, vco2: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vcf: {cutoff: 2800, resonance: 0.35, envMod: 0.65}, vca: {level: 0.92}, envelope: {attack: 0.002, decay: 0.2, sustain: 0, release: 0.12}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'perc_shaker': {name: 'Shaker', category: 'Percussion', vco1: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vco2: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vcf: {cutoff: 9000, resonance: 0.2, envMod: 0.4}, vca: {level: 0.65}, envelope: {attack: 0.001, decay: 0.05, sustain: 0, release: 0.03}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'perc_tambourine': {name: 'Tambourine', category: 'Percussion', vco1: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vco2: {waveform: 'square', frequency: 1200, fine: 0, mod: 0}, vcf: {cutoff: 6000, resonance: 0.45, envMod: 0.6}, vca: {level: 0.75}, envelope: {attack: 0.001, decay: 0.1, sustain: 0, release: 0.08}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'perc_bongo': {name: 'Bongo', category: 'Percussion', vco1: {waveform: 'sine', frequency: 300, fine: 0, mod: 0}, vco2: {waveform: 'sine', frequency: 220, fine: 0, mod: 0}, vcf: {cutoff: 2200, resonance: 0.38, envMod: 0.68}, vca: {level: 0.85}, envelope: {attack: 0.002, decay: 0.16, sustain: 0, release: 0.1}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'perc_woodblock': {name: 'Woodblock', category: 'Percussion', vco1: {waveform: 'square', frequency: 600, fine: 0, mod: 0}, vco2: {waveform: 'sine', frequency: 400, fine: 0, mod: 0}, vcf: {cutoff: 3500, resonance: 0.5, envMod: 0.75}, vca: {level: 0.9}, envelope: {attack: 0.001, decay: 0.08, sustain: 0, release: 0.05}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'perc_triangle': {name: 'Triangle', category: 'Percussion', vco1: {waveform: 'triangle', frequency: 1200, fine: 0, mod: 0}, vco2: {waveform: 'sine', frequency: 2400, fine: 0, mod: 0}, vcf: {cutoff: 8000, resonance: 0.3, envMod: 0.5}, vca: {level: 0.7}, envelope: {attack: 0.001, decay: 0.3, sustain: 0.1, release: 0.25}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            
            // ========== ADDITIONAL FX (70 total) ==========
            'fx_whoosh': {name: 'Whoosh', category: 'FX', vco1: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vco2: {waveform: 'sine', frequency: 220, fine: 0, mod: 0}, vcf: {cutoff: 800, resonance: 0.6, envMod: 0.85}, vca: {level: 0.65}, envelope: {attack: 0.3, decay: 1.2, sustain: 0.15, release: 0.6}, lfo: {rate: 0.5, depth: 0.7, destination: 'filter'}},
            'fx_impact': {name: 'Impact', category: 'FX', vco1: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vco2: {waveform: 'sine', frequency: 60, fine: 0, mod: 0}, vcf: {cutoff: 500, resonance: 0.75, envMod: 0.9}, vca: {level: 0.95}, envelope: {attack: 0.001, decay: 0.8, sustain: 0, release: 0.4}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'fx_siren': {name: 'Siren', category: 'FX', vco1: {waveform: 'sine', frequency: 440, fine: 0, mod: 0}, vco2: {waveform: 'square', frequency: 440, fine: 0, mod: 0}, vcf: {cutoff: 2200, resonance: 0.5, envMod: 0.3}, vca: {level: 0.75}, envelope: {attack: 0.1, decay: 0.5, sustain: 0.7, release: 0.5}, lfo: {rate: 1.5, depth: 0.9, destination: 'pitch'}},
            'fx_alarm': {name: 'Alarm', category: 'FX', vco1: {waveform: 'square', frequency: 880, fine: 0, mod: 0}, vco2: {waveform: 'square', frequency: 1100, fine: 0, mod: 0}, vcf: {cutoff: 3000, resonance: 0.45, envMod: 0.4}, vca: {level: 0.85}, envelope: {attack: 0.01, decay: 0.15, sustain: 0.6, release: 0.2}, lfo: {rate: 4, depth: 0.8, destination: 'vca'}},
            'fx_explosion': {name: 'Explosion', category: 'FX', vco1: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vco2: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vcf: {cutoff: 1200, resonance: 0.8, envMod: 0.95}, vca: {level: 1.0}, envelope: {attack: 0.001, decay: 1.5, sustain: 0, release: 0.8}, lfo: {rate: 0.2, depth: 0.6, destination: 'filter'}},
            'fx_wind': {name: 'Wind', category: 'FX', vco1: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vco2: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vcf: {cutoff: 1500, resonance: 0.35, envMod: 0.2}, vca: {level: 0.5}, envelope: {attack: 2.0, decay: 1.0, sustain: 0.5, release: 2.5}, lfo: {rate: 0.15, depth: 0.45, destination: 'filter'}},
            'fx_rain': {name: 'Rain', category: 'FX', vco1: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vco2: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vcf: {cutoff: 3500, resonance: 0.25, envMod: 0.15}, vca: {level: 0.45}, envelope: {attack: 1.5, decay: 1.5, sustain: 0.6, release: 2.0}, lfo: {rate: 0.3, depth: 0.3, destination: 'filter'}},
            'fx_thunder': {name: 'Thunder', category: 'FX', vco1: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vco2: {waveform: 'sine', frequency: 40, fine: 0, mod: 0}, vcf: {cutoff: 600, resonance: 0.65, envMod: 0.85}, vca: {level: 0.85}, envelope: {attack: 0.1, decay: 2.5, sustain: 0.1, release: 1.5}, lfo: {rate: 0.1, depth: 0.5, destination: 'filter'}},
            'fx_helicopter': {name: 'Helicopter', category: 'FX', vco1: {waveform: 'square', frequency: 110, fine: 0, mod: 0}, vco2: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vcf: {cutoff: 1800, resonance: 0.55, envMod: 0.3}, vca: {level: 0.7}, envelope: {attack: 0.5, decay: 0.3, sustain: 0.8, release: 1.0}, lfo: {rate: 12, depth: 0.6, destination: 'pitch'}},
            'fx_robot': {name: 'Robot Voice', category: 'FX', vco1: {waveform: 'square', frequency: 220, fine: 0, mod: 0.4}, vco2: {waveform: 'sawtooth', frequency: 220, fine: -12, mod: 0.4}, vcf: {cutoff: 1400, resonance: 0.7, envMod: 0.6}, vca: {level: 0.8}, envelope: {attack: 0.02, decay: 0.3, sustain: 0.5, release: 0.3}, lfo: {rate: 7, depth: 0.5, destination: 'filter'}},
            
            // ========== BELLS (30 total) ==========
            'bell_tubular': {name: 'Tubular Bells', category: 'Bells', vco1: {waveform: 'sine', frequency: 523, fine: 0, mod: 0}, vco2: {waveform: 'triangle', frequency: 1046, fine: 0, mod: 0}, vcf: {cutoff: 3500, resonance: 0.3, envMod: 0.5}, vca: {level: 0.8}, envelope: {attack: 0.001, decay: 2.5, sustain: 0.3, release: 3.0}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'bell_church': {name: 'Church Bell', category: 'Bells', vco1: {waveform: 'sine', frequency: 261, fine: 0, mod: 0}, vco2: {waveform: 'triangle', frequency: 523, fine: 0, mod: 0}, vcf: {cutoff: 2800, resonance: 0.25, envMod: 0.4}, vca: {level: 0.85}, envelope: {attack: 0.002, decay: 3.5, sustain: 0.2, release: 4.0}, lfo: {rate: 0.1, depth: 0.15, destination: 'pitch'}},
            'bell_glockenspiel': {name: 'Glockenspiel', category: 'Bells', vco1: {waveform: 'triangle', frequency: 1046, fine: 0, mod: 0}, vco2: {waveform: 'sine', frequency: 2093, fine: 0, mod: 0}, vcf: {cutoff: 6000, resonance: 0.2, envMod: 0.4}, vca: {level: 0.75}, envelope: {attack: 0.001, decay: 0.8, sustain: 0.1, release: 0.6}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'bell_wind_chimes': {name: 'Wind Chimes', category: 'Bells', vco1: {waveform: 'sine', frequency: 880, fine: 0, mod: 0}, vco2: {waveform: 'triangle', frequency: 1320, fine: 0, mod: 0}, vcf: {cutoff: 5000, resonance: 0.28, envMod: 0.45}, vca: {level: 0.65}, envelope: {attack: 0.01, decay: 1.5, sustain: 0.15, release: 2.0}, lfo: {rate: 0.2, depth: 0.3, destination: 'pitch'}},
            'bell_hand_bell': {name: 'Hand Bell', category: 'Bells', vco1: {waveform: 'sine', frequency: 698, fine: 0, mod: 0}, vco2: {waveform: 'triangle', frequency: 1396, fine: 0, mod: 0}, vcf: {cutoff: 4200, resonance: 0.32, envMod: 0.5}, vca: {level: 0.78}, envelope: {attack: 0.002, decay: 1.8, sustain: 0.25, release: 2.2}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'bell_sleigh': {name: 'Sleigh Bells', category: 'Bells', vco1: {waveform: 'triangle', frequency: 1760, fine: 0, mod: 0}, vco2: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vcf: {cutoff: 7000, resonance: 0.35, envMod: 0.6}, vca: {level: 0.7}, envelope: {attack: 0.001, decay: 0.15, sustain: 0.05, release: 0.12}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'bell_carillon': {name: 'Carillon', category: 'Bells', vco1: {waveform: 'sine', frequency: 523, fine: 0, mod: 0}, vco2: {waveform: 'sine', frequency: 784, fine: 0, mod: 0}, vcf: {cutoff: 3800, resonance: 0.27, envMod: 0.42}, vca: {level: 0.82}, envelope: {attack: 0.003, decay: 2.8, sustain: 0.28, release: 3.5}, lfo: {rate: 0.08, depth: 0.12, destination: 'pitch'}},
            'bell_crystal': {name: 'Crystal Bell', category: 'Bells', vco1: {waveform: 'sine', frequency: 1318, fine: 0, mod: 0}, vco2: {waveform: 'triangle', frequency: 2637, fine: 0, mod: 0}, vcf: {cutoff: 8000, resonance: 0.22, envMod: 0.38}, vca: {level: 0.68}, envelope: {attack: 0.001, decay: 1.2, sustain: 0.12, release: 1.5}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'bell_temple': {name: 'Temple Bell', category: 'Bells', vco1: {waveform: 'sine', frequency: 196, fine: 0, mod: 0}, vco2: {waveform: 'triangle', frequency: 392, fine: 0, mod: 0}, vcf: {cutoff: 2200, resonance: 0.3, envMod: 0.45}, vca: {level: 0.88}, envelope: {attack: 0.005, decay: 4.0, sustain: 0.18, release: 5.0}, lfo: {rate: 0.05, depth: 0.1, destination: 'pitch'}},
            'bell_music_box': {name: 'Music Box', category: 'Bells', vco1: {waveform: 'triangle', frequency: 1568, fine: 0, mod: 0}, vco2: {waveform: 'sine', frequency: 3136, fine: 0, mod: 0}, vcf: {cutoff: 5500, resonance: 0.25, envMod: 0.4}, vca: {level: 0.72}, envelope: {attack: 0.001, decay: 0.6, sustain: 0.08, release: 0.5}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            
            // ========== KEYS (40 total) ==========
            'keys_clavinet': {name: 'Clavinet', category: 'Keys', vco1: {waveform: 'square', frequency: 440, fine: 0, mod: 0}, vco2: {waveform: 'sawtooth', frequency: 440, fine: -3, mod: 0}, vcf: {cutoff: 2800, resonance: 0.5, envMod: 0.7}, vca: {level: 0.85}, envelope: {attack: 0.001, decay: 0.15, sustain: 0.1, release: 0.08}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'keys_celeste': {name: 'Celeste', category: 'Keys', vco1: {waveform: 'triangle', frequency: 880, fine: 0, mod: 0}, vco2: {waveform: 'sine', frequency: 880, fine: 8, mod: 0}, vcf: {cutoff: 3500, resonance: 0.28, envMod: 0.4}, vca: {level: 0.75}, envelope: {attack: 0.005, decay: 1.2, sustain: 0.4, release: 1.5}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'keys_harpsichord': {name: 'Harpsichord', category: 'Keys', vco1: {waveform: 'sawtooth', frequency: 440, fine: 0, mod: 0}, vco2: {waveform: 'square', frequency: 880, fine: 0, mod: 0}, vcf: {cutoff: 4000, resonance: 0.35, envMod: 0.6}, vca: {level: 0.8}, envelope: {attack: 0.001, decay: 0.25, sustain: 0.15, release: 0.2}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'keys_toy_piano': {name: 'Toy Piano', category: 'Keys', vco1: {waveform: 'triangle', frequency: 880, fine: 0, mod: 0}, vco2: {waveform: 'sine', frequency: 1760, fine: 0, mod: 0}, vcf: {cutoff: 4500, resonance: 0.22, envMod: 0.45}, vca: {level: 0.7}, envelope: {attack: 0.001, decay: 0.18, sustain: 0.05, release: 0.12}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'keys_wurlitzer': {name: 'Wurlitzer EP', category: 'Keys', vco1: {waveform: 'sine', frequency: 440, fine: 0, mod: 0}, vco2: {waveform: 'triangle', frequency: 440, fine: 5, mod: 0}, vcf: {cutoff: 2600, resonance: 0.38, envMod: 0.5}, vca: {level: 0.82}, envelope: {attack: 0.002, decay: 0.8, sustain: 0.5, release: 0.6}, lfo: {rate: 5, depth: 0.08, destination: 'pitch'}},
            'keys_rhodes': {name: 'Rhodes EP', category: 'Keys', vco1: {waveform: 'sine', frequency: 440, fine: 0, mod: 0}, vco2: {waveform: 'triangle', frequency: 880, fine: 0, mod: 0}, vcf: {cutoff: 2400, resonance: 0.32, envMod: 0.48}, vca: {level: 0.8}, envelope: {attack: 0.003, decay: 0.9, sustain: 0.45, release: 0.7}, lfo: {rate: 6, depth: 0.1, destination: 'pitch'}},
            'keys_honky_tonk': {name: 'Honky-Tonk Piano', category: 'Keys', vco1: {waveform: 'triangle', frequency: 440, fine: 0, mod: 0}, vco2: {waveform: 'triangle', frequency: 440, fine: -12, mod: 0}, vcf: {cutoff: 3200, resonance: 0.3, envMod: 0.5}, vca: {level: 0.85}, envelope: {attack: 0.002, decay: 0.5, sustain: 0.3, release: 0.4}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'keys_tack_piano': {name: 'Tack Piano', category: 'Keys', vco1: {waveform: 'sawtooth', frequency: 440, fine: 0, mod: 0}, vco2: {waveform: 'triangle', frequency: 880, fine: 0, mod: 0}, vcf: {cutoff: 5000, resonance: 0.4, envMod: 0.65}, vca: {level: 0.78}, envelope: {attack: 0.001, decay: 0.12, sustain: 0.08, release: 0.1}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'keys_dx_epiano': {name: 'DX E.Piano', category: 'Keys', vco1: {waveform: 'sine', frequency: 440, fine: 0, mod: 0.6}, vco2: {waveform: 'sine', frequency: 880, fine: 0, mod: 0.6}, vcf: {cutoff: 2800, resonance: 0.25, envMod: 0.4}, vca: {level: 0.83}, envelope: {attack: 0.003, decay: 0.7, sustain: 0.35, release: 0.65}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'keys_clavichord': {name: 'Clavichord', category: 'Keys', vco1: {waveform: 'triangle', frequency: 440, fine: 0, mod: 0}, vco2: {waveform: 'sine', frequency: 880, fine: 0, mod: 0}, vcf: {cutoff: 3000, resonance: 0.28, envMod: 0.42}, vca: {level: 0.68}, envelope: {attack: 0.005, decay: 0.6, sustain: 0.25, release: 0.5}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            
            // ========== MALLETS (25 total) ==========
            'mallet_vibraphone': {name: 'Vibraphone', category: 'Mallets', vco1: {waveform: 'triangle', frequency: 440, fine: 0, mod: 0}, vco2: {waveform: 'sine', frequency: 880, fine: 0, mod: 0}, vcf: {cutoff: 4500, resonance: 0.25, envMod: 0.4}, vca: {level: 0.8}, envelope: {attack: 0.002, decay: 1.5, sustain: 0.4, release: 2.0}, lfo: {rate: 6, depth: 0.3, destination: 'vca'}},
            'mallet_marimba': {name: 'Marimba', category: 'Mallets', vco1: {waveform: 'triangle', frequency: 440, fine: 0, mod: 0}, vco2: {waveform: 'sine', frequency: 880, fine: 0, mod: 0}, vcf: {cutoff: 3500, resonance: 0.2, envMod: 0.5}, vca: {level: 0.85}, envelope: {attack: 0.001, decay: 0.8, sustain: 0.2, release: 0.6}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'mallet_xylophone': {name: 'Xylophone', category: 'Mallets', vco1: {waveform: 'triangle', frequency: 880, fine: 0, mod: 0}, vco2: {waveform: 'square', frequency: 1760, fine: 0, mod: 0}, vcf: {cutoff: 6000, resonance: 0.28, envMod: 0.55}, vca: {level: 0.75}, envelope: {attack: 0.001, decay: 0.3, sustain: 0.05, release: 0.2}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'mallet_timpani': {name: 'Timpani', category: 'Mallets', vco1: {waveform: 'sine', frequency: 110, fine: 0, mod: 0}, vco2: {waveform: 'triangle', frequency: 220, fine: 0, mod: 0}, vcf: {cutoff: 1200, resonance: 0.4, envMod: 0.7}, vca: {level: 1.0}, envelope: {attack: 0.002, decay: 1.2, sustain: 0.3, release: 0.8}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'mallet_kalimba': {name: 'Kalimba', category: 'Mallets', vco1: {waveform: 'triangle', frequency: 880, fine: 0, mod: 0}, vco2: {waveform: 'sine', frequency: 1760, fine: 0, mod: 0}, vcf: {cutoff: 4000, resonance: 0.22, envMod: 0.45}, vca: {level: 0.7}, envelope: {attack: 0.001, decay: 0.5, sustain: 0.15, release: 0.4}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'mallet_steel_drum': {name: 'Steel Drum', category: 'Mallets', vco1: {waveform: 'sine', frequency: 440, fine: 0, mod: 0}, vco2: {waveform: 'triangle', frequency: 880, fine: 0, mod: 0}, vcf: {cutoff: 5000, resonance: 0.35, envMod: 0.6}, vca: {level: 0.82}, envelope: {attack: 0.001, decay: 1.0, sustain: 0.25, release: 0.8}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'mallet_gong': {name: 'Gong', category: 'Mallets', vco1: {waveform: 'sine', frequency: 130, fine: 0, mod: 0}, vco2: {waveform: 'triangle', frequency: 260, fine: 0, mod: 0}, vcf: {cutoff: 2000, resonance: 0.5, envMod: 0.65}, vca: {level: 0.95}, envelope: {attack: 0.01, decay: 3.5, sustain: 0.4, release: 4.0}, lfo: {rate: 0.1, depth: 0.25, destination: 'pitch'}},
            'mallet_crotales': {name: 'Crotales', category: 'Mallets', vco1: {waveform: 'sine', frequency: 2093, fine: 0, mod: 0}, vco2: {waveform: 'triangle', frequency: 4186, fine: 0, mod: 0}, vcf: {cutoff: 8000, resonance: 0.2, envMod: 0.35}, vca: {level: 0.65}, envelope: {attack: 0.001, decay: 1.8, sustain: 0.2, release: 2.0}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'mallet_orchestra_bells': {name: 'Orchestra Bells', category: 'Mallets', vco1: {waveform: 'triangle', frequency: 1046, fine: 0, mod: 0}, vco2: {waveform: 'sine', frequency: 2093, fine: 0, mod: 0}, vcf: {cutoff: 6500, resonance: 0.25, envMod: 0.4}, vca: {level: 0.75}, envelope: {attack: 0.001, decay: 1.2, sustain: 0.15, release: 1.0}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'mallet_gamelan': {name: 'Gamelan', category: 'Mallets', vco1: {waveform: 'sine', frequency: 523, fine: 0, mod: 0}, vco2: {waveform: 'triangle', frequency: 784, fine: 0, mod: 0}, vcf: {cutoff: 3800, resonance: 0.38, envMod: 0.55}, vca: {level: 0.8}, envelope: {attack: 0.002, decay: 2.0, sustain: 0.3, release: 2.5}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            
            // ========== WOODWINDS (45 total) ==========
            'wood_clarinet': {name: 'Clarinet', category: 'Woodwinds', vco1: {waveform: 'square', frequency: 440, fine: 0, mod: 0}, vco2: {waveform: 'triangle', frequency: 440, fine: 3, mod: 0}, vcf: {cutoff: 1800, resonance: 0.35, envMod: 0.45}, vca: {level: 0.75}, envelope: {attack: 0.08, decay: 0.3, sustain: 0.7, release: 0.4}, lfo: {rate: 5, depth: 0.12, destination: 'pitch'}},
            'wood_oboe': {name: 'Oboe', category: 'Woodwinds', vco1: {waveform: 'sawtooth', frequency: 440, fine: 0, mod: 0.1}, vco2: {waveform: 'square', frequency: 440, fine: -5, mod: 0.1}, vcf: {cutoff: 2200, resonance: 0.4, envMod: 0.5}, vca: {level: 0.78}, envelope: {attack: 0.1, decay: 0.4, sustain: 0.75, release: 0.5}, lfo: {rate: 5.5, depth: 0.15, destination: 'pitch'}},
            'wood_bassoon': {name: 'Bassoon', category: 'Woodwinds', vco1: {waveform: 'sawtooth', frequency: 110, fine: 0, mod: 0.12}, vco2: {waveform: 'triangle', frequency: 110, fine: -3, mod: 0.12}, vcf: {cutoff: 1200, resonance: 0.38, envMod: 0.48}, vca: {level: 0.82}, envelope: {attack: 0.12, decay: 0.45, sustain: 0.72, release: 0.6}, lfo: {rate: 4.8, depth: 0.1, destination: 'pitch'}},
            'wood_piccolo': {name: 'Piccolo', category: 'Woodwinds', vco1: {waveform: 'sine', frequency: 1760, fine: 0, mod: 0}, vco2: {waveform: 'triangle', frequency: 1760, fine: 4, mod: 0}, vcf: {cutoff: 6000, resonance: 0.25, envMod: 0.35}, vca: {level: 0.68}, envelope: {attack: 0.05, decay: 0.25, sustain: 0.65, release: 0.3}, lfo: {rate: 6, depth: 0.18, destination: 'pitch'}},
            'wood_recorder': {name: 'Recorder', category: 'Woodwinds', vco1: {waveform: 'triangle', frequency: 880, fine: 0, mod: 0}, vco2: {waveform: 'sine', frequency: 880, fine: 5, mod: 0}, vcf: {cutoff: 3500, resonance: 0.22, envMod: 0.38}, vca: {level: 0.7}, envelope: {attack: 0.06, decay: 0.3, sustain: 0.68, release: 0.35}, lfo: {rate: 5.2, depth: 0.14, destination: 'pitch'}},
            'wood_pan_flute': {name: 'Pan Flute', category: 'Woodwinds', vco1: {waveform: 'sine', frequency: 880, fine: 0, mod: 0}, vco2: {waveform: 'triangle', frequency: 880, fine: 7, mod: 0}, vcf: {cutoff: 3000, resonance: 0.2, envMod: 0.32}, vca: {level: 0.65}, envelope: {attack: 0.1, decay: 0.4, sustain: 0.7, release: 0.5}, lfo: {rate: 4.5, depth: 0.2, destination: 'pitch'}},
            'wood_saxophone': {name: 'Saxophone', category: 'Woodwinds', vco1: {waveform: 'sawtooth', frequency: 220, fine: 0, mod: 0.15}, vco2: {waveform: 'square', frequency: 220, fine: -6, mod: 0.15}, vcf: {cutoff: 1600, resonance: 0.5, envMod: 0.58}, vca: {level: 0.85}, envelope: {attack: 0.08, decay: 0.35, sustain: 0.78, release: 0.45}, lfo: {rate: 5.8, depth: 0.16, destination: 'pitch'}},
            'wood_english_horn': {name: 'English Horn', category: 'Woodwinds', vco1: {waveform: 'sawtooth', frequency: 330, fine: 0, mod: 0.1}, vco2: {waveform: 'triangle', frequency: 330, fine: -4, mod: 0.1}, vcf: {cutoff: 1700, resonance: 0.42, envMod: 0.52}, vca: {level: 0.76}, envelope: {attack: 0.11, decay: 0.42, sustain: 0.73, release: 0.55}, lfo: {rate: 5, depth: 0.13, destination: 'pitch'}},
            'wood_harmonica': {name: 'Harmonica', category: 'Woodwinds', vco1: {waveform: 'square', frequency: 440, fine: 0, mod: 0.08}, vco2: {waveform: 'sawtooth', frequency: 440, fine: 8, mod: 0.08}, vcf: {cutoff: 2400, resonance: 0.32, envMod: 0.42}, vca: {level: 0.72}, envelope: {attack: 0.05, decay: 0.3, sustain: 0.75, release: 0.4}, lfo: {rate: 6.5, depth: 0.22, destination: 'vca'}},
            'wood_shakuhachi': {name: 'Shakuhachi', category: 'Woodwinds', vco1: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vco2: {waveform: 'sine', frequency: 440, fine: 0, mod: 0}, vcf: {cutoff: 2800, resonance: 0.35, envMod: 0.45}, vca: {level: 0.62}, envelope: {attack: 0.15, decay: 0.5, sustain: 0.65, release: 0.6}, lfo: {rate: 4, depth: 0.25, destination: 'pitch'}},
            
            // ========== AMBIENT (50 total) ==========
            'ambient_drone_dark': {name: 'Dark Drone', category: 'Ambient', vco1: {waveform: 'sawtooth', frequency: 55, fine: 0, mod: 0.05}, vco2: {waveform: 'sine', frequency: 55, fine: -8, mod: 0.05}, vcf: {cutoff: 400, resonance: 0.4, envMod: 0.2}, vca: {level: 0.55}, envelope: {attack: 3.0, decay: 2.0, sustain: 0.75, release: 3.5}, lfo: {rate: 0.05, depth: 0.25, destination: 'filter'}},
            'ambient_texture': {name: 'Texture', category: 'Ambient', vco1: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vco2: {waveform: 'triangle', frequency: 110, fine: 0, mod: 0}, vcf: {cutoff: 1200, resonance: 0.35, envMod: 0.3}, vca: {level: 0.48}, envelope: {attack: 2.5, decay: 1.8, sustain: 0.7, release: 3.0}, lfo: {rate: 0.08, depth: 0.3, destination: 'filter'}},
            'ambient_atmosphere': {name: 'Atmosphere', category: 'Ambient', vco1: {waveform: 'sine', frequency: 110, fine: 0, mod: 0.08}, vco2: {waveform: 'triangle', frequency: 110, fine: 6, mod: 0.08}, vcf: {cutoff: 950, resonance: 0.28, envMod: 0.25}, vca: {level: 0.5}, envelope: {attack: 3.5, decay: 2.2, sustain: 0.8, release: 4.0}, lfo: {rate: 0.1, depth: 0.2, destination: 'pitch'}},
            'ambient_space': {name: 'Space Ambient', category: 'Ambient', vco1: {waveform: 'sine', frequency: 220, fine: 0, mod: 0.12}, vco2: {waveform: 'triangle', frequency: 220, fine: 10, mod: 0.12}, vcf: {cutoff: 1500, resonance: 0.32, envMod: 0.35}, vca: {level: 0.52}, envelope: {attack: 2.8, decay: 1.5, sustain: 0.78, release: 3.2}, lfo: {rate: 0.12, depth: 0.28, destination: 'filter'}},
            'ambient_ocean': {name: 'Ocean Waves', category: 'Ambient', vco1: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vco2: {waveform: 'sine', frequency: 55, fine: 0, mod: 0}, vcf: {cutoff: 800, resonance: 0.25, envMod: 0.2}, vca: {level: 0.45}, envelope: {attack: 4.0, decay: 2.5, sustain: 0.7, release: 4.5}, lfo: {rate: 0.06, depth: 0.35, destination: 'filter'}},
            'ambient_forest': {name: 'Forest', category: 'Ambient', vco1: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vco2: {waveform: 'triangle', frequency: 220, fine: 0, mod: 0}, vcf: {cutoff: 2200, resonance: 0.3, envMod: 0.25}, vca: {level: 0.42}, envelope: {attack: 3.2, decay: 2.0, sustain: 0.65, release: 3.8}, lfo: {rate: 0.15, depth: 0.25, destination: 'filter'}},
            'ambient_ethereal': {name: 'Ethereal', category: 'Ambient', vco1: {waveform: 'sine', frequency: 440, fine: 0, mod: 0.1}, vco2: {waveform: 'triangle', frequency: 440, fine: 12, mod: 0.1}, vcf: {cutoff: 1800, resonance: 0.22, envMod: 0.3}, vca: {level: 0.48}, envelope: {attack: 2.5, decay: 1.8, sustain: 0.82, release: 3.5}, lfo: {rate: 0.18, depth: 0.22, destination: 'pitch'}},
            'ambient_cosmic': {name: 'Cosmic', category: 'Ambient', vco1: {waveform: 'sawtooth', frequency: 110, fine: 0, mod: 0.15}, vco2: {waveform: 'sine', frequency: 110, fine: -12, mod: 0.15}, vcf: {cutoff: 1100, resonance: 0.38, envMod: 0.32}, vca: {level: 0.5}, envelope: {attack: 3.0, decay: 2.2, sustain: 0.75, release: 4.0}, lfo: {rate: 0.09, depth: 0.3, destination: 'filter'}},
            'ambient_cave': {name: 'Cave Resonance', category: 'Ambient', vco1: {waveform: 'triangle', frequency: 82, fine: 0, mod: 0.06}, vco2: {waveform: 'sine', frequency: 82, fine: -5, mod: 0.06}, vcf: {cutoff: 650, resonance: 0.45, envMod: 0.28}, vca: {level: 0.53}, envelope: {attack: 3.5, decay: 2.5, sustain: 0.72, release: 4.2}, lfo: {rate: 0.07, depth: 0.28, destination: 'filter'}},
            'ambient_meditation': {name: 'Meditation', category: 'Ambient', vco1: {waveform: 'sine', frequency: 174, fine: 0, mod: 0.04}, vco2: {waveform: 'triangle', frequency: 174, fine: 4, mod: 0.04}, vcf: {cutoff: 1000, resonance: 0.2, envMod: 0.22}, vca: {level: 0.46}, envelope: {attack: 4.0, decay: 3.0, sustain: 0.8, release: 5.0}, lfo: {rate: 0.05, depth: 0.15, destination: 'pitch'}},
            
            // ========== SYNTH (60 total) ==========
            'synth_analog_bass': {name: 'Analog Bass Synth', category: 'Synth', vco1: {waveform: 'sawtooth', frequency: 55, fine: 0, mod: 0.15}, vco2: {waveform: 'square', frequency: 55, fine: -8, mod: 0.15}, vcf: {cutoff: 650, resonance: 0.72, envMod: 0.78}, vca: {level: 0.95}, envelope: {attack: 0.005, decay: 0.4, sustain: 0.5, release: 0.25}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'synth_digital_bell': {name: 'Digital Bell', category: 'Synth', vco1: {waveform: 'sine', frequency: 880, fine: 0, mod: 0.7}, vco2: {waveform: 'sine', frequency: 1320, fine: 0, mod: 0.7}, vcf: {cutoff: 5000, resonance: 0.35, envMod: 0.5}, vca: {level: 0.75}, envelope: {attack: 0.001, decay: 1.5, sustain: 0.2, release: 1.8}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'synth_fm_brass': {name: 'FM Brass', category: 'Synth', vco1: {waveform: 'sine', frequency: 220, fine: 0, mod: 0.8}, vco2: {waveform: 'sine', frequency: 440, fine: 0, mod: 0.8}, vcf: {cutoff: 1800, resonance: 0.48, envMod: 0.58}, vca: {level: 0.82}, envelope: {attack: 0.08, decay: 0.45, sustain: 0.72, release: 0.5}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'synth_wavetable': {name: 'Wavetable Synth', category: 'Synth', vco1: {waveform: 'sawtooth', frequency: 220, fine: 0, mod: 0.4}, vco2: {waveform: 'triangle', frequency: 220, fine: 8, mod: 0.4}, vcf: {cutoff: 2000, resonance: 0.55, envMod: 0.65}, vca: {level: 0.78}, envelope: {attack: 0.02, decay: 0.35, sustain: 0.65, release: 0.4}, lfo: {rate: 3.5, depth: 0.4, destination: 'filter'}},
            'synth_hoover': {name: 'Hoover Synth', category: 'Synth', vco1: {waveform: 'sawtooth', frequency: 220, fine: 0, mod: 0.25}, vco2: {waveform: 'sawtooth', frequency: 220, fine: -14, mod: 0.25}, vcf: {cutoff: 1400, resonance: 0.68, envMod: 0.72}, vca: {level: 0.88}, envelope: {attack: 0.01, decay: 0.3, sustain: 0.7, release: 0.35}, lfo: {rate: 5, depth: 0.45, destination: 'filter'}},
            'synth_supersaw': {name: 'Supersaw', category: 'Synth', vco1: {waveform: 'sawtooth', frequency: 220, fine: 0, mod: 0.2}, vco2: {waveform: 'sawtooth', frequency: 220, fine: -10, mod: 0.2}, vcf: {cutoff: 2400, resonance: 0.48, envMod: 0.62}, vca: {level: 0.85}, envelope: {attack: 0.015, decay: 0.32, sustain: 0.68, release: 0.45}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'synth_rave_stab': {name: 'Rave Stab', category: 'Synth', vco1: {waveform: 'sawtooth', frequency: 220, fine: 0, mod: 0.3}, vco2: {waveform: 'square', frequency: 220, fine: -12, mod: 0.3}, vcf: {cutoff: 3000, resonance: 0.85, envMod: 0.92}, vca: {level: 0.95}, envelope: {attack: 0.001, decay: 0.25, sustain: 0.15, release: 0.2}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'synth_granular': {name: 'Granular Synth', category: 'Synth', vco1: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vco2: {waveform: 'triangle', frequency: 440, fine: 0, mod: 0.3}, vcf: {cutoff: 1600, resonance: 0.42, envMod: 0.55}, vca: {level: 0.68}, envelope: {attack: 0.5, decay: 0.6, sustain: 0.6, release: 0.8}, lfo: {rate: 8, depth: 0.5, destination: 'filter'}},
            'synth_vocal': {name: 'Vocal Synth', category: 'Synth', vco1: {waveform: 'sawtooth', frequency: 220, fine: 0, mod: 0.18}, vco2: {waveform: 'triangle', frequency: 220, fine: 7, mod: 0.18}, vcf: {cutoff: 1200, resonance: 0.65, envMod: 0.5}, vca: {level: 0.72}, envelope: {attack: 0.1, decay: 0.4, sustain: 0.75, release: 0.5}, lfo: {rate: 4, depth: 0.35, destination: 'filter'}},
            'synth_pluck_synth': {name: 'Pluck Synth', category: 'Synth', vco1: {waveform: 'triangle', frequency: 440, fine: 0, mod: 0.12}, vco2: {waveform: 'sine', frequency: 880, fine: 0, mod: 0.12}, vcf: {cutoff: 2800, resonance: 0.38, envMod: 0.85}, vca: {level: 0.8}, envelope: {attack: 0.001, decay: 0.2, sustain: 0.12, release: 0.15}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            
            // ========== TECHNO BASS VARIATIONS (30 total) ==========
            'techno_bass_driving': {name: 'Driving Techno Bass', category: 'Bass', vco1: {waveform: 'sawtooth', frequency: 55, fine: 0, mod: 0.2}, vco2: {waveform: 'square', frequency: 55, fine: -7, mod: 0.2}, vcf: {cutoff: 650, resonance: 0.75, envMod: 0.82}, vca: {level: 0.98}, envelope: {attack: 0.001, decay: 0.32, sustain: 0.38, release: 0.16}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'techno_bass_rolling': {name: 'Rolling Bass', category: 'Bass', vco1: {waveform: 'sawtooth', frequency: 55, fine: 0, mod: 0.18}, vco2: {waveform: 'sawtooth', frequency: 55, fine: -12, mod: 0.18}, vcf: {cutoff: 720, resonance: 0.68, envMod: 0.78}, vca: {level: 0.96}, envelope: {attack: 0.002, decay: 0.28, sustain: 0.42, release: 0.18}, lfo: {rate: 8, depth: 0.25, destination: 'filter'}},
            'techno_bass_detroit': {name: 'Detroit Bass', category: 'Bass', vco1: {waveform: 'triangle', frequency: 55, fine: 0, mod: 0.12}, vco2: {waveform: 'sine', frequency: 55, fine: 0, mod: 0.12}, vcf: {cutoff: 480, resonance: 0.42, envMod: 0.58}, vca: {level: 0.94}, envelope: {attack: 0.003, decay: 0.45, sustain: 0.48, release: 0.22}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'techno_bass_berlin': {name: 'Berlin Bass', category: 'Bass', vco1: {waveform: 'square', frequency: 55, fine: 0, mod: 0.22}, vco2: {waveform: 'sawtooth', frequency: 55, fine: -8, mod: 0.22}, vcf: {cutoff: 680, resonance: 0.72, envMod: 0.75}, vca: {level: 0.97}, envelope: {attack: 0.002, decay: 0.35, sustain: 0.4, release: 0.17}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'techno_bass_industrial': {name: 'Industrial Bass', category: 'Bass', vco1: {waveform: 'square', frequency: 55, fine: 0, mod: 0.35}, vco2: {waveform: 'square', frequency: 55, fine: -14, mod: 0.35}, vcf: {cutoff: 750, resonance: 0.82, envMod: 0.72}, vca: {level: 1.0}, envelope: {attack: 0.001, decay: 0.3, sustain: 0.35, release: 0.15}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'techno_bass_monolake': {name: 'Monolake Bass', category: 'Bass', vco1: {waveform: 'sine', frequency: 55, fine: 0, mod: 0.25}, vco2: {waveform: 'triangle', frequency: 110, fine: 0, mod: 0.25}, vcf: {cutoff: 520, resonance: 0.55, envMod: 0.68}, vca: {level: 0.92}, envelope: {attack: 0.004, decay: 0.5, sustain: 0.45, release: 0.25}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'techno_bass_hardgroove': {name: 'Hard Groove Bass', category: 'Bass', vco1: {waveform: 'sawtooth', frequency: 55, fine: 0, mod: 0.28}, vco2: {waveform: 'square', frequency: 55, fine: -10, mod: 0.28}, vcf: {cutoff: 780, resonance: 0.78, envMod: 0.8}, vca: {level: 0.99}, envelope: {attack: 0.001, decay: 0.25, sustain: 0.32, release: 0.14}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'techno_bass_schranz': {name: 'Schranz Bass', category: 'Bass', vco1: {waveform: 'square', frequency: 55, fine: 0, mod: 0.4}, vco2: {waveform: 'sawtooth', frequency: 55, fine: -16, mod: 0.4}, vcf: {cutoff: 850, resonance: 0.88, envMod: 0.68}, vca: {level: 1.0}, envelope: {attack: 0.001, decay: 0.22, sustain: 0.28, release: 0.12}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'techno_bass_hypnotic': {name: 'Hypnotic Bass', category: 'Bass', vco1: {waveform: 'sawtooth', frequency: 55, fine: 0, mod: 0.15}, vco2: {waveform: 'triangle', frequency: 55, fine: -5, mod: 0.15}, vcf: {cutoff: 580, resonance: 0.62, envMod: 0.7}, vca: {level: 0.93}, envelope: {attack: 0.003, decay: 0.38, sustain: 0.5, release: 0.2}, lfo: {rate: 4, depth: 0.18, destination: 'filter'}},
            'techno_bass_warehouse': {name: 'Warehouse Bass', category: 'Bass', vco1: {waveform: 'sawtooth', frequency: 55, fine: 0, mod: 0.24}, vco2: {waveform: 'sawtooth', frequency: 55, fine: -20, mod: 0.24}, vcf: {cutoff: 620, resonance: 0.7, envMod: 0.76}, vca: {level: 0.95}, envelope: {attack: 0.002, decay: 0.42, sustain: 0.44, release: 0.19}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            
            // ========== TECHNO LEAD VARIATIONS (25 total) ==========
            'techno_lead_acid': {name: 'Acid Lead', category: 'Lead', vco1: {waveform: 'square', frequency: 440, fine: 0, mod: 0.35}, vco2: {waveform: 'sawtooth', frequency: 440, fine: -7, mod: 0.35}, vcf: {cutoff: 1100, resonance: 0.88, envMod: 0.92}, vca: {level: 0.86}, envelope: {attack: 0.001, decay: 0.18, sustain: 0.42, release: 0.22}, lfo: {rate: 8, depth: 0.45, destination: 'filter'}},
            'techno_lead_303_style': {name: '303-Style Lead', category: 'Lead', vco1: {waveform: 'square', frequency: 440, fine: 0, mod: 0.4}, vco2: {waveform: 'square', frequency: 440, fine: -12, mod: 0.4}, vcf: {cutoff: 950, resonance: 0.92, envMod: 0.95}, vca: {level: 0.88}, envelope: {attack: 0.001, decay: 0.15, sustain: 0.38, release: 0.18}, lfo: {rate: 10, depth: 0.5, destination: 'filter'}},
            'techno_lead_trance': {name: 'Trance Lead', category: 'Lead', vco1: {waveform: 'sawtooth', frequency: 440, fine: 0, mod: 0.22}, vco2: {waveform: 'sawtooth', frequency: 440, fine: -8, mod: 0.22}, vcf: {cutoff: 2400, resonance: 0.58, envMod: 0.72}, vca: {level: 0.9}, envelope: {attack: 0.01, decay: 0.28, sustain: 0.68, release: 0.42}, lfo: {rate: 5.5, depth: 0.22, destination: 'filter'}},
            'techno_lead_stab': {name: 'Techno Stab', category: 'Lead', vco1: {waveform: 'sawtooth', frequency: 440, fine: 0, mod: 0.28}, vco2: {waveform: 'square', frequency: 440, fine: -10, mod: 0.28}, vcf: {cutoff: 2800, resonance: 0.82, envMod: 0.9}, vca: {level: 0.92}, envelope: {attack: 0.001, decay: 0.2, sustain: 0.12, release: 0.15}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'techno_lead_euro': {name: 'Euro Techno Lead', category: 'Lead', vco1: {waveform: 'sawtooth', frequency: 440, fine: 0, mod: 0.18}, vco2: {waveform: 'triangle', frequency: 440, fine: 6, mod: 0.18}, vcf: {cutoff: 2200, resonance: 0.62, envMod: 0.68}, vca: {level: 0.85}, envelope: {attack: 0.008, decay: 0.25, sustain: 0.58, release: 0.35}, lfo: {rate: 6, depth: 0.2, destination: 'filter'}},
            'techno_lead_minimal': {name: 'Minimal Lead', category: 'Lead', vco1: {waveform: 'triangle', frequency: 440, fine: 0, mod: 0.12}, vco2: {waveform: 'sine', frequency: 440, fine: 4, mod: 0.12}, vcf: {cutoff: 1800, resonance: 0.48, envMod: 0.58}, vca: {level: 0.78}, envelope: {attack: 0.012, decay: 0.32, sustain: 0.62, release: 0.4}, lfo: {rate: 4.5, depth: 0.16, destination: 'pitch'}},
            'techno_lead_riser': {name: 'Techno Riser', category: 'Lead', vco1: {waveform: 'sawtooth', frequency: 440, fine: 0, mod: 0.25}, vco2: {waveform: 'sawtooth', frequency: 440, fine: -14, mod: 0.25}, vcf: {cutoff: 1200, resonance: 0.72, envMod: 0.85}, vca: {level: 0.82}, envelope: {attack: 0.5, decay: 1.5, sustain: 0.7, release: 0.8}, lfo: {rate: 0.5, depth: 0.6, destination: 'filter'}},
            'techno_lead_analog': {name: 'Analog Techno Lead', category: 'Lead', vco1: {waveform: 'sawtooth', frequency: 440, fine: 0, mod: 0.2}, vco2: {waveform: 'sawtooth', frequency: 440, fine: -6, mod: 0.2}, vcf: {cutoff: 2000, resonance: 0.65, envMod: 0.75}, vca: {level: 0.87}, envelope: {attack: 0.006, decay: 0.26, sustain: 0.6, release: 0.38}, lfo: {rate: 5, depth: 0.18, destination: 'filter'}},
            'techno_lead_modular': {name: 'Modular Lead', category: 'Lead', vco1: {waveform: 'square', frequency: 440, fine: 0, mod: 0.32}, vco2: {waveform: 'triangle', frequency: 440, fine: -9, mod: 0.32}, vcf: {cutoff: 1600, resonance: 0.78, envMod: 0.82}, vca: {level: 0.84}, envelope: {attack: 0.004, decay: 0.22, sustain: 0.52, release: 0.28}, lfo: {rate: 7, depth: 0.35, destination: 'filter'}},
            'techno_lead_underground': {name: 'Underground Lead', category: 'Lead', vco1: {waveform: 'sawtooth', frequency: 440, fine: 0, mod: 0.16}, vco2: {waveform: 'square', frequency: 440, fine: -5, mod: 0.16}, vcf: {cutoff: 1400, resonance: 0.68, envMod: 0.72}, vca: {level: 0.8}, envelope: {attack: 0.01, decay: 0.3, sustain: 0.65, release: 0.45}, lfo: {rate: 4, depth: 0.24, destination: 'filter'}},
            
            // ========== TECHNO PAD VARIATIONS (20 total) ==========
            'techno_pad_dark': {name: 'Dark Techno Pad', category: 'Pad', vco1: {waveform: 'sawtooth', frequency: 220, fine: 0, mod: 0.12}, vco2: {waveform: 'triangle', frequency: 220, fine: -8, mod: 0.12}, vcf: {cutoff: 850, resonance: 0.45, envMod: 0.38}, vca: {level: 0.65}, envelope: {attack: 1.8, decay: 1.2, sustain: 0.78, release: 2.5}, lfo: {rate: 0.15, depth: 0.28, destination: 'filter'}},
            'techno_pad_industrial': {name: 'Industrial Pad', category: 'Pad', vco1: {waveform: 'square', frequency: 220, fine: 0, mod: 0.18}, vco2: {waveform: 'sawtooth', frequency: 220, fine: -12, mod: 0.18}, vcf: {cutoff: 920, resonance: 0.58, envMod: 0.48}, vca: {level: 0.7}, envelope: {attack: 1.5, decay: 1.0, sustain: 0.82, release: 2.2}, lfo: {rate: 0.2, depth: 0.32, destination: 'filter'}},
            'techno_pad_drone': {name: 'Techno Drone', category: 'Pad', vco1: {waveform: 'sawtooth', frequency: 110, fine: 0, mod: 0.08}, vco2: {waveform: 'sine', frequency: 110, fine: -5, mod: 0.08}, vcf: {cutoff: 650, resonance: 0.42, envMod: 0.32}, vca: {level: 0.6}, envelope: {attack: 2.5, decay: 1.5, sustain: 0.85, release: 3.0}, lfo: {rate: 0.08, depth: 0.22, destination: 'filter'}},
            'techno_pad_atmospheric': {name: 'Atmospheric Pad', category: 'Pad', vco1: {waveform: 'sine', frequency: 220, fine: 0, mod: 0.1}, vco2: {waveform: 'triangle', frequency: 220, fine: 8, mod: 0.1}, vcf: {cutoff: 1200, resonance: 0.32, envMod: 0.35}, vca: {level: 0.58}, envelope: {attack: 2.2, decay: 1.4, sustain: 0.8, release: 2.8}, lfo: {rate: 0.12, depth: 0.25, destination: 'pitch'}},
            'techno_pad_warehouse': {name: 'Warehouse Pad', category: 'Pad', vco1: {waveform: 'sawtooth', frequency: 220, fine: 0, mod: 0.14}, vco2: {waveform: 'square', frequency: 220, fine: -10, mod: 0.14}, vcf: {cutoff: 780, resonance: 0.52, envMod: 0.42}, vca: {level: 0.68}, envelope: {attack: 2.0, decay: 1.3, sustain: 0.75, release: 2.6}, lfo: {rate: 0.18, depth: 0.3, destination: 'filter'}},
            'techno_pad_modular': {name: 'Modular Pad', category: 'Pad', vco1: {waveform: 'triangle', frequency: 220, fine: 0, mod: 0.16}, vco2: {waveform: 'sawtooth', frequency: 220, fine: 6, mod: 0.16}, vcf: {cutoff: 1050, resonance: 0.38, envMod: 0.4}, vca: {level: 0.62}, envelope: {attack: 1.6, decay: 1.1, sustain: 0.82, release: 2.3}, lfo: {rate: 0.22, depth: 0.26, destination: 'filter'}},
            'techno_pad_berlin': {name: 'Berlin Pad', category: 'Pad', vco1: {waveform: 'sawtooth', frequency: 220, fine: 0, mod: 0.2}, vco2: {waveform: 'triangle', frequency: 220, fine: -7, mod: 0.2}, vcf: {cutoff: 980, resonance: 0.48, envMod: 0.45}, vca: {level: 0.66}, envelope: {attack: 1.7, decay: 1.15, sustain: 0.8, release: 2.4}, lfo: {rate: 0.16, depth: 0.28, destination: 'filter'}},
            'techno_pad_cosmic': {name: 'Cosmic Techno Pad', category: 'Pad', vco1: {waveform: 'sine', frequency: 220, fine: 0, mod: 0.12}, vco2: {waveform: 'triangle', frequency: 440, fine: 0, mod: 0.12}, vcf: {cutoff: 1350, resonance: 0.28, envMod: 0.38}, vca: {level: 0.55}, envelope: {attack: 2.4, decay: 1.6, sustain: 0.85, release: 3.2}, lfo: {rate: 0.1, depth: 0.24, destination: 'pitch'}},
            'techno_pad_underground': {name: 'Underground Pad', category: 'Pad', vco1: {waveform: 'square', frequency: 220, fine: 0, mod: 0.15}, vco2: {waveform: 'sawtooth', frequency: 220, fine: -9, mod: 0.15}, vcf: {cutoff: 820, resonance: 0.5, envMod: 0.4}, vca: {level: 0.64}, envelope: {attack: 1.9, decay: 1.25, sustain: 0.78, release: 2.5}, lfo: {rate: 0.14, depth: 0.27, destination: 'filter'}},
            'techno_pad_hypnotic': {name: 'Hypnotic Pad', category: 'Pad', vco1: {waveform: 'triangle', frequency: 220, fine: 0, mod: 0.1}, vco2: {waveform: 'sine', frequency: 220, fine: 5, mod: 0.1}, vcf: {cutoff: 1100, resonance: 0.35, envMod: 0.36}, vca: {level: 0.6}, envelope: {attack: 2.1, decay: 1.35, sustain: 0.82, release: 2.7}, lfo: {rate: 0.25, depth: 0.22, destination: 'vca'}},
            
            // ========== TECHNO PERCUSSION (15 total) ==========
            'techno_perc_hat_closed': {name: 'Closed Hat', category: 'Percussion', vco1: {waveform: 'square', frequency: 12000, fine: 0, mod: 0}, vco2: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vcf: {cutoff: 10000, resonance: 0.35, envMod: 0.6}, vca: {level: 0.7}, envelope: {attack: 0.001, decay: 0.04, sustain: 0, release: 0.03}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'techno_perc_hat_open': {name: 'Open Hat', category: 'Percussion', vco1: {waveform: 'square', frequency: 10000, fine: 0, mod: 0}, vco2: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vcf: {cutoff: 11000, resonance: 0.4, envMod: 0.5}, vca: {level: 0.65}, envelope: {attack: 0.001, decay: 0.15, sustain: 0.05, release: 0.12}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'techno_perc_ride': {name: 'Ride Cymbal', category: 'Percussion', vco1: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vco2: {waveform: 'square', frequency: 8000, fine: 0, mod: 0}, vcf: {cutoff: 9000, resonance: 0.32, envMod: 0.45}, vca: {level: 0.68}, envelope: {attack: 0.001, decay: 0.25, sustain: 0.08, release: 0.2}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'techno_perc_crash': {name: 'Crash Cymbal', category: 'Percussion', vco1: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vco2: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vcf: {cutoff: 8000, resonance: 0.38, envMod: 0.55}, vca: {level: 0.8}, envelope: {attack: 0.002, decay: 0.8, sustain: 0.15, release: 0.6}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'techno_perc_zap': {name: 'Zap', category: 'Percussion', vco1: {waveform: 'square', frequency: 2000, fine: 0, mod: 0}, vco2: {waveform: 'sawtooth', frequency: 1000, fine: 0, mod: 0}, vcf: {cutoff: 6000, resonance: 0.75, envMod: 0.9}, vca: {level: 0.75}, envelope: {attack: 0.001, decay: 0.08, sustain: 0, release: 0.05}, lfo: {rate: 25, depth: 0.85, destination: 'pitch'}},
            'techno_perc_blip': {name: 'Blip', category: 'Percussion', vco1: {waveform: 'sine', frequency: 1200, fine: 0, mod: 0}, vco2: {waveform: 'triangle', frequency: 2400, fine: 0, mod: 0}, vcf: {cutoff: 5000, resonance: 0.28, envMod: 0.65}, vca: {level: 0.7}, envelope: {attack: 0.001, decay: 0.06, sustain: 0, release: 0.04}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'techno_perc_click': {name: 'Click', category: 'Percussion', vco1: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vco2: {waveform: 'sine', frequency: 3000, fine: 0, mod: 0}, vcf: {cutoff: 7000, resonance: 0.42, envMod: 0.75}, vca: {level: 0.72}, envelope: {attack: 0.001, decay: 0.03, sustain: 0, release: 0.02}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'techno_perc_909_clap': {name: '909 Clap', category: 'Percussion', vco1: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vco2: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vcf: {cutoff: 2800, resonance: 0.28, envMod: 0.52}, vca: {level: 0.92}, envelope: {attack: 0.002, decay: 0.14, sustain: 0, release: 0.1}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'techno_perc_laser': {name: 'Laser Hit', category: 'Percussion', vco1: {waveform: 'square', frequency: 1500, fine: 0, mod: 0}, vco2: {waveform: 'sawtooth', frequency: 750, fine: 0, mod: 0}, vcf: {cutoff: 5500, resonance: 0.82, envMod: 0.88}, vca: {level: 0.78}, envelope: {attack: 0.001, decay: 0.12, sustain: 0, release: 0.08}, lfo: {rate: 30, depth: 0.9, destination: 'pitch'}},
            'techno_perc_metal': {name: 'Metal Hit', category: 'Percussion', vco1: {waveform: 'square', frequency: 800, fine: 0, mod: 0}, vco2: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vcf: {cutoff: 6500, resonance: 0.68, envMod: 0.72}, vca: {level: 0.82}, envelope: {attack: 0.001, decay: 0.18, sustain: 0, release: 0.14}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            
            // ========== TECHNO FX (20 total) ==========
            'techno_fx_buildup': {name: 'Techno Buildup', category: 'FX', vco1: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vco2: {waveform: 'sawtooth', frequency: 110, fine: 0, mod: 0}, vcf: {cutoff: 500, resonance: 0.68, envMod: 0.9}, vca: {level: 0.7}, envelope: {attack: 2.0, decay: 2.5, sustain: 0.5, release: 1.0}, lfo: {rate: 0.25, depth: 0.75, destination: 'filter'}},
            'techno_fx_sweep_up': {name: 'Sweep Up', category: 'FX', vco1: {waveform: 'sawtooth', frequency: 220, fine: 0, mod: 0}, vco2: {waveform: 'square', frequency: 220, fine: 0, mod: 0}, vcf: {cutoff: 400, resonance: 0.75, envMod: 0.95}, vca: {level: 0.75}, envelope: {attack: 0.5, decay: 1.5, sustain: 0.2, release: 0.5}, lfo: {rate: 0.5, depth: 0.8, destination: 'filter'}},
            'techno_fx_sweep_down': {name: 'Sweep Down', category: 'FX', vco1: {waveform: 'sawtooth', frequency: 880, fine: 0, mod: 0}, vco2: {waveform: 'square', frequency: 880, fine: 0, mod: 0}, vcf: {cutoff: 8000, resonance: 0.78, envMod: -0.92}, vca: {level: 0.72}, envelope: {attack: 0.1, decay: 1.8, sustain: 0.15, release: 0.6}, lfo: {rate: 0.3, depth: 0.7, destination: 'filter'}},
            'techno_fx_transition': {name: 'Transition FX', category: 'FX', vco1: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vco2: {waveform: 'sine', frequency: 440, fine: 0, mod: 0}, vcf: {cutoff: 1200, resonance: 0.65, envMod: 0.85}, vca: {level: 0.68}, envelope: {attack: 0.8, decay: 1.2, sustain: 0.25, release: 0.8}, lfo: {rate: 1.5, depth: 0.65, destination: 'filter'}},
            'techno_fx_riser_short': {name: 'Short Riser', category: 'FX', vco1: {waveform: 'sawtooth', frequency: 110, fine: 0, mod: 0}, vco2: {waveform: 'triangle', frequency: 110, fine: 0, mod: 0}, vcf: {cutoff: 600, resonance: 0.7, envMod: 0.88}, vca: {level: 0.72}, envelope: {attack: 0.2, decay: 0.8, sustain: 0.3, release: 0.4}, lfo: {rate: 2, depth: 0.7, destination: 'filter'}},
            'techno_fx_drop': {name: 'Drop FX', category: 'FX', vco1: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vco2: {waveform: 'sine', frequency: 80, fine: 0, mod: 0}, vcf: {cutoff: 2000, resonance: 0.8, envMod: -0.9}, vca: {level: 0.85}, envelope: {attack: 0.01, decay: 1.5, sustain: 0.1, release: 0.5}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'techno_fx_reverb_hit': {name: 'Reverb Hit', category: 'FX', vco1: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vco2: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vcf: {cutoff: 3500, resonance: 0.45, envMod: 0.6}, vca: {level: 0.78}, envelope: {attack: 0.01, decay: 2.0, sustain: 0.2, release: 1.5}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'techno_fx_noise_burst': {name: 'Noise Burst', category: 'FX', vco1: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vco2: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vcf: {cutoff: 4500, resonance: 0.55, envMod: 0.7}, vca: {level: 0.82}, envelope: {attack: 0.001, decay: 0.3, sustain: 0, release: 0.2}, lfo: {rate: 8, depth: 0.5, destination: 'filter'}},
            'techno_fx_bass_drop': {name: 'Bass Drop', category: 'FX', vco1: {waveform: 'sine', frequency: 55, fine: 0, mod: 0}, vco2: {waveform: 'triangle', frequency: 55, fine: 0, mod: 0}, vcf: {cutoff: 800, resonance: 0.72, envMod: 0.8}, vca: {level: 0.95}, envelope: {attack: 0.001, decay: 0.8, sustain: 0.3, release: 0.5}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'techno_fx_glitch': {name: 'Glitch FX', category: 'FX', vco1: {waveform: 'square', frequency: 880, fine: 0, mod: 0.5}, vco2: {waveform: 'noise', frequency: 0, fine: 0, mod: 0}, vcf: {cutoff: 3200, resonance: 0.68, envMod: 0.75}, vca: {level: 0.7}, envelope: {attack: 0.001, decay: 0.15, sustain: 0.1, release: 0.1}, lfo: {rate: 15, depth: 0.8, destination: 'pitch'}},
            
            // ========== TECHNO SYNTH (15 total) ==========
            'techno_synth_303': {name: 'TB-303 Techno', category: 'Synth', vco1: {waveform: 'square', frequency: 220, fine: 0, mod: 0.4}, vco2: {waveform: 'square', frequency: 220, fine: -7, mod: 0.4}, vcf: {cutoff: 850, resonance: 0.9, envMod: 0.95}, vca: {level: 0.9}, envelope: {attack: 0.001, decay: 0.12, sustain: 0.35, release: 0.15}, lfo: {rate: 10, depth: 0.55, destination: 'filter'}},
            'techno_synth_909_bass': {name: '909 Bass Synth', category: 'Synth', vco1: {waveform: 'sine', frequency: 55, fine: 0, mod: 0.3}, vco2: {waveform: 'triangle', frequency: 55, fine: 0, mod: 0.3}, vcf: {cutoff: 520, resonance: 0.68, envMod: 0.75}, vca: {level: 0.96}, envelope: {attack: 0.002, decay: 0.35, sustain: 0.4, release: 0.18}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'techno_synth_chord': {name: 'Techno Chord', category: 'Synth', vco1: {waveform: 'sawtooth', frequency: 220, fine: 0, mod: 0.22}, vco2: {waveform: 'sawtooth', frequency: 220, fine: -12, mod: 0.22}, vcf: {cutoff: 1800, resonance: 0.58, envMod: 0.68}, vca: {level: 0.82}, envelope: {attack: 0.02, decay: 0.4, sustain: 0.65, release: 0.5}, lfo: {rate: 4, depth: 0.2, destination: 'filter'}},
            'techno_synth_sequence': {name: 'Sequence Synth', category: 'Synth', vco1: {waveform: 'triangle', frequency: 440, fine: 0, mod: 0.18}, vco2: {waveform: 'square', frequency: 440, fine: -5, mod: 0.18}, vcf: {cutoff: 1600, resonance: 0.65, envMod: 0.72}, vca: {level: 0.85}, envelope: {attack: 0.003, decay: 0.2, sustain: 0.25, release: 0.18}, lfo: {rate: 8, depth: 0.28, destination: 'filter'}},
            'techno_synth_arp': {name: 'Techno Arp', category: 'Synth', vco1: {waveform: 'sawtooth', frequency: 440, fine: 0, mod: 0.15}, vco2: {waveform: 'triangle', frequency: 440, fine: 7, mod: 0.15}, vcf: {cutoff: 2200, resonance: 0.52, envMod: 0.65}, vca: {level: 0.78}, envelope: {attack: 0.001, decay: 0.15, sustain: 0.18, release: 0.12}, lfo: {rate: 6, depth: 0.22, destination: 'filter'}},
            'techno_synth_stab_hard': {name: 'Hard Stab', category: 'Synth', vco1: {waveform: 'sawtooth', frequency: 220, fine: 0, mod: 0.32}, vco2: {waveform: 'square', frequency: 220, fine: -14, mod: 0.32}, vcf: {cutoff: 3200, resonance: 0.88, envMod: 0.95}, vca: {level: 0.95}, envelope: {attack: 0.001, decay: 0.18, sustain: 0.08, release: 0.12}, lfo: {rate: 0, depth: 0, destination: 'none'}},
            'techno_synth_detroit': {name: 'Detroit Synth', category: 'Synth', vco1: {waveform: 'triangle', frequency: 220, fine: 0, mod: 0.14}, vco2: {waveform: 'sine', frequency: 220, fine: 5, mod: 0.14}, vcf: {cutoff: 1400, resonance: 0.48, envMod: 0.58}, vca: {level: 0.8}, envelope: {attack: 0.01, decay: 0.35, sustain: 0.6, release: 0.4}, lfo: {rate: 5, depth: 0.18, destination: 'pitch'}},
            'techno_synth_berlin': {name: 'Berlin Synth', category: 'Synth', vco1: {waveform: 'sawtooth', frequency: 220, fine: 0, mod: 0.25}, vco2: {waveform: 'square', frequency: 220, fine: -9, mod: 0.25}, vcf: {cutoff: 1650, resonance: 0.7, envMod: 0.75}, vca: {level: 0.86}, envelope: {attack: 0.008, decay: 0.28, sustain: 0.55, release: 0.35}, lfo: {rate: 6, depth: 0.25, destination: 'filter'}},
            'techno_synth_minimal': {name: 'Minimal Synth', category: 'Synth', vco1: {waveform: 'triangle', frequency: 440, fine: 0, mod: 0.1}, vco2: {waveform: 'sine', frequency: 440, fine: 3, mod: 0.1}, vcf: {cutoff: 1200, resonance: 0.42, envMod: 0.52}, vca: {level: 0.75}, envelope: {attack: 0.012, decay: 0.32, sustain: 0.58, release: 0.38}, lfo: {rate: 3.5, depth: 0.15, destination: 'filter'}},
            'techno_synth_schranz': {name: 'Schranz Synth', category: 'Synth', vco1: {waveform: 'square', frequency: 220, fine: 0, mod: 0.38}, vco2: {waveform: 'sawtooth', frequency: 220, fine: -16, mod: 0.38}, vcf: {cutoff: 2800, resonance: 0.85, envMod: 0.88}, vca: {level: 0.98}, envelope: {attack: 0.001, decay: 0.15, sustain: 0.22, release: 0.14}, lfo: {rate: 0, depth: 0, destination: 'none'}}
        };

        // Track instrument selection (default to original drums)
        const trackInstruments = {
            kick: 'kick',
            snare: 'snare',
            hihat: 'hihat',
            bass: 'bass',
            keys: 'piano_bright',
            lead: 'lead_vintage',
            fx: 'fx_space',
            perc: 'perc_snare'
        };

        // Change instrument for a track
        function changeInstrument(track, instrument) {
            trackInstruments[track] = instrument;
            
            // If bass track and it's a bass_* preset, load corresponding TB-303 preset
            if (track === 'bass' && instrument.startsWith('bass_')) {
                const bassPresetMap = {
                    'bass_classic': 1,   // Acid üß™
                    'bass_deep': 3,      // Deep üåä
                    'bass_acid': 2,      // Squelch üí¶
                    'bass_reese': 5,     // Liquid üíß
                    'bass_wobble': 6,    // Wobble üåÄ
                    'bass_sub': 7        // Sub üîä
                };
                
                const presetNum = bassPresetMap[instrument];
                if (presetNum && tb303Presets[presetNum]) {
                    loadTB303Preset(tb303Presets[presetNum]);
                    console.log(`üéõÔ∏è Loaded TB-303 preset: ${tb303Presets[presetNum].name} for ${instrument}`);
                }
            }
            
            // Update visual feedback
            const label = document.querySelector(`[data-track="${track}"]`)?.closest('div')?.querySelector('.track-label');
            if (label) {
                const preset = ARP2600_PRESETS[instrument];
                if (preset) {
                    // Update label color based on category
                    const categoryColors = {
                        'Lead': '#00D9FF',
                        'Pad': '#9370DB',
                        'Bass': '#39FF14',
                        'FX': '#FF6B35',
                        'Percussion': '#FF006E',
                        'Piano': '#FFD700',
                        'Strings': '#87CEEB',
                        'Violin': '#DDA0DD',
                        'Cello': '#CD853F',
                        'Brass': '#FFA500',
                        'Flute': '#98FB98',
                        'Organ': '#FF1493'
                    };
                    label.style.color = categoryColors[preset.category] || '#FF6B35';
                }
            }
            
            // Show notification
            showNotification(`üéµ ${track.toUpperCase()} ‚Üí ${ARP2600_PRESETS[instrument]?.name || instrument.toUpperCase()}`);
            
            // Test sound on selection
            if (HAOS && HAOS.initialized) {
                playSound(track, null, 0.7);
            }
        }

        // ARP 2600 Synthesizer Engine
        function playARP2600(preset, note = 440, time, velocity = 1.0, duration = 0.5) {
            const ctx = HAOS.audioContext;
            const now = time || ctx.currentTime;
            
            // ============ VCO 1 & 2 (Oscillators) ============
            let vco1Source, vco2Source;
            const vco1Gain = ctx.createGain();
            const vco2Gain = ctx.createGain();
            
            // VCO 1
            if (preset.vco1?.waveform === 'noise') {
                vco1Source = ctx.createBufferSource();
                const buffer = ctx.createBuffer(1, ctx.sampleRate * (duration + 0.1), ctx.sampleRate);
                const data = buffer.getChannelData(0);
                for (let i = 0; i < buffer.length; i++) {
                    data[i] = Math.random() * 2 - 1;
                }
                vco1Source.buffer = buffer;
                vco1Source.loop = false;
            } else {
                vco1Source = ctx.createOscillator();
                vco1Source.type = preset.vco1?.waveform || 'sawtooth';
                // Clamp frequency to valid range
                const baseFreq1 = Math.max(20, Math.min((preset.vco1?.frequency || note), 20000));
                const freq1 = baseFreq1 * Math.pow(2, (preset.vco1?.fine || 0) / 1200);
                vco1Source.frequency.setValueAtTime(Math.min(freq1, ctx.sampleRate / 3), now);
                
                // Apply VCO1 modulation (PWM simulation with detune)
                if ((preset.vco1?.mod || 0) > 0) {
                    vco1Source.detune.setValueAtTime(preset.vco1.mod * 150, now);
                }
            }
            vco1Source.connect(vco1Gain);
            
            // VCO 2
            if (preset.vco2?.waveform === 'noise') {
                vco2Source = ctx.createBufferSource();
                const buffer = ctx.createBuffer(1, ctx.sampleRate * (duration + 0.1), ctx.sampleRate);
                const data = buffer.getChannelData(0);
                for (let i = 0; i < buffer.length; i++) {
                    data[i] = Math.random() * 2 - 1;
                }
                vco2Source.buffer = buffer;
                vco2Source.loop = false;
            } else {
                vco2Source = ctx.createOscillator();
                vco2Source.type = preset.vco2?.waveform || 'square';
                const baseFreq2 = Math.max(20, Math.min((preset.vco2?.frequency || note), 20000));
                const freq2 = baseFreq2 * Math.pow(2, (preset.vco2?.fine || 0) / 1200);
                vco2Source.frequency.setValueAtTime(Math.min(freq2, ctx.sampleRate / 3), now);
                
                // Apply VCO2 modulation
                if ((preset.vco2?.mod || 0) > 0) {
                    vco2Source.detune.setValueAtTime(preset.vco2.mod * 150, now);
                }
            }
            vco2Source.connect(vco2Gain);
            
            // Oscillator mix levels (ARP 2600 style - slightly unequal for richness)
            vco1Gain.gain.value = 0.6;
            vco2Gain.gain.value = 0.5;
            
            // ============ MIXER ============
            const mixer = ctx.createGain();
            mixer.gain.value = 1.0;
            vco1Gain.connect(mixer);
            vco2Gain.connect(mixer);
            
            // ============ VCF (Voltage Controlled Filter) ============
            const vcf = ctx.createBiquadFilter();
            vcf.type = 'lowpass';
            
            // Base filter settings with clamping
            const cutoff = Math.max(30, Math.min(preset.vcf?.cutoff || 1000, 18000));
            const resonance = Math.max(0, Math.min(preset.vcf?.resonance || 0.5, 1));
            const envMod = preset.vcf?.envMod || 0;
            
            // Resonance scaling (ARP 2600 has aggressive resonance)
            vcf.Q.value = Math.min(30, 1 + (resonance * resonance * 25));
            
            // Filter envelope modulation
            const env = preset.envelope || {attack: 0.01, decay: 0.1, sustain: 0.7, release: 0.2};
            
            if (Math.abs(envMod) > 0.01) {
                // Support both positive and negative envelope modulation
                const envAmount = envMod * 8;
                const envPeak = cutoff * (1 + envAmount);
                const clampedPeak = Math.max(30, Math.min(envPeak, 18000));
                const clampedCutoff = Math.max(30, cutoff);
                
                // Exponential envelope for filter (more natural)
                if (envMod > 0) {
                    // Positive modulation (opening filter)
                    vcf.frequency.setValueAtTime(clampedPeak, now);
                    vcf.frequency.exponentialRampToValueAtTime(clampedPeak * 0.9, now + 0.001);
                    vcf.frequency.exponentialRampToValueAtTime(clampedPeak * 0.85, now + env.attack);
                    vcf.frequency.exponentialRampToValueAtTime(
                        clampedCutoff + ((clampedPeak - clampedCutoff) * env.sustain * 0.3),
                        now + env.attack + env.decay
                    );
                } else {
                    // Negative modulation (closing filter)
                    vcf.frequency.setValueAtTime(clampedCutoff, now);
                    vcf.frequency.exponentialRampToValueAtTime(
                        Math.max(30, clampedCutoff * 0.7),
                        now + env.attack + env.decay
                    );
                }
            } else {
                vcf.frequency.setValueAtTime(cutoff, now);
            }
            
            mixer.connect(vcf);
            
            // ============ LFO (Low Frequency Oscillator) ============
            if (preset.lfo && preset.lfo.rate > 0 && preset.lfo.depth > 0) {
                const lfo = ctx.createOscillator();
                const lfoGain = ctx.createGain();
                
                lfo.frequency.value = Math.min(preset.lfo.rate, 40); // Clamp LFO rate
                lfo.type = 'sine';
                
                // Route LFO to destination
                if (preset.lfo.destination === 'filter') {
                    lfoGain.gain.value = cutoff * preset.lfo.depth * 0.6;
                    lfo.connect(lfoGain);
                    lfoGain.connect(vcf.frequency);
                } else if (preset.lfo.destination === 'pitch') {
                    lfoGain.gain.value = preset.lfo.depth * 100;
                    lfo.connect(lfoGain);
                    if (vco1Source.detune) lfoGain.connect(vco1Source.detune);
                    if (vco2Source.detune) lfoGain.connect(vco2Source.detune);
                } else if (preset.lfo.destination === 'vca') {
                    // Tremolo effect - modulate VCA gain
                    lfoGain.gain.value = preset.lfo.depth * 0.5;
                    lfo.connect(lfoGain);
                    // Will be connected to VCA gain below
                }
                
                lfo.start(now);
                lfo.stop(now + duration + 0.1);
            }
            
            // ============ VCA (Voltage Controlled Amplifier) ============
            const vca = ctx.createGain();
            vca.gain.setValueAtTime(0, now);
            
            // ADSR Envelope with exponential curves (more analog feel)
            const vcaLevel = Math.max(0.1, Math.min((preset.vca?.level || 0.8) * velocity, 1.0));
            const attackEnd = now + Math.max(0.001, env.attack);
            const decayEnd = attackEnd + Math.max(0.01, env.decay);
            const releaseStart = now + duration - Math.min(env.release, duration * 0.4);
            const sustainLevel = Math.max(0.001, Math.min(env.sustain, 1.0));
            
            // Attack (exponential)
            vca.gain.setValueAtTime(0.001, now);
            vca.gain.exponentialRampToValueAtTime(vcaLevel, attackEnd);
            
            // Decay (exponential to sustain)
            vca.gain.exponentialRampToValueAtTime(
                Math.max(0.001, vcaLevel * sustainLevel),
                decayEnd
            );
            
            // Sustain (hold)
            vca.gain.setValueAtTime(Math.max(0.001, vcaLevel * sustainLevel), releaseStart);
            
            // Release (exponential)
            vca.gain.exponentialRampToValueAtTime(0.001, releaseStart + Math.max(0.05, env.release));
            
            vcf.connect(vca);
            
            // ============ OUTPUT ============
            vca.connect(HAOS.masterGain);
            
            // ============ START & STOP ============
            vco1Source.start(now);
            vco2Source.start(now);
            
            const stopTime = now + duration + 0.1;
            vco1Source.stop(stopTime);
            vco2Source.stop(stopTime);
        }

        function playSound(track, time, velocity = 1.0) {
            if (!HAOS || !HAOS.initialized) {
                console.warn('HAOS not initialized');
                return;
            }
            
            const ctx = HAOS.audioContext;
            const now = time || ctx.currentTime;
            
            // Get selected instrument for this track
            const instrument = trackInstruments[track] || track;
            
            // Check if it's an ARP 2600 preset
            if (ARP2600_PRESETS[instrument]) {
                const preset = ARP2600_PRESETS[instrument];
                let note = 440; // Default A4
                let duration = 0.3;
                
                // Set note and duration based on category
                switch(preset.category) {
                    case 'Bass':
                        note = 55; // A1
                        duration = 0.5;
                        break;
                    case 'Pad':
                        note = 220; // A3
                        duration = 1.5;
                        break;
                    case 'Lead':
                        note = 440; // A4
                        duration = 0.4;
                        break;
                    case 'Piano':
                        note = 440; // A4
                        duration = 0.6;
                        break;
                    case 'Strings':
                        note = 220; // A3
                        duration = 1.2;
                        break;
                    case 'Violin':
                        note = 440; // A4
                        duration = 0.8;
                        break;
                    case 'Cello':
                        note = 110; // A2
                        duration = 1.0;
                        break;
                    case 'Brass':
                        note = 220; // A3
                        duration = 0.6;
                        break;
                    case 'Flute':
                        note = 440; // A4
                        duration = 0.7;
                        break;
                    case 'Organ':
                        note = 220; // A3
                        duration = 0.9;
                        break;
                    case 'FX':
                        note = 440;
                        duration = 0.8;
                        break;
                    case 'Percussion':
                        note = 0;
                        duration = 0.15;
                        break;
                }
                
                playARP2600(preset, note, now, velocity, duration);
                return;
            }
            
            // Original drum synthesis for backward compatibility
            switch(instrument) {
                case 'kick':
                    // Synthesized kick drum with knob control
                    const kickOsc = ctx.createOscillator();
                    const kickGain = ctx.createGain();
                    
                    // Get knob values
                    const kickTuneKnob = document.querySelector('[data-param="kick-tune"]');
                    const kickDecayKnob = document.querySelector('[data-param="kick-decay"]');
                    const kickTuneValue = kickTuneKnob ? parseFloat(kickTuneKnob.dataset.value) : 0.5;
                    const kickDecayValue = kickDecayKnob ? parseFloat(kickDecayKnob.dataset.value) : 0.5;
                    
                    // Calculate kick parameters from knobs
                    const kickFreq = 50 + (kickTuneValue * 200); // 50Hz - 250Hz
                    const kickDecay = 0.1 + (kickDecayValue * 0.9); // 0.1s - 1s
                    
                    kickOsc.frequency.setValueAtTime(kickFreq, now);
                    kickOsc.frequency.exponentialRampToValueAtTime(0.01, now + kickDecay);
                    kickGain.gain.setValueAtTime(velocity, now);
                    kickGain.gain.exponentialRampToValueAtTime(0.01, now + kickDecay);
                    kickOsc.connect(kickGain).connect(HAOS.masterGain);
                    kickOsc.start(now);
                    kickOsc.stop(now + kickDecay + 0.1);
                    break;
                    
                case 'snare':
                    // Synthesized snare with noise and knob control
                    const snareOsc = ctx.createOscillator();
                    const snareNoise = ctx.createBufferSource();
                    const snareGain = ctx.createGain();
                    const noiseGain = ctx.createGain();
                    
                    // Get snap knob value
                    const snapKnob = document.querySelector('[data-param="snare-snap"]');
                    const snapValue = snapKnob ? parseFloat(snapKnob.dataset.value) : 0.7;
                    
                    // Create noise buffer
                    const noiseBuffer = ctx.createBuffer(1, ctx.sampleRate * 0.2, ctx.sampleRate);
                    const noiseData = noiseBuffer.getChannelData(0);
                    for (let i = 0; i < noiseBuffer.length; i++) {
                        noiseData[i] = Math.random() * 2 - 1;
                    }
                    snareNoise.buffer = noiseBuffer;
                    
                    // Snap controls the tone/noise balance and snap time
                    const toneFreq = 150 + (snapValue * 100); // 150Hz - 250Hz
                    const snapTime = 0.05 + ((1 - snapValue) * 0.15); // 0.05s - 0.2s (higher snap = shorter)
                    const noiseRatio = 0.3 + (snapValue * 0.4); // More snap = more noise
                    
                    snareOsc.frequency.value = toneFreq;
                    snareGain.gain.setValueAtTime(velocity * (1 - noiseRatio), now);
                    snareGain.gain.exponentialRampToValueAtTime(0.01, now + snapTime);
                    noiseGain.gain.setValueAtTime(velocity * noiseRatio, now);
                    noiseGain.gain.exponentialRampToValueAtTime(0.01, now + snapTime * 0.8);
                    
                    snareOsc.connect(snareGain).connect(HAOS.masterGain);
                    snareNoise.connect(noiseGain).connect(HAOS.masterGain);
                    snareOsc.start(now);
                    snareNoise.start(now);
                    snareOsc.stop(now + snapTime);
                    snareNoise.stop(now + snapTime * 0.8);
                    break;
                    
                case 'hihat':
                    // Synthesized hi-hat with high-frequency noise
                    const hihatNoise = ctx.createBufferSource();
                    const hihatBP = ctx.createBiquadFilter();
                    const hihatGain = ctx.createGain();
                    
                    const hihatBuffer = ctx.createBuffer(1, ctx.sampleRate * 0.1, ctx.sampleRate);
                    const hihatData = hihatBuffer.getChannelData(0);
                    for (let i = 0; i < hihatBuffer.length; i++) {
                        hihatData[i] = Math.random() * 2 - 1;
                    }
                    hihatNoise.buffer = hihatBuffer;
                    
                    hihatBP.type = 'bandpass';
                    hihatBP.frequency.value = 10000;
                    hihatBP.Q.value = 1;
                    
                    hihatGain.gain.setValueAtTime(velocity * 0.3, now);
                    hihatGain.gain.exponentialRampToValueAtTime(0.01, now + 0.05);
                    
                    hihatNoise.connect(hihatBP).connect(hihatGain).connect(HAOS.masterGain);
                    hihatNoise.start(now);
                    hihatNoise.stop(now + 0.05);
                    break;
                    
                case 'bass':
                    // TB-303 style bass using current knob parameters
                    const bassOsc = ctx.createOscillator();
                    const bassGain = ctx.createGain();
                    const bassFilter = ctx.createBiquadFilter();
                    const distortion = ctx.createWaveShaper();
                    
                    // Get current TB-303 knob values
                    const cutoffKnob = document.getElementById('tb303-cutoff');
                    const resonanceKnob = document.getElementById('tb303-resonance');
                    const envmodKnob = document.getElementById('tb303-envmod');
                    const decayKnob = document.getElementById('tb303-decay');
                    const distortionKnob = document.getElementById('tb303-distortion');
                    const accentKnob = document.getElementById('tb303-accent');
                    
                    const cutoffValue = cutoffKnob ? parseFloat(cutoffKnob.dataset.value) : 0.5;
                    const resonanceValue = resonanceKnob ? parseFloat(resonanceKnob.dataset.value) : 0.5;
                    const envmodValue = envmodKnob ? parseFloat(envmodKnob.dataset.value) : 0.5;
                    const decayValue = decayKnob ? parseFloat(decayKnob.dataset.value) : 0.5;
                    const distortionValue = distortionKnob ? parseFloat(distortionKnob.dataset.value) : 0.5;
                    const accentValue = accentKnob ? parseFloat(accentKnob.dataset.value) : 0.5;
                    
                    // Apply accent to velocity
                    const accentedVelocity = velocity * (1 + accentValue * 0.5);
                    
                    // Distortion curve (amount controlled by knob)
                    const curve = new Float32Array(256);
                    const deg = Math.PI / 180;
                    const distAmount = 3 + (distortionValue * 40); // 3-43 range
                    for (let i = 0; i < 128; i++) {
                        const x = i * 2 / 128 - 1;
                        curve[128 + i] = distAmount * x * 20 * deg / (Math.PI + 20 * Math.abs(x));
                        curve[128 - i] = -curve[128 + i];
                    }
                    distortion.curve = curve;
                    distortion.oversample = '4x';
                    
                    // TB-303 uses sawtooth wave
                    bassOsc.type = 'sawtooth';
                    bassOsc.frequency.value = 65.41; // C2
                    
                    // Filter with knob-controlled parameters
                    bassFilter.type = 'lowpass';
                    const baseCutoff = 50 + (cutoffValue * 3950); // 50Hz - 4000Hz
                    const envModAmount = baseCutoff * envmodValue * 4; // Envelope modulation depth
                    
                    bassFilter.frequency.setValueAtTime(baseCutoff + envModAmount, now);
                    bassFilter.frequency.exponentialRampToValueAtTime(Math.max(50, baseCutoff), now + (0.01 + decayValue * 1.99));
                    bassFilter.Q.value = 1 + (resonanceValue * 29); // 1-30 range
                    
                    // Envelope with decay from knob
                    const envelopeTime = 0.01 + (decayValue * 1.99); // 0.01s - 2s
                    bassGain.gain.setValueAtTime(accentedVelocity * 0.5, now);
                    bassGain.gain.exponentialRampToValueAtTime(0.01, now + envelopeTime);
                    
                    // Connect: Osc ‚Üí Distortion ‚Üí Filter ‚Üí Gain ‚Üí Master
                    bassOsc.connect(distortion);
                    distortion.connect(bassFilter);
                    bassFilter.connect(bassGain);
                    bassGain.connect(HAOS.masterGain);
                    
                    bassOsc.start(now);
                    bassOsc.stop(now + envelopeTime + 0.1);
                    break;
            }
        }

        // Initialize knob controls
        function initKnobs() {
            const knobs = document.querySelectorAll('.knob:not(.effect-knob)');
            console.log(`üéõÔ∏è Initializing ${knobs.length} parameter knobs...`);
            
            knobs.forEach((knob, index) => {
                let isDragging = false;
                let startY = 0;
                let value = parseFloat(knob.dataset.value) || 0.5;

                knob.addEventListener('mousedown', (e) => {
                    isDragging = true;
                    startY = e.clientY;
                    console.log(`üéõÔ∏è Knob ${index} mousedown - value: ${value}`);
                });

                window.addEventListener('mousemove', (e) => {
                    if (!isDragging) return;
                    const delta = startY - e.clientY;
                    value = Math.min(1, Math.max(0, value + delta * 0.01));
                    knob.dataset.value = value;
                    startY = e.clientY;
                    updateKnobVisual(knob, value);
                    updateKnobParam(knob);
                });

                window.addEventListener('mouseup', () => {
                    if (isDragging) {
                        console.log(`üéõÔ∏è Knob ${index} released - final value: ${value}`);
                    }
                    isDragging = false;
                });

                // Initialize visual
                updateKnobVisual(knob, value);
            });
            
            console.log(`‚úÖ Knobs initialized successfully`);
        }

        function updateKnobVisual(knob, value) {
            const rotation = (value * 270) - 135;
            knob.style.setProperty('--rotation', `${rotation}deg`);
            
            // Also log for debugging
            const param = knob.dataset.param || knob.id || 'unknown';
            console.log(`üîÑ Knob visual update: ${param} = ${Math.round(value * 100)}% (${Math.round(rotation)}¬∞)`);
        }

        function updateKnobParam(knob) {
            const param = knob.dataset.param;
            const value = parseFloat(knob.dataset.value);
            
            // Update live params system if initialized
            if (window.liveParams && param) {
                window.liveParams.setValue(param, value, true);
            }
            
            // Also update HAOS directly for TB-303 parameters
            if (HAOS && HAOS.setParam && param) {
                HAOS.setParam(param, value);
            }
            
            // Master volume control - directly update gain
            if (param === 'master-volume' && HAOS && HAOS.masterGain) {
                HAOS.masterGain.gain.value = value;
            }
            
            // Update value display
            const valueEl = knob.parentElement.querySelector('.knob-value');
            if (valueEl) {
                valueEl.textContent = formatParamValue(param, value);
            }

            // Add visual feedback - glow effect when changing
            knob.style.boxShadow = '0 0 20px rgba(255, 107, 53, 0.8)';
            setTimeout(() => {
                knob.style.boxShadow = '';
            }, 150);
        }

        function formatParamValue(param, value) {
            // Format based on parameter type
            if (!param) return Math.round(value * 100) + '%';
            
            // TB-303 parameters
            if (param.includes('cutoff') || param === 'tb303-cutoff') {
                return Math.round(50 + value * 3950) + ' Hz';
            } else if (param.includes('resonance') || param === 'tb303-resonance') {
                return Math.round(1 + value * 29);
            } else if (param.includes('decay') || param === 'tb303-decay') {
                return (0.01 + value * 1.99).toFixed(2) + 's';
            } else if (param.includes('envmod') || param === 'tb303-envmod') {
                return Math.round(value * 100) + '%';
            } else if (param.includes('distortion') || param === 'tb303-distortion') {
                return Math.round(value * 100) + '%';
            } else if (param.includes('accent') || param === 'tb303-accent') {
                return Math.round(value * 100) + '%';
            }
            // Drum parameters
            else if (param === 'kick-tune') {
                return Math.round(50 + value * 200) + ' Hz';
            } else if (param === 'kick-decay') {
                return (0.1 + value * 0.9).toFixed(2) + 's';
            } else if (param === 'snare-snap') {
                return Math.round(value * 100) + '%';
            }
            // Master parameters
            else if (param === 'master-volume') {
                return Math.round(value * 100) + '%';
            } else if (param === 'master-limiter') {
                return Math.round(-20 + value * 20) + ' dB';
            }
            // Default
            else {
                return Math.round(value * 100) + '%';
            }
        }

        // Sync knobs with parameter values (called when morphing)
        function syncKnobsWithParams() {
            if (!window.liveParams) return;

            document.querySelectorAll('.knob').forEach(knob => {
                const param = knob.dataset.param;
                if (param && window.liveParams.parameters.has(param)) {
                    const value = window.liveParams.getValue(param);
                    knob.dataset.value = value;
                    updateKnobVisual(knob, value);
                    
                    // Update value display
                    const valueEl = knob.parentElement.querySelector('.knob-value');
                    if (valueEl) {
                        valueEl.textContent = formatParamValue(param, value);
                    }
                }
            });
        }

        // Listen for parameter changes and update knobs
        window.addEventListener('parameterChanged', (e) => {
            const { param, value } = e.detail;
            const knob = document.querySelector(`.knob[data-param="${param}"]`);
            if (knob) {
                knob.dataset.value = value;
                updateKnobVisual(knob, value);
                
                const valueEl = knob.parentElement.querySelector('.knob-value');
                if (valueEl) {
                    valueEl.textContent = formatParamValue(param, value);
                }
            }
        });
        // ========== CHORD THEORY & PIANO ROLL ==========
        
        const chordTheory = {
            notes: ['C', 'Db', 'D', 'Eb', 'E', 'F', 'F#', 'G', 'Ab', 'A', 'Bb', 'B'],
            
            progressions: {
                dark_trap: {
                    name: 'Dark Trap',
                    degrees: [0, 5, 2, 6], // i-VI-III-VII
                    description: 'Classic dark trap sound'
                },
                melodic_trap: {
                    name: 'Melodic Trap',
                    degrees: [0, 3, 6, 5], // i-iv-VII-VI
                    description: 'Emotional, melodic vibe'
                },
                drill: {
                    name: 'Drill',
                    degrees: [0, 2, 6, 5], // i-III-VII-VI
                    description: 'UK/NY Drill progression'
                },
                cloud_rap: {
                    name: 'Cloud Rap',
                    degrees: [5, 3, 0, 4], // vi-IV-I-V
                    description: 'Dreamy, atmospheric'
                },
                boom_bap: {
                    name: 'Boom-Bap',
                    degrees: [0, 6, 5, 4], // i-VII-VI-V
                    description: '90s hip-hop classic'
                },
                emotional: {
                    name: 'Emotional',
                    degrees: [0, 4, 5, 2], // i-v-VI-III
                    description: 'Sad, introspective'
                }
            },

            minorScale: [0, 2, 3, 5, 7, 8, 10], // Natural minor intervals
            majorScale: [0, 2, 4, 5, 7, 9, 11],

            getChordNotes(root, type) {
                const rootIndex = this.notes.indexOf(root);
                let intervals;
                
                if (type === 'minor') {
                    intervals = [0, 3, 7]; // Minor triad
                } else if (type === 'major') {
                    intervals = [0, 4, 7]; // Major triad
                } else if (type === 'dim') {
                    intervals = [0, 3, 6]; // Diminished
                }
                
                return intervals.map(interval => 
                    this.notes[(rootIndex + interval) % 12]
                );
            },
            
            getMIDINote(note, octave) {
                const noteIndex = this.notes.indexOf(note);
                return 12 + (octave * 12) + noteIndex;
            },
            
            noteToFrequency(midiNote) {
                return 440 * Math.pow(2, (midiNote - 69) / 12);
            }
        };

        let generatedChords = [];

        // Generate Chord Progression
        function generateChordProgression() {
            const key = document.getElementById('chordKey').value;
            const mode = document.getElementById('chordMode').value;
            const progressionType = document.getElementById('progressionType').value;
            
            const progression = chordTheory.progressions[progressionType];
            const scale = mode === 'minor' ? chordTheory.minorScale : chordTheory.majorScale;
            const rootIndex = chordTheory.notes.indexOf(key);
            
            const chords = [];
            generatedChords = []; // Reset generated chords
            
            progression.degrees.forEach((degree, index) => {
                const scaleNote = (rootIndex + scale[degree]) % 12;
                const chordRoot = chordTheory.notes[scaleNote];
                
                // Determine chord quality
                let chordType = 'minor';
                if (mode === 'minor') {
                    if (degree === 2 || degree === 5 || degree === 6) chordType = 'major';
                    if (degree === 1) chordType = 'dim';
                } else {
                    if (degree === 0 || degree === 3 || degree === 4) chordType = 'major';
                }
                
                const notes = chordTheory.getChordNotes(chordRoot, chordType);
                const midiNotes = notes.map(n => chordTheory.getMIDINote(n, 4));
                const frequencies = midiNotes.map(m => chordTheory.noteToFrequency(m));
                const chordSymbol = chordType === 'minor' ? 'm' : 
                                  chordType === 'dim' ? 'dim' : '';
                
                const romanNumerals = ['i', 'ii', 'III', 'iv', 'v', 'VI', 'VII'];
                const roman = mode === 'minor' ? romanNumerals[degree] : romanNumerals[degree].toUpperCase();
                
                chords.push({
                    name: `${chordRoot}${chordSymbol}`,
                    notes: notes.join(' - '),
                    roman: roman
                });
                
                // Save for playback
                generatedChords.push({
                    name: `${chordRoot}${chordSymbol}`,
                    notes: frequencies
                });
            });
            
            displayChords(chords);
            showNotification(`üéº Generated: ${progression.name} in ${key} ${mode}`);
        }

        function displayChords(chords) {
            const display = document.getElementById('chordDisplay');
            display.innerHTML = chords.map((chord, i) => `
                <div style="padding: 8px; margin-bottom: 6px; background: rgba(255,107,53,0.1); border-left: 3px solid var(--haos-orange); border-radius: 4px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                        <span style="color: var(--haos-orange); font-weight: bold;">${i + 1}. ${chord.name}</span>
                        <span style="color: var(--haos-cyan); font-size: 0.65rem;">${chord.roman}</span>
                    </div>
                    <div style="color: var(--haos-dim); font-size: 0.6rem;">${chord.notes}</div>
                </div>
            `).join('');
        }

        // Play Chord Progression
        function playChordProgression() {
            if (!HAOS || !HAOS.initialized) {
                console.warn('HAOS not initialized');
                return;
            }
            
            if (generatedChords.length === 0) {
                showNotification('‚ö†Ô∏è Generate a progression first!');
                return;
            }
            
            const ctx = HAOS.audioContext;
            const startTime = ctx.currentTime + 0.1;
            const rhythmPattern = document.getElementById('rhythmPattern').value;
            const arpeggioPattern = document.getElementById('arpeggioPattern').value;
            const instrumentKey = document.getElementById('chordInstrument').value;
            const preset = ARP2600_PRESETS[instrumentKey];
            
            if (!preset) {
                showNotification('‚ö†Ô∏è Invalid instrument selection!');
                return;
            }
            
            // Calculate chord duration based on rhythm
            const baseDuration = rhythmPattern === 'quarter' ? 0.5 : 
                                rhythmPattern === 'half' ? 1.0 :
                                rhythmPattern === 'triplet' ? 0.33 : 1.5;
            
            let currentTime = startTime;
            
            generatedChords.forEach((chord, chordIndex) => {
                if (arpeggioPattern === 'none') {
                    // Play full chord
                    chord.notes.forEach(freq => {
                        playARP2600(preset, freq, currentTime, 0.6, baseDuration);
                    });
                    currentTime += baseDuration;
                } else {
                    // Arpeggio patterns
                    let notes = [...chord.notes];
                    
                    if (arpeggioPattern === 'down') {
                        notes.reverse();
                    } else if (arpeggioPattern === 'updown') {
                        notes = [...notes, ...notes.slice(0, -1).reverse()];
                    } else if (arpeggioPattern === 'random') {
                        notes.sort(() => Math.random() - 0.5);
                    }
                    
                    const noteDuration = baseDuration / notes.length;
                    notes.forEach((freq, noteIndex) => {
                        playARP2600(preset, freq, currentTime + (noteIndex * noteDuration), 0.7, noteDuration * 0.9);
                    });
                    currentTime += baseDuration;
                }
            });
            
            showNotification(`üéµ Playing ${generatedChords.length}-chord progression...`);
        }

        // ========== EFFECTS ENGINE ==========
        
        let effectsChain = {
            delay: null,
            reverb: null,
            compressor: null,
            distortion: null,
            delayFeedback: null,
            delayWet: null,
            reverbConvolver: null,
            reverbWet: null
        };

        function initEffects() {
            if (!HAOS || !HAOS.audioContext) return;
            
            const ctx = HAOS.audioContext;
            
            // Delay Effect
            effectsChain.delay = ctx.createDelay(2.0);
            effectsChain.delay.delayTime.value = 0.375;
            effectsChain.delayFeedback = ctx.createGain();
            effectsChain.delayFeedback.gain.value = 0.4;
            effectsChain.delayWet = ctx.createGain();
            effectsChain.delayWet.gain.value = 0.3;
            
            // Delay routing
            effectsChain.delay.connect(effectsChain.delayFeedback);
            effectsChain.delayFeedback.connect(effectsChain.delay);
            effectsChain.delay.connect(effectsChain.delayWet);
            
            // Reverb Effect
            effectsChain.reverb = ctx.createConvolver();
            effectsChain.reverbWet = ctx.createGain();
            effectsChain.reverbWet.gain.value = 0.3;
            
            // Create impulse response for reverb
            const reverbTime = 2.0;
            const sampleRate = ctx.sampleRate;
            const length = sampleRate * reverbTime;
            const impulse = ctx.createBuffer(2, length, sampleRate);
            const impulseL = impulse.getChannelData(0);
            const impulseR = impulse.getChannelData(1);
            
            for (let i = 0; i < length; i++) {
                const decay = Math.exp(-i / (sampleRate * 0.6));
                impulseL[i] = (Math.random() * 2 - 1) * decay;
                impulseR[i] = (Math.random() * 2 - 1) * decay;
            }
            effectsChain.reverb.buffer = impulse;
            effectsChain.reverb.connect(effectsChain.reverbWet);
            
            // Compressor
            effectsChain.compressor = ctx.createDynamicsCompressor();
            effectsChain.compressor.threshold.value = -24;
            effectsChain.compressor.knee.value = 30;
            effectsChain.compressor.ratio.value = 12;
            effectsChain.compressor.attack.value = 0.003;
            effectsChain.compressor.release.value = 0.25;
            
            // Distortion
            effectsChain.distortion = ctx.createWaveShaper();
            const distCurve = new Float32Array(256);
            const amount = 50;
            for (let i = 0; i < 128; i++) {
                const x = i / 128;
                distCurve[128 + i] = Math.tanh(x * amount) / Math.tanh(amount);
                distCurve[128 - i] = -distCurve[128 + i];
            }
            effectsChain.distortion.curve = distCurve;
            effectsChain.distortion.oversample = '4x';
            
            // === WIRE EFFECTS CHAIN TO MASTER OUTPUT ===
            // Disconnect masterGain from destination if already connected
            try {
                HAOS.masterGain.disconnect();
            } catch(e) { /* ignore if not connected */ }
            
            // Route: masterGain ‚Üí delay ‚Üí reverb ‚Üí compressor ‚Üí distortion ‚Üí destination
            HAOS.masterGain.connect(effectsChain.delay);
            effectsChain.delayWet.connect(effectsChain.reverb);
            effectsChain.reverbWet.connect(effectsChain.compressor);
            effectsChain.compressor.connect(effectsChain.distortion);
            effectsChain.distortion.connect(ctx.destination);
            
            // Also keep dry signal path for bypass (you can add bypass logic later)
            // HAOS.masterGain.connect(ctx.destination); // Uncomment for dry signal mix
            
            console.log('‚ú® Effects chain initialized and routed');
        }

        // Wire up effect knobs
        function initEffectSliders() {
            document.querySelectorAll('.effect-knob').forEach(knob => {
                const effect = knob.dataset.effect;
                let isDragging = false;
                let startY = 0;
                let value = parseFloat(knob.dataset.value) || 0.5;
                
                // Initialize visual
                updateEffectKnobVisual(knob, value);
                updateEffectDisplay(knob, effect, value);
                
                knob.addEventListener('mousedown', (e) => {
                    isDragging = true;
                    startY = e.clientY;
                    knob.style.cursor = 'grabbing';
                });
                
                window.addEventListener('mousemove', (e) => {
                    if (!isDragging) return;
                    
                    const delta = startY - e.clientY;
                    value = Math.max(0, Math.min(1, value + delta * 0.005));
                    knob.dataset.value = value;
                    startY = e.clientY;
                    
                    updateEffectKnobVisual(knob, value);
                    updateEffect(effect, value);
                    updateEffectDisplay(knob, effect, value);
                });
                
                window.addEventListener('mouseup', () => {
                    if (isDragging) {
                        isDragging = false;
                        knob.style.cursor = 'pointer';
                    }
                });
            });
        }

        function updateEffectKnobVisual(knob, value) {
            const rotation = (value * 270) - 135;
            knob.style.setProperty('--rotation', `${rotation}deg`);
        }

        function updateEffect(effect, value) {
            if (!effectsChain || !HAOS?.audioContext) return;
            
            switch(effect) {
                case 'delay-time':
                    if (effectsChain.delay) {
                        effectsChain.delay.delayTime.value = 0.1 + value * 1.9; // 100ms - 2s
                    }
                    break;
                case 'delay-feedback':
                    if (effectsChain.delayFeedback) {
                        effectsChain.delayFeedback.gain.value = value * 0.9; // Max 90% to avoid runaway
                    }
                    break;
                case 'reverb-size':
                    // Recreate impulse with new size
                    if (effectsChain.reverb) {
                        const ctx = HAOS.audioContext;
                        const reverbTime = 0.5 + value * 3.5; // 0.5s - 4s
                        const sampleRate = ctx.sampleRate;
                        const length = sampleRate * reverbTime;
                        const impulse = ctx.createBuffer(2, length, sampleRate);
                        const impulseL = impulse.getChannelData(0);
                        const impulseR = impulse.getChannelData(1);
                        
                        for (let i = 0; i < length; i++) {
                            const decay = Math.exp(-i / (sampleRate * (0.3 + value * 0.7)));
                            impulseL[i] = (Math.random() * 2 - 1) * decay;
                            impulseR[i] = (Math.random() * 2 - 1) * decay;
                        }
                        effectsChain.reverb.buffer = impulse;
                    }
                    break;
                case 'reverb-mix':
                    if (effectsChain.reverbWet) {
                        effectsChain.reverbWet.gain.value = value;
                    }
                    break;
                case 'comp-threshold':
                    if (effectsChain.compressor) {
                        effectsChain.compressor.threshold.value = -60 + value * 60; // -60dB to 0dB
                    }
                    break;
                case 'comp-ratio':
                    if (effectsChain.compressor) {
                        effectsChain.compressor.ratio.value = 1 + value * 19; // 1:1 to 20:1
                    }
                    break;
                case 'dist-drive':
                    // Recreate distortion curve with new amount
                    if (effectsChain.distortion) {
                        const distCurve = new Float32Array(256);
                        const amount = 1 + value * 99; // 1 to 100
                        for (let i = 0; i < 128; i++) {
                            const x = i / 128;
                            distCurve[128 + i] = Math.tanh(x * amount) / Math.tanh(amount);
                            distCurve[128 - i] = -distCurve[128 + i];
                        }
                        effectsChain.distortion.curve = distCurve;
                    }
                    break;
                case 'dist-tone':
                    // Could add a filter here for tone control
                    break;
            }
        }

        function updateEffectDisplay(knob, effect, value) {
            if (!knob) return;
            
            // Find the knob-value element
            const valueEl = knob.parentElement?.querySelector('.knob-value');
            if (!valueEl) return;
            
            let displayValue = '';
            
            switch(effect) {
                case 'delay-time':
                    displayValue = Math.round(100 + value * 1900) + 'ms';
                    break;
                case 'delay-feedback':
                    displayValue = Math.round(value * 90) + '%';
                    break;
                case 'reverb-size':
                    displayValue = (0.5 + value * 3.5).toFixed(1) + 's';
                    break;
                case 'reverb-mix':
                    displayValue = Math.round(value * 100) + '%';
                    break;
                case 'comp-threshold':
                    displayValue = Math.round(-60 + value * 60) + 'dB';
                    break;
                case 'comp-ratio':
                    displayValue = Math.round(1 + value * 19) + ':1';
                    break;
                case 'dist-drive':
                    displayValue = Math.round(1 + value * 99);
                    break;
                case 'dist-tone':
                    displayValue = Math.round(value * 100) + '%';
                    break;
                default:
                    displayValue = Math.round(value * 100) + '%';
            }
            
            valueEl.textContent = displayValue;
            
            // Add visual feedback - glow effect when changing
            knob.style.boxShadow = '0 0 20px rgba(57, 255, 20, 0.8)';
            setTimeout(() => {
                knob.style.boxShadow = '';
            }, 150);
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            initSequencer();
            initKnobs();
            initEffects();
            initEffectSliders();
            
            // Load saved patterns from localStorage
            const stored = localStorage.getItem('haos_patterns');
            if (stored) {
                try {
                    savedPatterns = JSON.parse(stored);
                    console.log(`üíæ Loaded ${Object.keys(savedPatterns).length} saved pattern(s)`);
                } catch (e) {
                    console.warn('Failed to load saved patterns:', e);
                }
            }
            
            console.log('üéõÔ∏è Techno Workspace initialized');
            console.log('%cüéµ SEQUENCER FEATURES', 'color: #39FF14; font-size: 14px; font-weight: bold');
            console.log('%c‚Ä¢ Click steps to toggle', 'color: #888');
            console.log('%c‚Ä¢ Right-click to adjust velocity (25% ‚Üí 100%)', 'color: #888');
            console.log('%c‚Ä¢ Double-click for random velocity', 'color: #888');
            console.log('%c‚Ä¢ Use track controls: üé≤ Randomize, ‚Üê ‚Üí Shift, üóëÔ∏è Clear', 'color: #888');
            console.log('%c‚Ä¢ Save/Load patterns, adjust swing & sequence length', 'color: #888');
            
            // Sync knobs every 100ms during morphing
            setInterval(() => {
                if (window.presetMorph && window.presetMorph.morphing && window.presetMorph.morphing.size > 0) {
                    syncKnobsWithParams();
                }
            }, 100);
        });

        // Auto-init audio on first interaction
        document.addEventListener('click', async () => {
            if (!HAOS.initialized) {
                await HAOS.init();
                console.log('üîä Audio system ready');
            }
        }, { once: true });
    </script>

    <!-- Live Parameter System -->
    <script src="/js/live-params.js"></script>
    <script src="/js/preset-morph.js"></script>
    <script src="/js/cable-router.js"></script>
    <script src="/js/macro-system.js"></script>

    <!-- Integration Script -->
    <script>
        // Global systems
        let liveParams;
        let presetMorph;
        let cableRouter;
        let macroSystem;

        // Initialize modular systems
        function initModularSystems() {
            // 1. Live Parameters
            liveParams = new LiveParams();
            console.log('‚úÖ Live Parameters initialized');

            // Register TB-303 parameters
            registerTB303Params();

            // Register TR-909 parameters
            registerTR909Params();

            // 2. Preset Morphing
            presetMorph = new PresetMorph(liveParams);
            console.log('‚úÖ Preset Morph initialized');

            // 3. Macro System
            macroSystem = new MacroSystem(liveParams);
            console.log('‚úÖ Macro System initialized');
            console.log(`   üìä ${macroSystem.getMacros().length} default macros loaded`);

            // 4. Cable Router
            const canvas = document.getElementById('patch-canvas');
            if (canvas) {
                cableRouter = new CableRouter(canvas);
                console.log('‚úÖ Cable Router initialized');
                
                // Register connection points
                registerPatchPoints();
            }

            // Wire up UI controls
            wireupMorphControls();
            wireupPresetControls();
            wireupMacroControls();
            
            console.log('üéõÔ∏è All modular systems online');
        }

        // Register TB-303 parameters
        function registerTB303Params() {
            liveParams.register('tb303-cutoff', {
                value: 0.5,
                min: 0,
                max: 1,
                curve: 'exponential',
                label: 'Cutoff',
                unit: 'Hz',
                onChange: (val) => {
                    const freq = 100 + val * 7900;
                    if (window.HAOS?.tb303?.filter) {
                        window.HAOS.tb303.filter.frequency.value = freq;
                    }
                }
            });

            liveParams.register('tb303-resonance', {
                value: 0.7,
                min: 0,
                max: 0.95,
                label: 'Resonance',
                onChange: (val) => {
                    if (window.HAOS?.tb303?.filter) {
                        window.HAOS.tb303.filter.Q.value = 1 + val * 29;
                    }
                }
            });

            liveParams.register('tb303-envmod', {
                value: 0.6,
                min: 0,
                max: 1,
                label: 'Env Mod',
                onChange: (val) => {
                    if (window.HAOS?.tb303) {
                        window.HAOS.tb303.envMod = val;
                    }
                }
            });

            liveParams.register('tb303-decay', {
                value: 0.3,
                min: 0,
                max: 1,
                label: 'Decay',
                unit: 's',
                onChange: (val) => {
                    if (window.HAOS?.tb303) {
                        window.HAOS.tb303.decay = 0.01 + val * 1.99;
                    }
                }
            });

            liveParams.register('tb303-accent', {
                value: 0.5,
                min: 0,
                max: 1,
                label: 'Accent',
                onChange: (val) => {
                    if (window.HAOS?.tb303) {
                        window.HAOS.tb303.accent = val;
                    }
                }
            });

            liveParams.register('tb303-distortion', {
                value: 0.2,
                min: 0,
                max: 1,
                label: 'Distortion',
                onChange: (val) => {
                    if (window.HAOS?.tb303?.distortion) {
                        window.HAOS.tb303.distortion.curve = makeDistortionCurve(val * 100);
                    }
                }
            });
        }

        // Register TR-909 parameters
        function registerTR909Params() {
            liveParams.register('tr909-kick-punch', {
                value: 0.7,
                min: 0,
                max: 1,
                label: 'Kick Punch',
                onChange: (val) => {
                    if (window.HAOS?.tr909) {
                        window.HAOS.tr909.kickPunch = val;
                    }
                }
            });

            liveParams.register('tr909-snare-snap', {
                value: 0.6,
                min: 0,
                max: 1,
                label: 'Snare Snap',
                onChange: (val) => {
                    if (window.HAOS?.tr909) {
                        window.HAOS.tr909.snareSnap = val;
                    }
                }
            });

            liveParams.register('tr909-hat-decay', {
                value: 0.4,
                min: 0,
                max: 1,
                label: 'Hat Decay',
                onChange: (val) => {
                    if (window.HAOS?.tr909) {
                        window.HAOS.tr909.hatDecay = val;
                    }
                }
            });
        }

        // Register patch points
        function registerPatchPoints() {
            // TB-303 outputs
            cableRouter.registerOutput('tb303-audio-out', 150, 200, 'audio', 'OUT');
            cableRouter.registerOutput('tb303-env-out', 150, 240, 'cv', 'ENV');

            // TR-909 outputs
            cableRouter.registerOutput('tr909-audio-out', 150, 400, 'audio', 'OUT');
            cableRouter.registerOutput('tr909-trigger', 150, 440, 'gate', 'TRIG');

            // Sequencer outputs
            cableRouter.registerOutput('seq-gate', 550, 350, 'gate', 'GATE');
            cableRouter.registerOutput('seq-cv', 550, 390, 'cv', 'CV');

            // Master inputs
            cableRouter.registerInput('master-ch1', 850, 200, 'audio', 'CH1');
            cableRouter.registerInput('master-ch2', 850, 240, 'audio', 'CH2');
            cableRouter.registerInput('master-ch3', 850, 280, 'audio', 'CH3');
            cableRouter.registerInput('master-ch4', 850, 320, 'audio', 'CH4');

            // Effects inputs
            cableRouter.registerInput('delay-in', 850, 400, 'audio', 'DELAY');
            cableRouter.registerInput('reverb-in', 850, 440, 'audio', 'REVERB');

            // Listen for cable connections
            window.addEventListener('haos-cable-connect', (e) => {
                console.log('Cable connected:', e.detail);
                handleCableConnection(e.detail);
            });

            window.addEventListener('haos-cable-disconnect', (e) => {
                console.log('Cable disconnected:', e.detail);
                handleCableDisconnection(e.detail);
            });
        }

        // Handle cable connections
        function handleCableConnection(detail) {
            const { output, input } = detail;
            
            // Route audio based on connection
            if (output.id.includes('tb303') && input.id.includes('master')) {
                console.log('Routing TB-303 to master');
                // Actual audio routing would happen here
            } else if (output.id.includes('tr909') && input.id.includes('master')) {
                console.log('Routing TR-909 to master');
            }
        }

        // Handle cable disconnections
        function handleCableDisconnection(detail) {
            console.log('Disconnecting:', detail);
        }

        // Wire up morph controls
        function wireupMorphControls() {
            // Morph slider
            const morphSlider = document.getElementById('morph-slider');
            if (morphSlider) {
                morphSlider.addEventListener('input', (e) => {
                    const position = parseFloat(e.target.value);
                    presetMorph.setMorphPosition(position, 0);
                });
            }

            // Listen for morph position changes
            window.addEventListener('morphPositionChanged', (e) => {
                const { position, presetA, presetB } = e.detail;
                
                // Update UI
                const display = document.getElementById('morph-display');
                if (display) {
                    const percentage = Math.round(position * 100);
                    display.textContent = `${100 - percentage}% A | ${percentage}% B`;
                }
            });
        }

        // Wire up preset controls
        function wireupPresetControls() {
            // Capture A button
            const captureA = document.getElementById('capture-a');
            if (captureA) {
                captureA.addEventListener('click', () => {
                    const name = prompt('Preset A name:', 'Preset A');
                    if (name) {
                        presetMorph.captureA(name);
                        showNotification('Captured Preset A');
                        updatePresetNames();
                    }
                });
            }

            // Capture B button
            const captureB = document.getElementById('capture-b');
            if (captureB) {
                captureB.addEventListener('click', () => {
                    const name = prompt('Preset B name:', 'Preset B');
                    if (name) {
                        presetMorph.captureB(name);
                        showNotification('Captured Preset B');
                        updatePresetNames();
                    }
                });
            }

            // Recall A button
            const recallA = document.getElementById('recall-a');
            if (recallA) {
                recallA.addEventListener('click', () => {
                    presetMorph.recallA(500);
                    showNotification('Recalled Preset A');
                });
            }

            // Recall B button
            const recallB = document.getElementById('recall-b');
            if (recallB) {
                recallB.addEventListener('click', () => {
                    presetMorph.recallB(500);
                    showNotification('Recalled Preset B');
                });
            }

            // Crossfade buttons
            const crossfadeA = document.getElementById('crossfade-a');
            if (crossfadeA) {
                crossfadeA.addEventListener('click', () => {
                    presetMorph.crossfadeToA(2000);
                });
            }

            const crossfadeB = document.getElementById('crossfade-b');
            if (crossfadeB) {
                crossfadeB.addEventListener('click', () => {
                    presetMorph.crossfadeToB(2000);
                });
            }

            // Swap A/B
            const swapAB = document.getElementById('swap-ab');
            if (swapAB) {
                swapAB.addEventListener('click', () => {
                    presetMorph.swapAB();
                    showNotification('Swapped A ‚áÑ B');
                });
            }

            // Preset Bank slots
            let selectedBankSlot = null;
            const bankSlots = document.querySelectorAll('.bank-slot');
            bankSlots.forEach(slot => {
                slot.addEventListener('click', () => {
                    // Deselect all
                    bankSlots.forEach(s => s.classList.remove('active'));
                    
                    // Select this one
                    slot.classList.add('active');
                    selectedBankSlot = parseInt(slot.dataset.slot);
                    
                    showNotification(`Slot ${selectedBankSlot} selected`);
                });

                // Double-click to quick load
                slot.addEventListener('dblclick', () => {
                    const slotNum = parseInt(slot.dataset.slot);
                    const preset = presetMorph.loadFromBank(slotNum, 'current', 500);
                    if (preset) {
                        showNotification(`Loaded: ${preset.name}`);
                        updateBankUI();
                    }
                });
            });

            // Save to bank
            const saveToBank = document.getElementById('save-to-bank');
            if (saveToBank) {
                saveToBank.addEventListener('click', () => {
                    if (selectedBankSlot === null) {
                        showNotification('‚ö†Ô∏è Select a slot first', 2000);
                        return;
                    }

                    const name = prompt('Preset name:', `Preset ${selectedBankSlot}`);
                    if (name) {
                        const preset = {
                            name,
                            parameters: liveParams.snapshot(),
                            timestamp: Date.now()
                        };
                        presetMorph.saveToBank(selectedBankSlot, preset);
                        showNotification(`üíæ Saved to slot ${selectedBankSlot}`);
                        updateBankUI();
                    }
                });
            }

            // Load from bank
            const loadFromBank = document.getElementById('load-from-bank');
            if (loadFromBank) {
                loadFromBank.addEventListener('click', () => {
                    if (selectedBankSlot === null) {
                        showNotification('‚ö†Ô∏è Select a slot first', 2000);
                        return;
                    }

                    // Show load options
                    const target = prompt('Load to:\nA = Preset A\nB = Preset B\nC = Current (immediate)\n', 'C');
                    if (!target) return;

                    let targetKey = 'current';
                    if (target.toUpperCase() === 'A') targetKey = 'A';
                    else if (target.toUpperCase() === 'B') targetKey = 'B';

                    const preset = presetMorph.loadFromBank(selectedBankSlot, targetKey, 500);
                    if (preset) {
                        showNotification(`üìÇ Loaded: ${preset.name}`);
                        updatePresetNames();
                        updateBankUI();
                    }
                });
            }

            // Update bank UI
            function updateBankUI() {
                const contents = presetMorph.getCurrentBankContents();
                bankSlots.forEach(slot => {
                    const slotNum = parseInt(slot.dataset.slot);
                    const preset = contents.find(p => p.slot === slotNum);
                    
                    if (preset) {
                        slot.classList.add('filled');
                        slot.title = `${preset.name}\n${preset.paramCount} parameters\n${new Date(preset.timestamp).toLocaleString()}`;
                    } else {
                        slot.classList.remove('filled');
                        slot.title = 'Empty slot';
                    }
                });
            }

            // Update preset names in UI
            function updatePresetNames() {
                const presetAName = document.getElementById('preset-a-name');
                const presetBName = document.getElementById('preset-b-name');
                
                if (presetAName && presetMorph.presetA) {
                    presetAName.textContent = `PRESET A: ${presetMorph.presetA.name}`;
                }
                if (presetBName && presetMorph.presetB) {
                    presetBName.textContent = `PRESET B: ${presetMorph.presetB.name}`;
                }
            }

            // Initial bank UI update
            setTimeout(() => {
                updateBankUI();
            }, 100);
        }

        // Wire up macro controls
        function wireupMacroControls() {
            // Expose macros globally for console debugging
            window.macros = macroSystem;

            // Log available macros
            console.log('üìä Available Macros:');
            macroSystem.getMacros().forEach(macro => {
                console.log(`   ‚Ä¢ ${macro.label} (${macro.mappings.length} params)`);
            });

            // Listen for macro changes
            window.addEventListener('macroChanged', (e) => {
                const { macroId, value, macro } = e.detail;
                console.log(`Macro "${macro.label}": ${Math.round(value * 100)}%`);
                
                // Sync knobs when macro changes
                syncKnobsWithParams();
            });

            // Example: Bind keyboard shortcuts to macros
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey || e.metaKey) return; // Ignore if Ctrl/Cmd is held
                
                switch(e.key) {
                    case '1':
                        macroSystem.morphMacro('tb303-intensity', Math.random(), 1000);
                        showNotification('üéõÔ∏è TB-303 Intensity randomized');
                        break;
                    case '2':
                        macroSystem.morphMacro('tb303-darkness', Math.random(), 1000);
                        showNotification('üéõÔ∏è TB-303 Darkness randomized');
                        break;
                    case '3':
                        macroSystem.morphMacro('tr909-punch', Math.random(), 1000);
                        showNotification('üéõÔ∏è TR-909 Punch randomized');
                        break;
                    case '0':
                        macroSystem.resetAll(1000);
                        showNotification('üîÑ All macros reset');
                        break;
                }
            });

            console.log('‚úÖ Macro controls wired (Keys: 1=Intensity, 2=Darkness, 3=Punch, 0=Reset)');
        }

        // Utility: Show notification
        function showNotification(message, duration = 2000) {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 30px;
                background: rgba(255, 107, 53, 0.95);
                color: white;
                padding: 12px 24px;
                border-radius: 8px;
                font-family: var(--font-mono);
                font-size: 0.9rem;
                z-index: 10000;
                box-shadow: 0 4px 20px rgba(255, 107, 53, 0.4);
                animation: slideInRight 0.3s ease-out;
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease-in';
                setTimeout(() => notification.remove(), 300);
            }, duration);
        }

        // Utility: Distortion curve
        function makeDistortionCurve(amount) {
            const samples = 44100;
            const curve = new Float32Array(samples);
            const deg = Math.PI / 180;
            
            for (let i = 0; i < samples; i++) {
                const x = (i * 2 / samples) - 1;
                curve[i] = (3 + amount) * x * 20 * deg / (Math.PI + amount * Math.abs(x));
            }
            
            return curve;
        }

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from {
                    transform: translateX(400px);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            
            @keyframes slideOutRight {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(400px);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);

        // Initialize all systems when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            // Wait a bit for HAOS to be ready
            setTimeout(() => {
                initModularSystems();
            }, 500);
        });

        // Expose systems globally for debugging
        window.HAOS_SYSTEMS = {
            liveParams,
            presetMorph,
            cableRouter,
            macroSystem
        };
        
        // Console helpers
        window.HAOS_HELP = () => {
            console.log(`
%cüéõÔ∏è HAOS TECHNO WORKSPACE - CONSOLE COMMANDS %c

%cLIVE PARAMETERS:%c
  liveParams.morph('tb303-cutoff', 0.8, 1000)
  liveParams.morphMultiple({...}, 1000)
  liveParams.snapshot()
  liveParams.restore(state, 500)

%cPRESET MORPHING:%c
  presetMorph.captureA('Acid')
  presetMorph.captureB('Bass')
  presetMorph.crossfadeToB(2000)
  presetMorph.setMorphPosition(0.5)
  presetMorph.saveToBank(1)
  presetMorph.loadFromBank(1)

%cMACRO SYSTEM:%c
  macroSystem.setMacro('tb303-intensity', 0.8)
  macroSystem.morphMacro('global-energy', 1.0, 2000)
  macroSystem.randomizeAll(0.5, 1000)
  macroSystem.resetAll()
  macroSystem.getMacros()

%cCABLE ROUTER:%c
  cableRouter.connect('tb303-audio-out', 'master-ch1')
  cableRouter.disconnect(cableId)
  cableRouter.exportPatch()
  cableRouter.importPatch(patchData)

%cKEYBOARD SHORTCUTS:%c
  1 = Randomize TB-303 Intensity
  2 = Randomize TB-303 Darkness
  3 = Randomize TR-909 Punch
  0 = Reset all macros

%cGLOBAL ACCESS:%c
  window.HAOS_SYSTEMS.liveParams
  window.HAOS_SYSTEMS.presetMorph
  window.HAOS_SYSTEMS.macroSystem
  window.HAOS_SYSTEMS.cableRouter
            `, 
            'background: #FF6B35; color: white; padding: 10px; font-size: 14px; font-weight: bold',
            '',
            'color: #FF6B35; font-weight: bold', '',
            'color: #00D9FF; font-weight: bold', '',
            'color: #39FF14; font-weight: bold', '',
            'color: #FF006E; font-weight: bold', '',
            'color: #FFD700; font-weight: bold', '',
            'color: #888; font-weight: bold', ''
            );
        };
        
        console.log('%cüéõÔ∏è Type HAOS_HELP() for available commands', 'color: #FF6B35; font-size: 12px; font-weight: bold');

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üéµ SOUND PLAYBACK & PRESET INTEGRATION
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        // TB-303 Preset Definitions
        const tb303Presets = {
            1: { name: 'Acid üß™', cutoff: 0.75, resonance: 0.85, envmod: 0.7, decay: 0.3, distortion: 0.2, accent: 0.8 },
            2: { name: 'Squelch üí¶', cutoff: 0.35, resonance: 0.95, envmod: 0.9, decay: 0.15, distortion: 0.3, accent: 0.6 },
            3: { name: 'Deep üåä', cutoff: 0.25, resonance: 0.4, envmod: 0.3, decay: 0.7, distortion: 0.1, accent: 0.4 },
            4: { name: 'Screamer üò±', cutoff: 0.9, resonance: 1.0, envmod: 1.0, decay: 0.1, distortion: 0.6, accent: 1.0 },
            5: { name: 'Liquid üíß', cutoff: 0.55, resonance: 0.65, envmod: 0.5, decay: 0.5, distortion: 0.15, accent: 0.5 },
            6: { name: 'Wobble üåÄ', cutoff: 0.45, resonance: 0.75, envmod: 0.8, decay: 0.4, distortion: 0.25, accent: 0.7 },
            7: { name: 'Sub üîä', cutoff: 0.15, resonance: 0.2, envmod: 0.2, decay: 0.9, distortion: 0.05, accent: 0.3 },
            8: { name: 'Rumble üí•', cutoff: 0.2, resonance: 0.5, envmod: 0.4, decay: 0.8, distortion: 0.4, accent: 0.9 }
        };

        // Audio initialization flag
        let audioInitialized = false;

        // Initialize audio on first interaction
        async function ensureAudioInit() {
            if (!audioInitialized) {
                if (!HAOS || !HAOS.initialized) {
                    await initHAOS();
                }
                audioInitialized = true;
                console.log('üéµ HAOS Audio Engine initialized');
            }
        }

        // TB-303 Test Sound Button
        document.addEventListener('DOMContentLoaded', () => {
            const tb303TestBtn = document.getElementById('tb303-test');
            if (tb303TestBtn) {
                tb303TestBtn.addEventListener('click', async () => {
                    await ensureAudioInit();
                    
                    // Play classic acid bass line
                    if (HAOS && HAOS.playNote) {
                        HAOS.playNote({ note: 'C2', accent: true });
                        
                        // Animate button
                        tb303TestBtn.style.transform = 'scale(0.95)';
                        tb303TestBtn.style.boxShadow = '0 0 20px rgba(255, 107, 53, 0.8)';
                        
                        setTimeout(() => {
                            tb303TestBtn.style.transform = '';
                            tb303TestBtn.style.boxShadow = '';
                        }, 200);
                        
                        // Animate VU meter
                        animateVU('bass-vu');
                    } else {
                        console.error('HAOS or playNote not available');
                    }
                });
            }

            // TR-909 Test Drum Buttons
            const testKick = document.getElementById('test-kick');
            if (testKick) {
                testKick.addEventListener('click', async () => {
                    await ensureAudioInit();
                    if (HAOS && HAOS.playKick) {
                        HAOS.playKick(1.0, 0.5); // velocity, tune
                        animateButton(testKick);
                        animateVU('drum-vu');
                    }
                });
            }

            const testSnare = document.getElementById('test-snare');
            if (testSnare) {
                testSnare.addEventListener('click', async () => {
                    await ensureAudioInit();
                    if (HAOS && HAOS.playSnare) {
                        HAOS.playSnare(0.8, 0.6); // velocity, snap
                        animateButton(testSnare);
                        animateVU('drum-vu');
                    }
                });
            }

            const testHihat = document.getElementById('test-hihat');
            if (testHihat) {
                testHihat.addEventListener('click', async () => {
                    await ensureAudioInit();
                    if (HAOS && HAOS.playHihat) {
                        HAOS.playHihat(0.6, false); // velocity, open
                        animateButton(testHihat);
                        animateVU('drum-vu');
                    }
                });
            }

            // TB-303 Preset Bank Slots
            const presetSlots = document.querySelectorAll('.bank-slot');
            presetSlots.forEach(slot => {
                slot.addEventListener('click', async () => {
                    const slotNum = parseInt(slot.dataset.slot);
                    const preset = tb303Presets[slotNum];
                    
                    if (preset) {
                        await ensureAudioInit();
                        
                        // Load preset parameters
                        loadTB303Preset(preset);
                        
                        // Play test sound
                        if (HAOS && HAOS.playNote) {
                            HAOS.playNote({ note: 'C2', accent: preset.accent > 0.5 });
                        }
                        
                        // Visual feedback
                        presetSlots.forEach(s => s.classList.remove('active'));
                        slot.classList.add('active');
                        animateButton(slot);
                        animateVU('bass-vu');
                        
                        showNotification(`üéµ Loaded: ${preset.name}`);
                    }
                });
            });

            // Update bank UI with preset names
            updatePresetBankUI();
        });

        // Load TB-303 preset parameters into UI
        function loadTB303Preset(preset) {
            const knobs = {
                'tb303-cutoff': preset.cutoff,
                'tb303-resonance': preset.resonance,
                'tb303-envmod': preset.envmod,
                'tb303-decay': preset.decay,
                'tb303-dist': preset.distortion, // Note: ID is tb303-dist but param is tb303-distortion
                'tb303-accent': preset.accent
            };

            // Update knobs visually and data attributes
            Object.entries(knobs).forEach(([id, value]) => {
                const knob = document.getElementById(id);
                if (knob) {
                    // Update data-value attribute
                    knob.dataset.value = value;
                    
                    // Update visual rotation
                    const rotation = -135 + (value * 270);
                    knob.style.transform = `rotate(${rotation}deg)`;
                    knob.style.setProperty('--rotation', `${rotation}deg`);
                    
                    // Update value display
                    const wrapper = knob.parentElement;
                    const valueEl = wrapper?.querySelector('.knob-value');
                    if (valueEl) {
                        // Get the param from the knob's data-param attribute
                        const param = knob.dataset.param || id;
                        valueEl.textContent = formatParamValue(param, value);
                    }
                    
                    // Update live params if available
                    if (typeof liveParams !== 'undefined') {
                        const param = knob.dataset.param || id;
                        liveParams.set(param, value);
                    }
                }
            });

            // Update HAOS audio engine parameters if available
            if (typeof HAOS !== 'undefined' && HAOS.setParam) {
                HAOS.setParam('tb303-cutoff', preset.cutoff);
                HAOS.setParam('tb303-resonance', preset.resonance);
                HAOS.setParam('tb303-envmod', preset.envmod);
                HAOS.setParam('tb303-decay', preset.decay);
                HAOS.setParam('tb303-distortion', preset.distortion);
                HAOS.setParam('tb303-accent', preset.accent);
                console.log(`‚úÖ Loaded preset: ${preset.name}`);
            }
        }

        // Update preset bank UI with names
        function updatePresetBankUI() {
            const presetSlots = document.querySelectorAll('.bank-slot');
            presetSlots.forEach(slot => {
                const slotNum = parseInt(slot.dataset.slot);
                const preset = tb303Presets[slotNum];
                
                if (preset) {
                    slot.classList.add('filled');
                    slot.title = preset.name;
                    
                    // Add preset name as text content
                    if (!slot.querySelector('.preset-name')) {
                        const nameEl = document.createElement('div');
                        nameEl.className = 'preset-name';
                        nameEl.style.fontSize = '9px';
                        nameEl.style.marginTop = '4px';
                        nameEl.style.opacity = '0.7';
                        nameEl.textContent = preset.name;
                        slot.appendChild(nameEl);
                    }
                }
            });
        }

        // Animate button on click
        function animateButton(button) {
            button.style.transform = 'scale(0.95)';
            button.style.boxShadow = '0 0 20px rgba(0, 217, 255, 0.8)';
            
            setTimeout(() => {
                button.style.transform = '';
                button.style.boxShadow = '';
            }, 200);
        }

        // Animate VU meter
        function animateVU(vuId) {
            const vu = document.getElementById(vuId);
            if (vu) {
                vu.style.width = '100%';
                vu.style.opacity = '1';
                
                setTimeout(() => {
                    vu.style.width = '0%';
                    vu.style.opacity = '0.3';
                }, 300);
            }
        }

        // Expose preset loader globally
        window.loadTB303Preset = loadTB303Preset;
        window.tb303Presets = tb303Presets;
        
        console.log('üéµ Sound Playback System loaded - Click any TEST button or preset slot!');

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üéπ MIDI EXPORT SYSTEM
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function exportToMIDI() {
            // Get active steps from all sequencer tracks
            const tracks = {
                kick: Array.from(document.querySelectorAll('[data-track="kick"]'))
                    .map((el, i) => ({ step: i, active: el.classList.contains('active') }))
                    .filter(s => s.active),
                snare: Array.from(document.querySelectorAll('[data-track="snare"]'))
                    .map((el, i) => ({ step: i, active: el.classList.contains('active') }))
                    .filter(s => s.active),
                hihat: Array.from(document.querySelectorAll('[data-track="hihat"]'))
                    .map((el, i) => ({ step: i, active: el.classList.contains('active') }))
                    .filter(s => s.active),
                bass: Array.from(document.querySelectorAll('[data-track="bass"]'))
                    .map((el, i) => ({ step: i, active: el.classList.contains('active') }))
                    .filter(s => s.active)
            };

            // Create MIDI file content (simplified format)
            const midiData = {
                format: 1,
                bpm: parseInt(document.getElementById('bpm-value').textContent),
                tracks: [
                    {
                        name: 'Kick',
                        instrument: 'Acoustic Bass Drum',
                        midiNote: 36,
                        steps: tracks.kick.map(s => s.step)
                    },
                    {
                        name: 'Snare',
                        instrument: 'Acoustic Snare',
                        midiNote: 38,
                        steps: tracks.snare.map(s => s.step)
                    },
                    {
                        name: 'Hi-Hat',
                        instrument: 'Closed Hi-Hat',
                        midiNote: 42,
                        steps: tracks.hihat.map(s => s.step)
                    },
                    {
                        name: 'Bass',
                        instrument: 'TB-303 Bass',
                        midiNote: 36, // C2
                        steps: tracks.bass.map(s => s.step)
                    }
                ],
                timestamp: new Date().toISOString(),
                creator: 'HAOS.fm Techno Workspace'
            };

            // Convert to JSON for now (full MIDI binary export would need a library)
            const blob = new Blob([JSON.stringify(midiData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `haos-pattern-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);

            showNotification('üíæ MIDI Pattern Exported!');
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // ‚è∫ AUDIO RECORDING SYSTEM
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        let mediaRecorder = null;
        let audioChunks = [];
        let isRecording = false;

        async function startRecording() {
            try {
                // Get audio from HAOS master output
                if (!HAOS || !HAOS.initialized) {
                    await initHAOS();
                }

                // Create MediaRecorder from Web Audio API
                const dest = HAOS.audioContext.createMediaStreamDestination();
                
                // Connect master output to destination
                if (HAOS.masterGain) {
                    HAOS.masterGain.connect(dest);
                }

                mediaRecorder = new MediaRecorder(dest.stream, {
                    mimeType: 'audio/webm;codecs=opus'
                });

                audioChunks = [];

                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        audioChunks.push(event.data);
                    }
                };

                mediaRecorder.onstop = () => {
                    const blob = new Blob(audioChunks, { type: 'audio/webm' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `haos-recording-${Date.now()}.webm`;
                    a.click();
                    URL.revokeObjectURL(url);
                    
                    showNotification('üéµ Recording Saved!');
                    isRecording = false;
                    document.getElementById('record-btn').classList.remove('active');
                    document.getElementById('record-btn').textContent = '‚è∫ RECORD';
                    document.getElementById('record-led').classList.remove('active');
                };

                mediaRecorder.start();
                isRecording = true;
                document.getElementById('record-btn').classList.add('active');
                document.getElementById('record-btn').textContent = '‚èπ RECORDING...';
                document.getElementById('record-led').classList.add('active');
                
                showNotification('üî¥ Recording Started!');

            } catch (error) {
                console.error('Recording error:', error);
                showNotification('‚ö†Ô∏è Recording failed: ' + error.message);
            }
        }

        function stopRecording() {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üìä SPECTRUM ANALYZER
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        let analyser = null;
        let spectrumAnimationId = null;

        async function initSpectrumAnalyzer() {
            if (!HAOS || !HAOS.initialized) {
                await initHAOS();
            }
            
            if (!HAOS.audioContext) {
                console.warn('Audio context not available for spectrum analyzer');
                return;
            }

            analyser = HAOS.audioContext.createAnalyser();
            analyser.fftSize = 2048;
            analyser.smoothingTimeConstant = 0.8;

            // Connect master output to analyzer
            if (HAOS.masterGain) {
                HAOS.masterGain.connect(analyser);
            }

            const canvas = document.getElementById('spectrum-canvas');
            const ctx = canvas.getContext('2d');
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);

            function drawSpectrum() {
                spectrumAnimationId = requestAnimationFrame(drawSpectrum);

                analyser.getByteFrequencyData(dataArray);

                ctx.fillStyle = 'rgba(10, 10, 10, 0.3)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                const barWidth = (canvas.width / bufferLength) * 2.5;
                let barHeight;
                let x = 0;

                for (let i = 0; i < bufferLength; i++) {
                    barHeight = (dataArray[i] / 255) * canvas.height;

                    // HAOS brand gradient
                    const gradient = ctx.createLinearGradient(0, canvas.height - barHeight, 0, canvas.height);
                    gradient.addColorStop(0, '#FF6B35'); // Orange
                    gradient.addColorStop(0.5, '#FF8C42'); // Bright orange
                    gradient.addColorStop(1, '#FFD700'); // Gold

                    ctx.fillStyle = gradient;
                    ctx.fillRect(x, canvas.height - barHeight, barWidth, barHeight);

                    x += barWidth + 1;
                }
            }

            drawSpectrum();
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üì¶ PROJECT EXPORT
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function exportProject() {
            const project = {
                version: '1.0.0',
                name: 'HAOS Techno Workspace Project',
                bpm: parseInt(document.getElementById('bpm-value').textContent),
                timestamp: new Date().toISOString(),
                
                // Sequencer patterns
                patterns: {
                    kick: Array.from(document.querySelectorAll('[data-track="kick"]'))
                        .map(el => el.classList.contains('active')),
                    snare: Array.from(document.querySelectorAll('[data-track="snare"]'))
                        .map(el => el.classList.contains('active')),
                    hihat: Array.from(document.querySelectorAll('[data-track="hihat"]'))
                        .map(el => el.classList.contains('active')),
                    bass: Array.from(document.querySelectorAll('[data-track="bass"]'))
                        .map(el => el.classList.contains('active'))
                },
                
                // Current preset state
                presets: {
                    tb303: tb303Presets,
                    activePreset: null
                },
                
                // Live parameters
                parameters: typeof liveParams !== 'undefined' ? liveParams.snapshot() : {},
                
                // Preset morphing state
                morphState: typeof presetMorph !== 'undefined' ? {
                    presetA: presetMorph.presets.A,
                    presetB: presetMorph.presets.B,
                    morphPosition: presetMorph.morphPosition
                } : null
            };

            const blob = new Blob([JSON.stringify(project, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `haos-project-${Date.now()}.haos`;
            a.click();
            URL.revokeObjectURL(url);

            showNotification('üì¶ Project Exported!');
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üíæ AUTO-SAVE & PROJECT MANAGEMENT
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        const AUTO_SAVE_KEY = 'haos_techno_workspace_autosave';
        const AUTO_SAVE_INTERVAL = 10000; // 10 seconds

        function autoSave() {
            const state = {
                version: '1.0.0',
                timestamp: new Date().toISOString(),
                bpm: parseInt(document.getElementById('bpm-value').textContent),
                patterns: {
                    kick: Array.from(document.querySelectorAll('[data-track="kick"]'))
                        .map(el => ({
                            active: el.classList.contains('active'),
                            velocity: el.dataset.velocity || '100'
                        })),
                    snare: Array.from(document.querySelectorAll('[data-track="snare"]'))
                        .map(el => ({
                            active: el.classList.contains('active'),
                            velocity: el.dataset.velocity || '100'
                        })),
                    hihat: Array.from(document.querySelectorAll('[data-track="hihat"]'))
                        .map(el => ({
                            active: el.classList.contains('active'),
                            velocity: el.dataset.velocity || '100'
                        })),
                    bass: Array.from(document.querySelectorAll('[data-track="bass"]'))
                        .map(el => ({
                            active: el.classList.contains('active'),
                            velocity: el.dataset.velocity || '100'
                        }))
                }
            };

            try {
                localStorage.setItem(AUTO_SAVE_KEY, JSON.stringify(state));
                console.log('üíæ Auto-saved at', new Date().toLocaleTimeString());
            } catch (error) {
                console.warn('Auto-save failed:', error);
            }
        }

        function loadAutoSave() {
            try {
                const saved = localStorage.getItem(AUTO_SAVE_KEY);
                if (!saved) return false;

                const state = JSON.parse(saved);
                
                // Restore BPM
                if (state.bpm) {
                    bpm = state.bpm;
                    document.getElementById('bpm-value').textContent = bpm;
                }

                // Restore patterns
                ['kick', 'snare', 'hihat', 'bass'].forEach(track => {
                    if (state.patterns[track]) {
                        const steps = document.querySelectorAll(`[data-track="${track}"]`);
                        state.patterns[track].forEach((stepData, i) => {
                            if (stepData.active) {
                                steps[i].classList.add('active');
                                steps[i].dataset.velocity = stepData.velocity;
                                steps[i].style.setProperty('--velocity', `${stepData.velocity}%`);
                            }
                        });
                    }
                });

                const savedDate = new Date(state.timestamp);
                showNotification(`üìÇ Restored auto-save from ${savedDate.toLocaleTimeString()}`);
                return true;
            } catch (error) {
                console.warn('Auto-save load failed:', error);
                return false;
            }
        }

        function clearAutoSave() {
            localStorage.removeItem(AUTO_SAVE_KEY);
            showNotification('üóëÔ∏è Auto-save cleared');
        }

        // Start auto-save interval
        setInterval(autoSave, AUTO_SAVE_INTERVAL);

        // Auto-save on pattern changes
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('seq-step')) {
                setTimeout(autoSave, 100);
            }
        });

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üéõÔ∏è WIRE UP EXPORT BUTTONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        document.addEventListener('DOMContentLoaded', () => {
            // MIDI Export
            const exportMidiBtn = document.getElementById('export-midi-btn');
            if (exportMidiBtn) {
                exportMidiBtn.addEventListener('click', exportToMIDI);
            }

            // Audio Recording
            const recordBtn = document.getElementById('record-btn');
            if (recordBtn) {
                recordBtn.addEventListener('click', () => {
                    if (isRecording) {
                        stopRecording();
                    } else {
                        startRecording();
                    }
                });
            }

            // Project Export
            const exportProjectBtn = document.getElementById('export-project-btn');
            if (exportProjectBtn) {
                exportProjectBtn.addEventListener('click', exportProject);
            }

            // Initialize spectrum analyzer
            setTimeout(initSpectrumAnalyzer, 1000);
            
            // Load auto-saved state
            setTimeout(() => {
                if (loadAutoSave()) {
                    console.log('‚úÖ Auto-save restored successfully');
                } else {
                    console.log('üìù Starting fresh session');
                }
            }, 500);
        });

        // Expose globally
        window.exportToMIDI = exportToMIDI;
        window.startRecording = startRecording;
        window.stopRecording = stopRecording;
        window.exportProject = exportProject;
        window.autoSave = autoSave;
        window.loadAutoSave = loadAutoSave;
        window.clearAutoSave = clearAutoSave;
        window.randomizePattern = randomizePattern;
        window.clearPattern = clearPattern;
        window.shiftPattern = shiftPattern;
        window.changeInstrument = changeInstrument;
        window.loadPatternPreset = loadPatternPreset;

        console.log('üéπ Export System loaded - MIDI, Audio Recording, and Project Export ready!');
        console.log('üíæ Auto-save enabled - Saves every 10 seconds');
        console.log('üé≤ Pattern Tools: window.randomizePattern(track), window.shiftPattern(track, direction)');
    </script>
</body>
</html>
