<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - HAOS.fm | Where Chaos Becomes Creation</title>
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="/css/haos-brand.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background-color: #0A0A0A;
            color: #F4E8D8;
            font-family: 'Inter', Arial, sans-serif;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iMzAwIj48ZmlsdGVyIGlkPSJhIj48ZmVUdXJidWxlbmNlIGJhc2VGcmVxdWVuY3k9Ii43NSIgc3RpdGNoVGlsZXM9InN0aXRjaCIgdHlwZT0iZnJhY3RhbE5vaXNlIi8+PGZlQ29sb3JNYXRyaXggdHlwZT0ic2F0dXJhdGUiIHZhbHVlcz0iMCIvPjwvZmlsdGVyPjxwYXRoIGQ9Ik0wIDBoMzAwdjMwMEgweiIgZmlsdGVyPSJ1cmwoI2EpIiBvcGFjaXR5PSIuMDUiLz48L3N2Zz4=');
            opacity: 0.03;
            mix-blend-mode: overlay;
            pointer-events: none;
            z-index: 9999;
        }
        .bg-glow { position: fixed; width: 400px; height: 400px; border-radius: 50%; filter: blur(120px); opacity: 0.15; animation: float 8s ease-in-out infinite; }
        .bg-glow.orange { background: #FF6B35; top: -100px; left: -100px; }
        .bg-glow.purple { background: #6A0DAD; bottom: -100px; right: -100px; animation-delay: -4s; }
        .bg-glow.cyan { background: #00D9FF; top: 50%; left: 50%; transform: translate(-50%, -50%); animation-delay: -2s; opacity: 0.08; }
        @keyframes float { 0%, 100% { transform: translate(0, 0); } 50% { transform: translate(30px, -30px); } }
        .login-container { position: relative; z-index: 10; width: 100%; max-width: 900px; }
        .haos-header { text-align: center; margin-bottom: 48px; animation: fadeIn 0.6s ease-out; }
        .haos-logo { display: inline-flex; align-items: center; justify-content: center; width: 100px; height: 100px; background: linear-gradient(135deg, #FF6B35 0%, #D4AF37 100%); border-radius: 50%; margin-bottom: 24px; box-shadow: 0 0 40px rgba(255, 107, 53, 0.4); position: relative; }
        .haos-logo::before { content: ''; position: absolute; width: 100%; height: 100%; border-radius: 50%; border: 2px solid rgba(255, 107, 53, 0.6); animation: pulse-ring 2s ease-out infinite; }
        @keyframes pulse-ring { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(1.5); opacity: 0; } }
        .haos-logo i { font-size: 48px; color: #0A0A0A; }
        .haos-title { font-family: 'Bebas Neue', Arial, sans-serif; font-size: clamp(48px, 8vw, 72px); letter-spacing: 4px; background: linear-gradient(135deg, #FF6B35 0%, #D4AF37 50%, #00D9FF 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 8px; }
        .haos-subtitle { font-family: 'Space Mono', monospace; font-size: 16px; color: #6B6B6B; letter-spacing: 2px; text-transform: uppercase; }
        .cards-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(340px, 1fr)); gap: 32px; margin-bottom: 48px; }
        .login-card { background: linear-gradient(145deg, #151515 0%, #0d0d0d 100%); border: 1px solid #2a2a2a; border-radius: 16px; padding: 40px; transition: all 0.3s ease; animation: fadeIn 0.6s ease-out; cursor: pointer; }
        .login-card:hover { transform: translateY(-8px); border-color: #FF6B35; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4), 0 0 30px rgba(255, 107, 53, 0.1); }
        .login-card.delay-1 { animation-delay: 0.1s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .card-icon { width: 72px; height: 72px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 24px; font-size: 32px; }
        .card-icon.explore { background: linear-gradient(135deg, #3D5A3D 0%, #2d452d 100%); color: #39FF14; box-shadow: 0 0 20px rgba(57, 255, 20, 0.2); }
        .card-icon.studio { background: linear-gradient(135deg, #6A0DAD 0%, #4a0880 100%); color: #00D9FF; box-shadow: 0 0 20px rgba(0, 217, 255, 0.2); }
        .card-title { font-family: 'Bebas Neue', Arial, sans-serif; font-size: 32px; letter-spacing: 2px; color: #F4E8D8; text-align: center; margin-bottom: 12px; }
        .card-desc { color: #6B6B6B; text-align: center; font-size: 15px; line-height: 1.6; margin-bottom: 24px; }
        .feature-list { list-style: none; padding: 0; margin: 0 0 32px 0; }
        .feature-list li { display: flex; align-items: center; gap: 12px; padding: 8px 0; font-size: 14px; color: #F4E8D8; }
        .feature-list li.disabled { color: #444; }
        .feature-list li i.fa-check-circle { color: #39FF14; }
        .feature-list li i.fa-times-circle { color: #444; }
        .btn-primary { width: 100%; background: linear-gradient(135deg, #FF6B35 0%, #D4AF37 100%); color: #0A0A0A; font-family: 'Bebas Neue', Arial, sans-serif; font-size: 18px; letter-spacing: 2px; padding: 16px 24px; border: none; border-radius: 12px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary:hover { transform: scale(1.02); box-shadow: 0 0 30px rgba(255, 107, 53, 0.4); }
        .btn-social { width: 100%; padding: 14px 24px; border-radius: 12px; font-weight: 600; font-size: 15px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 12px; text-decoration: none; margin-bottom: 12px; border: 1px solid transparent; }
        .btn-social:hover { transform: scale(1.02); }
        .btn-google { background: #ffffff; color: #333; border-color: #ddd; }
        .btn-google:hover { box-shadow: 0 4px 20px rgba(255, 255, 255, 0.2); }
        .btn-facebook { background: #1877f2; color: white; }
        .btn-facebook:hover { background: #166fe5; box-shadow: 0 4px 20px rgba(24, 119, 242, 0.4); }
        .btn-apple { background: #000; color: white; border-color: #333; }
        .btn-apple:hover { background: #111; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4); }
        .status-banner { padding: 16px; border-radius: 12px; margin-bottom: 20px; display: none; }
        .status-banner.error { background: rgba(139, 38, 53, 0.2); border: 1px solid #8B2635; color: #F4E8D8; }
        .features-highlight { text-align: center; color: #6B6B6B; animation: fadeIn 0.6s ease-out; animation-delay: 0.4s; animation-fill-mode: both; }
        .features-highlight h3 { font-family: 'Space Mono', monospace; font-size: 14px; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 20px; }
        .features-list { display: flex; flex-wrap: wrap; justify-content: center; gap: 24px; }
        .feature-badge { display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: rgba(255, 107, 53, 0.1); border: 1px solid rgba(255, 107, 53, 0.2); border-radius: 20px; font-size: 13px; color: #FF6B35; transition: all 0.3s ease; }
        .feature-badge:hover { background: rgba(255, 107, 53, 0.2); border-color: #FF6B35; }
        .login-footer { text-align: center; margin-top: 48px; animation: fadeIn 0.6s ease-out; animation-delay: 0.5s; animation-fill-mode: both; }
        .login-footer p { font-family: 'Space Mono', monospace; font-size: 12px; color: #444; letter-spacing: 1px; }
        .login-footer a { color: #FF6B35; text-decoration: none; transition: color 0.3s ease; }
        .login-footer a:hover { color: #D4AF37; }
        .divider { display: flex; align-items: center; gap: 16px; margin: 20px 0; color: #444; font-size: 12px; text-transform: uppercase; letter-spacing: 2px; }
        .divider::before, .divider::after { content: ''; flex: 1; height: 1px; background: #2a2a2a; }
        .hidden { display: none !important; }
        @keyframes pulse { 0%, 100% { transform: scale(1); box-shadow: 0 4px 20px rgba(255, 255, 255, 0.2); } 50% { transform: scale(1.05); box-shadow: 0 8px 30px rgba(255, 255, 255, 0.4); } }
        @media (max-width: 768px) { .cards-grid { grid-template-columns: 1fr; } .haos-title { font-size: 48px; } .login-card { padding: 28px; } }
    </style>
</head>
<body>
    <div class="bg-glow orange"></div>
    <div class="bg-glow purple"></div>
    <div class="bg-glow cyan"></div>
    <div class="login-container">
        <div class="haos-header">
            <div class="haos-logo"><i class="fas fa-broadcast-tower"></i></div>
            <h1 class="haos-title">HAOS.FM</h1>
            <p class="haos-subtitle">Where Chaos Becomes Creation</p>
        </div>
        <div class="cards-grid">
            <div class="login-card" onclick="continueAsGuest()">
                <div class="card-icon explore"><i class="fas fa-headphones-alt"></i></div>
                <h2 class="card-title">EXPLORE</h2>
                <p class="card-desc">Listen to the 24/7 radio stream, browse sounds, and discover the HAOS universe</p>
                <ul class="feature-list">
                    <li><i class="fas fa-check-circle"></i><span>24/7 Radio streaming</span></li>
                    <li><i class="fas fa-check-circle"></i><span>Browse sound library</span></li>
                    <li><i class="fas fa-check-circle"></i><span>Preview synth presets</span></li>
                    <li class="disabled"><i class="fas fa-times-circle"></i><span>Create & save projects</span></li>
                    <li class="disabled"><i class="fas fa-times-circle"></i><span>Full studio access</span></li>
                </ul>
                <button class="btn-primary"><i class="fas fa-play"></i>START EXPLORING</button>
            </div>
            <div class="login-card delay-1">
                <div class="card-icon studio"><i class="fas fa-sliders-h"></i></div>
                <h2 class="card-title">STUDIO ACCESS</h2>
                <p class="card-desc">Sign in to unlock the full creative suite with synthesis, sequencing & collaboration</p>
                <ul class="feature-list">
                    <li><i class="fas fa-check-circle"></i><span>All explorer features</span></li>
                    <li><i class="fas fa-check-circle"></i><span>Modular synthesizer</span></li>
                    <li><i class="fas fa-check-circle"></i><span>Pattern sequencer</span></li>
                    <li><i class="fas fa-check-circle"></i><span>Save & export projects</span></li>
                    <li><i class="fas fa-check-circle"></i><span>Real-time collaboration</span></li>
                </ul>
                <div id="error-banner" class="status-banner error"><span id="error-message"></span></div>
                
                <!-- Email/Password Login Form -->
                <form id="login-form" style="margin-bottom:24px">
                    <input type="email" id="login-email" placeholder="Email address" required
                           style="width:100%;padding:14px;border:1px solid #2a2a2a;border-radius:8px;background:#0d0d0d;color:#F4E8D8;font-size:15px;margin-bottom:12px;outline:none;transition:border-color 0.3s"
                           onfocus="this.style.borderColor='#FF6B35'" onblur="this.style.borderColor='#2a2a2a'">
                    <input type="password" id="login-password" placeholder="Password" required
                           style="width:100%;padding:14px;border:1px solid #2a2a2a;border-radius:8px;background:#0d0d0d;color:#F4E8D8;font-size:15px;margin-bottom:12px;outline:none;transition:border-color 0.3s"
                           onfocus="this.style.borderColor='#FF6B35'" onblur="this.style.borderColor='#2a2a2a'">
                    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px">
                        <label style="display:flex;align-items:center;gap:8px;cursor:pointer;font-size:13px;color:#6B6B6B">
                            <input type="checkbox" id="remember-me" style="cursor:pointer">
                            <span>Remember me</span>
                        </label>
                        <a href="/forgot-password" style="color:#FF6B35;font-size:13px;text-decoration:none;transition:color 0.3s">Forgot password?</a>
                    </div>
                    <button type="submit" class="btn-primary" id="login-submit-btn">
                        <i class="fas fa-sign-in-alt"></i>SIGN IN
                    </button>
                </form>

                <div class="divider">or continue with</div>
                
                <div id="login-buttons">
                    <a id="google-btn" href="/auth/google" class="btn-social btn-google">
                        <svg width="18" height="18" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                        Continue with Google
                    </a>
                    <a id="facebook-btn" href="/auth/facebook" class="btn-social btn-facebook hidden"><i class="fab fa-facebook-f"></i>Continue with Facebook</a>
                    <a id="apple-btn" href="/auth/apple" class="btn-social btn-apple hidden"><i class="fab fa-apple"></i>Continue with Apple</a>
                    <div id="enterprise-sso" class="hidden">
                        <div class="divider">or</div>
                        <a href="/api/auth/login/azure" class="btn-social" style="background:linear-gradient(135deg,#0078d4 0%,#106ebe 100%);color:white"><i class="fab fa-microsoft"></i>Sign in with Microsoft</a>
                    </div>
                    
                    <div class="divider">don't have an account?</div>
                    <a href="/register" class="btn-social" style="background:linear-gradient(135deg,#FF6B35 0%,#D4AF37 100%);color:#0A0A0A;font-weight:700">
                        <i class="fas fa-user-plus"></i>Create Free Account
                    </a>
                </div>
            </div>
        </div>
        <div class="features-highlight">
            <h3>Platform Features</h3>
            <div class="features-list">
                <div class="feature-badge"><i class="fas fa-broadcast-tower"></i><span>24/7 Radio</span></div>
                <div class="feature-badge"><i class="fas fa-wave-square"></i><span>Modular Synth</span></div>
                <div class="feature-badge"><i class="fas fa-drum"></i><span>Pattern Sequencer</span></div>
                <div class="feature-badge"><i class="fas fa-users"></i><span>Live Collaboration</span></div>
                <div class="feature-badge"><i class="fas fa-file-export"></i><span>Export to WAV</span></div>
            </div>
        </div>
        <div class="login-footer">
            <p>Hardware Analog Oscillator Synthesis • <a href="/privacy">Privacy</a> • <a href="/terms">Terms</a></p>
        </div>
    </div>
    <script>
        function continueAsGuest() { localStorage.setItem('userMode', 'guest'); localStorage.removeItem('userProfile'); window.location.href = '/'; }
        
        async function checkExistingSession() {
            try {
                const response = await fetch('/auth/status', { credentials: 'include' });
                if (response.ok) {
                    const data = await response.json();
                    if (data.authenticated && data.user) {
                        localStorage.setItem('userMode', 'authenticated');
                        localStorage.setItem('userProfile', JSON.stringify(data.user));
                        window.location.href = sessionStorage.getItem('loginReturnTo') || '/';
                        sessionStorage.removeItem('loginReturnTo');
                        return true;
                    }
                }
            } catch (e) { console.log('No existing session'); }
            return false;
        }
        
        function showError(message) {
            const errorBanner = document.getElementById('error-banner');
            const errorMessage = document.getElementById('error-message');
            errorMessage.textContent = message;
            errorBanner.style.display = 'block';
            setTimeout(() => { errorBanner.style.display = 'none'; }, 5000);
        }
        
        function checkUrlError() {
            const urlParams = new URLSearchParams(window.location.search);
            const error = urlParams.get('error');
            if (error) {
                const errorMessages = { 
                    'google_failed': 'Google login failed. Please try again.', 
                    'facebook_failed': 'Facebook login failed. Please try again.', 
                    'apple_failed': 'Apple login failed. Please try again.', 
                    'unauthorized': 'Sign in to access studio features.', 
                    'session_expired': 'Session expired. Please sign in again.' 
                };
                showError(errorMessages[error] || 'An error occurred. Please try again.');
            }
        }
        
        // Handle email/password login form
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const rememberMe = document.getElementById('remember-me').checked;
            const submitBtn = document.getElementById('login-submit-btn');
            
            // Disable button and show loading
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>SIGNING IN...';
            
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ email, password, rememberMe })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    // Store user info
                    localStorage.setItem('userMode', 'authenticated');
                    localStorage.setItem('userProfile', JSON.stringify(data.user));
                    
                    // Redirect
                    window.location.href = sessionStorage.getItem('loginReturnTo') || '/';
                    sessionStorage.removeItem('loginReturnTo');
                } else {
                    // Show error
                    showError(data.error || 'Login failed. Please try again.');
                    
                    // Handle specific error cases
                    if (data.needsVerification) {
                        setTimeout(() => {
                            if (confirm('Your email is not verified. Would you like to resend the verification email?')) {
                                window.location.href = `/resend-verification?email=${encodeURIComponent(email)}`;
                            }
                        }, 1000);
                    } else if (data.socialLogin) {
                        setTimeout(() => {
                            document.getElementById('google-btn').style.animation = 'pulse 1s ease-in-out 3';
                        }, 1000);
                    }
                    
                    // Re-enable button
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i>SIGN IN';
                }
            } catch (error) {
                console.error('Login error:', error);
                showError('Network error. Please check your connection and try again.');
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i>SIGN IN';
            }
        });
        
        async function loadProviders() {
            try {
                // Try multiple endpoints for provider information
                const endpoints = ['/auth/providers', '/api/auth/providers', '/api/platform/auth/providers'];
                let providers = [];
                
                for (const endpoint of endpoints) {
                    try {
                        const response = await fetch(endpoint);
                        if (response.ok) {
                            const data = await response.json();
                            providers = data.providers || data.auth?.providers || [];
                            break;
                        }
                    } catch (e) {
                        console.log(`Provider check failed for ${endpoint}`);
                    }
                }
                
                // Show available providers
                providers.forEach(provider => {
                    const btn = document.getElementById(provider.id + '-btn');
                    if (btn) btn.classList.remove('hidden');
                });
                
                // Handle OAuth provider issues
                const googleBtn = document.getElementById('google-btn');
                if (googleBtn && providers.find(p => p.id === 'google')) {
                    // Add fallback for Google OAuth issues
                    googleBtn.addEventListener('click', (e) => {
                        // Set a timeout to check if OAuth succeeded
                        setTimeout(() => {
                            checkOAuthSuccess();
                        }, 5000);
                    });
                } else if (googleBtn) {
                    // Disable Google login and show alternative
                    googleBtn.style.opacity = '0.5';
                    googleBtn.style.pointerEvents = 'none';
                    googleBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i>Google login temporarily unavailable';
                    
                    // Highlight email/password login
                    document.getElementById('login-form').style.border = '2px solid #FF6B35';
                    document.getElementById('login-form').style.borderRadius = '12px';
                    document.getElementById('login-form').style.padding = '16px';
                    document.getElementById('login-form').style.marginBottom = '24px';
                    
                    // Add note about Google issues
                    const note = document.createElement('div');
                    note.style.cssText = 'background: rgba(255, 107, 53, 0.1); border: 1px solid rgba(255, 107, 53, 0.3); border-radius: 8px; padding: 12px; margin-bottom: 16px; font-size: 13px; color: #FF6B35;';
                    note.innerHTML = '<i class="fas fa-info-circle"></i> Google login is currently experiencing issues. Please use email/password login or try again later.';
                    document.getElementById('login-form').parentNode.insertBefore(note, document.getElementById('login-form'));
                }
                
            } catch (e) { 
                console.log('Could not load providers:', e);
                // Fallback: assume email/password login works, disable OAuth
                const oauthButtons = document.querySelectorAll('.btn-social[href*="/auth/"]');
                oauthButtons.forEach(btn => {
                    btn.style.opacity = '0.5';
                    btn.style.pointerEvents = 'none';
                });
            }
        }
        
        function checkOAuthSuccess() {
            // Check if we're still on the login page after OAuth attempt
            if (window.location.pathname === '/login.html') {
                // OAuth might have failed silently
                showError('OAuth login failed. Please try email/password login or contact support.');
                
                // Highlight alternative login methods
                const emailInput = document.getElementById('login-email');
                if (emailInput) {
                    emailInput.focus();
                    emailInput.style.borderColor = '#FF6B35';
                    emailInput.style.boxShadow = '0 0 0 3px rgba(255, 107, 53, 0.2)';
                }
            }
        }
        
        async function enhancedAuthCheck() {
            try {
                // Try multiple auth status endpoints
                const endpoints = ['/auth/status', '/api/auth/status', '/api/user/profile'];
                
                for (const endpoint of endpoints) {
                    try {
                        const response = await fetch(endpoint, { credentials: 'include' });
                        if (response.ok) {
                            const data = await response.json();
                            if ((data.authenticated || data.success) && data.user) {
                                localStorage.setItem('userMode', 'authenticated');
                                localStorage.setItem('userProfile', JSON.stringify(data.user));
                                
                                // Redirect to intended destination
                                const returnTo = sessionStorage.getItem('loginReturnTo') || 
                                               new URLSearchParams(window.location.search).get('returnTo') || 
                                               '/';
                                window.location.href = returnTo;
                                sessionStorage.removeItem('loginReturnTo');
                                return true;
                            }
                        }
                    } catch (e) {
                        console.log(`Auth check failed for ${endpoint}`);
                    }
                }
            } catch (e) { 
                console.log('No existing session'); 
            }
            return false;
        }
        
        document.addEventListener('DOMContentLoaded', async () => {
            checkUrlError();
            
            // Enhanced authentication check
            const isAuthenticated = await enhancedAuthCheck();
            if (isAuthenticated) return;
            
            // Load OAuth providers with fallbacks
            await loadProviders();
            
            // Check for enterprise SSO availability
            try { 
                const response = await fetch('/api/auth/status');
                if (response.ok) {
                    document.getElementById('enterprise-sso').classList.remove('hidden');
                }
            } catch (e) {
                console.log('Enterprise SSO not available');
            }
            
            // Auto-fill email from URL parameter if present
            const urlParams = new URLSearchParams(window.location.search);
            const emailParam = urlParams.get('email');
            if (emailParam) {
                document.getElementById('login-email').value = emailParam;
                document.getElementById('login-password').focus();
            }
            
            // Add form validation enhancements
            const loginForm = document.getElementById('login-form');
            const emailInput = document.getElementById('login-email');
            const passwordInput = document.getElementById('login-password');
            
            // Real-time validation
            emailInput.addEventListener('input', () => {
                const isValid = emailInput.validity.valid;
                emailInput.style.borderColor = isValid ? '#2a2a2a' : '#ff4444';
            });
            
            passwordInput.addEventListener('input', () => {
                const isValid = passwordInput.value.length >= 6;
                passwordInput.style.borderColor = isValid ? '#2a2a2a' : '#ff4444';
            });
            
            // Focus management
            emailInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && emailInput.validity.valid) {
                    passwordInput.focus();
                }
            });
            
            passwordInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && passwordInput.value.length >= 6) {
                    loginForm.dispatchEvent(new Event('submit'));
                }
            });
        });
        
        // Enhanced keyboard shortcuts
        document.addEventListener('keydown', (e) => { 
            if (e.key === 'Escape') {
                continueAsGuest();
            }
            
            // Quick login shortcuts
            if (e.ctrlKey || e.metaKey) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    document.getElementById('login-form').dispatchEvent(new Event('submit'));
                }
            }
        });
    </script>
</body>
</html>
