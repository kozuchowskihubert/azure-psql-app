<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAOS.fm | Hardware Analog Operating System</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Space+Mono:wght@400;700&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* HAOS Brand Colors */
            --haos-black: #0a0a0a;
            --haos-panel: rgba(20, 20, 25, 0.85);
            --haos-orange: #FF6B35;
            --haos-orange-bright: #FF8C42;
            --haos-orange-dark: #E55A2B;
            --haos-green: #39FF14;
            --haos-cyan: #00D9FF;
            --haos-pink: #FF006E;
            --haos-text: #e0e0e0;
            --haos-dim: #888;
            --haos-border: rgba(255, 107, 53, 0.2);
            
            /* Typography */
            --font-display: 'Bebas Neue', sans-serif;
            --font-mono: 'Space Mono', monospace;
            --font-body: 'Inter', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: var(--font-body);
            background: var(--haos-black);
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(255, 107, 53, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(255, 140, 66, 0.06) 0%, transparent 50%);
            color: var(--haos-text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Header */
        .haos-header {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--haos-border);
            padding: 20px 30px;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 30px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 20px;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .logo-section:hover {
            transform: scale(1.05);
            opacity: 0.8;
        }

        .logo-section img {
            height: 50px;
            filter: drop-shadow(0 2px 10px rgba(255, 255, 255, 0.2));
        }

        .brand-text {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .brand-name {
            font-family: var(--font-display);
            font-size: 1.8rem;
            letter-spacing: 2px;
            background: linear-gradient(135deg, var(--haos-orange), var(--haos-orange-bright));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .brand-tagline {
            font-family: var(--font-mono);
            font-size: 0.65rem;
            letter-spacing: 3px;
            color: var(--haos-orange);
            text-transform: uppercase;
        }

        .header-status {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            border-radius: 20px;
            border: 1px solid var(--haos-border);
            background: rgba(0, 0, 0, 0.4);
            font-family: var(--font-mono);
            font-size: 0.7rem;
            letter-spacing: 1px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--haos-orange);
            animation: pulse 2s infinite;
            box-shadow: 0 0 10px var(--haos-orange);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        /* Main Container */
        .haos-main {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 30px;
        }

        /* Hero Welcome */
        .hero-welcome {
            text-align: center;
            padding: 60px 30px 40px;
            margin-bottom: 50px;
        }

        .hero-welcome h1 {
            font-family: var(--font-display);
            font-size: 4.5rem;
            line-height: 1;
            letter-spacing: 2px;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #fff 0%, var(--haos-orange) 40%, var(--haos-orange-bright) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero-subtitle {
            font-family: var(--font-mono);
            font-size: 0.9rem;
            letter-spacing: 2px;
            color: var(--haos-orange);
            text-transform: uppercase;
            margin-bottom: 15px;
        }

        .hero-description {
            font-size: 1.1rem;
            color: var(--haos-dim);
            line-height: 1.7;
            max-width: 700px;
            margin: 0 auto 40px;
        }

        /* OS Selection */
        .os-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 30px;
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .os-card {
            position: relative;
            background: var(--haos-panel);
            backdrop-filter: blur(12px);
            border: 2px solid var(--haos-border);
            border-radius: 24px;
            padding: 50px 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s ease;
            overflow: hidden;
        }

        .os-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--os-color);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .os-card:hover::before {
            opacity: 1;
        }

        .os-card.techno {
            --os-color: var(--haos-orange);
        }

        .os-card.hiphop {
            --os-color: var(--haos-orange-bright);
        }

        .os-card:hover {
            transform: translateY(-5px);
            border-color: var(--os-color);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5),
                        0 0 40px var(--os-color);
        }

        .os-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            filter: grayscale(0.3);
            transition: filter 0.3s ease;
        }

        .os-card:hover .os-icon {
            filter: grayscale(0);
        }

        .os-title {
            font-family: var(--font-display);
            font-size: 2.5rem;
            letter-spacing: 2px;
            margin-bottom: 15px;
            color: var(--os-color);
        }

        .os-tagline {
            font-family: var(--font-mono);
            font-size: 0.75rem;
            letter-spacing: 2px;
            color: var(--haos-dim);
            text-transform: uppercase;
            margin-bottom: 20px;
        }

        .os-features {
            text-align: left;
            margin: 25px 0;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .os-features ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .os-features li {
            padding: 8px 0;
            color: var(--haos-text);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .os-features li::before {
            content: '‚ñ∏';
            color: var(--os-color);
            font-size: 1.2rem;
        }

        .os-btn {
            margin-top: 20px;
            padding: 14px 30px;
            border-radius: 8px;
            border: 2px solid var(--os-color);
            background: transparent;
            color: var(--os-color);
            font-family: var(--font-mono);
            font-size: 0.85rem;
            letter-spacing: 1px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .os-btn:hover {
            background: var(--os-color);
            color: #000;
            transform: scale(1.05);
        }

        /* OS Mode Active State */
        .os-mode-active {
            display: none;
        }

        body[data-os="techno"] .os-mode-active.techno-mode,
        body[data-os="hiphop"] .os-mode-active.hiphop-mode {
            display: block;
        }

        body[data-os="techno"] .os-selector,
        body[data-os="hiphop"] .os-selector {
            display: none;
        }

        /* Mode Header */
        .mode-header {
            background: var(--haos-panel);
            border: 1px solid var(--haos-border);
            border-radius: 16px;
            padding: 20px 30px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .mode-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .mode-title h2 {
            font-family: var(--font-display);
            font-size: 2rem;
            color: var(--os-color);
        }

        .mode-badge {
            padding: 6px 14px;
            border-radius: 20px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--os-color);
            font-family: var(--font-mono);
            font-size: 0.7rem;
            letter-spacing: 2px;
            color: var(--os-color);
            text-transform: uppercase;
        }

        .switch-os-btn {
            padding: 8px 16px;
            border-radius: 6px;
            border: 1px solid var(--haos-border);
            background: transparent;
            color: var(--haos-dim);
            font-family: var(--font-mono);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .switch-os-btn:hover {
            border-color: var(--haos-orange);
            color: var(--haos-orange);
        }

        /* Creator Panel */
        .creator-panel {
            background: var(--haos-panel);
            backdrop-filter: blur(12px);
            border: 1px solid var(--haos-border);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        }

        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--haos-border);
        }

        .panel-title {
            font-family: var(--font-display);
            font-size: 2rem;
            letter-spacing: 1px;
            color: var(--haos-orange);
        }

        .panel-badge {
            padding: 6px 14px;
            border-radius: 20px;
            background: rgba(255, 107, 53, 0.1);
            border: 1px solid rgba(255, 107, 53, 0.3);
            font-family: var(--font-mono);
            font-size: 0.7rem;
            letter-spacing: 2px;
            color: var(--haos-orange);
            text-transform: uppercase;
        }

        .panel-content {
            display: grid;
            gap: 25px;
        }

        .control-group {
            display: grid;
            gap: 15px;
        }

        .control-label {
            font-family: var(--font-mono);
            font-size: 0.75rem;
            letter-spacing: 1px;
            color: var(--haos-dim);
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .control-description {
            color: var(--haos-dim);
            font-size: 0.9rem;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-family: var(--font-mono);
            font-size: 0.85rem;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--haos-orange), var(--haos-orange-bright));
            color: #000;
            font-weight: bold;
            box-shadow: 0 4px 20px rgba(255, 107, 53, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 30px rgba(255, 107, 53, 0.6);
        }

        .btn-secondary {
            background: transparent;
            color: var(--haos-text);
            border: 1px solid var(--haos-border);
        }

        .btn-secondary:hover {
            border-color: var(--haos-orange);
            color: var(--haos-orange);
        }

        /* Action Grid */
        .action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .action-card {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--haos-border);
            border-radius: 16px;
            padding: 25px;
            transition: all 0.3s ease;
        }

        .action-card:hover {
            border-color: var(--haos-orange);
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(255, 107, 53, 0.2);
        }

        .action-icon {
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .action-title {
            font-family: var(--font-display);
            font-size: 1.4rem;
            margin-bottom: 10px;
            color: var(--haos-orange);
        }

        .action-description {
            color: var(--haos-dim);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        /* Info Bar */
        .info-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 30px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 12px;
            border: 1px solid var(--haos-border);
            margin-top: 30px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .info-label {
            font-family: var(--font-mono);
            font-size: 0.7rem;
            letter-spacing: 1px;
            color: var(--haos-dim);
            text-transform: uppercase;
        }

        .info-value {
            font-family: var(--font-display);
            font-size: 1.5rem;
            color: var(--haos-orange);
        }

        /* Footer */
        .haos-footer {
            margin-top: 80px;
            padding: 30px;
            text-align: center;
            border-top: 1px solid var(--haos-border);
        }

        .footer-text {
            font-family: var(--font-mono);
            font-size: 0.75rem;
            color: var(--haos-dim);
            letter-spacing: 1px;
        }

        /* Studio Panel Modal */
        .studio-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .studio-panel-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
        }

        .studio-panel-content {
            position: relative;
            width: 90%;
            max-width: 1200px;
            max-height: 85vh;
            background: var(--haos-panel);
            border: 2px solid var(--haos-orange);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(255, 107, 53, 0.5);
            overflow: hidden;
            animation: slideInPanel 0.3s ease-out;
        }

        @keyframes slideInPanel {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .studio-panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 25px 30px;
            background: rgba(0, 0, 0, 0.5);
            border-bottom: 1px solid var(--haos-border);
        }

        .studio-panel-header h2 {
            font-family: var(--font-display);
            font-size: 2rem;
            color: var(--haos-orange);
            margin: 0;
        }

        .studio-close-btn {
            background: transparent;
            border: 2px solid var(--haos-orange);
            color: var(--haos-orange);
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .studio-close-btn:hover {
            background: var(--haos-orange);
            color: #000;
            transform: rotate(90deg);
        }

        .studio-panel-body {
            padding: 30px;
            overflow-y: auto;
            max-height: calc(85vh - 100px);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero-welcome h1 {
                font-size: 2.5rem;
            }
            
            .header-content {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .os-selector {
                grid-template-columns: 1fr;
            }
            
            .action-grid {
                grid-template-columns: 1fr;
            }
            
            .info-bar {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
        }
    </style>
</head>
<body>

    <!-- Load HAOS Audio Engine -->
    <script src="/js/haos-audio-engine.js"></script>
    
    <!-- Header -->
    <header class="haos-header">
        <div class="header-content">
            <a href="/" class="logo-section" style="text-decoration: none; cursor: pointer;">
                <img src="/images/haos-logo-white.png" alt="HAOS.fm Logo">
                <div class="brand-text">
                    <div class="brand-name">HAOS.FM</div>
                    <div class="brand-tagline">Future Modulation</div>
                </div>
            </a>
            <div class="header-status">
                <div class="status-indicator">
                    <span class="status-dot"></span>
                    <span>System Ready</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="haos-main">
        
        <!-- Hero Section -->
        <section class="hero-welcome">
            <div class="hero-subtitle">Hardware Analog Operating System</div>
            <h1>FUTURE MODULATION</h1>
            <p class="hero-description">
                Choose your sonic universe. Each operating system is purpose-built for its genre with dedicated tools, workflows, and sound design philosophy.
            </p>

            <!-- OS Selection -->
            <div class="os-selector">
                <div class="os-card techno" data-os-select="techno">
                    <div class="os-icon">‚ö°</div>
                    <h2 class="os-title">TECHNO OS</h2>
                    <p class="os-tagline">Industrial ¬∑ Hypnotic ¬∑ Relentless</p>
                    <div class="os-features">
                        <ul>
                            <li>TB-303 Acid Bass Engine</li>
                            <li>TR-909 Drum Machine</li>
                            <li>Modular Step Sequencer</li>
                            <li>Industrial FX Chain</li>
                            <li>BPM: 120-150 optimized</li>
                        </ul>
                    </div>
                    <button class="os-btn">Enter Techno OS</button>
                </div>

                <div class="os-card hiphop" data-os-select="hiphop">
                    <div class="os-icon">üî•</div>
                    <h2 class="os-title">HIP-HOP OS</h2>
                    <p class="os-tagline">Rhythmic ¬∑ Layered ¬∑ Dynamic</p>
                    <div class="os-features">
                        <ul>
                            <li>TR-808 Drum Synthesis</li>
                            <li>Sample Chopper & Slicer</li>
                            <li>Swing & Groove Engine</li>
                            <li>Vinyl Saturation FX</li>
                            <li>BPM: 60-100 optimized</li>
                        </ul>
                    </div>
                    <button class="os-btn">Enter Hip-Hop OS</button>
                </div>
            </div>
        </section>

        <!-- TECHNO OS MODE -->
        <section class="os-mode-active techno-mode">
            <div class="mode-header">
                <div class="mode-title">
                    <span style="font-size: 2rem;">‚ö°</span>
                    <h2>TECHNO OS</h2>
                    <span class="mode-badge">Active</span>
                </div>
                <button class="switch-os-btn" onclick="HAOS.switchOS(null)">Switch OS</button>
            </div>

            <div class="creator-panel" style="--os-color: var(--haos-green);">
                <div class="panel-header">
                    <h2 class="panel-title">Techno Studio</h2>
                    <span class="panel-badge">Industrial Tools</span>
                </div>
                
                <div class="panel-content">
                    <div class="control-group">
                        <div class="control-label">Techno Workflow</div>
                        <p class="control-description">
                            Build hypnotic loops with acid basslines, industrial drums, and evolving modulation.
                            The Techno OS is optimized for repetitive, driving rhythms and squelchy 303 sequences.
                        </p>
                        
                        <div class="action-grid">
                            <div class="action-card" onclick="HAOS.openPanel('acid-lab')" style="cursor: pointer;">
                                <div class="action-icon">üéõÔ∏è</div>
                                <h3 class="action-title">TB-303 Acid Lab</h3>
                                <p class="action-description">
                                    Classic acid bassline synthesis with resonance, envelope, and slide controls.
                                </p>
                            </div>
                            
                            <div class="action-card" onclick="HAOS.openPanel('drums-909')" style="cursor: pointer;">
                                <div class="action-icon">ü•Å</div>
                                <h3 class="action-title">TR-909 Drums</h3>
                                <p class="action-description">
                                    Legendary kick, snare, hi-hats, and cymbals for driving techno rhythms.
                                </p>
                            </div>
                            
                            <div class="action-card" onclick="HAOS.openPanel('sequencer')" style="cursor: pointer;">
                                <div class="action-icon">‚öôÔ∏è</div>
                                <h3 class="action-title">Modular Sequencer</h3>
                                <p class="action-description">
                                    16-step pattern programming with automation and randomization.
                                </p>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        <button class="btn btn-primary" onclick="HAOS.openPanel('acid-lab')">Launch Studio</button>
                        <button class="btn btn-secondary" onclick="console.log('Available:', HAOS.getAvailablePanels())">View Available Tools</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- HIP-HOP OS MODE -->
        <section class="os-mode-active hiphop-mode">
            <div class="mode-header">
                <div class="mode-title">
                    <span style="font-size: 2rem;">üî•</span>
                    <h2>HIP-HOP OS</h2>
                    <span class="mode-badge" style="--os-color: var(--haos-pink);">Active</span>
                </div>
                <button class="switch-os-btn" onclick="HAOS.switchOS(null)">Switch OS</button>
            </div>

            <div class="creator-panel" style="--os-color: var(--haos-pink);">
                <div class="panel-header">
                    <h2 class="panel-title" style="color: var(--haos-pink);">Hip-Hop Studio</h2>
                    <span class="panel-badge" style="border-color: var(--haos-pink); color: var(--haos-pink);">Boom Bap Tools</span>
                </div>
                
                <div class="panel-content">
                    <div class="control-group">
                        <div class="control-label">Hip-Hop Workflow</div>
                        <p class="control-description">
                            Craft hard-hitting beats with punchy 808s, layered samples, and swung grooves.
                            The Hip-Hop OS emphasizes rhythm, texture, and dynamic sample manipulation.
                        </p>
                        
                        <div class="action-grid">
                            <div class="action-card">
                                <div class="action-icon">üéõÔ∏è</div>
                                <h3 class="action-title" style="color: var(--haos-pink);">TR-808 Engine</h3>
                                <p class="action-description">
                                    Iconic 808 kick, snare, clap, and hi-hat synthesis for boom-bap beats.
                                </p>
                            </div>
                            
                            <div class="action-card">
                                <div class="action-icon">‚úÇÔ∏è</div>
                                <h3 class="action-title" style="color: var(--haos-pink);">Sample Chopper</h3>
                                <p class="action-description">
                                    Slice, dice, and rearrange samples with swing and groove quantization.
                                </p>
                            </div>
                            
                            <div class="action-card">
                                <div class="action-icon">üéöÔ∏è</div>
                                <h3 class="action-title" style="color: var(--haos-pink);">MPC-Style Pads</h3>
                                <p class="action-description">
                                    16-pad controller with velocity sensitivity and live performance mode.
                                </p>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        <button class="btn btn-primary" style="background: var(--haos-orange-bright);" onclick="HAOS.openPanel('drums-808')">Launch Studio</button>
                        <button class="btn btn-secondary" onclick="console.log('Available:', HAOS.getAvailablePanels())">View Available Tools</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- System Info -->
        <div class="info-bar">
            <div class="info-item">
                <span class="info-label">Platform Status</span>
                <span class="info-value">Online</span>
            </div>
            <div class="info-item">
                <span class="info-label">Modules Loaded</span>
                <span class="info-value">3</span>
            </div>
            <div class="info-item">
                <span class="info-label">DSP Engine</span>
                <span class="info-value">Active</span>
            </div>
            <div class="info-item">
                <span class="info-label">Sample Rate</span>
                <span class="info-value">48kHz</span>
            </div>
        </div>

    </main>

    <!-- Studio Panel Modal -->
    <div id="studio-panel" class="studio-panel" style="display: none;">
        <div class="studio-panel-overlay" onclick="HAOS.closeStudio()"></div>
        <div class="studio-panel-content">
            <div class="studio-panel-header">
                <h2 id="studio-title">Studio</h2>
                <button class="studio-close-btn" onclick="HAOS.closeStudio()">‚úï</button>
            </div>
            <div id="studio-body" class="studio-panel-body">
                <!-- Dynamic content loads here -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="haos-footer">
        <p class="footer-text">
            HAOS.FM ¬∑ Hardware Analog Operating System ¬∑ Future Modulation Platform
        </p>
    </footer>

    <!-- Minimal JavaScript -->
    <script>
        // HAOS Audio Engine Wrapper
        const AudioEngine = {
            engine: null,
            context: null,
            masterGain: null,
            initialized: false,
            
            // Synth modules
            tb303: null,
            tr909: null,
            sequencer: null,
            
            async init() {
                if (this.initialized) return;
                
                try {
                    console.log('üéõÔ∏è Initializing HAOS Audio Engine...');
                    
                    // Initialize HAOS Audio Engine
                    this.engine = new HAOSAudioEngine();
                    await this.engine.init();
                    
                    this.context = this.engine.audioContext;
                    this.masterGain = this.engine.masterGain;
                    
                    // Reference synth modules
                    this.tb303 = this.engine.tb303;
                    this.tr909 = this.engine.tr909;
                    this.sequencer = this.engine.sequencer;
                    
                    this.initialized = true;
                    
                    console.log('üîä HAOS Audio Engine initialized:', {
                        sampleRate: this.context.sampleRate + ' Hz',
                        state: this.context.state,
                        modules: {
                            TB303: !!this.tb303,
                            TR909: !!this.tr909,
                            Sequencer: !!this.sequencer
                        }
                    });
                    
                    return true;
                } catch (error) {
                    console.error('‚ùå Failed to initialize audio engine:', error);
                    throw error;
                }
            },
            
            // Simple note player
            playNote(freq, duration, waveform) {
                const now = this.context.currentTime;
                const osc = this.context.createOscillator();
                const env = this.context.createGain();
                
                osc.type = waveform || 'sine';
                osc.frequency.value = freq;
                
                env.gain.setValueAtTime(0.3, now);
                env.gain.exponentialRampToValueAtTime(0.01, now + duration);
                
                osc.connect(env);
                env.connect(this.masterGain);
                
                osc.start(now);
                osc.stop(now + duration + 0.1);
            }
        };
        
        // HAOS Platform Core
        const HAOS = {
            version: '1.0',
            initialized: false,
            currentOS: null,
            currentPanel: null,
            
            // Panel Registry - defines all available panels per OS
            panels: {
                techno: {
                    home: {
                        id: 'home',
                        title: 'Techno Studio',
                        icon: '‚ö°',
                        available: true,
                        tools: ['acid-lab', 'drums-909', 'sequencer']
                    },
                    'acid-lab': {
                        id: 'acid-lab',
                        title: 'TB-303 Acid Lab',
                        icon: 'üéõÔ∏è',
                        parent: 'home',
                        available: true,
                        description: 'Classic acid bassline synthesis'
                    },
                    'drums-909': {
                        id: 'drums-909',
                        title: 'TR-909 Drums',
                        icon: 'ü•Å',
                        parent: 'home',
                        available: true,
                        description: 'Legendary techno drum machine'
                    },
                    'sequencer': {
                        id: 'sequencer',
                        title: 'Modular Sequencer',
                        icon: '‚öôÔ∏è',
                        parent: 'home',
                        available: true,
                        description: '16-step pattern programming'
                    }
                },
                hiphop: {
                    home: {
                        id: 'home',
                        title: 'Hip-Hop Studio',
                        icon: 'üî•',
                        available: true,
                        tools: ['drums-808', 'sample-chopper', 'mpc-pads']
                    },
                    'drums-808': {
                        id: 'drums-808',
                        title: 'TR-808 Engine',
                        icon: 'üéõÔ∏è',
                        parent: 'home',
                        available: true,
                        description: 'Iconic 808 drum synthesis'
                    },
                    'sample-chopper': {
                        id: 'sample-chopper',
                        title: 'Sample Chopper',
                        icon: '‚úÇÔ∏è',
                        parent: 'home',
                        available: true,
                        description: 'Slice and rearrange samples'
                    },
                    'mpc-pads': {
                        id: 'mpc-pads',
                        title: 'MPC-Style Pads',
                        icon: 'üéöÔ∏è',
                        parent: 'home',
                        available: true,
                        description: '16-pad controller'
                    }
                }
            },
            
            // ===== INITIALIZATION =====
            init() {
                console.log('üéõÔ∏è HAOS.FM Platform Initializing...');
                this.setupEventListeners();
                this.loadSavedOS();
                
                // Initialize pattern management
                this.patternManager = new HAOSPatternManager();
                this.tb303Presets = new HAOSTB303Presets();
                
                // Check for pattern in URL
                this.loadPatternFromURL();
                
                this.initialized = true;
                console.log('‚úì HAOS.FM Ready - Future Modulation Online');
            },
            
            loadPatternFromURL() {
                if (!this.patternManager) return;
                
                const urlPattern = this.patternManager.patternFromURL();
                if (urlPattern) {
                    console.log('üì• Loading pattern from URL...');
                    setTimeout(() => {
                        // Load pattern after sequencer is ready
                        if (urlPattern.pattern && this.sequencerState) {
                            Object.keys(urlPattern.pattern).forEach(track => {
                                if (this.sequencerState.pattern[track]) {
                                    urlPattern.pattern[track].forEach((active, i) => {
                                        this.sequencerState.pattern[track][i] = active;
                                    });
                                }
                            });
                        }
                        
                        // Load TB-303 params
                        if (urlPattern.tb303 && AudioEngine.tb303) {
                            Object.assign(AudioEngine.tb303.params, urlPattern.tb303);
                        }
                        
                        this.showToast('üì• Pattern loaded from URL');
                    }, 1000);
                }
            },
            
            setupEventListeners() {
                // OS Selection Cards
                document.querySelectorAll('[data-os-select]').forEach(card => {
                    card.addEventListener('click', (e) => {
                        const os = card.dataset.osSelect;
                        this.switchOS(os);
                    });
                });
                
                // Make all action cards clickable
                setTimeout(() => {
                    document.querySelectorAll('.action-card').forEach((card, index) => {
                        card.style.cursor = 'pointer';
                        card.addEventListener('click', () => {
                            const title = card.querySelector('.action-title')?.textContent;
                            const panelId = this.getPanelIdFromTitle(title);
                            if (panelId) this.openPanel(panelId);
                        });
                    });
                }, 500);
                
                // Initialize audio on first user interaction
                document.addEventListener('click', async () => {
                    if (!AudioEngine.initialized) {
                        await AudioEngine.init();
                    }
                }, { once: true });
            },
            
            // ===== OS MANAGEMENT =====
            switchOS(os) {
                if (os === null) {
                    this.resetOS();
                } else {
                    this.activateOS(os);
                }
            },
            
            resetOS() {
                document.body.removeAttribute('data-os');
                this.currentOS = null;
                this.currentPanel = null;
                localStorage.removeItem('haos-os');
                this.showToast('OS selection reset');
            },
            
            activateOS(os) {
                document.body.setAttribute('data-os', os);
                this.currentOS = os;
                this.currentPanel = 'home';
                localStorage.setItem('haos-os', os);
                
                const osName = os === 'techno' ? 'Techno OS' : 'Hip-Hop OS';
                this.showToast(`${osName} activated`);
                console.log(`üéõÔ∏è Switched to ${osName}`);
                console.log(`üìã Available panels:`, Object.keys(this.panels[os]));
                
                // Play welcome sound
                AudioEngine.playNote(440, 0.1, 'sawtooth');
            },
            
            loadSavedOS() {
                const savedOS = localStorage.getItem('haos-os');
                if (savedOS && (savedOS === 'techno' || savedOS === 'hiphop')) {
                    this.switchOS(savedOS);
                }
            },
            
            // ===== PANEL MANAGEMENT =====
            getPanelIdFromTitle(title) {
                const mapping = {
                    'TB-303': 'acid-lab',
                    'TR-909': 'drums-909',
                    'Sequencer': 'sequencer',
                    '808': 'drums-808',
                    'Chopper': 'sample-chopper',
                    'MPC': 'mpc-pads'
                };
                
                for (const [key, value] of Object.entries(mapping)) {
                    if (title?.includes(key)) return value;
                }
                return null;
            },
            
            openPanel(panelId) {
                if (!this.validatePanelAccess(panelId)) return;
                
                const panel = this.panels[this.currentOS][panelId];
                this.currentPanel = panelId;
                console.log(`üìÇ Opening panel:`, panel);
                
                this.showStudioPanel(panelId, panel);
            },
            
            validatePanelAccess(panelId) {
                if (!this.currentOS) {
                    console.warn('No OS selected');
                    return false;
                }
                
                const panel = this.panels[this.currentOS][panelId];
                if (!panel) {
                    console.warn(`Panel ${panelId} not found`);
                    return false;
                }
                
                if (!panel.available) {
                    this.showToast('This panel is locked. Complete prerequisites first.');
                    return false;
                }
                
                return true;
            },
            
            // ===== STUDIO PANEL UI =====
            showStudioPanel(panelId, panel) {
                const studioPanel = document.getElementById('studio-panel');
                const studioTitle = document.getElementById('studio-title');
                const studioBody = document.getElementById('studio-body');
                
                if (!studioPanel || !studioTitle || !studioBody) {
                    console.error('Studio panel elements not found');
                    return;
                }
                
                studioTitle.textContent = panel.title;
                studioBody.innerHTML = this.renderPanelContent(panelId, panel);
                studioPanel.style.display = 'flex';
                
                // Update saved patterns dropdown when opening sequencer
                if (panelId === 'sequencer') {
                    setTimeout(() => this.updateSavedPatternsDropdown(), 100);
                }
                
                // Play demo after panel opens
                setTimeout(() => this.playPanelDemo(panelId), 300);
            },
            
            closeStudio() {
                const studioPanel = document.getElementById('studio-panel');
                if (studioPanel) {
                    studioPanel.style.display = 'none';
                }
                console.log('üö™ Studio closed');
            },
            
            // ===== PANEL CONTENT RENDERING =====
            renderPanelContent(panelId, panel) {
                const renderers = {
                    'acid-lab': () => this.renderTB303Studio(),
                    'drums-909': () => this.renderTR909Studio(),
                    'drums-808': () => this.renderTR808Studio(),
                    'sequencer': () => this.renderSequencerStudio(),
                };
                
                const renderer = renderers[panelId];
                return renderer ? renderer() : this.renderDefaultStudio(panel, panelId);
            },
            
            renderDefaultStudio(panel, panelId) {
                return `
                    <div style="text-align: center; padding: 40px;">
                        <h3 style="color: var(--haos-orange); font-size: 1.5rem; margin-bottom: 20px;">
                            ${panel.title}
                        </h3>
                        <p style="color: var(--haos-dim); margin-bottom: 30px;">
                            ${panel.description || 'Studio interface coming soon...'}
                        </p>
                        <p style="font-family: var(--font-mono); font-size: 0.9rem;">
                            üéõÔ∏è Panel ID: ${panelId}<br>
                            ‚öôÔ∏è Features in development
                        </p>
                    </div>
                `;
            },
            
            // ===== STUDIO RENDERERS =====
            renderTB303Studio() {
                return `
                    <div style="padding: 20px;">
                        <h3 style="color: var(--haos-green); font-size: 1.8rem; margin-bottom: 10px; text-align: center;">
                            TB-303 Acid Lab
                        </h3>
                        <p style="color: var(--haos-dim); margin-bottom: 30px; text-align: center;">
                            Classic acid bassline synthesis
                        </p>
                        
                        <!-- Control Grid -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                            
                            <!-- Cutoff -->
                            <div class="synth-control">
                                <label style="font-family: var(--font-mono); font-size: 0.8rem; color: var(--haos-orange); margin-bottom: 10px; display: block;">
                                    CUTOFF
                                </label>
                                <input type="range" id="tb303-cutoff" min="200" max="4000" value="1200" 
                                    style="width: 100%; margin-bottom: 10px;"
                                    oninput="HAOS.updateTB303Param('cutoff', this.value)">
                                <div id="tb303-cutoff-value" style="text-align: center; color: var(--haos-text); font-size: 1.2rem;">
                                    1200 Hz
                                </div>
                            </div>
                            
                            <!-- Resonance -->
                            <div class="synth-control">
                                <label style="font-family: var(--font-mono); font-size: 0.8rem; color: var(--haos-orange); margin-bottom: 10px; display: block;">
                                    RESONANCE
                                </label>
                                <input type="range" id="tb303-resonance" min="0" max="30" value="15" step="0.5"
                                    style="width: 100%; margin-bottom: 10px;"
                                    oninput="HAOS.updateTB303Param('resonance', this.value)">
                                <div id="tb303-resonance-value" style="text-align: center; color: var(--haos-text); font-size: 1.2rem;">
                                    15
                                </div>
                            </div>
                            
                            <!-- Env Mod -->
                            <div class="synth-control">
                                <label style="font-family: var(--font-mono); font-size: 0.8rem; color: var(--haos-orange); margin-bottom: 10px; display: block;">
                                    ENV MOD
                                </label>
                                <input type="range" id="tb303-envmod" min="0" max="100" value="70"
                                    style="width: 100%; margin-bottom: 10px;"
                                    oninput="HAOS.updateTB303Param('envMod', this.value)">
                                <div id="tb303-envmod-value" style="text-align: center; color: var(--haos-text); font-size: 1.2rem;">
                                    70%
                                </div>
                            </div>
                            
                            <!-- Decay -->
                            <div class="synth-control">
                                <label style="font-family: var(--font-mono); font-size: 0.8rem; color: var(--haos-orange); margin-bottom: 10px; display: block;">
                                    DECAY
                                </label>
                                <input type="range" id="tb303-decay" min="0.05" max="2" value="0.3" step="0.05"
                                    style="width: 100%; margin-bottom: 10px;"
                                    oninput="HAOS.updateTB303Param('decay', this.value)">
                                <div id="tb303-decay-value" style="text-align: center; color: var(--haos-text); font-size: 1.2rem;">
                                    0.30s
                                </div>
                            </div>
                            
                            <!-- Distortion -->
                            <div class="synth-control">
                                <label style="font-family: var(--font-mono); font-size: 0.8rem; color: var(--haos-orange); margin-bottom: 10px; display: block;">
                                    DISTORTION
                                </label>
                                <input type="range" id="tb303-distortion" min="0" max="100" value="20"
                                    style="width: 100%; margin-bottom: 10px;"
                                    oninput="HAOS.updateTB303Param('distortion', this.value)">
                                <div id="tb303-distortion-value" style="text-align: center; color: var(--haos-text); font-size: 1.2rem;">
                                    20%
                                </div>
                            </div>
                            
                            <!-- Accent -->
                            <div class="synth-control">
                                <label style="font-family: var(--font-mono); font-size: 0.8rem; color: var(--haos-orange); margin-bottom: 10px; display: block;">
                                    ACCENT
                                </label>
                                <input type="range" id="tb303-accent" min="0" max="100" value="50"
                                    style="width: 100%; margin-bottom: 10px;"
                                    oninput="HAOS.updateTB303Param('accentLevel', this.value)">
                                <div id="tb303-accent-value" style="text-align: center; color: var(--haos-text); font-size: 1.2rem;">
                                    50%
                                </div>
                            </div>
                        </div>
                        
                        <!-- Waveform Selection -->
                        <div style="margin-bottom: 30px; text-align: center;">
                            <label style="font-family: var(--font-mono); font-size: 0.8rem; color: var(--haos-orange); display: block; margin-bottom: 15px;">
                                WAVEFORM
                            </label>
                            <div style="display: flex; gap: 15px; justify-content: center;">
                                <button onclick="HAOS.updateTB303Param('waveform', 'sawtooth')" 
                                    style="padding: 15px 30px; background: var(--haos-orange); border: none; border-radius: 8px; color: #000; font-family: var(--font-display); cursor: pointer;">
                                    SAW
                                </button>
                                <button onclick="HAOS.updateTB303Param('waveform', 'square')" 
                                    style="padding: 15px 30px; background: rgba(255, 107, 53, 0.3); border: 2px solid var(--haos-orange); border-radius: 8px; color: var(--haos-orange); font-family: var(--font-display); cursor: pointer;">
                                    SQUARE
                                </button>
                            </div>
                        </div>
                        
                        <!-- Preset Selection -->
                        <div style="margin-bottom: 30px; text-align: center;">
                            <label style="font-family: var(--font-mono); font-size: 0.8rem; color: var(--haos-orange); display: block; margin-bottom: 15px;">
                                PRESETS
                            </label>
                            <select id="tb303-preset" onchange="HAOS.loadTB303Preset(this.value)"
                                style="padding: 12px 20px; background: var(--haos-panel); border: 2px solid var(--haos-orange); border-radius: 8px; color: var(--haos-text); font-family: var(--font-mono); font-size: 0.9rem; min-width: 250px;">
                                <option value="">Select Preset...</option>
                                <option value="Classic Acid">üéõÔ∏è Classic Acid</option>
                                <option value="Deep Bass">üîä Deep Bass</option>
                                <option value="Squelchy">ÔøΩ Squelchy</option>
                                <option value="Hard Attack">‚ö° Hard Attack</option>
                                <option value="Minimal">üéµ Minimal</option>
                                <option value="Detroit">üè≠ Detroit</option>
                                <option value="Aggressive">üî• Aggressive</option>
                                <option value="Warm Sub">ÔøΩ Warm Sub</option>
                                <option value="Techno Stab">‚öôÔ∏è Techno Stab</option>
                                <option value="Bubbles">üí´ Bubbles</option>
                            </select>
                        </div>
                        
                        <!-- Play Test Note -->
                        <div style="text-align: center;">
                            <button onclick="HAOS.playTB303TestNote()" 
                                style="padding: 20px 50px; background: linear-gradient(135deg, var(--haos-green), #2EFF00); border: none; border-radius: 12px; color: #000; font-family: var(--font-display); font-size: 1.3rem; cursor: pointer; box-shadow: 0 5px 20px rgba(57, 255, 20, 0.3);">
                                ‚ñ∂ PLAY TEST
                            </button>
                        </div>
                    </div>
                `;
            },
            
            renderTR909Studio() {
                return `
                    <div style="padding: 30px; max-width: 1400px; margin: 0 auto;">
                        <h2 style="color: #00D9FF; margin-bottom: 10px; font-family: var(--font-display); font-size: 2.5em; text-align: center;">
                            ü•Å TR-909 DRUM MACHINE
                        </h2>
                        <p style="color: rgba(255,255,255,0.7); margin-bottom: 30px; text-align: center; font-size: 1.1em;">
                            Legendary Roland TR-909 ‚Ä¢ Industrial techno drum synthesis
                        </p>

                        <!-- DRUM PADS GRID -->
                        <div style="background: rgba(0,0,0,0.4); padding: 30px; border-radius: 12px; margin-bottom: 30px; border: 2px solid #00D9FF;">
                            <h3 style="color: #00D9FF; margin-bottom: 25px; font-family: var(--font-display); text-align: center; font-size: 1.8em;">
                                DRUM PADS
                            </h3>
                            
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; max-width: 800px; margin: 0 auto;">
                                
                                <!-- KICK -->
                                <button onclick="HAOS.playTR909Drum('kick')" 
                                        style="padding: 40px 20px; background: linear-gradient(135deg, rgba(255,107,53,0.2), rgba(255,107,53,0.1)); 
                                               border: 3px solid var(--orange-primary); border-radius: 16px; color: white; cursor: pointer; 
                                               transition: all 0.1s; display: flex; flex-direction: column; align-items: center; gap: 10px;
                                               font-family: var(--font-display); font-size: 1.2em;">
                                    <span style="font-size: 3em;">üí•</span>
                                    <span>KICK</span>
                                </button>

                                <!-- SNARE -->
                                <button onclick="HAOS.playTR909Drum('snare')" 
                                        style="padding: 40px 20px; background: linear-gradient(135deg, rgba(0,217,255,0.2), rgba(0,217,255,0.1)); 
                                               border: 3px solid #00D9FF; border-radius: 16px; color: white; cursor: pointer; 
                                               transition: all 0.1s; display: flex; flex-direction: column; align-items: center; gap: 10px;
                                               font-family: var(--font-display); font-size: 1.2em;">
                                    <span style="font-size: 3em;">ü•Å</span>
                                    <span>SNARE</span>
                                </button>

                                <!-- CLOSED HI-HAT -->
                                <button onclick="HAOS.playTR909Drum('hatClosed')" 
                                        style="padding: 40px 20px; background: linear-gradient(135deg, rgba(57,255,20,0.2), rgba(57,255,20,0.1)); 
                                               border: 3px solid #39FF14; border-radius: 16px; color: white; cursor: pointer; 
                                               transition: all 0.1s; display: flex; flex-direction: column; align-items: center; gap: 10px;
                                               font-family: var(--font-display); font-size: 1.2em;">
                                    <span style="font-size: 3em;">‚ú®</span>
                                    <span>HI-HAT (C)</span>
                                </button>

                                <!-- OPEN HI-HAT -->
                                <button onclick="HAOS.playTR909Drum('hatOpen')" 
                                        style="padding: 40px 20px; background: linear-gradient(135deg, rgba(57,255,20,0.25), rgba(57,255,20,0.15)); 
                                               border: 3px solid #39FF14; border-radius: 16px; color: white; cursor: pointer; 
                                               transition: all 0.1s; display: flex; flex-direction: column; align-items: center; gap: 10px;
                                               font-family: var(--font-display); font-size: 1.2em;">
                                    <span style="font-size: 3em;">üåä</span>
                                    <span>HI-HAT (O)</span>
                                </button>

                                <!-- CLAP -->
                                <button onclick="HAOS.playTR909Drum('clap')" 
                                        style="padding: 40px 20px; background: linear-gradient(135deg, rgba(255,0,110,0.2), rgba(255,0,110,0.1)); 
                                               border: 3px solid #FF006E; border-radius: 16px; color: white; cursor: pointer; 
                                               transition: all 0.1s; display: flex; flex-direction: column; align-items: center; gap: 10px;
                                               font-family: var(--font-display); font-size: 1.2em;">
                                    <span style="font-size: 3em;">üëè</span>
                                    <span>CLAP</span>
                                </button>

                                <!-- TOM -->
                                <button onclick="HAOS.playTR909Drum('tom')" 
                                        style="padding: 40px 20px; background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,215,0,0.1)); 
                                               border: 3px solid #FFD700; border-radius: 16px; color: white; cursor: pointer; 
                                               transition: all 0.1s; display: flex; flex-direction: column; align-items: center; gap: 10px;
                                               font-family: var(--font-display); font-size: 1.2em;">
                                    <span style="font-size: 3em;">üéØ</span>
                                    <span>TOM</span>
                                </button>

                                <!-- RIDE CYMBAL -->
                                <button onclick="HAOS.playTR909Drum('ride')" 
                                        style="padding: 40px 20px; background: linear-gradient(135deg, rgba(138,43,226,0.2), rgba(138,43,226,0.1)); 
                                               border: 3px solid #8A2BE2; border-radius: 16px; color: white; cursor: pointer; 
                                               transition: all 0.1s; display: flex; flex-direction: column; align-items: center; gap: 10px;
                                               font-family: var(--font-display); font-size: 1.2em;">
                                    <span style="font-size: 3em;">üîî</span>
                                    <span>RIDE</span>
                                </button>

                                <!-- CRASH CYMBAL -->
                                <button onclick="HAOS.playTR909Drum('crash')" 
                                        style="padding: 40px 20px; background: linear-gradient(135deg, rgba(255,69,0,0.2), rgba(255,69,0,0.1)); 
                                               border: 3px solid #FF4500; border-radius: 16px; color: white; cursor: pointer; 
                                               transition: all 0.1s; display: flex; flex-direction: column; align-items: center; gap: 10px;
                                               font-family: var(--font-display); font-size: 1.2em;">
                                    <span style="font-size: 3em;">üí•</span>
                                    <span>CRASH</span>
                                </button>

                                <!-- RIM SHOT -->
                                <button onclick="HAOS.playTR909Drum('rim')" 
                                        style="padding: 40px 20px; background: linear-gradient(135deg, rgba(255,255,255,0.15), rgba(255,255,255,0.05)); 
                                               border: 3px solid #CCC; border-radius: 16px; color: white; cursor: pointer; 
                                               transition: all 0.1s; display: flex; flex-direction: column; align-items: center; gap: 10px;
                                               font-family: var(--font-display); font-size: 1.2em;">
                                    <span style="font-size: 3em;">üéµ</span>
                                    <span>RIM</span>
                                </button>
                            </div>
                        </div>

                        <!-- PRESET PATTERNS -->
                        <div style="background: rgba(0,0,0,0.4); padding: 25px; border-radius: 12px; margin-bottom: 30px; border: 2px solid var(--orange-secondary);">
                            <h3 style="color: var(--orange-secondary); margin-bottom: 20px; font-family: var(--font-display); display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 1.5em;">üéπ</span>
                                CLASSIC 909 PATTERNS
                            </h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                <button class="preset-btn" onclick="HAOS.load909Pattern('fourFloor')" 
                                        style="padding: 20px; background: linear-gradient(135deg, rgba(255,107,53,0.2), rgba(255,107,53,0.1)); 
                                               border: 2px solid var(--orange-primary); border-radius: 12px; color: white; cursor: pointer; transition: all 0.3s;
                                               display: flex; flex-direction: column; align-items: center; gap: 8px;">
                                    <span style="font-size: 2em;">üî•</span>
                                    <span style="font-weight: bold; font-family: var(--font-display);">Four on Floor</span>
                                </button>
                                <button class="preset-btn" onclick="HAOS.load909Pattern('breakbeat')"
                                        style="padding: 20px; background: linear-gradient(135deg, rgba(0,217,255,0.2), rgba(0,217,255,0.1)); 
                                               border: 2px solid #00D9FF; border-radius: 12px; color: white; cursor: pointer; transition: all 0.3s;
                                               display: flex; flex-direction: column; align-items: center; gap: 8px;">
                                    <span style="font-size: 2em;">üí´</span>
                                    <span style="font-weight: bold; font-family: var(--font-display);">Breakbeat</span>
                                </button>
                                <button class="preset-btn" onclick="HAOS.load909Pattern('technoGroove')"
                                        style="padding: 20px; background: linear-gradient(135deg, rgba(57,255,20,0.2), rgba(57,255,20,0.1)); 
                                               border: 2px solid #39FF14; border-radius: 12px; color: white; cursor: pointer; transition: all 0.3s;
                                               display: flex; flex-direction: column; align-items: center; gap: 8px;">
                                    <span style="font-size: 2em;">‚ö°</span>
                                    <span style="font-weight: bold; font-family: var(--font-display);">Techno Groove</span>
                                </button>
                                <button class="preset-btn" onclick="HAOS.load909Pattern('industrial')"
                                        style="padding: 20px; background: linear-gradient(135deg, rgba(255,0,110,0.2), rgba(255,0,110,0.1)); 
                                               border: 2px solid #FF006E; border-radius: 12px; color: white; cursor: pointer; transition: all 0.3s;
                                               display: flex; flex-direction: column; align-items: center; gap: 8px;">
                                    <span style="font-size: 2em;">‚öôÔ∏è</span>
                                    <span style="font-weight: bold; font-family: var(--font-display);">Industrial</span>
                                </button>
                            </div>
                        </div>

                        <!-- Play Demo Button -->
                        <button onclick="HAOS.playTR909Demo()"
                                style="width: 100%; padding: 25px; background: linear-gradient(135deg, #00D9FF, #00AAFF); 
                                       border: none; border-radius: 15px; color: black; font-size: 1.5em; cursor: pointer; 
                                       font-weight: bold; font-family: var(--font-display); letter-spacing: 3px; text-transform: uppercase;
                                       box-shadow: 0 8px 20px rgba(0,217,255,0.4); transition: all 0.3s;">
                            üéµ PLAY DEMO PATTERN
                        </button>
                    </div>

                    <style>
                        button:active {
                            transform: scale(0.95);
                        }
                    </style>
                `;
            },
            
            renderTR808Studio() {
                const drums = ['808 KICK', 'CLAP', 'HI-HAT'];
                return this.renderDrumPads('TR-808 Engine', 'Iconic 808 drum synthesis for boom-bap', 
                                          drums, 'var(--haos-pink)', 'üéõÔ∏è');
            },
            
            renderSequencerStudio() {
                return `
                    <div style="padding: 30px; max-width: 1400px; margin: 0 auto;">
                        <h2 style="color: var(--orange-primary); margin-bottom: 10px; font-family: var(--font-display); font-size: 2.5em; text-align: center;">
                            ‚öôÔ∏è 16-STEP SEQUENCER
                        </h2>
                        <p style="color: rgba(255,255,255,0.7); margin-bottom: 30px; text-align: center; font-size: 1.1em;">
                            Pattern programming and automation for Techno OS
                        </p>

                        <!-- BPM CONTROL -->
                        <div style="background: rgba(0,0,0,0.4); padding: 25px; border-radius: 12px; margin-bottom: 30px; border: 2px solid var(--orange-primary);">
                            <div style="display: flex; align-items: center; justify-content: center; gap: 20px; flex-wrap: wrap;">
                                <div style="display: flex; align-items: center; gap: 15px;">
                                    <label style="color: rgba(255,255,255,0.8); font-family: var(--font-mono); font-size: 0.9em;">TEMPO:</label>
                                    <input type="range" id="seq-bpm" min="80" max="180" value="135" step="1"
                                           oninput="HAOS.updateSequencerBPM(this.value)"
                                           style="width: 200px; height: 8px; background: rgba(255,255,255,0.1); border-radius: 5px; cursor: pointer;">
                                    <div id="seq-bpm-value" style="color: var(--orange-primary); font-weight: bold; font-size: 1.5em; font-family: var(--font-display); min-width: 80px;">
                                        135 BPM
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 16-STEP GRID -->
                        <div style="background: rgba(0,0,0,0.4); padding: 30px; border-radius: 12px; margin-bottom: 30px; border: 2px solid var(--orange-secondary);">
                            <h3 style="color: var(--orange-secondary); margin-bottom: 20px; font-family: var(--font-display); text-align: center; font-size: 1.8em;">
                                PATTERN GRID
                            </h3>
                            
                            <!-- Track Labels -->
                            <div style="display: grid; grid-template-columns: 80px repeat(16, 1fr); gap: 8px; margin-bottom: 30px;">
                                <!-- Row: Kick -->
                                <div style="display: flex; align-items: center; justify-content: flex-start; color: var(--orange-primary); font-family: var(--font-mono); font-size: 0.85em; font-weight: bold;">
                                    KICK
                                </div>
                                ${this.renderSequencerSteps('kick', 16)}
                                
                                <!-- Row: Snare -->
                                <div style="display: flex; align-items: center; justify-content: flex-start; color: #00D9FF; font-family: var(--font-mono); font-size: 0.85em; font-weight: bold;">
                                    SNARE
                                </div>
                                ${this.renderSequencerSteps('snare', 16)}
                                
                                <!-- Row: Hi-Hat -->
                                <div style="display: flex; align-items: center; justify-content: flex-start; color: #39FF14; font-family: var(--font-mono); font-size: 0.85em; font-weight: bold;">
                                    HI-HAT
                                </div>
                                ${this.renderSequencerSteps('hihat', 16)}
                                
                                <!-- Row: Clap -->
                                <div style="display: flex; align-items: center; justify-content: flex-start; color: #FF006E; font-family: var(--font-mono); font-size: 0.85em; font-weight: bold;">
                                    CLAP
                                </div>
                                ${this.renderSequencerSteps('clap', 16)}
                            </div>

                            <!-- Step Numbers -->
                            <div style="display: grid; grid-template-columns: 80px repeat(16, 1fr); gap: 8px;">
                                <div></div>
                                ${Array.from({length: 16}, (_, i) => `
                                    <div style="text-align: center; color: rgba(255,255,255,0.3); font-family: var(--font-mono); font-size: 0.7em;">
                                        ${i + 1}
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <!-- CONTROL BUTTONS -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 30px;">
                            <button onclick="HAOS.playSequencer()"
                                    style="padding: 18px; background: linear-gradient(135deg, #39FF14, #2ECC00); 
                                           border: none; border-radius: 12px; color: black; font-size: 1.1em; cursor: pointer; 
                                           font-weight: bold; font-family: var(--font-display); letter-spacing: 2px; text-transform: uppercase;
                                           box-shadow: 0 4px 15px rgba(57,255,20,0.4); transition: all 0.3s;">
                                ‚ñ∂Ô∏è PLAY
                            </button>
                            
                            <button onclick="HAOS.stopSequencer()"
                                    style="padding: 18px; background: linear-gradient(135deg, #FF4444, #CC0000); 
                                           border: none; border-radius: 12px; color: white; font-size: 1.1em; cursor: pointer; 
                                           font-weight: bold; font-family: var(--font-display); letter-spacing: 2px; text-transform: uppercase;
                                           box-shadow: 0 4px 15px rgba(255,68,68,0.4); transition: all 0.3s;">
                                ‚èπÔ∏è STOP
                            </button>
                            
                            <button onclick="HAOS.randomizeSequencer()"
                                    style="padding: 18px; background: linear-gradient(135deg, #00D9FF, #00AACC); 
                                           border: none; border-radius: 12px; color: white; font-size: 1.1em; cursor: pointer; 
                                           font-weight: bold; font-family: var(--font-display); letter-spacing: 2px; text-transform: uppercase;
                                           box-shadow: 0 4px 15px rgba(0,217,255,0.4); transition: all 0.3s;">
                                üé≤ RANDOM
                            </button>
                            
                            <button onclick="HAOS.clearSequencer()"
                                    style="padding: 18px; background: linear-gradient(135deg, #666, #444); 
                                           border: none; border-radius: 12px; color: white; font-size: 1.1em; cursor: pointer; 
                                           font-weight: bold; font-family: var(--font-display); letter-spacing: 2px; text-transform: uppercase;
                                           box-shadow: 0 4px 15px rgba(100,100,100,0.4); transition: all 0.3s;">
                                üóëÔ∏è CLEAR
                            </button>
                        </div>

                        <!-- PATTERN MANAGEMENT -->
                        <div style="background: rgba(0,0,0,0.4); padding: 25px; border-radius: 12px; border: 2px solid #39FF14; margin-bottom: 30px;">
                            <h3 style="color: #39FF14; margin-bottom: 20px; font-family: var(--font-display); display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 1.5em;">üíæ</span>
                                PATTERN MANAGEMENT
                            </h3>
                            
                            <!-- Save/Load Pattern -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                                <div>
                                    <input type="text" id="pattern-name" placeholder="Pattern Name..." 
                                           style="width: 100%; padding: 12px; background: var(--haos-panel); border: 2px solid #39FF14; border-radius: 8px; color: var(--haos-text); font-family: var(--font-mono); margin-bottom: 10px;">
                                    <button onclick="HAOS.saveCurrentPattern()" 
                                            style="width: 100%; padding: 15px; background: linear-gradient(135deg, #39FF14, #2ECC00); border: none; border-radius: 8px; color: #000; font-weight: bold; cursor: pointer; font-family: var(--font-display);">
                                        üíæ SAVE PATTERN
                                    </button>
                                </div>
                                <div>
                                    <select id="saved-patterns" 
                                            style="width: 100%; padding: 12px; background: var(--haos-panel); border: 2px solid #39FF14; border-radius: 8px; color: var(--haos-text); font-family: var(--font-mono); margin-bottom: 10px;">
                                        <option value="">Select saved pattern...</option>
                                    </select>
                                    <button onclick="HAOS.loadSavedPattern()" 
                                            style="width: 100%; padding: 15px; background: linear-gradient(135deg, #00D9FF, #00AACC); border: none; border-radius: 8px; color: #fff; font-weight: bold; cursor: pointer; font-family: var(--font-display);">
                                        üìÇ LOAD PATTERN
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Export/Import/Share -->
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                                <button onclick="HAOS.exportPattern()" 
                                        style="padding: 15px; background: rgba(255, 107, 53, 0.2); border: 2px solid var(--haos-orange); border-radius: 8px; color: var(--haos-orange); font-weight: bold; cursor: pointer; font-family: var(--font-mono);">
                                    üì§ EXPORT JSON
                                </button>
                                <button onclick="document.getElementById('pattern-import').click()" 
                                        style="padding: 15px; background: rgba(0, 217, 255, 0.2); border: 2px solid #00D9FF; border-radius: 8px; color: #00D9FF; font-weight: bold; cursor: pointer; font-family: var(--font-mono);">
                                    üì• IMPORT JSON
                                </button>
                                <button onclick="HAOS.sharePattern()" 
                                        style="padding: 15px; background: rgba(255, 0, 110, 0.2); border: 2px solid #FF006E; border-radius: 8px; color: #FF006E; font-weight: bold; cursor: pointer; font-family: var(--font-mono);">
                                    üîó SHARE URL
                                </button>
                            </div>
                            <input type="file" id="pattern-import" accept=".json" style="display: none;" onchange="HAOS.importPattern(event)">
                        </div>

                        <!-- PRESET PATTERNS -->
                        <div style="background: rgba(0,0,0,0.4); padding: 25px; border-radius: 12px; border: 2px solid var(--orange-primary);">
                            <h3 style="color: var(--orange-primary); margin-bottom: 20px; font-family: var(--font-display); display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 1.5em;">üéπ</span>
                                PATTERN PRESETS
                            </h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                <button class="preset-btn" onclick="HAOS.loadSequencerPattern('fourFloor')" 
                                        style="padding: 20px; background: linear-gradient(135deg, rgba(255,107,53,0.2), rgba(255,107,53,0.1)); 
                                               border: 2px solid var(--orange-primary); border-radius: 12px; color: white; cursor: pointer; transition: all 0.3s;
                                               display: flex; flex-direction: column; align-items: center; gap: 8px;">
                                    <span style="font-size: 2em;">üî•</span>
                                    <span style="font-weight: bold; font-family: var(--font-display);">Four on Floor</span>
                                </button>
                                <button class="preset-btn" onclick="HAOS.loadSequencerPattern('technoBasic')"
                                        style="padding: 20px; background: linear-gradient(135deg, rgba(0,217,255,0.2), rgba(0,217,255,0.1)); 
                                               border: 2px solid #00D9FF; border-radius: 12px; color: white; cursor: pointer; transition: all 0.3s;
                                               display: flex; flex-direction: column; align-items: center; gap: 8px;">
                                    <span style="font-size: 2em;">‚ö°</span>
                                    <span style="font-weight: bold; font-family: var(--font-display);">Techno Basic</span>
                                </button>
                                <button class="preset-btn" onclick="HAOS.loadSequencerPattern('industrial')"
                                        style="padding: 20px; background: linear-gradient(135deg, rgba(57,255,20,0.2), rgba(57,255,20,0.1)); 
                                               border: 2px solid #39FF14; border-radius: 12px; color: white; cursor: pointer; transition: all 0.3s;
                                               display: flex; flex-direction: column; align-items: center; gap: 8px;">
                                    <span style="font-size: 2em;">‚öôÔ∏è</span>
                                    <span style="font-weight: bold; font-family: var(--font-display);">Industrial</span>
                                </button>
                                <button class="preset-btn" onclick="HAOS.loadSequencerPattern('minimal')"
                                        style="padding: 20px; background: linear-gradient(135deg, rgba(255,0,110,0.2), rgba(255,0,110,0.1)); 
                                               border: 2px solid #FF006E; border-radius: 12px; color: white; cursor: pointer; transition: all 0.3s;
                                               display: flex; flex-direction: column; align-items: center; gap: 8px;">
                                    <span style="font-size: 2em;">‚¨ú</span>
                                    <span style="font-weight: bold; font-family: var(--font-display);">Minimal</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <style>
                        .seq-step {
                            width: 100%;
                            aspect-ratio: 1;
                            border: 2px solid rgba(255,255,255,0.2);
                            border-radius: 6px;
                            background: rgba(0,0,0,0.3);
                            cursor: pointer;
                            transition: all 0.15s;
                        }
                        .seq-step:hover {
                            border-color: var(--orange-primary);
                            background: rgba(255,107,53,0.2);
                        }
                        .seq-step.active {
                            background: var(--orange-primary);
                            border-color: var(--orange-primary);
                            box-shadow: 0 0 15px rgba(255,107,53,0.6);
                        }
                        .seq-step.playing {
                            animation: stepPulse 0.2s ease;
                        }
                        @keyframes stepPulse {
                            0%, 100% { transform: scale(1); }
                            50% { transform: scale(1.15); }
                        }
                    </style>
                `;
            },
            
            renderSequencerSteps(track, count) {
                let steps = '';
                for (let i = 0; i < count; i++) {
                    steps += `
                        <button class="seq-step" id="seq-${track}-${i}" 
                                onclick="HAOS.toggleSequencerStep('${track}', ${i})"
                                data-track="${track}" data-step="${i}">
                        </button>
                    `;
                }
                return steps;
            },
            
            // ===== REUSABLE UI COMPONENTS =====
            renderControlGrid(controls) {
                const controlCards = controls.map(ctrl => `
                    <div class="control-card">
                        <div style="font-family: var(--font-mono); font-size: 0.8rem; color: ${ctrl.color}; margin-bottom: 10px;">
                            ${ctrl.label}
                        </div>
                        <div style="font-size: 2rem; color: var(--haos-text);">
                            ${ctrl.value}
                        </div>
                    </div>
                `).join('');
                
                return `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 30px;">
                        ${controlCards}
                    </div>
                `;
            },
            
            renderDrumPads(title, description, pads, color, emoji) {
                const padButtons = pads.map(pad => `
                    <button style="padding: 30px; background: ${color.replace(')', ', 0.1)')}; border: 2px solid ${color}; border-radius: 12px; color: ${color}; font-family: var(--font-display); font-size: 1.2rem; cursor: pointer;">
                        ${pad}
                    </button>
                `).join('');
                
                return `
                    <div style="text-align: center; padding: 20px;">
                        <h3 style="color: ${color}; font-size: 1.8rem; margin-bottom: 15px;">
                            ${title}
                        </h3>
                        <p style="color: var(--haos-dim); margin-bottom: 30px;">
                            ${description}
                        </p>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; max-width: 600px; margin: 30px auto;">
                            ${padButtons}
                        </div>
                        <p style="margin-top: 40px; font-family: var(--font-mono); color: ${color};">
                            ${emoji} Playing demo pattern...
                        </p>
                    </div>
                `;
            },
            
            // ===== DEMO PLAYBACK =====
            playPanelDemo(panelId) {
                if (!AudioEngine.initialized) return;
                
                const demoFunctions = {
                    'acid-lab': () => this.playTB303Demo(),
                    'drums-909': () => this.playTR909Demo(),
                    'drums-808': () => this.playTR808Demo(),
                    'sequencer': () => this.playSequencerDemo(),
                    'mpc-pads': () => this.playSequencerDemo(),
                    'sample-chopper': () => this.playSequencerDemo()
                };
                
                const demoFunction = demoFunctions[panelId];
                if (demoFunction) {
                    console.log('üéµ Playing demo for:', panelId);
                    demoFunction();
                } else {
                    console.warn('No demo available for:', panelId);
                }
            },
            
            playTB303Demo() {
                if (!AudioEngine.tb303) return;
                
                AudioEngine.loadPreset('tb303', 'Acid Squelch');
                const notes = [
                    { note: 'C2', active: true, accent: false, slide: false },
                    { note: 'D#2', active: true, accent: true, slide: true },
                    { note: 'G2', active: true, accent: false, slide: false }
                ];
                
                notes.forEach((step, i) => {
                    setTimeout(() => {
                        console.log('TB303 note:', step.note);
                        AudioEngine.tb303.playNote(step);
                    }, i * 250);
                });
            },
            
            playTR909Demo() {
                if (!AudioEngine.tr909) return;
                
                AudioEngine.loadPreset('tr909', 'Four on the Floor');
                const pattern = [
                    { time: 0, action: () => AudioEngine.tr909.playKick() },
                    { time: 125, action: () => AudioEngine.tr909.playHatClosed() },
                    { time: 250, action: () => AudioEngine.tr909.playSnare() },
                    { time: 375, action: () => AudioEngine.tr909.playHatClosed() }
                ];
                
                pattern.forEach(({ time, action }) => setTimeout(action, time));
            },
            
            playTR808Demo() {
                if (!AudioEngine.tr808) return;
                
                AudioEngine.loadPreset('tr808', 'Classic Trap');
                const pattern = [
                    { time: 0, action: () => AudioEngine.tr808.playKick() },
                    { time: 125, action: () => AudioEngine.tr808.playHat() },
                    { time: 250, action: () => AudioEngine.tr808.playClap() },
                    { time: 375, action: () => AudioEngine.tr808.playHat() }
                ];
                
                pattern.forEach(({ time, action }) => setTimeout(action, time));
            },
            
            playSequencerDemo() {
                for (let i = 0; i < 4; i++) {
                    setTimeout(() => AudioEngine.playNote(220 + i * 50, 0.1, 'square'), i * 150);
                }
            },
            
            // ===== TB-303 CONTROL FUNCTIONS =====
            updateTB303Param(param, value) {
                if (!AudioEngine.tb303) {
                    console.warn('TB303 not initialized');
                    return;
                }
                
                // Update the synth parameter
                AudioEngine.tb303.setParam(param, value);
                
                // Update the display value
                const displayValue = this.formatTB303Value(param, value);
                const displayElement = document.getElementById(`tb303-${param}-value`);
                if (displayElement) {
                    displayElement.textContent = displayValue;
                }
                
                console.log(`TB303 ${param} set to:`, displayValue);
            },
            
            formatTB303Value(param, value) {
                switch(param) {
                    case 'cutoff':
                        return Math.round(value) + ' Hz';
                    case 'decay':
                        return parseFloat(value).toFixed(2) + 's';
                    case 'envMod':
                    case 'accentLevel':
                    case 'distortion':
                        return Math.round(value) + '%';
                    case 'resonance':
                        return parseFloat(value).toFixed(1);
                    case 'waveform':
                        return value.toUpperCase();
                    default:
                        return value;
                }
            },
            
            loadTB303Preset(presetName) {
                if (!presetName) return;
                
                AudioEngine.loadPreset('tb303', presetName);
                this.showToast(`Loaded preset: ${presetName}`);
                
                // Update UI controls to match preset
                setTimeout(() => {
                    if (AudioEngine.tb303 && AudioEngine.tb303.params) {
                        const params = AudioEngine.tb303.params;
                        this.updateTB303UI(params);
                    }
                }, 100);
            },
            
            updateTB303UI(params) {
                const controls = ['cutoff', 'resonance', 'envMod', 'decay', 'distortion', 'accentLevel'];
                controls.forEach(param => {
                    const input = document.getElementById(`tb303-${param}`);
                    const display = document.getElementById(`tb303-${param}-value`);
                    
                    if (input && params[param] !== undefined) {
                        input.value = params[param];
                        if (display) {
                            display.textContent = this.formatTB303Value(param, params[param]);
                        }
                    }
                });
            },
            
            playTB303TestNote() {
                if (!AudioEngine.tb303) {
                    this.showToast('TB303 not initialized');
                    return;
                }
                
                // Play a test sequence
                const testPattern = [
                    { note: 'C2', active: true, accent: false, slide: false },
                    { note: 'D#2', active: true, accent: true, slide: true },
                    { note: 'F2', active: true, accent: false, slide: false },
                    { note: 'G2', active: true, accent: true, slide: false }
                ];
                
                testPattern.forEach((step, i) => {
                    setTimeout(() => {
                        AudioEngine.tb303.playNote(step);
                    }, i * 200);
                });
                
                this.showToast('üéµ Playing test sequence...');
            },
            
            // ===== TR-909 CONTROL FUNCTIONS =====
            playTR909Drum(drumType) {
                if (!AudioEngine.tr909) {
                    this.showToast('TR-909 not initialized');
                    return;
                }
                
                console.log('ü•Å Playing TR-909:', drumType);
                
                try {
                    switch(drumType) {
                        case 'kick':
                            AudioEngine.tr909.playKick();
                            break;
                        case 'snare':
                            AudioEngine.tr909.playSnare();
                            break;
                        case 'hatClosed':
                            AudioEngine.tr909.playHatClosed();
                            break;
                        case 'hatOpen':
                            AudioEngine.tr909.playHatOpen();
                            break;
                        case 'clap':
                            // TR-909 doesn't have separate clap, use snare with different variation
                            AudioEngine.tr909.playSnare('tight');
                            break;
                        case 'tom':
                            AudioEngine.tr909.playTom('mid');
                            break;
                        case 'ride':
                            AudioEngine.tr909.playRide();
                            break;
                        case 'crash':
                            AudioEngine.tr909.playCrash();
                            break;
                        case 'rim':
                            AudioEngine.tr909.playRimshot();
                            break;
                        default:
                            console.warn('Unknown drum type:', drumType);
                    }
                } catch (error) {
                    console.error('Error playing drum:', error);
                    this.showToast('Error playing drum sound');
                }
            },
            
            load909Pattern(patternName) {
                if (!AudioEngine.tr909) {
                    this.showToast('TR-909 not initialized');
                    return;
                }
                
                console.log('üéµ Loading 909 pattern:', patternName);
                
                // Define pattern sequences
                const patterns = {
                    fourFloor: [
                        { time: 0, drum: 'kick' },
                        { time: 125, drum: 'hatClosed' },
                        { time: 250, drum: 'snare' },
                        { time: 250, drum: 'hatClosed' },
                        { time: 375, drum: 'hatClosed' },
                        { time: 500, drum: 'kick' },
                        { time: 625, drum: 'hatClosed' },
                        { time: 750, drum: 'snare' },
                        { time: 750, drum: 'hatClosed' },
                        { time: 875, drum: 'hatClosed' }
                    ],
                    breakbeat: [
                        { time: 0, drum: 'kick' },
                        { time: 83, drum: 'hatClosed' },
                        { time: 167, drum: 'hatClosed' },
                        { time: 250, drum: 'snare' },
                        { time: 333, drum: 'kick' },
                        { time: 417, drum: 'hatClosed' },
                        { time: 500, drum: 'hatClosed' },
                        { time: 583, drum: 'clap' },
                        { time: 667, drum: 'hatClosed' },
                        { time: 750, drum: 'snare' }
                    ],
                    technoGroove: [
                        { time: 0, drum: 'kick' },
                        { time: 125, drum: 'hatClosed' },
                        { time: 250, drum: 'kick' },
                        { time: 250, drum: 'snare' },
                        { time: 375, drum: 'hatClosed' },
                        { time: 500, drum: 'kick' },
                        { time: 625, drum: 'hatOpen' },
                        { time: 750, drum: 'snare' },
                        { time: 875, drum: 'hatClosed' }
                    ],
                    industrial: [
                        { time: 0, drum: 'kick' },
                        { time: 83, drum: 'rim' },
                        { time: 167, drum: 'hatClosed' },
                        { time: 250, drum: 'snare' },
                        { time: 250, drum: 'clap' },
                        { time: 333, drum: 'hatClosed' },
                        { time: 500, drum: 'kick' },
                        { time: 583, drum: 'tom' },
                        { time: 667, drum: 'hatClosed' },
                        { time: 750, drum: 'snare' },
                        { time: 875, drum: 'crash' }
                    ]
                };
                
                const pattern = patterns[patternName];
                if (!pattern) {
                    console.warn('Pattern not found:', patternName);
                    return;
                }
                
                // Play the pattern
                pattern.forEach(({ time, drum }) => {
                    setTimeout(() => this.playTR909Drum(drum), time);
                });
                
                this.showToast(`Playing: ${patternName}`);
            },
            
            // ===== SEQUENCER CONTROL FUNCTIONS =====
            sequencerState: {
                bpm: 135,
                isPlaying: false,
                currentStep: 0,
                intervalId: null,
                pattern: {
                    kick: Array(16).fill(false),
                    snare: Array(16).fill(false),
                    hihat: Array(16).fill(false),
                    clap: Array(16).fill(false)
                }
            },
            
            updateSequencerBPM(value) {
                this.sequencerState.bpm = parseInt(value);
                const display = document.getElementById('seq-bpm-value');
                if (display) {
                    display.textContent = `${value} BPM`;
                }
                
                // If playing, restart with new BPM
                if (this.sequencerState.isPlaying) {
                    this.stopSequencer();
                    setTimeout(() => this.playSequencer(), 100);
                }
            },
            
            toggleSequencerStep(track, step) {
                // Toggle the step state
                this.sequencerState.pattern[track][step] = !this.sequencerState.pattern[track][step];
                
                // Update visual
                const button = document.getElementById(`seq-${track}-${step}`);
                if (button) {
                    if (this.sequencerState.pattern[track][step]) {
                        button.classList.add('active');
                    } else {
                        button.classList.remove('active');
                    }
                }
                
                console.log(`Step ${track}[${step}]:`, this.sequencerState.pattern[track][step]);
            },
            
            playSequencer() {
                if (this.sequencerState.isPlaying) return;
                
                if (!AudioEngine.tr909) {
                    this.showToast('TR-909 not initialized');
                    return;
                }
                
                this.sequencerState.isPlaying = true;
                this.sequencerState.currentStep = 0;
                
                const stepTime = (60 / this.sequencerState.bpm) * 250; // 16th notes
                
                this.sequencerState.intervalId = setInterval(() => {
                    this.playSequencerStep(this.sequencerState.currentStep);
                    this.sequencerState.currentStep = (this.sequencerState.currentStep + 1) % 16;
                }, stepTime);
                
                this.showToast('‚ñ∂Ô∏è Sequencer playing');
                console.log('üéµ Sequencer started at', this.sequencerState.bpm, 'BPM');
            },
            
            playSequencerStep(step) {
                // Play drums for this step
                if (this.sequencerState.pattern.kick[step]) {
                    this.playTR909Drum('kick');
                }
                if (this.sequencerState.pattern.snare[step]) {
                    this.playTR909Drum('snare');
                }
                if (this.sequencerState.pattern.hihat[step]) {
                    this.playTR909Drum('hatClosed');
                }
                if (this.sequencerState.pattern.clap[step]) {
                    this.playTR909Drum('clap');
                }
                
                // Visual feedback
                ['kick', 'snare', 'hihat', 'clap'].forEach(track => {
                    const button = document.getElementById(`seq-${track}-${step}`);
                    if (button) {
                        button.classList.add('playing');
                        setTimeout(() => button.classList.remove('playing'), 100);
                    }
                });
            },
            
            stopSequencer() {
                if (this.sequencerState.intervalId) {
                    clearInterval(this.sequencerState.intervalId);
                    this.sequencerState.intervalId = null;
                }
                this.sequencerState.isPlaying = false;
                this.sequencerState.currentStep = 0;
                
                this.showToast('‚èπÔ∏è Sequencer stopped');
                console.log('‚èπÔ∏è Sequencer stopped');
            },
            
            randomizeSequencer() {
                const tracks = ['kick', 'snare', 'hihat', 'clap'];
                tracks.forEach(track => {
                    for (let i = 0; i < 16; i++) {
                        const shouldActivate = Math.random() > 0.65; // 35% chance
                        this.sequencerState.pattern[track][i] = shouldActivate;
                        
                        const button = document.getElementById(`seq-${track}-${i}`);
                        if (button) {
                            if (shouldActivate) {
                                button.classList.add('active');
                            } else {
                                button.classList.remove('active');
                            }
                        }
                    }
                });
                
                this.showToast('üé≤ Pattern randomized');
            },
            
            clearSequencer() {
                const tracks = ['kick', 'snare', 'hihat', 'clap'];
                tracks.forEach(track => {
                    for (let i = 0; i < 16; i++) {
                        this.sequencerState.pattern[track][i] = false;
                        
                        const button = document.getElementById(`seq-${track}-${i}`);
                        if (button) {
                            button.classList.remove('active');
                        }
                    }
                });
                
                this.showToast('üóëÔ∏è Pattern cleared');
            },
            
            loadSequencerPattern(patternName) {
                // Clear current pattern
                this.clearSequencer();
                
                // Define preset patterns
                const patterns = {
                    fourFloor: {
                        kick: [1,0,0,0, 1,0,0,0, 1,0,0,0, 1,0,0,0],
                        snare: [0,0,0,0, 1,0,0,0, 0,0,0,0, 1,0,0,0],
                        hihat: [1,0,1,0, 1,0,1,0, 1,0,1,0, 1,0,1,0],
                        clap: [0,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,0]
                    },
                    technoBasic: {
                        kick: [1,0,0,0, 1,0,1,0, 1,0,0,0, 1,0,0,0],
                        snare: [0,0,0,0, 1,0,0,0, 0,0,0,0, 1,0,0,0],
                        hihat: [1,1,1,1, 1,1,1,1, 1,1,1,1, 1,1,1,1],
                        clap: [0,0,0,0, 1,0,0,0, 0,0,0,0, 1,0,0,0]
                    },
                    industrial: {
                        kick: [1,0,0,1, 0,0,1,0, 1,0,0,0, 1,0,1,0],
                        snare: [0,0,0,0, 1,0,0,1, 0,0,0,0, 1,0,0,0],
                        hihat: [1,1,1,1, 1,1,1,1, 1,1,1,1, 1,1,1,1],
                        clap: [0,0,1,0, 1,0,0,0, 0,0,1,0, 1,0,0,1]
                    },
                    minimal: {
                        kick: [1,0,0,0, 0,0,0,0, 1,0,0,0, 0,0,0,0],
                        snare: [0,0,0,0, 0,0,0,0, 1,0,0,0, 0,0,0,0],
                        hihat: [1,0,0,1, 0,0,1,0, 1,0,0,1, 0,0,1,0],
                        clap: [0,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,0]
                    }
                };
                
                const pattern = patterns[patternName];
                if (!pattern) {
                    console.warn('Pattern not found:', patternName);
                    return;
                }
                
                // Load the pattern
                Object.keys(pattern).forEach(track => {
                    pattern[track].forEach((active, i) => {
                        this.sequencerState.pattern[track][i] = active === 1;
                        
                        const button = document.getElementById(`seq-${track}-${i}`);
                        if (button) {
                            if (active === 1) {
                                button.classList.add('active');
                            } else {
                                button.classList.remove('active');
                            }
                        }
                    });
                });
                
                this.showToast(`Loaded: ${patternName}`);
            },
            
            // ===== PATTERN MANAGEMENT FUNCTIONS =====
            saveCurrentPattern() {
                const nameInput = document.getElementById('pattern-name');
                const name = nameInput.value.trim();
                
                if (!name) {
                    this.showToast('‚ùå Please enter a pattern name');
                    return;
                }
                
                if (!this.patternManager) {
                    this.patternManager = new HAOSPatternManager();
                }
                
                // Get current pattern from sequencer
                const pattern = this.sequencerState.pattern;
                
                // Get current TB-303 params if available
                const tb303Params = AudioEngine.tb303 ? AudioEngine.tb303.params : {};
                
                // Save to localStorage
                this.patternManager.savePattern(name, pattern, tb303Params);
                
                // Update saved patterns dropdown
                this.updateSavedPatternsDropdown();
                
                // Clear input
                nameInput.value = '';
                
                this.showToast(`üíæ Saved: ${name}`);
            },
            
            loadSavedPattern() {
                const select = document.getElementById('saved-patterns');
                const name = select.value;
                
                if (!name) {
                    this.showToast('‚ùå Please select a pattern');
                    return;
                }
                
                if (!this.patternManager) {
                    this.patternManager = new HAOSPatternManager();
                }
                
                const data = this.patternManager.loadPattern(name);
                
                if (!data) {
                    this.showToast('‚ùå Pattern not found');
                    return;
                }
                
                // Load the pattern into sequencer
                if (data.pattern) {
                    Object.keys(data.pattern).forEach(track => {
                        data.pattern[track].forEach((active, i) => {
                            this.sequencerState.pattern[track][i] = active;
                            
                            const button = document.getElementById(`seq-${track}-${i}`);
                            if (button) {
                                if (active) {
                                    button.classList.add('active');
                                } else {
                                    button.classList.remove('active');
                                }
                            }
                        });
                    });
                }
                
                // Load TB-303 params if available
                if (data.tb303 && AudioEngine.tb303) {
                    Object.assign(AudioEngine.tb303.params, data.tb303);
                    this.updateTB303UI();
                }
                
                this.showToast(`üìÇ Loaded: ${name}`);
            },
            
            updateSavedPatternsDropdown() {
                if (!this.patternManager) {
                    this.patternManager = new HAOSPatternManager();
                }
                
                const select = document.getElementById('saved-patterns');
                if (!select) return;
                
                const patterns = this.patternManager.loadAllPatterns();
                
                // Clear current options except first
                select.innerHTML = '<option value="">Select saved pattern...</option>';
                
                // Add saved patterns
                Object.keys(patterns).sort().forEach(name => {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name;
                    select.appendChild(option);
                });
            },
            
            exportPattern() {
                if (!this.patternManager) {
                    this.patternManager = new HAOSPatternManager();
                }
                
                const pattern = this.sequencerState.pattern;
                const tb303Params = AudioEngine.tb303 ? AudioEngine.tb303.params : {};
                
                const data = this.patternManager.exportPattern(pattern, tb303Params);
                
                // Create download link
                const json = JSON.stringify(data, null, 2);
                const blob = new Blob([json], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `haos-pattern-${Date.now()}.json`;
                a.click();
                
                URL.revokeObjectURL(url);
                
                this.showToast('üì§ Pattern exported');
            },
            
            importPattern(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const json = e.target.result;
                        const data = JSON.parse(json);
                        
                        if (!this.patternManager) {
                            this.patternManager = new HAOSPatternManager();
                        }
                        
                        const imported = this.patternManager.importPattern(data);
                        
                        // Load the pattern
                        if (imported.pattern) {
                            Object.keys(imported.pattern).forEach(track => {
                                imported.pattern[track].forEach((active, i) => {
                                    this.sequencerState.pattern[track][i] = active;
                                    
                                    const button = document.getElementById(`seq-${track}-${i}`);
                                    if (button) {
                                        if (active) {
                                            button.classList.add('active');
                                        } else {
                                            button.classList.remove('active');
                                        }
                                    }
                                });
                            });
                        }
                        
                        // Load TB-303 params
                        if (imported.tb303 && AudioEngine.tb303) {
                            Object.assign(AudioEngine.tb303.params, imported.tb303);
                            this.updateTB303UI();
                        }
                        
                        this.showToast('üì• Pattern imported');
                    } catch (error) {
                        console.error('Import error:', error);
                        this.showToast('‚ùå Invalid pattern file');
                    }
                };
                reader.readAsText(file);
                
                // Reset file input
                event.target.value = '';
            },
            
            sharePattern() {
                if (!this.patternManager) {
                    this.patternManager = new HAOSPatternManager();
                }
                
                const pattern = this.sequencerState.pattern;
                const tb303Params = AudioEngine.tb303 ? AudioEngine.tb303.params : {};
                
                const url = this.patternManager.patternToURL(pattern, tb303Params);
                
                // Copy to clipboard
                navigator.clipboard.writeText(url).then(() => {
                    this.showToast('üîó URL copied to clipboard!');
                }).catch(() => {
                    // Fallback: show URL in prompt
                    prompt('Share this URL:', url);
                });
            },
            
            loadTB303Preset(presetName) {
                if (!presetName) return;
                
                if (!this.tb303Presets) {
                    this.tb303Presets = new HAOSTB303Presets();
                }
                
                const preset = this.tb303Presets.applyPreset(AudioEngine.tb303, presetName);
                
                if (preset) {
                    this.updateTB303UI();
                    this.showToast(`üéõÔ∏è Loaded: ${presetName}`);
                }
            },
            
            updateTB303UI() {
                // Update all TB-303 sliders to match current params
                if (!AudioEngine.tb303) return;
                
                const params = AudioEngine.tb303.params;
                
                // Update cutoff
                const cutoffSlider = document.getElementById('tb303-cutoff');
                if (cutoffSlider) {
                    cutoffSlider.value = params.cutoff;
                    document.getElementById('tb303-cutoff-value').textContent = `${params.cutoff} Hz`;
                }
                
                // Update resonance
                const resSlider = document.getElementById('tb303-resonance');
                if (resSlider) {
                    resSlider.value = params.resonance;
                    document.getElementById('tb303-resonance-value').textContent = params.resonance.toFixed(1);
                }
                
                // Update envmod
                const envSlider = document.getElementById('tb303-envmod');
                if (envSlider) {
                    envSlider.value = params.envMod;
                    document.getElementById('tb303-envmod-value').textContent = `${params.envMod}%`;
                }
                
                // Update decay
                const decaySlider = document.getElementById('tb303-decay');
                if (decaySlider) {
                    decaySlider.value = params.decay;
                    document.getElementById('tb303-decay-value').textContent = `${params.decay.toFixed(2)}s`;
                }
                
                // Update distortion
                const distSlider = document.getElementById('tb303-distortion');
                if (distSlider) {
                    distSlider.value = params.distortion;
                    document.getElementById('tb303-distortion-value').textContent = `${params.distortion}%`;
                }
                
                // Update accent
                const accentSlider = document.getElementById('tb303-accent');
                if (accentSlider) {
                    accentSlider.value = params.accentLevel;
                    document.getElementById('tb303-accent-value').textContent = `${params.accentLevel}%`;
                }
            },
            
            randomizeSequencer() {
                if (this.sequencer) {
                    this.sequencer.randomizePattern();
                    
                    // Update UI
                    const pattern = this.sequencer.getPattern();
                    Object.keys(pattern).forEach(track => {
                        pattern[track].forEach((active, i) => {
                            this.sequencerState.pattern[track][i] = active;
                            
                            const button = document.getElementById(`seq-${track}-${i}`);
                            if (button) {
                                if (active) {
                                    button.classList.add('active');
                                } else {
                                    button.classList.remove('active');
                                }
                            }
                        });
                    });
                    
                    this.showToast('üé≤ Pattern randomized');
                } else {
                    // Fallback if sequencer object not available
                    const tracks = ['kick', 'snare', 'hihat', 'clap'];
                    tracks.forEach(track => {
                        for (let i = 0; i < 16; i++) {
                            const active = Math.random() > 0.7;
                            this.sequencerState.pattern[track][i] = active;
                            
                            const button = document.getElementById(`seq-${track}-${i}`);
                            if (button) {
                                if (active) {
                                    button.classList.add('active');
                                } else {
                                    button.classList.remove('active');
                                }
                            }
                        }
                    });
                    
                    this.showToast('üé≤ Pattern randomized');
                }
            },
            
            // ===== UTILITY FUNCTIONS =====
            getAvailablePanels() {
                if (!this.currentOS) return [];
                return Object.values(this.panels[this.currentOS])
                    .filter(p => p.available);
            },
            
            showToast(message) {
                // Simple toast notification
                const toast = document.createElement('div');
                toast.style.cssText = `
                    position: fixed;
                    bottom: 30px;
                    right: 30px;
                    padding: 15px 25px;
                    background: linear-gradient(135deg, var(--haos-orange), var(--haos-orange-bright));
                    color: #000;
                    border-radius: 8px;
                    font-family: 'Space Mono', monospace;
                    font-size: 0.85rem;
                    font-weight: bold;
                    box-shadow: 0 10px 30px rgba(255, 107, 53, 0.5);
                    z-index: 10000;
                    animation: slideIn 0.3s ease;
                `;
                toast.textContent = message;
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }
        };
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            HAOS.init();
        });
        
        // Add animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(400px); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(400px); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>

</body>
</html>
