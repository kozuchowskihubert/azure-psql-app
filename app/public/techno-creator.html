<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="description" content="Professional Techno Production Studio - Acid basslines, industrial percussion, minimal patterns">
    <meta name="theme-color" content="#0a0a0a">
    
    <!-- iOS Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Techno Creator">
    
    <title>‚ö° Techno Production Studio ‚ö°</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Industrial Techno Theme */
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --bg-tertiary: #2a2a2a;
            --accent-primary: #00ff00;
            --accent-secondary: #ff00ff;
            --accent-cyan: #00ffff;
            --text-primary: #00ff00;
            --text-secondary: #00cc00;
            --success: #00ff00;
            --warning: #ffff00;
            --border: #333;
            --glow: rgba(0, 255, 0, 0.5);
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Animated Scanline Effect */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 255, 0, 0.03) 0px,
                transparent 1px,
                transparent 2px,
                rgba(0, 255, 0, 0.03) 3px
            );
            animation: scanline 8s linear infinite;
            pointer-events: none;
            z-index: 1000;
        }

        @keyframes scanline {
            0% { transform: translateY(0); }
            100% { transform: translateY(100%); }
        }

        /* Header */
        .header {
            position: relative;
            z-index: 10;
            background: var(--bg-secondary);
            border-bottom: 2px solid var(--accent-primary);
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            color: var(--accent-primary);
            text-shadow: 
                0 0 10px var(--glow),
                0 0 20px var(--glow),
                0 0 30px var(--glow);
            margin-bottom: 10px;
            animation: flicker 3s ease-in-out infinite;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }

        @keyframes flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
            51% { opacity: 1; }
            52% { opacity: 0.85; }
            53% { opacity: 1; }
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.1em;
        }

        /* Main Container */
        .container {
            position: relative;
            z-index: 5;
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
        }

        /* Navigation */
        .nav-menu {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-menu a {
            color: var(--text-primary);
            text-decoration: none;
            padding: 12px 24px;
            background: var(--bg-tertiary);
            border: 1px solid var(--accent-primary);
            border-radius: 5px;
            transition: all 0.3s;
            font-weight: bold;
        }

        .nav-menu a:hover {
            background: var(--accent-primary);
            color: var(--bg-primary);
            box-shadow: 0 0 20px var(--glow);
        }

        /* Tool Sections */
        .tool-section {
            background: var(--bg-secondary);
            border: 2px solid var(--accent-primary);
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 
                0 0 20px rgba(0, 255, 0, 0.2),
                inset 0 0 20px rgba(0, 255, 0, 0.05);
        }

        .tool-section h2 {
            color: var(--accent-primary);
            margin-bottom: 15px;
            font-size: 1.8em;
            text-shadow: 0 0 10px var(--glow);
        }

        .tool-section h3 {
            color: var(--accent-cyan);
            margin: 20px 0 10px 0;
            font-size: 1.3em;
        }

        /* Form Controls */
        .control-group {
            margin: 15px 0;
        }

        .control-group label {
            display: block;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-weight: bold;
        }

        select, input[type="range"] {
            width: 100%;
            padding: 12px;
            background: var(--bg-primary);
            color: var(--text-primary);
            border: 1px solid var(--accent-primary);
            border-radius: 5px;
            font-family: 'Courier New', monospace;
        }

        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            background: var(--bg-tertiary);
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--accent-primary);
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 0 10px var(--glow);
        }

        /* Buttons */
        .btn {
            padding: 12px 30px;
            background: linear-gradient(135deg, var(--accent-primary), #00cc00);
            color: var(--bg-primary);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0, 255, 0, 0.3);
            font-family: 'Courier New', monospace;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--glow);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--bg-tertiary), var(--border));
            color: var(--text-primary);
            border: 1px solid var(--accent-primary);
        }

        .btn-magenta {
            background: linear-gradient(135deg, var(--accent-secondary), #cc00cc);
        }

        .btn-cyan {
            background: linear-gradient(135deg, var(--accent-cyan), #00cccc);
        }

        /* Output Box */
        .output-box {
            background: var(--bg-primary);
            border: 1px solid var(--accent-primary);
            border-radius: 5px;
            padding: 20px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            max-height: 400px;
            overflow-y: auto;
        }

        .output-box pre {
            color: var(--accent-primary);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* Sequencer Grid */
        .sequencer-grid {
            display: grid;
            gap: 5px;
            margin: 20px 0;
            background: var(--bg-primary);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--accent-primary);
        }

        .sequencer-row {
            display: grid;
            grid-template-columns: 100px repeat(16, 1fr);
            gap: 3px;
            align-items: center;
        }

        .instrument-label {
            color: var(--text-primary);
            font-weight: bold;
            padding: 10px;
            background: var(--bg-tertiary);
            border-radius: 5px;
            text-align: center;
            border: 1px solid var(--accent-primary);
        }

        .step {
            aspect-ratio: 1;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .step.active {
            background: var(--accent-primary);
            box-shadow: 0 0 10px var(--glow);
        }

        .step.playing {
            border: 2px solid var(--accent-cyan);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.8);
            animation: pulse 0.3s ease-in-out;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .step:hover {
            border-color: var(--accent-primary);
        }

        /* Chord Display */
        .chord-display {
            background: var(--bg-primary);
            border: 1px solid var(--accent-primary);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .chord-item {
            padding: 15px;
            margin: 10px 0;
            background: var(--bg-tertiary);
            border-left: 3px solid var(--accent-primary);
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chord-name {
            font-size: 1.5em;
            color: var(--accent-primary);
            font-weight: bold;
        }

        .chord-notes {
            color: var(--text-secondary);
            font-family: 'Courier New', monospace;
        }

        /* Waveform Canvas */
        canvas {
            width: 100%;
            height: 200px;
            background: var(--bg-primary);
            border: 1px solid var(--accent-primary);
            border-radius: 5px;
            margin-top: 15px;
        }

        /* Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animated {
            animation: slideIn 0.5s ease-out;
        }

        /* ============================================
           LIVE GUIDANCE SYSTEM (Techno Theme)
           ============================================ */
        
        .guidance-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            max-height: 500px;
            background: linear-gradient(135deg, rgba(10, 10, 10, 0.98), rgba(26, 26, 26, 0.98));
            border: 2px solid var(--accent-primary);
            border-radius: 5px;
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.5);
            z-index: 1000;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .guidance-panel.minimized {
            width: 60px;
            height: 60px;
        }

        .guidance-header {
            background: linear-gradient(135deg, var(--accent-primary), #00cc00);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            color: #000;
            font-weight: bold;
        }

        .guidance-header h3 {
            margin: 0;
            font-size: 1em;
            color: #000;
        }

        .guidance-content {
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .guidance-panel.minimized .guidance-content {
            display: none;
        }

        .guidance-tip {
            background: var(--bg-tertiary);
            border-left: 4px solid var(--accent-cyan);
            padding: 12px;
            margin-bottom: 12px;
            border-radius: 3px;
            animation: slideIn 0.3s ease-out;
        }

        .guidance-tip-title {
            font-weight: bold;
            color: var(--accent-primary);
            margin-bottom: 5px;
            font-size: 0.95em;
        }

        .guidance-tip-text {
            color: var(--text-secondary);
            font-size: 0.85em;
            line-height: 1.4;
        }

        .guidance-step {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(0, 255, 0, 0.1);
            border-radius: 3px;
            border: 1px solid var(--border);
        }

        .guidance-step-number {
            background: var(--accent-primary);
            color: #000;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
            margin-right: 12px;
        }

        .guidance-step-text {
            font-size: 0.9em;
            color: var(--text-primary);
        }

        /* Enhanced Tooltips */
        .info-tooltip {
            display: inline-block;
            width: 18px;
            height: 18px;
            background: var(--accent-cyan);
            color: var(--bg-primary);
            border-radius: 3px;
            text-align: center;
            line-height: 18px;
            font-size: 0.75em;
            font-weight: bold;
            cursor: help;
            margin-left: 5px;
            position: relative;
        }

        .info-tooltip:hover::after {
            content: attr(data-tip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-primary);
            color: var(--text-primary);
            padding: 10px 15px;
            border-radius: 3px;
            border: 2px solid var(--accent-cyan);
            width: max-content;
            max-width: 250px;
            font-size: 0.85rem;
            font-weight: normal;
            z-index: 1000;
            white-space: normal;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }

        .info-tooltip:hover::before {
            content: '';
            position: absolute;
            bottom: 110%;
            left: 50%;
            transform: translateX(-50%);
            border: 8px solid transparent;
            border-top-color: var(--accent-cyan);
        }

        /* Live Feedback Indicators */
        .live-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: var(--success);
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse-indicator 2s infinite;
        }

        @keyframes pulse-indicator {
            0%, 100% { opacity: 1; box-shadow: 0 0 5px var(--success); }
            50% { opacity: 0.5; box-shadow: 0 0 15px var(--success); }
        }

        .value-display {
            display: inline-block;
            background: rgba(0, 255, 0, 0.2);
            border: 1px solid var(--accent-primary);
            padding: 4px 12px;
            border-radius: 3px;
            font-weight: bold;
            color: var(--accent-cyan);
            margin-left: 10px;
            min-width: 60px;
            text-align: center;
        }

        .control-label-enhanced {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .control-description {
            font-size: 0.8em;
            color: var(--text-secondary);
            font-style: italic;
            margin-top: 4px;
        }

        /* Section Headers with Icons */
        .section-header-enhanced {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
        }

        .section-icon {
            font-size: 2.5em;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .section-info {
            flex: 1;
        }

        .section-title {
            font-size: 1.8em;
            color: var(--accent-primary);
            margin: 0;
        }

        .section-subtitle {
            color: var(--text-secondary);
            font-size: 0.95em;
            margin-top: 5px;
        }

        /* Quick Action Buttons */
        .quick-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 15px 0;
        }

        .quick-action-btn {
            flex: 1;
            min-width: 150px;
            padding: 12px 20px;
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 3px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }

        .quick-action-btn:hover {
            border-color: var(--accent-cyan);
            background: rgba(0, 255, 255, 0.1);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        }

        .quick-action-btn.active {
            border-color: var(--accent-primary);
            background: rgba(0, 255, 0, 0.2);
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
        }

        /* Mode Selector Tabs */
        .mode-selector {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            padding: 10px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            border: 1px solid var(--accent-primary);
            justify-content: center;
            flex-wrap: wrap;
        }

        .mode-tab {
            flex: 1;
            min-width: 120px;
            padding: 12px 20px;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 3px;
            color: var(--text-secondary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            font-family: 'Courier New', monospace;
        }

        .mode-tab:hover {
            border-color: var(--accent-cyan);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        }

        .mode-tab.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: var(--bg-primary);
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
        }

        .mode-tab .mode-icon {
            font-size: 1.5em;
            display: block;
            margin-bottom: 5px;
        }

        .mode-tab .mode-name {
            font-size: 0.95em;
            display: block;
        }

        .mode-tab .mode-desc {
            font-size: 0.75em;
            opacity: 0.7;
            display: block;
            margin-top: 3px;
        }

        /* Control Visibility by Mode */
        .control-group[data-mode="pro"],
        .control-group[data-mode="advanced"] {
            display: none;
        }

        .mode-basic .control-group[data-mode="basic"] {
            display: block;
        }

        .mode-pro .control-group[data-mode="basic"],
        .mode-pro .control-group[data-mode="pro"] {
            display: block;
        }

        .mode-advanced .control-group {
            display: block;
        }

        /* Mode Indicator Badge */
        .mode-badge {
            position: fixed;
            top: 80px;
            right: 20px;
            background: var(--accent-primary);
            color: var(--bg-primary);
            padding: 8px 16px;
            border-radius: 3px;
            font-size: 0.85em;
            font-weight: 600;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
            z-index: 999;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: 'Courier New', monospace;
        }

        .mode-badge .badge-icon {
            font-size: 1.2em;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .sequencer-row {
                grid-template-columns: 80px repeat(16, 1fr);
            }

            .tool-section {
                padding: 20px;
            }
            
            .guidance-panel {
                width: 90%;
                right: 5%;
            }
        }
    </style>
</head>
<body>
    <!-- Mode Indicator Badge -->
    <div class="mode-badge" id="modeBadge">
        <span class="badge-icon">üéöÔ∏è</span>
        <span id="modeText">BASIC MODE</span>
    </div>

    <div class="header">
        <div style="display: flex; justify-content: space-between; align-items: center; max-width: 1400px; margin: 0 auto;">
            <div>
                <h1>‚ö° TECHNO PRODUCTION STUDIO ‚ö°</h1>
                <p>[ HARD ‚Ä¢ ACID ‚Ä¢ MINIMAL ‚Ä¢ INDUSTRIAL ‚Ä¢ DETROIT ‚Ä¢ DUB ]</p>
            </div>
            <button id="theme-toggle" style="color: var(--text-primary); padding: 12px 18px; background: var(--bg-tertiary); border: 1px solid var(--accent-primary); border-radius: 8px; cursor: pointer; transition: all 0.3s; font-size: 1.2em;" aria-label="Toggle theme">
                <i class="fas fa-moon"></i>
            </button>
        </div>
    </div>

    <!-- Live Guidance Panel -->
    <div class="guidance-panel" id="guidancePanel">
        <div class="guidance-header" onclick="toggleGuidance()">
            <h3>‚ö° TECHNO GUIDE</h3>
            <span id="guidanceToggle">‚àí</span>
        </div>
        <div class="guidance-content" id="guidanceContent">
            <div class="guidance-tip">
                <div class="guidance-tip-title">üéØ TECHNO WORKFLOW</div>
                <div class="guidance-tip-text">Build hypnotic sequences and driving rhythms</div>
            </div>
            
            <div class="guidance-step">
                <div class="guidance-step-number">1</div>
                <div class="guidance-step-text">Choose a <strong>techno style</strong> (Acid, Minimal, Industrial)</div>
            </div>
            
            <div class="guidance-step">
                <div class="guidance-step-number">2</div>
                <div class="guidance-step-text">Generate a <strong>bassline</strong> or melodic sequence</div>
            </div>
            
            <div class="guidance-step">
                <div class="guidance-step-number">3</div>
                <div class="guidance-step-text">Add <strong>drum patterns</strong> - kick on every beat</div>
            </div>
            
            <div class="guidance-step">
                <div class="guidance-step-number">4</div>
                <div class="guidance-step-text">Set <strong>BPM</strong> (120-140 for techno)</div>
            </div>
            
            <div class="guidance-step">
                <div class="guidance-step-number">5</div>
                <div class="guidance-step-text">Tweak <strong>synthesis</strong> for movement and texture</div>
            </div>
            
            <div class="guidance-step">
                <div class="guidance-step-number">6</div>
                <div class="guidance-step-text">Click <strong>"Play Loop"</strong> to hear the groove</div>
            </div>
            
            <div class="guidance-step">
                <div class="guidance-step-number">7</div>
                <div class="guidance-step-text">Use <strong>"Send to Radio"</strong> to broadcast your techno!</div>
            </div>
            
            <div class="guidance-tip" style="background: rgba(0, 255, 255, 0.1); border-left-color: var(--accent-cyan);">
                <div class="guidance-tip-title">‚ö° TECHNO TIPS</div>
                <div class="guidance-tip-text">
                    ‚Ä¢ 4/4 kick pattern = foundation<br>
                    ‚Ä¢ Acid = TB-303 style squelch<br>
                    ‚Ä¢ Minimal = less is more<br>
                    ‚Ä¢ Industrial = harsh textures<br>
                    ‚Ä¢ Filter automation = movement
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Mode Selector -->
        <div class="mode-selector" id="modeSelector">
            <div class="mode-tab active" data-mode="basic" onclick="switchMode('basic')">
                <span class="mode-icon">üéØ</span>
                <span class="mode-name">BASIC</span>
                <span class="mode-desc">Essential controls</span>
            </div>
            <div class="mode-tab" data-mode="pro" onclick="switchMode('pro')">
                <span class="mode-icon">üéõÔ∏è</span>
                <span class="mode-name">PRO</span>
                <span class="mode-desc">Production tools</span>
            </div>
            <div class="mode-tab" data-mode="advanced" onclick="switchMode('advanced')">
                <span class="mode-icon">‚ö°</span>
                <span class="mode-name">ADVANCED</span>
                <span class="mode-desc">Full control</span>
            </div>
        </div>

        <!-- Navigation -->
        <div class="nav-menu">
            <a href="/">üè† Home</a>
            <a href="/trap-studio.html">üî• Trap Studio</a>
            <a href="/techno-creator.html" style="background: var(--accent-primary); color: var(--bg-primary);">‚ö° Techno Creator</a>
            <a href="/radio.html" style="background: linear-gradient(135deg, #ff00ff, #00ff00); color: #000; font-weight: bold;">üìª Radio 24/7</a>
        </div>

        <!-- Techno Chord/Sequence Generator -->
        <div class="tool-section animated">
            <h2>üéπ TECHNO SEQUENCE GENERATOR</h2>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                Generate hypnotic sequences and minimal progressions for various techno subgenres
            </p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                <!-- Key Selection -->
                <div class="control-group">
                    <label for="technoKey">Root Note:</label>
                    <select id="technoKey">
                        <option value="C">C</option>
                        <option value="C#">C# / Db</option>
                        <option value="D">D</option>
                        <option value="D#">D# / Eb</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="F#">F# / Gb</option>
                        <option value="G">G</option>
                        <option value="G#">G# / Ab</option>
                        <option value="A" selected>A</option>
                        <option value="A#">A# / Bb</option>
                        <option value="B">B</option>
                    </select>
                </div>

                <!-- Scale Type -->
                <div class="control-group">
                    <label for="technoScale">Scale/Mode:</label>
                    <select id="technoScale">
                        <option value="minor" selected>Natural Minor (Aeolian)</option>
                        <option value="phrygian">Phrygian (Dark)</option>
                        <option value="dorian">Dorian (Groovy)</option>
                        <option value="minor_penta">Minor Pentatonic</option>
                        <option value="harmonic">Harmonic Minor</option>
                    </select>
                </div>

                <!-- Subgenre -->
                <div class="control-group">
                    <label for="technoSubgenre">Techno Subgenre:</label>
                    <select id="technoSubgenre">
                        <option value="hard_techno">Hard Techno (Fast, Aggressive)</option>
                        <option value="acid_techno" selected>Acid Techno (303 Style)</option>
                        <option value="minimal">Minimal Techno (Hypnotic)</option>
                        <option value="industrial">Industrial Techno (Dark)</option>
                        <option value="detroit">Detroit Techno (Classic)</option>
                        <option value="dub_techno">Dub Techno (Deep)</option>
                    </select>
                </div>
            </div>

            <!-- Generate Buttons -->
            <div style="margin: 20px 0; display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
                <button class="btn" onclick="generateTechnoSequence()">
                    ‚ö° Generate Sequence
                </button>
                <button class="btn btn-secondary" onclick="playTechnoSequence()">
                    ‚ñ∂Ô∏è Play Preview
                </button>
                <button class="btn btn-cyan" onclick="randomizeTechnoSequence()">
                    üé≤ Randomize
                </button>
            </div>

            <!-- Instrument Selection -->
            <div style="margin: 15px 0; padding: 15px; background: var(--bg-tertiary); border-radius: 10px; border: 1px solid var(--accent-primary);">
                <p style="color: var(--text-secondary); margin-bottom: 10px; font-size: 0.9em;">
                    üéõÔ∏è SELECT SYNTHESIS ENGINE:
                </p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                    <button class="btn btn-secondary" onclick="setTechnoInstrument('enhanced')" id="inst-enhanced_techno" style="padding: 8px 12px; font-size: 0.85em; background: linear-gradient(135deg, var(--accent-primary), var(--accent-cyan)); color: #000; font-weight: bold; border: 2px solid var(--accent-cyan);">
                        ‚ö° ENHANCED
                    </button>
                    <button class="btn btn-secondary" onclick="setTechnoInstrument('acid_bass')" id="inst-acid_bass" style="padding: 8px 12px; font-size: 0.85em; border: 2px solid var(--accent-primary);">
                        üîä Acid Bass (303)
                    </button>
                    <button class="btn btn-secondary" onclick="setTechnoInstrument('minimal_stab')" id="inst-minimal_stab" style="padding: 8px 12px; font-size: 0.85em;">
                        üéπ Minimal Stab
                    </button>
                    <button class="btn btn-secondary" onclick="setTechnoInstrument('dub_chord')" id="inst-dub_chord" style="padding: 8px 12px; font-size: 0.85em;">
                        üåä Dub Chord
                    </button>
                    <button class="btn btn-secondary" onclick="setTechnoInstrument('industrial_drone')" id="inst-industrial_drone" style="padding: 8px 12px; font-size: 0.85em;">
                        ‚öôÔ∏è Industrial Drone
                    </button>
                    <button class="btn btn-secondary" onclick="setTechnoInstrument('detroit_pad')" id="inst-detroit_pad" style="padding: 8px 12px; font-size: 0.85em;">
                        üèôÔ∏è Detroit Pad
                    </button>
                    <button class="btn btn-secondary" onclick="setTechnoInstrument('perc_synth')" id="inst-perc_synth" style="padding: 8px 12px; font-size: 0.85em;">
                        ü•Å Perc Synth
                    </button>
                </div>
            </div>

            <!-- Advanced Controls -->
            <div style="margin: 15px 0; padding: 15px; background: var(--bg-tertiary); border-radius: 10px; border: 1px solid var(--accent-primary);">
                <p style="color: var(--text-secondary); margin-bottom: 10px; font-size: 0.9em;">
                    ‚öôÔ∏è MODULATION & EFFECTS:
                </p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <!-- Acid Parameters -->
                    <div>
                        <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                            üéõÔ∏è Filter Resonance: <span id="resonanceValue">70</span>%
                        </label>
                        <input type="range" id="resonanceControl" min="0" max="100" value="70" 
                               oninput="document.getElementById('resonanceValue').textContent = this.value"
                               style="width: 100%;">
                    </div>

                    <!-- Filter Cutoff -->
                    <div>
                        <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                            üîß Filter Cutoff: <span id="cutoffValue">500</span> Hz
                        </label>
                        <input type="range" id="cutoffControl" min="100" max="5000" value="500" 
                               oninput="document.getElementById('cutoffValue').textContent = this.value"
                               style="width: 100%;">
                    </div>

                    <!-- Glide/Portamento -->
                    <div>
                        <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                            üéµ Glide Time: <span id="glideValue">50</span> ms
                        </label>
                        <input type="range" id="glideControl" min="0" max="200" value="50" 
                               oninput="document.getElementById('glideValue').textContent = this.value"
                               style="width: 100%;">
                    </div>

                    <!-- Distortion -->
                    <div>
                        <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                            üî• Distortion: <span id="distortionValue">30</span>%
                        </label>
                        <input type="range" id="distortionControl" min="0" max="100" value="30" 
                               oninput="document.getElementById('distortionValue').textContent = this.value"
                               style="width: 100%;">
                    </div>
                </div>

                <!-- Effect Toggles -->
                <div style="margin-top: 15px; display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                    <label style="display: flex; align-items: center; color: var(--text-secondary); font-size: 0.85em; cursor: pointer;">
                        <input type="checkbox" id="delayToggle" checked style="margin-right: 8px;">
                        ‚è±Ô∏è Delay
                    </label>
                    <label style="display: flex; align-items: center; color: var(--text-secondary); font-size: 0.85em; cursor: pointer;">
                        <input type="checkbox" id="reverbToggle" checked style="margin-right: 8px;">
                        üåä Reverb
                    </label>
                    <label style="display: flex; align-items: center; color: var(--text-secondary); font-size: 0.85em; cursor: pointer;">
                        <input type="checkbox" id="lfoToggle" checked style="margin-right: 8px;">
                        „Ä∞Ô∏è LFO Modulation
                    </label>
                </div>
            </div>

            <!-- Advanced Synthesis Engine -->
            <div style="margin: 15px 0; padding: 20px; background: linear-gradient(135deg, rgba(0, 255, 0, 0.1), rgba(255, 0, 255, 0.1)); border: 2px solid var(--accent-primary); border-radius: 10px;">
                <h3 style="color: var(--accent-cyan); margin-bottom: 15px; font-size: 1.1em; text-align: center;">
                    ‚ö° ADVANCED SYNTHESIS ENGINE ‚ö°
                </h3>
                
                <!-- Oscillator Section -->
                <div style="margin-bottom: 15px; padding: 15px; background: rgba(0,0,0,0.5); border-radius: 8px; border: 1px solid var(--border);">
                    <p style="color: var(--accent-primary); margin-bottom: 10px; font-size: 0.95em; font-weight: bold;">
                        >>> OSCILLATOR <<<
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px;">
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Waveform:
                            </label>
                            <select id="technoWaveform" class="form-control" style="width: 100%; padding: 6px; background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--accent-primary); border-radius: 5px; font-family: 'Courier New', monospace;">
                                <option value="sine">SINE</option>
                                <option value="triangle">TRIANGLE</option>
                                <option value="sawtooth" selected>SAWTOOTH</option>
                                <option value="square">SQUARE</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Unison: <span id="technoUnisonValue">3</span>
                            </label>
                            <input type="range" id="technoUnison" min="1" max="7" value="3" step="2"
                                   oninput="document.getElementById('technoUnisonValue').textContent = this.value"
                                   style="width: 100%;">
                        </div>
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Detune: <span id="technoDetuneValue">10</span> cents
                            </label>
                            <input type="range" id="technoDetune" min="0" max="50" value="10"
                                   oninput="document.getElementById('technoDetuneValue').textContent = this.value"
                                   style="width: 100%;">
                        </div>
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Harmonics: <span id="technoHarmonicsValue">3</span>
                            </label>
                            <input type="range" id="technoHarmonics" min="0" max="5" value="3"
                                   oninput="document.getElementById('technoHarmonicsValue').textContent = this.value"
                                   style="width: 100%;">
                        </div>
                    </div>
                </div>

                <!-- Filter Section -->
                <div style="margin-bottom: 15px; padding: 15px; background: rgba(0,0,0,0.5); border-radius: 8px; border: 1px solid var(--border);">
                    <p style="color: var(--accent-primary); margin-bottom: 10px; font-size: 0.95em; font-weight: bold;">
                        >>> FILTER <<<
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px;">
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Type:
                            </label>
                            <select id="technoFilterType" class="form-control" style="width: 100%; padding: 6px; background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--accent-primary); border-radius: 5px; font-family: 'Courier New', monospace;">
                                <option value="lowpass" selected>LOW-PASS</option>
                                <option value="highpass">HIGH-PASS</option>
                                <option value="bandpass">BAND-PASS</option>
                                <option value="notch">NOTCH</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Filter Env: <span id="technoFilterEnvValue">80</span>%
                            </label>
                            <input type="range" id="technoFilterEnv" min="0" max="100" value="80"
                                   oninput="document.getElementById('technoFilterEnvValue').textContent = this.value"
                                   style="width: 100%;">
                        </div>
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Velocity: <span id="technoVelocityValue">90</span>%
                            </label>
                            <input type="range" id="technoVelocity" min="30" max="100" value="90"
                                   oninput="document.getElementById('technoVelocityValue').textContent = this.value"
                                   style="width: 100%;">
                        </div>
                    </div>
                </div>

                <!-- Envelope Section -->
                <div style="margin-bottom: 15px; padding: 15px; background: rgba(0,0,0,0.5); border-radius: 8px; border: 1px solid var(--border);">
                    <p style="color: var(--accent-primary); margin-bottom: 10px; font-size: 0.95em; font-weight: bold;">
                        >>> ENVELOPE (ADSR) <<<
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px;">
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Attack: <span id="technoAttackValue">0.01</span>s
                            </label>
                            <input type="range" id="technoAttack" min="0.001" max="1" value="0.01" step="0.001"
                                   oninput="document.getElementById('technoAttackValue').textContent = parseFloat(this.value).toFixed(3)"
                                   style="width: 100%;">
                        </div>
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Decay: <span id="technoDecayValue">0.2</span>s
                            </label>
                            <input type="range" id="technoDecay" min="0.01" max="2" value="0.2" step="0.01"
                                   oninput="document.getElementById('technoDecayValue').textContent = parseFloat(this.value).toFixed(2)"
                                   style="width: 100%;">
                        </div>
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Sustain: <span id="technoSustainValue">50</span>%
                            </label>
                            <input type="range" id="technoSustain" min="0" max="100" value="50"
                                   oninput="document.getElementById('technoSustainValue').textContent = this.value"
                                   style="width: 100%;">
                        </div>
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Release: <span id="technoReleaseValue">0.3</span>s
                            </label>
                            <input type="range" id="technoRelease" min="0.01" max="3" value="0.3" step="0.01"
                                   oninput="document.getElementById('technoReleaseValue').textContent = parseFloat(this.value).toFixed(2)"
                                   style="width: 100%;">
                        </div>
                    </div>
                </div>

                <!-- LFO Configuration -->
                <div style="margin-bottom: 15px; padding: 15px; background: rgba(0,0,0,0.5); border-radius: 8px; border: 1px solid var(--border);">
                    <p style="color: var(--accent-primary); margin-bottom: 10px; font-size: 0.95em; font-weight: bold;">
                        >>> LFO MODULATION <<<
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px;">
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                LFO Rate: <span id="technoLFORateValue">6</span> Hz
                            </label>
                            <input type="range" id="technoLFORate" min="0.1" max="20" value="6" step="0.1"
                                   oninput="document.getElementById('technoLFORateValue').textContent = parseFloat(this.value).toFixed(1)"
                                   style="width: 100%;">
                        </div>
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                LFO Depth: <span id="technoLFODepthValue">40</span>%
                            </label>
                            <input type="range" id="technoLFODepth" min="0" max="100" value="40"
                                   oninput="document.getElementById('technoLFODepthValue').textContent = this.value"
                                   style="width: 100%;">
                        </div>
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Target:
                            </label>
                            <select id="technoLFOTarget" class="form-control" style="width: 100%; padding: 6px; background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--accent-primary); border-radius: 5px; font-family: 'Courier New', monospace;">
                                <option value="pitch">PITCH</option>
                                <option value="filter" selected>FILTER</option>
                                <option value="volume">VOLUME</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Automation -->
                <div style="padding: 15px; background: rgba(0,0,0,0.5); border-radius: 8px; border: 1px solid var(--border);">
                    <p style="color: var(--accent-primary); margin-bottom: 10px; font-size: 0.95em; font-weight: bold;">
                        >>> AUTOMATION <<<
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px;">
                        <label style="display: flex; align-items: center; color: var(--text-secondary); font-size: 0.85em; cursor: pointer;">
                            <input type="checkbox" id="technoAutoFilter" style="margin-right: 8px;">
                            FILTER SWEEP
                        </label>
                        <label style="display: flex; align-items: center; color: var(--text-secondary); font-size: 0.85em; cursor: pointer;">
                            <input type="checkbox" id="technoAutoVolume" style="margin-right: 8px;">
                            VOLUME FADE
                        </label>
                        <label style="display: flex; align-items: center; color: var(--text-secondary); font-size: 0.85em; cursor: pointer;">
                            <input type="checkbox" id="technoAutoPan" style="margin-right: 8px;">
                            AUTO-PAN
                        </label>
                        <label style="display: flex; align-items: center; color: var(--text-secondary); font-size: 0.85em; cursor: pointer;">
                            <input type="checkbox" id="technoPulseWidth" style="margin-right: 8px;">
                            PULSE WIDTH MOD
                        </label>
                    </div>
                </div>
            </div>

            <!-- Sequence Display -->
            <div id="technoDisplay" class="chord-display">
                <p style="text-align: center; color: var(--text-secondary);">
                    >>> READY TO GENERATE TECHNO SEQUENCE <<<
                </p>
            </div>

            <div id="technoOutput" class="output-box" style="display: none;">
                <pre id="technoCode"></pre>
            </div>
        </div>

        <!-- Techno Beat Sequencer -->
        <div class="tool-section animated">
            <h2>ü•Å TECHNO DRUM MACHINE</h2>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                Create hard-hitting techno drum patterns (16-step sequencer)
            </p>

            <div class="control-group">
                <label for="technoBpmControl">BPM: <span class="bpm-display" id="technoBpmValue">135</span></label>
                <input type="range" id="technoBpmControl" min="120" max="160" value="135" 
                       oninput="updateTechnoBPM(this.value)">
            </div>

            <h3>üéõÔ∏è PATTERN GRID (16 STEPS)</h3>
            
            <!-- Sound Preview Buttons -->
            <div style="margin: 15px 0; padding: 15px; background: var(--bg-tertiary); border-radius: 10px; border: 1px solid var(--accent-primary);">
                <p style="color: var(--text-secondary); margin-bottom: 10px; font-size: 0.9em;">
                    üéß PREVIEW SOUNDS:
                </p>
                <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
                    <button class="btn btn-secondary" onclick="initAudio(); playTechnoKick(audioContext, audioContext.currentTime)" style="padding: 8px 16px; font-size: 0.9em;">
                        ü¶∂ Techno Kick
                    </button>
                    <button class="btn btn-secondary" onclick="initAudio(); playTechnoHat(audioContext, audioContext.currentTime)" style="padding: 8px 16px; font-size: 0.9em;">
                        üé© Hi-Hat
                    </button>
                    <button class="btn btn-secondary" onclick="initAudio(); playTechnoClap(audioContext, audioContext.currentTime)" style="padding: 8px 16px; font-size: 0.9em;">
                        üëè Clap
                    </button>
                    <button class="btn btn-secondary" onclick="initAudio(); playTechnoPerc(audioContext, audioContext.currentTime)" style="padding: 8px 16px; font-size: 0.9em;">
                        üîî Perc
                    </button>
                </div>
            </div>

            <!-- Kick Pattern Variations (Pro Mode) -->
            <div class="control-group" data-mode="pro" style="margin: 20px 0; padding: 15px; background: var(--bg-tertiary); border-radius: 3px; border: 1px solid var(--accent-cyan);">
                <label style="display: block; margin-bottom: 10px; color: var(--accent-cyan);">
                    ü¶∂ KICK PATTERN VARIATIONS:
                </label>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px;">
                    <button class="btn btn-secondary" onclick="loadTechnoKickPattern('four-floor')" style="padding: 8px 12px; font-size: 0.85em;">
                        üéµ Four Floor
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoKickPattern('hard')" style="padding: 8px 12px; font-size: 0.85em;">
                        üí™ Hard Techno
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoKickPattern('offbeat')" style="padding: 8px 12px; font-size: 0.85em;">
                        ‚ö° Offbeat
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoKickPattern('double')" style="padding: 8px 12px; font-size: 0.85em;">
                        ‚úåÔ∏è Double
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoKickPattern('minimal')" style="padding: 8px 12px; font-size: 0.85em;">
                        ‚óΩ Minimal
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoKickPattern('tribal')" style="padding: 8px 12px; font-size: 0.85em;">
                        üåç Tribal
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoKickPattern('acid')" style="padding: 8px 12px; font-size: 0.85em;">
                        üî• Acid
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoKickPattern('industrial')" style="padding: 8px 12px; font-size: 0.85em;">
                        ‚öôÔ∏è Industrial
                    </button>
                </div>
            </div>

            <!-- Hi-Hat Pattern Variations (Pro Mode) -->
            <div class="control-group" data-mode="pro" style="margin: 20px 0; padding: 15px; background: var(--bg-tertiary); border-radius: 3px; border: 1px solid var(--accent-cyan);">
                <label style="display: block; margin-bottom: 10px; color: var(--accent-cyan);">
                    üé© HI-HAT PATTERN VARIATIONS:
                </label>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px;">
                    <button class="btn btn-secondary" onclick="loadTechnoHatPattern('closed')" style="padding: 8px 12px; font-size: 0.85em;">
                        üîí Closed 8ths
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoHatPattern('open')" style="padding: 8px 12px; font-size: 0.85em;">
                        üîì Open
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoHatPattern('16ths')" style="padding: 8px 12px; font-size: 0.85em;">
                        ‚ö° 16th Notes
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoHatPattern('offbeat')" style="padding: 8px 12px; font-size: 0.85em;">
                        üéµ Offbeat
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoHatPattern('minimal')" style="padding: 8px 12px; font-size: 0.85em;">
                        ‚óΩ Minimal
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoHatPattern('rolling')" style="padding: 8px 12px; font-size: 0.85em;">
                        üåÄ Rolling
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoHatPattern('syncopated')" style="padding: 8px 12px; font-size: 0.85em;">
                        üé∂ Syncopated
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoHatPattern('industrial')" style="padding: 8px 12px; font-size: 0.85em;">
                        ‚öôÔ∏è Industrial
                    </button>
                </div>
            </div>

            <!-- ============================================ -->
            <!-- EXPERT MODE: PATTERN COMBINATOR & INTELLIGENT BEAT GENERATOR -->
            <!-- ============================================ -->
            <div class="control-group" data-mode="advanced" style="margin: 30px 0; padding: 25px; background: linear-gradient(135deg, rgba(0, 255, 65, 0.15), rgba(0, 191, 255, 0.15)); border: 2px solid var(--accent-cyan); border-radius: 15px;">
                <h3 style="color: var(--accent-cyan); margin-bottom: 20px; font-size: 1.3em; text-align: center;">
                    üß† Intelligent Techno Generator - Expert Mode
                </h3>
                
                <p style="color: var(--text-secondary); text-align: center; margin-bottom: 25px; font-size: 0.95em;">
                    Generate complete techno patterns based on style, instruments, and complexity!
                </p>

                <!-- Style-Based Beat Generation -->
                <div style="margin-bottom: 25px; padding: 20px; background: var(--bg-secondary); border-radius: 10px;">
                    <h4 style="color: var(--accent-cyan); margin-bottom: 15px; font-size: 1.1em;">
                        üéØ Style-Based Auto-Generation
                    </h4>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <!-- Genre Selection -->
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.9em; margin-bottom: 8px;">
                                üéº Techno Style:
                            </label>
                            <select id="technoGenreStyle" class="form-control" style="width: 100%; padding: 10px; background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border); border-radius: 8px; font-size: 0.95em;">
                                <option value="detroit">üöó Detroit Techno</option>
                                <option value="minimal">‚óΩ Minimal Techno</option>
                                <option value="industrial">‚öôÔ∏è Industrial</option>
                                <option value="acid">üî• Acid Techno</option>
                                <option value="hard">üí• Hard Techno</option>
                                <option value="tribal">ü•Å Tribal</option>
                                <option value="progressive">üåä Progressive</option>
                            </select>
                        </div>
                        
                        <!-- Complexity Level -->
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.9em; margin-bottom: 8px;">
                                ‚öôÔ∏è Complexity:
                            </label>
                            <select id="technoComplexityLevel" class="form-control" style="width: 100%; padding: 10px; background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border); border-radius: 8px; font-size: 0.95em;">
                                <option value="minimal">‚óΩ Minimal</option>
                                <option value="simple">üü¢ Simple</option>
                                <option value="moderate" selected>üü° Moderate</option>
                                <option value="complex">üü† Complex</option>
                                <option value="chaotic">üî¥ Chaotic</option>
                            </select>
                        </div>
                        
                        <!-- Energy Level -->
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.9em; margin-bottom: 8px;">
                                ‚ö° Energy Level:
                            </label>
                            <input type="range" id="technoEnergyLevel" min="1" max="10" value="7" 
                                   style="width: 100%; margin-top: 10px;"
                                   oninput="document.getElementById('technoEnergyValue').textContent = this.value">
                            <div style="text-align: center; color: var(--accent-cyan); font-weight: bold; margin-top: 5px;">
                                <span id="technoEnergyValue">7</span> / 10
                            </div>
                        </div>
                    </div>

                    <!-- Instrument Selection -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: var(--text-secondary); font-size: 0.9em; margin-bottom: 10px;">
                            üéπ Select Active Instruments:
                        </label>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                            <label style="display: flex; align-items: center; padding: 10px; background: var(--bg-tertiary); border-radius: 8px; cursor: pointer;">
                                <input type="checkbox" id="techno_inst_kick" checked style="margin-right: 10px;">
                                <span>ü•Å Kick</span>
                            </label>
                            <label style="display: flex; align-items: center; padding: 10px; background: var(--bg-tertiary); border-radius: 8px; cursor: pointer;">
                                <input type="checkbox" id="techno_inst_snare" checked style="margin-right: 10px;">
                                <span>üëè Snare</span>
                            </label>
                            <label style="display: flex; align-items: center; padding: 10px; background: var(--bg-tertiary); border-radius: 8px; cursor: pointer;">
                                <input type="checkbox" id="techno_inst_hihat" checked style="margin-right: 10px;">
                                <span>üé© Hi-Hat</span>
                            </label>
                            <label style="display: flex; align-items: center; padding: 10px; background: var(--bg-tertiary); border-radius: 8px; cursor: pointer;">
                                <input type="checkbox" id="techno_inst_perc" style="margin-right: 10px;">
                                <span>üéµ Percussion</span>
                            </label>
                        </div>
                    </div>

                    <!-- Generate Button -->
                    <div style="text-align: center;">
                        <button class="btn" onclick="generateIntelligentTechno()" style="font-size: 1.1em; padding: 15px 40px; background: linear-gradient(135deg, var(--accent-cyan), #00ffff); color: #000; font-weight: bold; box-shadow: 0 5px 20px rgba(0, 255, 255, 0.4);">
                            üß† Generate Techno
                        </button>
                    </div>
                </div>

                <!-- Pattern Combination Library -->
                <div style="padding: 20px; background: var(--bg-secondary); border-radius: 10px;">
                    <h4 style="color: var(--accent-cyan); margin-bottom: 15px; font-size: 1.1em;">
                        üé® Techno Pattern Presets
                    </h4>
                    <p style="color: var(--text-secondary); font-size: 0.85em; margin-bottom: 15px;">
                        Classic techno combinations. Click to apply!
                    </p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                        <button class="btn btn-secondary" onclick="loadTechnoCombo('four-floor-classic')" style="padding: 12px;">
                            üéµ Four-on-Floor Classic
                            <div style="font-size: 0.75em; opacity: 0.8;">Detroit Style</div>
                        </button>
                        <button class="btn btn-secondary" onclick="loadTechnoCombo('minimal-groove')" style="padding: 12px;">
                            ‚óΩ Minimal Groove
                            <div style="font-size: 0.75em; opacity: 0.8;">Sparse & Deep</div>
                        </button>
                        <button class="btn btn-secondary" onclick="loadTechnoCombo('industrial-assault')" style="padding: 12px;">
                            ‚öôÔ∏è Industrial Assault
                            <div style="font-size: 0.75em; opacity: 0.8;">Hard & Heavy</div>
                        </button>
                        <button class="btn btn-secondary" onclick="loadTechnoCombo('acid-rave')" style="padding: 12px;">
                            üî• Acid Rave
                            <div style="font-size: 0.75em; opacity: 0.8;">303 Vibes</div>
                        </button>
                        <button class="btn btn-secondary" onclick="loadTechnoCombo('tribal-ritual')" style="padding: 12px;">
                            ü•Å Tribal Ritual
                            <div style="font-size: 0.75em; opacity: 0.8;">Percussive Energy</div>
                        </button>
                        <button class="btn btn-secondary" onclick="loadTechnoCombo('progressive-journey')" style="padding: 12px;">
                            üåä Progressive Journey
                            <div style="font-size: 0.75em; opacity: 0.8;">Build & Release</div>
                        </button>
                    </div>
                </div>

                <!-- Pattern Randomizer -->
                <div style="margin-top: 20px; padding: 20px; background: var(--bg-tertiary); border-radius: 10px; text-align: center;">
                    <h4 style="color: var(--accent-cyan); margin-bottom: 15px; font-size: 1em;">
                        üé≤ Pattern Randomizer
                    </h4>
                    <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                        <button class="btn btn-secondary" onclick="randomizeTechnoKickPattern()">
                            ü•Å Random Kick
                        </button>
                        <button class="btn btn-secondary" onclick="randomizeTechnoHiHatPattern()">
                            üé© Random Hi-Hat
                        </button>
                        <button class="btn btn-secondary" onclick="randomizeAllTechnoPatterns()">
                            üé≤ Randomize All
                        </button>
                    </div>
                </div>
            </div>

            <!-- Sequencer Grid -->
            <div class="sequencer-grid" id="technoSequencerGrid">
                <!-- Will be populated by JavaScript -->
            </div>

            <!-- Sequencer Controls -->
            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px; flex-wrap: wrap;">
                <button class="btn" onclick="playTechnoPattern()">
                    ‚ñ∂Ô∏è Play Pattern
                </button>
                <button class="btn btn-secondary" onclick="stopTechnoPattern()">
                    ‚èπÔ∏è Stop
                </button>
                <button class="btn btn-magenta" onclick="clearTechnoPattern()">
                    üóëÔ∏è Clear
                </button>
                <button class="btn btn-cyan" onclick="randomizeTechnoPattern()">
                    üé≤ Random Pattern
                </button>
                <button class="btn" onclick="exportTechnoToRadio()" style="background: linear-gradient(135deg, #00ff00, #00ffff); color: #000; font-weight: bold;">
                    üìª Send to Radio
                </button>
            </div>

            <!-- Preset Patterns -->
            <div style="margin-top: 20px;">
                <h3>üì¶ PRESET PATTERNS:</h3>
                <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
                    <button class="btn btn-secondary" onclick="loadTechnoPreset('hard_techno')">
                        ‚ö° Hard Techno
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoPreset('minimal')">
                        üéµ Minimal
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoPreset('industrial')">
                        ‚öôÔ∏è Industrial
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoPreset('acid_groove')">
                        üîä Acid Groove
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Audio Context
        let audioContext = null;
        let currentTechnoInstrument = 'acid_bass';
        let generatedTechnoSequence = [];
        let technoBPM = 135;
        let technoPattern = {
            kick: new Array(16).fill(false),
            hat: new Array(16).fill(false),
            clap: new Array(16).fill(false),
            perc: new Array(16).fill(false)
        };
        let technoIsPlaying = false;
        let technoCurrentStep = 0;
        let technoIntervalId = null;

        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            return audioContext;
        }

        // ============================================
        // LIVE GUIDANCE SYSTEM (Techno)
        // ============================================
        
        function toggleGuidance() {
            const panel = document.getElementById('guidancePanel');
            const toggle = document.getElementById('guidanceToggle');
            panel.classList.toggle('minimized');
            toggle.textContent = panel.classList.contains('minimized') ? '+' : '‚àí';
        }

        function updateGuidance(type, value) {
            const content = document.getElementById('guidanceContent');
            let tip = '';
            
            switch(type) {
                case 'bpm':
                    const bpmNum = parseInt(value);
                    let bpmStyle = '';
                    if (bpmNum < 120) bpmStyle = 'Slow/Dub Techno';
                    else if (bpmNum < 130) bpmStyle = 'Classic Techno';
                    else if (bpmNum < 140) bpmStyle = 'Acid/Hard Techno';
                    else if (bpmNum < 150) bpmStyle = 'Hard Techno';
                    else bpmStyle = 'Hardcore/Gabber';
                    
                    if (document.getElementById('bpmStyle')) {
                        document.getElementById('bpmStyle').textContent = bpmStyle;
                    }
                    
                    tip = `
                        <div class="guidance-tip" style="background: rgba(0, 255, 0, 0.15); border-left-color: var(--accent-primary);">
                            <div class="guidance-tip-title">‚ö° BPM: ${value} - ${bpmStyle}</div>
                            <div class="guidance-tip-text">
                                ${bpmNum < 120 ? 'üåä Deep, atmospheric dub techno territory' :
                                  bpmNum < 130 ? 'üéµ Classic Detroit/Berlin techno tempo' :
                                  bpmNum < 140 ? 'üî• Peak time energy - acid and hard techno' :
                                  bpmNum < 150 ? '‚ö° Hard techno - industrial power' :
                                  'üíÄ Hardcore/gabber - extreme intensity'}
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'pattern':
                    tip = `
                        <div class="guidance-tip" style="background: rgba(0, 255, 255, 0.15); border-left-color: var(--accent-cyan);">
                            <div class="guidance-tip-title">üéµ Pattern: ${value}</div>
                            <div class="guidance-tip-text">
                                ${value === 'acid_techno' ? 'üß™ TB-303 style squelchy basslines' :
                                  value === 'minimal_techno' ? '‚ú® Less is more - subtle variations' :
                                  value === 'hard_techno' ? '‚ö° Aggressive, driving energy' :
                                  value === 'industrial' ? 'üè≠ Harsh, metallic textures' :
                                  value === 'detroit' ? 'üöó Soulful, futuristic grooves' :
                                  value === 'dub_techno' ? 'üåä Deep, spacious atmospheres' : 
                                  'Experimental techno style'}
                            </div>
                        </div>
                    `;
                    break;
            }
            
            if (tip) {
                // Add tip at the top of guidance content
                const existingContent = content.innerHTML;
                content.innerHTML = tip + existingContent;
                
                // Keep only last 5 tips
                const tips = content.querySelectorAll('.guidance-tip');
                if (tips.length > 5) {
                    tips[tips.length - 1].remove();
                }
            }
        }

        // Techno Music Theory
        const technoTheory = {
            notes: ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'],
            scales: {
                minor: [0, 2, 3, 5, 7, 8, 10],           // Natural minor
                phrygian: [0, 1, 3, 5, 7, 8, 10],        // Dark, Spanish
                dorian: [0, 2, 3, 5, 7, 9, 10],          // Groovy, jazzy
                minor_penta: [0, 3, 5, 7, 10],           // Simple, hypnotic
                harmonic: [0, 2, 3, 5, 7, 8, 11]         // Exotic, dramatic
            },
            patterns: {
                hard_techno: {
                    name: 'Hard Techno Sequence',
                    pattern: [0, 0, 5, 0, 3, 0, 7, 0],  // Root, fifth, third patterns
                    rhythm: 'driving'
                },
                acid_techno: {
                    name: 'Acid Bassline',
                    pattern: [0, 3, 5, 3, 7, 5, 3, 0],  // Classic 303 pattern
                    rhythm: 'hypnotic'
                },
                minimal: {
                    name: 'Minimal Loop',
                    pattern: [0, 5, 7, 5],              // Simple, repetitive
                    rhythm: 'sparse'
                },
                industrial: {
                    name: 'Industrial Sequence',
                    pattern: [0, 1, 0, 3, 0, 1, 5, 3],  // Chromatic, harsh
                    rhythm: 'aggressive'
                },
                detroit: {
                    name: 'Detroit Chord Progression',
                    pattern: [0, 3, 7, 10, 3, 7, 5, 3], // Soulful, melodic
                    rhythm: 'groovy'
                },
                dub_techno: {
                    name: 'Dub Techno Chords',
                    pattern: [0, 5, 7, 10],             // Deep, sustained
                    rhythm: 'spacious'
                }
            }
        };

        // Generate Techno Sequence
        function generateTechnoSequence() {
            const root = document.getElementById('technoKey').value;
            const scale = document.getElementById('technoScale').value;
            const subgenre = document.getElementById('technoSubgenre').value;
            
            const scaleIntervals = technoTheory.scales[scale];
            const pattern = technoTheory.patterns[subgenre];
            const rootIndex = technoTheory.notes.indexOf(root);
            
            generatedTechnoSequence = [];
            let codeOutput = `# ${pattern.name}\n`;
            codeOutput += `Root: ${root} | Scale: ${scale} | Style: ${subgenre}\n\n`;
            
            const sequence = [];
            pattern.pattern.forEach((degree, index) => {
                const noteIndex = (rootIndex + scaleIntervals[degree % scaleIntervals.length]) % 12;
                const noteName = technoTheory.notes[noteIndex];
                const octave = 3; // Bass octave for techno
                const midiNote = 12 + (octave * 12) + noteIndex;
                
                sequence.push({
                    note: noteName,
                    midi: midiNote,
                    step: index + 1
                });
                
                generatedTechnoSequence.push(midiNote);
                
                codeOutput += `Step ${index + 1}: ${noteName}${octave} (MIDI ${midiNote})\n`;
            });
            
            displayTechnoSequence(sequence, pattern.name);
            document.getElementById('technoCode').textContent = codeOutput;
            document.getElementById('technoOutput').style.display = 'block';
        }

        function displayTechnoSequence(sequence, patternName) {
            const display = document.getElementById('technoDisplay');
            display.innerHTML = `
                <div style="text-align: center; margin-bottom: 15px;">
                    <h3 style="color: var(--accent-primary);">${patternName}</h3>
                </div>
                ${sequence.map(item => `
                    <div class="chord-item animated">
                        <div>
                            <span class="chord-name">Step ${item.step}: ${item.note}</span>
                        </div>
                        <span class="chord-notes">MIDI: ${item.midi}</span>
                    </div>
                `).join('')}
            `;
        }

        // Set Instrument
        function setTechnoInstrument(instrument) {
            currentTechnoInstrument = instrument;
            
            // Update button styles
            document.querySelectorAll('[id^="inst-"]').forEach(btn => {
                btn.style.border = '1px solid var(--accent-primary)';
                btn.style.background = 'linear-gradient(135deg, var(--bg-tertiary), var(--border))';
            });
            document.getElementById(`inst-${instrument}`).style.border = '2px solid var(--accent-primary)';
            document.getElementById(`inst-${instrument}`).style.background = 'linear-gradient(135deg, var(--accent-primary), #00cc00)';
        }

        // Randomize Sequence
        function randomizeTechnoSequence() {
            const notes = ['A', 'A#', 'B', 'C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#'];
            const scales = ['minor', 'phrygian', 'dorian', 'minor_penta', 'harmonic'];
            const subgenres = ['hard_techno', 'acid_techno', 'minimal', 'industrial', 'detroit', 'dub_techno'];
            
            document.getElementById('technoKey').value = notes[Math.floor(Math.random() * notes.length)];
            document.getElementById('technoScale').value = scales[Math.floor(Math.random() * scales.length)];
            document.getElementById('technoSubgenre').value = subgenres[Math.floor(Math.random() * subgenres.length)];
            
            generateTechnoSequence();
        }

        // Play Techno Sequence
        function playTechnoSequence() {
            initAudio();
            
            if (generatedTechnoSequence.length === 0) {
                alert('‚ö†Ô∏è Generate a sequence first!');
                return;
            }
            
            const ctx = audioContext;
            const startTime = ctx.currentTime + 0.1;
            const noteLength = 0.25; // 16th notes
            
            generatedTechnoSequence.forEach((midi, index) => {
                const time = startTime + (index * noteLength);
                const freq = midiToFrequency(midi);
                playTechnoNote(ctx, freq, time, currentTechnoInstrument);
            });
        }

        function midiToFrequency(midi) {
            return 440 * Math.pow(2, (midi - 69) / 12);
        }

        function playTechnoNote(ctx, freq, startTime, instrument) {
            // Use enhanced engine if selected
            if (instrument === 'enhanced') {
                playEnhancedTechnoNote(ctx, freq, startTime, 0.25);
                return;
            }
            
            const resonance = parseInt(document.getElementById('resonanceControl').value) / 100;
            const cutoff = parseInt(document.getElementById('cutoffControl').value);
            const glide = parseInt(document.getElementById('glideControl').value) / 1000;
            const distortion = parseInt(document.getElementById('distortionControl').value);
            
            switch(instrument) {
                case 'acid_bass':
                    playAcidBass(ctx, freq, startTime, resonance, cutoff, glide, distortion);
                    break;
                case 'minimal_stab':
                    playMinimalStab(ctx, freq, startTime);
                    break;
                case 'dub_chord':
                    playDubChord(ctx, freq, startTime);
                    break;
                case 'industrial_drone':
                    playIndustrialDrone(ctx, freq, startTime);
                    break;
                case 'detroit_pad':
                    playDetroitPad(ctx, freq, startTime);
                    break;
                case 'perc_synth':
                    playPercSynth(ctx, freq, startTime);
                    break;
            }
        }

        // ============================================
        // ENHANCED TECHNO SYNTHESIS ENGINE
        // Uses advanced parameters from UI controls
        // ============================================
        
        function playEnhancedTechnoNote(ctx, freq, startTime, duration = 0.5) {
            // Get synthesis parameters from UI
            const waveform = document.getElementById('technoWaveform')?.value || 'sawtooth';
            const unisonVoices = parseInt(document.getElementById('technoUnison')?.value || 3);
            const detuneAmount = parseFloat(document.getElementById('technoDetune')?.value || 10);
            const harmonicCount = parseInt(document.getElementById('technoHarmonics')?.value || 3);
            
            // Filter parameters
            const filterType = document.getElementById('technoFilterType')?.value || 'lowpass';
            const baseCutoff = parseFloat(document.getElementById('cutoffControl')?.value || 500);
            const baseResonance = parseFloat(document.getElementById('resonanceControl')?.value || 70) / 100;
            const filterEnvelope = parseFloat(document.getElementById('technoFilterEnv')?.value || 80) / 100;
            const velocity = parseFloat(document.getElementById('technoVelocity')?.value || 90) / 100;
            
            // Envelope parameters
            const attackTime = parseFloat(document.getElementById('technoAttack')?.value || 0.01);
            const decayTime = parseFloat(document.getElementById('technoDecay')?.value || 0.2);
            const sustainLevel = parseFloat(document.getElementById('technoSustain')?.value || 50) / 100;
            const releaseTime = parseFloat(document.getElementById('technoRelease')?.value || 0.3);
            
            // LFO parameters
            const lfoEnabled = document.getElementById('lfoToggle')?.checked || false;
            const lfoRate = parseFloat(document.getElementById('technoLFORate')?.value || 6);
            const lfoDepth = parseFloat(document.getElementById('technoLFODepth')?.value || 40) / 100;
            const lfoTarget = document.getElementById('technoLFOTarget')?.value || 'filter';
            
            // Distortion from existing control
            const distortionAmount = parseFloat(document.getElementById('distortionControl')?.value || 30);
            
            // Automation
            const autoFilter = document.getElementById('technoAutoFilter')?.checked || false;
            const autoVolume = document.getElementById('technoAutoVolume')?.checked || false;
            const autoPan = document.getElementById('technoAutoPan')?.checked || false;
            const pulseMod = document.getElementById('technoPulseWidth')?.checked || false;
            
            // Create master filter
            const masterFilter = ctx.createBiquadFilter();
            masterFilter.type = filterType;
            masterFilter.frequency.setValueAtTime(baseCutoff, startTime);
            masterFilter.Q.setValueAtTime(baseResonance * 20, startTime);
            
            // Distortion
            const distNode = ctx.createWaveShaper();
            distNode.curve = makeDistortionCurve(distortionAmount);
            
            // Create master gain
            const masterGain = ctx.createGain();
            
            // Create panner for auto-pan
            const panner = ctx.createStereoPanner();
            panner.pan.setValueAtTime(0, startTime);
            
            // LFO setup
            let lfo = null;
            let lfoGain = null;
            if (lfoEnabled) {
                lfo = ctx.createOscillator();
                lfoGain = ctx.createGain();
                lfo.frequency.setValueAtTime(lfoRate, startTime);
                lfo.connect(lfoGain);
                
                if (lfoTarget === 'pitch') {
                    lfoGain.gain.setValueAtTime(freq * lfoDepth * 0.05, startTime);
                } else if (lfoTarget === 'filter') {
                    lfoGain.gain.setValueAtTime(baseCutoff * lfoDepth * 2, startTime);
                    lfoGain.connect(masterFilter.frequency);
                } else if (lfoTarget === 'volume') {
                    lfoGain.gain.setValueAtTime(velocity * lfoDepth * 0.5, startTime);
                    lfoGain.connect(masterGain.gain);
                }
                
                lfo.start(startTime);
                lfo.stop(startTime + duration);
            }
            
            // Create pulse width modulation LFO
            let pwmLFO = null;
            let pwmGain = null;
            if (pulseMod && waveform === 'square') {
                pwmLFO = ctx.createOscillator();
                pwmGain = ctx.createGain();
                pwmLFO.frequency.setValueAtTime(0.5, startTime); // Slow modulation
                pwmGain.gain.setValueAtTime(20, startTime); // Detune amount
                pwmLFO.connect(pwmGain);
                pwmLFO.start(startTime);
                pwmLFO.stop(startTime + duration);
            }
            
            // Create unison voices with harmonics
            const oscillators = [];
            
            for (let voice = 0; voice < unisonVoices; voice++) {
                // Calculate detune for this voice
                const voiceDetune = voice === Math.floor(unisonVoices / 2) ? 0 : 
                    ((voice - Math.floor(unisonVoices / 2)) * detuneAmount);
                
                // Create fundamental oscillator
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                
                osc.type = waveform;
                osc.frequency.setValueAtTime(freq, startTime);
                osc.detune.setValueAtTime(voiceDetune, startTime);
                
                // Connect pitch LFO if enabled
                if (lfoEnabled && lfoTarget === 'pitch') {
                    lfoGain.connect(osc.frequency);
                }
                
                // Connect PWM if enabled
                if (pwmLFO && waveform === 'square') {
                    pwmGain.connect(osc.detune);
                }
                
                osc.connect(gain);
                gain.connect(masterFilter);
                
                // Voice amplitude (center voice louder)
                const voiceAmp = voice === Math.floor(unisonVoices / 2) ? 1.0 : 0.6;
                gain.gain.setValueAtTime(voiceAmp / unisonVoices, startTime);
                
                oscillators.push(osc);
                
                // Add harmonics
                for (let h = 1; h <= harmonicCount; h++) {
                    const harmOsc = ctx.createOscillator();
                    const harmGain = ctx.createGain();
                    
                    harmOsc.type = 'sine';
                    harmOsc.frequency.setValueAtTime(freq * (h + 1), startTime);
                    harmOsc.detune.setValueAtTime(voiceDetune, startTime);
                    
                    harmOsc.connect(harmGain);
                    harmGain.connect(masterFilter);
                    
                    // Decreasing amplitude for higher harmonics
                    harmGain.gain.setValueAtTime((voiceAmp / unisonVoices) * (0.4 / (h + 1)), startTime);
                    
                    oscillators.push(harmOsc);
                }
            }
            
            // Connect filter -> distortion -> gain -> panner -> destination
            masterFilter.connect(distNode);
            distNode.connect(masterGain);
            masterGain.connect(panner);
            panner.connect(ctx.destination);
            
            // Apply ADSR envelope
            masterGain.gain.setValueAtTime(0, startTime);
            masterGain.gain.linearRampToValueAtTime(velocity * 0.4, startTime + attackTime);
            masterGain.gain.linearRampToValueAtTime(velocity * 0.4 * sustainLevel, startTime + attackTime + decayTime);
            
            const releaseStart = startTime + duration - releaseTime;
            if (releaseStart > startTime + attackTime + decayTime) {
                masterGain.gain.setValueAtTime(velocity * 0.4 * sustainLevel, releaseStart);
            }
            masterGain.gain.exponentialRampToValueAtTime(0.001, startTime + duration);
            
            // TB-303 style filter envelope
            const filterEnvAmount = baseCutoff * filterEnvelope * 8;
            masterFilter.frequency.setValueAtTime(baseCutoff, startTime);
            masterFilter.frequency.exponentialRampToValueAtTime(baseCutoff + filterEnvAmount, startTime + attackTime * 2);
            masterFilter.frequency.exponentialRampToValueAtTime(baseCutoff, startTime + attackTime + decayTime + 0.1);
            
            // Automation effects
            if (autoFilter) {
                // Filter sweep over duration
                masterFilter.frequency.exponentialRampToValueAtTime(baseCutoff * 0.2, startTime + duration * 0.9);
            }
            
            if (autoVolume) {
                // Volume fade
                masterGain.gain.linearRampToValueAtTime(velocity * 0.2, startTime + duration * 0.95);
            }
            
            if (autoPan) {
                // Auto-pan sweep
                panner.pan.setValueAtTime(-1, startTime);
                panner.pan.linearRampToValueAtTime(1, startTime + duration);
            }
            
            // Start and stop all oscillators
            oscillators.forEach(osc => {
                osc.start(startTime);
                osc.stop(startTime + duration);
            });
        }

        // Play enhanced note sequence
        function playEnhancedTechnoSequence(sequence) {
            if (!audioContext) initAudio();
            
            const startTime = audioContext.currentTime;
            const noteDuration = 0.25; // 16th notes
            
            sequence.forEach((note, index) => {
                if (note && note.freq) {
                    const noteTime = startTime + (index * noteDuration);
                    playEnhancedTechnoNote(audioContext, note.freq, noteTime, noteDuration * 0.9);
                }
            });
        }

        // Acid Bass (TB-303 Style)
        function playAcidBass(ctx, freq, startTime, resonance, cutoff, glide, distortion) {
            const osc = ctx.createOscillator();
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(freq, startTime);
            if (glide > 0) {
                osc.frequency.exponentialRampToValueAtTime(freq, startTime + glide);
            }
            
            const filter = ctx.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(cutoff, startTime);
            filter.Q.setValueAtTime(resonance * 20, startTime);
            
            // Filter envelope
            filter.frequency.exponentialRampToValueAtTime(cutoff * 3, startTime + 0.05);
            filter.frequency.exponentialRampToValueAtTime(cutoff, startTime + 0.2);
            
            const distNode = ctx.createWaveShaper();
            distNode.curve = makeDistortionCurve(distortion);
            
            const gain = ctx.createGain();
            gain.gain.setValueAtTime(0, startTime);
            gain.gain.linearRampToValueAtTime(0.3, startTime + 0.01);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.25);
            
            osc.connect(filter);
            filter.connect(distNode);
            distNode.connect(gain);
            gain.connect(ctx.destination);
            
            osc.start(startTime);
            osc.stop(startTime + 0.3);
        }

        // Minimal Stab
        function playMinimalStab(ctx, freq, startTime) {
            const osc = ctx.createOscillator();
            osc.type = 'square';
            osc.frequency.setValueAtTime(freq, startTime);
            
            const filter = ctx.createBiquadFilter();
            filter.type = 'bandpass';
            filter.frequency.setValueAtTime(freq * 2, startTime);
            filter.Q.setValueAtTime(5, startTime);
            
            const gain = ctx.createGain();
            gain.gain.setValueAtTime(0, startTime);
            gain.gain.linearRampToValueAtTime(0.2, startTime + 0.005);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.15);
            
            osc.connect(filter);
            filter.connect(gain);
            gain.connect(ctx.destination);
            
            osc.start(startTime);
            osc.stop(startTime + 0.2);
        }

        // Dub Chord
        function playDubChord(ctx, freq, startTime) {
            [1, 1.25, 1.5].forEach(ratio => {
                const osc = ctx.createOscillator();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(freq * ratio, startTime);
                
                const filter = ctx.createBiquadFilter();
                filter.type = 'lowpass';
                filter.frequency.setValueAtTime(800, startTime);
                filter.Q.setValueAtTime(1, startTime);
                
                const gain = ctx.createGain();
                gain.gain.setValueAtTime(0, startTime);
                gain.gain.linearRampToValueAtTime(0.1, startTime + 0.3);
                gain.gain.exponentialRampToValueAtTime(0.01, startTime + 2.0);
                
                osc.connect(filter);
                filter.connect(gain);
                gain.connect(ctx.destination);
                
                osc.start(startTime);
                osc.stop(startTime + 2.5);
            });
        }

        // Industrial Drone
        function playIndustrialDrone(ctx, freq, startTime) {
            const osc1 = ctx.createOscillator();
            const osc2 = ctx.createOscillator();
            
            osc1.type = 'sawtooth';
            osc2.type = 'square';
            osc1.frequency.setValueAtTime(freq, startTime);
            osc2.frequency.setValueAtTime(freq * 0.99, startTime);
            
            const noise = createNoiseBuffer(ctx);
            const noiseSource = ctx.createBufferSource();
            noiseSource.buffer = noise;
            
            const noiseGain = ctx.createGain();
            noiseGain.gain.setValueAtTime(0.1, startTime);
            
            const filter = ctx.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(300, startTime);
            filter.Q.setValueAtTime(10, startTime);
            
            const gain = ctx.createGain();
            gain.gain.setValueAtTime(0, startTime);
            gain.gain.linearRampToValueAtTime(0.2, startTime + 0.1);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.8);
            
            osc1.connect(filter);
            osc2.connect(filter);
            noiseSource.connect(noiseGain);
            noiseGain.connect(filter);
            filter.connect(gain);
            gain.connect(ctx.destination);
            
            osc1.start(startTime);
            osc2.start(startTime);
            noiseSource.start(startTime);
            osc1.stop(startTime + 1.0);
            osc2.stop(startTime + 1.0);
            noiseSource.stop(startTime + 1.0);
        }

        // Detroit Pad
        function playDetroitPad(ctx, freq, startTime) {
            [0.99, 1, 1.01].forEach((detune, i) => {
                const osc = ctx.createOscillator();
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(freq * detune, startTime);
                
                const filter = ctx.createBiquadFilter();
                filter.type = 'lowpass';
                filter.frequency.setValueAtTime(1500, startTime);
                filter.Q.setValueAtTime(0.7, startTime);
                
                const gain = ctx.createGain();
                gain.gain.setValueAtTime(0, startTime);
                gain.gain.linearRampToValueAtTime(0.08, startTime + 0.5);
                gain.gain.exponentialRampToValueAtTime(0.01, startTime + 3.0);
                
                osc.connect(filter);
                filter.connect(gain);
                gain.connect(ctx.destination);
                
                osc.start(startTime);
                osc.stop(startTime + 3.5);
            });
        }

        // Perc Synth
        function playPercSynth(ctx, freq, startTime) {
            const osc = ctx.createOscillator();
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(freq * 4, startTime);
            osc.frequency.exponentialRampToValueAtTime(freq, startTime + 0.05);
            
            const filter = ctx.createBiquadFilter();
            filter.type = 'bandpass';
            filter.frequency.setValueAtTime(freq * 2, startTime);
            filter.Q.setValueAtTime(10, startTime);
            
            const gain = ctx.createGain();
            gain.gain.setValueAtTime(0, startTime);
            gain.gain.linearRampToValueAtTime(0.3, startTime + 0.001);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.1);
            
            osc.connect(filter);
            filter.connect(gain);
            gain.connect(ctx.destination);
            
            osc.start(startTime);
            osc.stop(startTime + 0.15);
        }

        // Drum Synthesis
        function playTechnoKick(ctx, startTime) {
            const osc = ctx.createOscillator();
            osc.frequency.setValueAtTime(150, startTime);
            osc.frequency.exponentialRampToValueAtTime(40, startTime + 0.05);
            
            const gain = ctx.createGain();
            gain.gain.setValueAtTime(1, startTime);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.3);
            
            osc.connect(gain);
            gain.connect(ctx.destination);
            
            osc.start(startTime);
            osc.stop(startTime + 0.3);
        }

        function playTechnoHat(ctx, startTime) {
            const noise = createNoiseBuffer(ctx);
            const source = ctx.createBufferSource();
            source.buffer = noise;
            
            const filter = ctx.createBiquadFilter();
            filter.type = 'highpass';
            filter.frequency.setValueAtTime(8000, startTime);
            
            const gain = ctx.createGain();
            gain.gain.setValueAtTime(0.3, startTime);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.05);
            
            source.connect(filter);
            filter.connect(gain);
            gain.connect(ctx.destination);
            
            source.start(startTime);
            source.stop(startTime + 0.05);
        }

        function playTechnoClap(ctx, startTime) {
            const noise = createNoiseBuffer(ctx);
            
            [0, 0.015, 0.03].forEach(offset => {
                const source = ctx.createBufferSource();
                source.buffer = noise;
                
                const filter = ctx.createBiquadFilter();
                filter.type = 'bandpass';
                filter.frequency.setValueAtTime(1500, startTime + offset);
                filter.Q.setValueAtTime(1, startTime + offset);
                
                const gain = ctx.createGain();
                gain.gain.setValueAtTime(0.5, startTime + offset);
                gain.gain.exponentialRampToValueAtTime(0.01, startTime + offset + 0.1);
                
                source.connect(filter);
                filter.connect(gain);
                gain.connect(ctx.destination);
                
                source.start(startTime + offset);
                source.stop(startTime + offset + 0.1);
            });
        }

        function playTechnoPerc(ctx, startTime) {
            const osc = ctx.createOscillator();
            osc.frequency.setValueAtTime(800, startTime);
            osc.frequency.exponentialRampToValueAtTime(400, startTime + 0.05);
            osc.type = 'sine';
            
            const gain = ctx.createGain();
            gain.gain.setValueAtTime(0.4, startTime);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.08);
            
            osc.connect(gain);
            gain.connect(ctx.destination);
            
            osc.start(startTime);
            osc.stop(startTime + 0.08);
        }

        // Utility Functions
        function createNoiseBuffer(ctx) {
            const bufferSize = ctx.sampleRate * 0.5;
            const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) {
                data[i] = Math.random() * 2 - 1;
            }
            return buffer;
        }

        function makeDistortionCurve(amount) {
            const samples = 44100;
            const curve = new Float32Array(samples);
            const deg = Math.PI / 180;
            for (let i = 0; i < samples; i++) {
                const x = (i * 2) / samples - 1;
                curve[i] = ((3 + amount) * x * 20 * deg) / (Math.PI + amount * Math.abs(x));
            }
            return curve;
        }

        // ============================================
        // CLEAN SOUND ENGINE UTILITIES (TECHNO)
        // Anti-aliasing and improved synthesis
        // ============================================
        
        /**
         * Create bandlimited oscillator with reduced aliasing
         */
        function createCleanOscillator(ctx, freq, waveform, maxPartials = 32) {
            const nyquist = ctx.sampleRate / 2;
            const fundamental = freq;
            const safePartials = Math.min(maxPartials, Math.floor(nyquist / fundamental) - 1);
            
            const oscillators = [];
            const gains = [];
            const merger = ctx.createGain();
            
            for (let n = 1; n <= safePartials; n++) {
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                
                osc.type = 'sine';
                osc.frequency.value = fundamental * n;
                
                let amplitude = 0;
                switch(waveform) {
                    case 'sawtooth':
                        amplitude = 1 / n;
                        break;
                    case 'square':
                        amplitude = (n % 2 === 1) ? (1 / n) : 0;
                        break;
                    case 'triangle':
                        amplitude = (n % 2 === 1) ? (1 / (n * n)) : 0;
                        break;
                    case 'sine':
                        amplitude = (n === 1) ? 1 : 0;
                        break;
                }
                
                gain.gain.value = amplitude / safePartials;
                osc.connect(gain);
                gain.connect(merger);
                
                oscillators.push(osc);
                gains.push(gain);
            }
            
            return { oscillators, gains, output: merger };
        }
        
        /**
         * Create cascaded filter for steeper rolloff
         */
        function createCleanFilter(ctx, type, cutoff, resonance, stages = 2) {
            const filters = [];
            let input = null;
            
            for (let i = 0; i < stages; i++) {
                const filter = ctx.createBiquadFilter();
                filter.type = type;
                filter.frequency.value = cutoff;
                filter.Q.value = Math.pow(resonance, 1 / stages);
                
                if (input) {
                    input.connect(filter);
                }
                
                filters.push(filter);
                input = filter;
            }
            
            return {
                input: filters[0],
                output: filters[filters.length - 1],
                filters: filters,
                setFrequency: (freq) => filters.forEach(f => f.frequency.value = freq),
                setQ: (q) => filters.forEach((f, i) => f.Q.value = Math.pow(q, 1 / stages))
            };
        }
        
        /**
         * Soft clipping for warmer techno saturation
         */
        function createSoftClipper(ctx, drive = 1.0) {
            const samples = 2048;
            const curve = new Float32Array(samples);
            
            for (let i = 0; i < samples; i++) {
                const x = (i * 2 / samples) - 1;
                const processed = Math.tanh(x * drive);
                curve[i] = processed / Math.max(Math.abs(processed), 1.0);
            }
            
            const shaper = ctx.createWaveShaper();
            shaper.curve = curve;
            shaper.oversample = '4x';
            
            return shaper;
        }
        
        /**
         * Industrial delay with feedback saturation
         */
        function createIndustrialDelay(ctx, time = 0.375, feedback = 0.4) {
            const delay = ctx.createDelay();
            const feedbackGain = ctx.createGain();
            const saturator = createSoftClipper(ctx, 2.0);
            const output = ctx.createGain();
            
            delay.delayTime.value = time;
            feedbackGain.gain.value = feedback;
            output.gain.value = 0.5;
            
            delay.connect(saturator);
            saturator.connect(feedbackGain);
            feedbackGain.connect(delay);
            delay.connect(output);
            
            return { input: delay, output: output, feedbackNode: feedbackGain };
        }

        // ============================================
        // MODE SWITCHING SYSTEM
        // ============================================
        
        let currentMode = 'basic';
        
        function switchMode(mode) {
            currentMode = mode;
            const container = document.querySelector('.container');
            
            // Remove all mode classes
            container.classList.remove('mode-basic', 'mode-pro', 'mode-advanced');
            
            // Add new mode class
            container.classList.add(`mode-${mode}`);
            
            // Update mode tabs
            document.querySelectorAll('.mode-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`.mode-tab[data-mode="${mode}"]`).classList.add('active');
            
            // Update mode badge
            const badges = {
                'basic': 'üéØ BASIC MODE',
                'pro': 'üéõÔ∏è PRO MODE',
                'advanced': '‚ö° ADVANCED MODE'
            };
            document.getElementById('modeText').textContent = badges[mode];
            
            // Save mode preference
            localStorage.setItem('techno-creator-mode', mode);
            
            console.log(`Switched to ${mode} mode`);
        }
        
        // Load saved mode on page load
        window.addEventListener('DOMContentLoaded', () => {
            const savedMode = localStorage.getItem('techno-creator-mode') || 'basic';
            switchMode(savedMode);
        });

        // ============================================
        // KICK PATTERN VARIATIONS
        // ============================================
        
        const technoKickPatterns = {
            'four-floor': [true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false],  // Classic four on floor
            'hard': [true, false, false, false, true, false, false, false, true, false, false, false, true, false, true, false],  // Hard techno
            'offbeat': [false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false],  // Offbeat
            'double': [true, true, false, false, true, true, false, false, true, true, false, false, true, true, false, false],  // Double kicks
            'minimal': [true, false, false, false, false, false, false, false, true, false, false, false, false, false, false, false],  // Minimal
            'tribal': [true, false, false, true, false, true, false, false, true, false, false, true, false, true, false, false],  // Tribal
            'acid': [true, false, true, false, true, false, true, false, true, false, true, false, true, false, true, false],  // Acid
            'industrial': [true, false, false, true, true, false, false, true, true, false, false, true, true, false, false, true]  // Industrial
        };
        
        function loadTechnoKickPattern(patternName) {
            const pattern = technoKickPatterns[patternName];
            if (!pattern) return;
            
            // Clear current kick pattern
            technoPattern.kick.fill(false);
            document.querySelectorAll('[data-instrument="kick"]').forEach(el => {
                el.classList.remove('active');
            });
            
            // Load new pattern
            pattern.forEach((active, index) => {
                if (active) {
                    technoPattern.kick[index] = true;
                    const step = document.querySelector(`[data-instrument="kick"][data-step="${index}"]`);
                    if (step) step.classList.add('active');
                }
            });
            
            console.log(`Loaded ${patternName} kick pattern ü¶∂`);
        }

        // ============================================
        // HI-HAT PATTERN VARIATIONS
        // ============================================
        
        const technoHatPatterns = {
            'closed': [false, true, false, true, false, true, false, true, false, true, false, true, false, true, false, true],  // Closed 8ths
            'open': [false, false, false, false, true, false, false, false, false, false, false, false, true, false, false, false],  // Open
            '16ths': [true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true],  // 16th notes
            'offbeat': [false, true, false, true, false, true, false, true, false, true, false, true, false, true, false, true],  // Offbeat
            'minimal': [false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true],  // Minimal
            'rolling': [true, false, true, true, false, true, true, false, true, false, true, true, false, true, true, false],  // Rolling
            'syncopated': [true, false, false, true, false, true, false, false, true, false, false, true, false, true, false, false],  // Syncopated
            'industrial': [true, true, false, true, true, false, true, false, true, true, false, true, true, false, true, false]  // Industrial
        };
        
        function loadTechnoHatPattern(patternName) {
            const pattern = technoHatPatterns[patternName];
            if (!pattern) return;
            
            // Clear current hat pattern
            technoPattern.hat.fill(false);
            document.querySelectorAll('[data-instrument="hat"]').forEach(el => {
                el.classList.remove('active');
            });
            
            // Load new pattern
            pattern.forEach((active, index) => {
                if (active) {
                    technoPattern.hat[index] = true;
                    const step = document.querySelector(`[data-instrument="hat"][data-step="${index}"]`);
                    if (step) step.classList.add('active');
                }
            });
            
            console.log(`Loaded ${patternName} hi-hat pattern üé©`);
        }

        // Sequencer Functions
        function initTechnoSequencer() {
            const grid = document.getElementById('technoSequencerGrid');
            const instruments = [
                { name: 'KICK', key: 'kick', icon: 'ü¶∂' },
                { name: 'HAT', key: 'hat', icon: 'üé©' },
                { name: 'CLAP', key: 'clap', icon: 'üëè' },
                { name: 'PERC', key: 'perc', icon: 'üîî' }
            ];
            
            grid.innerHTML = '';
            
            instruments.forEach(inst => {
                const row = document.createElement('div');
                row.className = 'sequencer-row';
                
                const label = document.createElement('div');
                label.className = 'instrument-label';
                label.textContent = `${inst.icon} ${inst.name}`;
                row.appendChild(label);
                
                for (let i = 0; i < 16; i++) {
                    const step = document.createElement('div');
                    step.className = 'step';
                    step.dataset.instrument = inst.key;
                    step.dataset.step = i;
                    step.onclick = () => toggleTechnoStep(inst.key, i, step);
                    row.appendChild(step);
                }
                
                grid.appendChild(row);
            });
        }

        function toggleTechnoStep(instrument, step, element) {
            technoPattern[instrument][step] = !technoPattern[instrument][step];
            element.classList.toggle('active');
        }

        function playTechnoPattern() {
            console.log('üéµ Play button clicked');
            
            if (technoIsPlaying) {
                console.log('‚ö†Ô∏è Already playing, ignoring');
                return;
            }
            
            // Check if there's a pattern to play
            const hasPattern = Object.keys(technoPattern).some(key => 
                technoPattern[key].some(val => val === true)
            );
            
            if (!hasPattern) {
                console.warn('‚ö†Ô∏è No pattern to play! Load a preset or create a pattern first.');
                showTechnoNotification('‚ö†Ô∏è No pattern! Load a preset first.');
                return;
            }
            
            console.log('‚úÖ Pattern found, initializing audio...');
            initAudio();
            technoIsPlaying = true;
            technoCurrentStep = 0;
            
            const stepDuration = (60 / technoBPM) / 4 * 1000; // 16th notes
            console.log(`‚ñ∂Ô∏è Playing at ${technoBPM} BPM (${stepDuration.toFixed(2)}ms per step)`);
            
            technoIntervalId = setInterval(() => {
                const ctx = audioContext;
                const time = ctx.currentTime;
                
                if (technoPattern.kick[technoCurrentStep]) playTechnoKick(ctx, time);
                if (technoPattern.hat[technoCurrentStep]) playTechnoHat(ctx, time);
                if (technoPattern.clap[technoCurrentStep]) playTechnoClap(ctx, time);
                if (technoPattern.perc[technoCurrentStep]) playTechnoPerc(ctx, time);
                
                // Highlight current step
                document.querySelectorAll('.step').forEach(el => el.classList.remove('playing'));
                document.querySelectorAll(`[data-step="${technoCurrentStep}"]`).forEach(el => {
                    el.classList.add('playing');
                });
                
                technoCurrentStep = (technoCurrentStep + 1) % 16;
            }, stepDuration);
        }

        function stopTechnoPattern() {
            console.log('‚èπÔ∏è Stop button clicked');
            technoIsPlaying = false;
            if (technoIntervalId) {
                clearInterval(technoIntervalId);
                technoIntervalId = null;
            }
            technoCurrentStep = 0;
            
            // Remove playing highlights
            document.querySelectorAll('.step').forEach(el => el.classList.remove('playing'));
            console.log('‚úÖ Playback stopped');
        }

        function clearTechnoPattern() {
            Object.keys(technoPattern).forEach(key => {
                technoPattern[key].fill(false);
            });
            document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
        }

        function randomizeTechnoPattern() {
            clearTechnoPattern();
            Object.keys(technoPattern).forEach((key, instIndex) => {
                for (let i = 0; i < 16; i++) {
                    if (Math.random() > 0.7) {
                        technoPattern[key][i] = true;
                        const step = document.querySelector(`[data-instrument="${key}"][data-step="${i}"]`);
                        if (step) step.classList.add('active');
                    }
                }
            });
        }

        function loadTechnoPreset(preset) {
            console.log(`üéµ Loading techno preset: ${preset}`);
            clearTechnoPattern();
            
            const presets = {
                hard_techno: {
                    kick: [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],
                    hat: [0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1],
                    clap: [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],
                    perc: [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0]
                },
                minimal: {
                    kick: [1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],
                    hat: [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0],
                    clap: [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],
                    perc: [0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0]
                },
                industrial: {
                    kick: [1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0],
                    hat: [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
                    clap: [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0],
                    perc: [0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1]
                },
                acid_groove: {
                    kick: [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],
                    hat: [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0],
                    clap: [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],
                    perc: [1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0]
                }
            };
            
            const pattern = presets[preset];
            if (!pattern) {
                console.error(`‚ùå Preset not found: ${preset}`);
                return;
            }
            
            let stepsActivated = 0;
            Object.keys(pattern).forEach(key => {
                pattern[key].forEach((val, i) => {
                    technoPattern[key][i] = val === 1;
                    const step = document.querySelector(`[data-instrument="${key}"][data-step="${i}"]`);
                    if (step) {
                        if (val === 1) {
                            step.classList.add('active');
                            stepsActivated++;
                        }
                    } else {
                        console.warn(`‚ö†Ô∏è Step element not found: ${key}[${i}]`);
                    }
                });
            });
            
            console.log(`‚úÖ Preset loaded: ${stepsActivated} steps activated`);
            
            // Show visual feedback
            showTechnoNotification(`${preset.replace('_', ' ').toUpperCase()} loaded! Click ‚ñ∂Ô∏è to play.`);
        }

        function updateTechnoBPM(value) {
            technoBPM = parseInt(value);
            document.getElementById('technoBpmValue').textContent = value;
        }

        // Show notification helper
        function showTechnoNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: linear-gradient(135deg, #00ff00, #00ffff);
                color: #000;
                padding: 15px 25px;
                border-radius: 10px;
                box-shadow: 0 4px 20px rgba(0, 255, 0, 0.3);
                z-index: 9999;
                font-weight: bold;
                animation: slideIn 0.3s ease-out;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'fadeOut 0.3s ease-out';
                setTimeout(() => notification.remove(), 300);
            }, 2500);
        }

        // ============================================
        // RADIO INTEGRATION
        // ============================================
        
        /**
         * Export current techno track to Radio 24/7
         * Records the pattern and sends it to the radio queue
         */
        async function exportTechnoToRadio() {
            if (!hasActiveTechnoPattern() && technoSequence.length === 0) {
                alert('‚ö†Ô∏è Create a techno track first!\n\n1. Generate a melodic sequence\n2. Add drum pattern\n3. Click "Send to Radio"');
                return;
            }

            // Show progress
            const originalBtn = event.target;
            const originalText = originalBtn.innerHTML;
            originalBtn.innerHTML = 'üéôÔ∏è Recording...';
            originalBtn.disabled = true;

            try {
                // Record the pattern (8 bars)
                const audioBlob = await recordTechnoTrack();
                
                if (!audioBlob) {
                    throw new Error('Recording failed');
                }

                // Get track metadata
                const trackName = `Techno Track ${new Date().toLocaleTimeString()}`;
                const bpm = technoBPM;
                const instrument = currentTechnoInstrument;
                
                // Send to Radio 24/7
                const success = sendTechnoToRadio({
                    blob: audioBlob,
                    title: trackName,
                    artist: 'Techno Creator',
                    bpm: bpm,
                    instrument: instrument,
                    channel: 'techno' // Techno tracks go to Techno channel
                });

                if (success) {
                    originalBtn.innerHTML = '‚úÖ Sent to Radio!';
                    setTimeout(() => {
                        originalBtn.innerHTML = originalText;
                        originalBtn.disabled = false;
                    }, 2000);
                    
                    // Ask if user wants to open radio
                    if (confirm('üéâ Track sent to Techno Radio!\n\nOpen Radio 24/7 now?')) {
                        window.open('/radio.html', '_blank');
                    }
                } else {
                    throw new Error('Failed to send to radio');
                }
            } catch (error) {
                console.error('Export to radio error:', error);
                originalBtn.innerHTML = '‚ùå Failed';
                setTimeout(() => {
                    originalBtn.innerHTML = originalText;
                    originalBtn.disabled = false;
                }, 2000);
                alert('‚ùå Failed to send to radio. Make sure you have created a track first.');
            }
        }

        /**
         * Check if there's an active techno pattern
         */
        function hasActiveTechnoPattern() {
            return Object.values(technoPattern).some(track => track.some(step => step));
        }

        /**
         * Record the current techno track to audio blob
         */
        async function recordTechnoTrack() {
            return new Promise((resolve, reject) => {
                try {
                    // Initialize audio if needed
                    if (!audioContext) {
                        initAudio();
                    }
                    
                    // Create MediaStreamDestination for recording
                    const destination = audioContext.createMediaStreamDestination();
                    
                    // Start recording
                    const mediaRecorder = new MediaRecorder(destination.stream, {
                        mimeType: 'audio/webm;codecs=opus'
                    });
                    
                    const chunks = [];
                    
                    mediaRecorder.ondataavailable = (e) => {
                        if (e.data.size > 0) {
                            chunks.push(e.data);
                        }
                    };
                    
                    mediaRecorder.onstop = () => {
                        const blob = new Blob(chunks, { type: 'audio/webm' });
                        resolve(blob);
                    };
                    
                    mediaRecorder.onerror = (error) => {
                        reject(error);
                    };
                    
                    // Start recording
                    mediaRecorder.start();
                    
                    // Calculate recording duration (8 bars)
                    const barDuration = (60 / technoBPM) * 4 * 1000; // 4 beats per bar
                    const recordingDuration = barDuration * 8; // 8 bars
                    
                    // Play the pattern with recording destination
                    playTechnoPatternWithDestination(destination, recordingDuration);
                    
                    // Stop recording after duration
                    setTimeout(() => {
                        mediaRecorder.stop();
                    }, recordingDuration + 500); // Add 500ms buffer
                    
                } catch (error) {
                    reject(error);
                }
            });
        }

        /**
         * Play techno pattern with custom destination (for recording)
         */
        function playTechnoPatternWithDestination(destination, duration) {
            const stepTime = (60 / technoBPM) / 4; // 16th note duration in seconds
            let currentStep = 0;
            const totalSteps = Math.ceil(duration / (stepTime * 1000));
            
            const playStep = () => {
                if (currentStep >= totalSteps) return;
                
                const step = currentStep % 16;
                const time = audioContext.currentTime;
                
                // Play drums
                if (technoPattern.kick[step]) {
                    playTechnoKickWithDestination(time, destination);
                }
                if (technoPattern.hat[step]) {
                    playTechnoHatWithDestination(time, destination);
                }
                if (technoPattern.clap[step]) {
                    playTechnoClapWithDestination(time, destination);
                }
                if (technoPattern.perc[step]) {
                    playTechnoPercWithDestination(time, destination);
                }
                
                // Play melodic sequence
                if (technoSequence.length > 0 && step % 4 === 0) {
                    const noteIndex = Math.floor(step / 4) % technoSequence.length;
                    const note = technoSequence[noteIndex];
                    if (note && note.freq) {
                        playTechnoNoteWithDestination(note.freq, time, destination);
                    }
                }
                
                currentStep++;
                setTimeout(playStep, stepTime * 1000);
            };
            
            playStep();
        }

        /**
         * Play techno instruments with custom destination
         */
        function playTechnoKickWithDestination(time, destination) {
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            
            osc.connect(gain);
            gain.connect(destination);
            gain.connect(audioContext.destination);
            
            osc.frequency.setValueAtTime(150, time);
            osc.frequency.exponentialRampToValueAtTime(40, time + 0.5);
            gain.gain.setValueAtTime(1, time);
            gain.gain.exponentialRampToValueAtTime(0.01, time + 0.5);
            
            osc.start(time);
            osc.stop(time + 0.5);
        }

        function playTechnoHatWithDestination(time, destination) {
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            
            osc.type = 'square';
            osc.connect(gain);
            gain.connect(destination);
            gain.connect(audioContext.destination);
            
            osc.frequency.setValueAtTime(10000, time);
            gain.gain.setValueAtTime(0.3, time);
            gain.gain.exponentialRampToValueAtTime(0.01, time + 0.05);
            
            osc.start(time);
            osc.stop(time + 0.05);
        }

        function playTechnoClapWithDestination(time, destination) {
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            
            osc.type = 'square';
            osc.connect(gain);
            gain.connect(destination);
            gain.connect(audioContext.destination);
            
            osc.frequency.setValueAtTime(1000, time);
            gain.gain.setValueAtTime(0.5, time);
            gain.gain.exponentialRampToValueAtTime(0.01, time + 0.1);
            
            osc.start(time);
            osc.stop(time + 0.1);
        }

        function playTechnoPercWithDestination(time, destination) {
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            
            osc.type = 'triangle';
            osc.connect(gain);
            gain.connect(destination);
            gain.connect(audioContext.destination);
            
            osc.frequency.setValueAtTime(800, time);
            gain.gain.setValueAtTime(0.4, time);
            gain.gain.exponentialRampToValueAtTime(0.01, time + 0.15);
            
            osc.start(time);
            osc.stop(time + 0.15);
        }

        function playTechnoNoteWithDestination(freq, time, destination) {
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            const filter = audioContext.createBiquadFilter();
            
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(freq, time);
            
            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(2000, time);
            filter.Q.setValueAtTime(5, time);
            
            osc.connect(filter);
            filter.connect(gain);
            gain.connect(destination);
            gain.connect(audioContext.destination);
            
            gain.gain.setValueAtTime(0.3, time);
            gain.gain.exponentialRampToValueAtTime(0.01, time + 0.5);
            
            osc.start(time);
            osc.stop(time + 0.5);
        }

        /**
         * Send audio blob to Radio 24/7
         */
        function sendTechnoToRadio(trackData) {
            try {
                // Create a unique track object
                const track = {
                    id: Date.now() + Math.random(),
                    title: trackData.title,
                    artist: trackData.artist,
                    bpm: trackData.bpm,
                    instrument: trackData.instrument,
                    url: URL.createObjectURL(trackData.blob),
                    file: new File([trackData.blob], `${trackData.title}.webm`, { type: 'audio/webm' }),
                    channel: trackData.channel,
                    duration: 0, // Will be calculated by Radio
                    source: 'Techno Creator'
                };
                
                // Store in localStorage for Radio to pickup
                const radioQueue = localStorage.getItem('technoQueue');
                let queue = radioQueue ? JSON.parse(radioQueue) : [];
                
                // Add metadata (note: blob URLs can't be persisted)
                queue.push({
                    id: track.id,
                    title: track.title,
                    artist: track.artist,
                    bpm: track.bpm,
                    instrument: track.instrument,
                    channel: track.channel,
                    source: track.source,
                    timestamp: new Date().toISOString()
                });
                
                localStorage.setItem('technoQueue', JSON.stringify(queue));
                
                // Also send via postMessage if Radio is open
                if (window.opener || window.parent !== window) {
                    window.postMessage({
                        type: 'ADD_TO_RADIO',
                        track: track
                    }, '*');
                }
                
                // Dispatch custom event for same-window communication
                window.dispatchEvent(new CustomEvent('technoCreatorTrackExport', {
                    detail: track
                }));
                
                return true;
            } catch (error) {
                console.error('Failed to send to radio:', error);
                return false;
            }
        }

        // ============================================
        // INTELLIGENT TECHNO GENERATOR - EXPERT MODE
        // ============================================
        
        /**
         * Generate an intelligent techno pattern based on style, complexity, and instruments
         */
        function generateIntelligentTechno() {
            const genre = document.getElementById('technoGenreStyle').value;
            const complexity = document.getElementById('technoComplexityLevel').value;
            const energy = parseInt(document.getElementById('technoEnergyLevel').value);
            
            // Get active instruments
            const instruments = {
                kick: document.getElementById('techno_inst_kick').checked,
                snare: document.getElementById('techno_inst_snare').checked,
                hihat: document.getElementById('techno_inst_hihat').checked,
                perc: document.getElementById('techno_inst_perc').checked
            };
            
            console.log(`Generating ${genre} techno | Complexity: ${complexity} | Energy: ${energy}`);
            
            // Clear current pattern
            clearTechnoPattern();
            
            // Generate BPM based on genre and energy
            const bpm = calculateTechnoBPM(genre, energy);
            document.getElementById('technoBPM').value = bpm;
            // Update BPM display if function exists
            if (typeof updateTechnoBPM === 'function') {
                updateTechnoBPM(bpm);
            }
            
            // Generate patterns for each active instrument
            if (instruments.kick) {
                const kickPattern = selectTechnoKickPattern(genre, complexity, energy);
                loadTechnoKickPattern(kickPattern);
            }
            
            if (instruments.hihat) {
                const hihatPattern = selectTechnoHiHatPattern(genre, complexity, energy);
                loadTechnoHatPattern(hihatPattern);
            }
            
            // Play preview
            setTimeout(() => {
                playTechnoPattern();
            }, 300);
            
            // Show notification
            showTechnoGenerationNotification(genre, complexity);
        }
        
        /**
         * Calculate BPM for techno genre
         */
        function calculateTechnoBPM(genre, energy) {
            const bpmRanges = {
                'detroit': { min: 120, max: 130 },
                'minimal': { min: 125, max: 135 },
                'industrial': { min: 135, max: 150 },
                'acid': { min: 130, max: 145 },
                'hard': { min: 140, max: 155 },
                'tribal': { min: 125, max: 140 },
                'progressive': { min: 128, max: 138 }
            };
            
            const range = bpmRanges[genre] || { min: 128, max: 135 };
            const bpm = Math.round(range.min + (range.max - range.min) * (energy / 10));
            return bpm;
        }
        
        /**
         * Select techno kick pattern based on parameters
         */
        function selectTechnoKickPattern(genre, complexity, energy) {
            const patterns = {
                'detroit': {
                    minimal: 'four-floor',
                    simple: 'four-floor',
                    moderate: 'hard',
                    complex: 'double',
                    chaotic: 'offbeat'
                },
                'minimal': {
                    minimal: 'minimal',
                    simple: 'minimal',
                    moderate: 'four-floor',
                    complex: 'offbeat',
                    chaotic: 'double'
                },
                'industrial': {
                    minimal: 'hard',
                    simple: 'industrial',
                    moderate: 'industrial',
                    complex: 'double',
                    chaotic: 'acid'
                },
                'acid': {
                    minimal: 'four-floor',
                    simple: 'acid',
                    moderate: 'acid',
                    complex: 'offbeat',
                    chaotic: 'double'
                },
                'hard': {
                    minimal: 'hard',
                    simple: 'hard',
                    moderate: 'industrial',
                    complex: 'double',
                    chaotic: 'acid'
                },
                'tribal': {
                    minimal: 'four-floor',
                    simple: 'tribal',
                    moderate: 'tribal',
                    complex: 'offbeat',
                    chaotic: 'double'
                },
                'progressive': {
                    minimal: 'minimal',
                    simple: 'four-floor',
                    moderate: 'offbeat',
                    complex: 'double',
                    chaotic: 'hard'
                }
            };
            
            return patterns[genre]?.[complexity] || 'four-floor';
        }
        
        /**
         * Select techno hi-hat pattern based on parameters
         */
        function selectTechnoHiHatPattern(genre, complexity, energy) {
            const patterns = {
                'detroit': {
                    minimal: 'closed',
                    simple: 'closed',
                    moderate: '16ths',
                    complex: 'rolling',
                    chaotic: 'syncopated'
                },
                'minimal': {
                    minimal: 'minimal',
                    simple: 'minimal',
                    moderate: 'closed',
                    complex: 'offbeat',
                    chaotic: '16ths'
                },
                'industrial': {
                    minimal: 'closed',
                    simple: 'industrial',
                    moderate: 'industrial',
                    complex: '16ths',
                    chaotic: 'rolling'
                },
                'acid': {
                    minimal: 'closed',
                    simple: 'offbeat',
                    moderate: '16ths',
                    complex: 'rolling',
                    chaotic: 'syncopated'
                },
                'hard': {
                    minimal: 'closed',
                    simple: '16ths',
                    moderate: 'industrial',
                    complex: 'rolling',
                    chaotic: 'syncopated'
                },
                'tribal': {
                    minimal: 'minimal',
                    simple: 'offbeat',
                    moderate: 'syncopated',
                    complex: 'rolling',
                    chaotic: '16ths'
                },
                'progressive': {
                    minimal: 'minimal',
                    simple: 'closed',
                    moderate: 'offbeat',
                    complex: '16ths',
                    chaotic: 'rolling'
                }
            };
            
            return patterns[genre]?.[complexity] || 'closed';
        }
        
        /**
         * Show techno generation notification
         */
        function showTechnoGenerationNotification(genre, complexity) {
            const notif = document.createElement('div');
            notif.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 20px 30px;
                background: linear-gradient(135deg, var(--accent-cyan), #00ffff);
                color: #000;
                border-radius: 10px;
                box-shadow: 0 10px 30px rgba(0, 255, 255, 0.5);
                z-index: 10000;
                font-weight: bold;
                animation: slideInRight 0.3s ease-out;
            `;
            notif.innerHTML = `üß† Generated ${genre.toUpperCase()} techno<br><small style="opacity:0.8">${complexity} complexity</small>`;
            document.body.appendChild(notif);
            setTimeout(() => {
                notif.style.animation = 'slideOutRight 0.3s ease-out';
                setTimeout(() => document.body.removeChild(notif), 300);
            }, 3000);
        }
        
        /**
         * Load techno pattern combination presets
         */
        function loadTechnoCombo(comboName) {
            const combos = {
                'four-floor-classic': {
                    kick: 'four-floor',
                    hihat: 'closed',
                    bpm: 128
                },
                'minimal-groove': {
                    kick: 'minimal',
                    hihat: 'minimal',
                    bpm: 130
                },
                'industrial-assault': {
                    kick: 'industrial',
                    hihat: 'industrial',
                    bpm: 145
                },
                'acid-rave': {
                    kick: 'acid',
                    hihat: '16ths',
                    bpm: 138
                },
                'tribal-ritual': {
                    kick: 'tribal',
                    hihat: 'syncopated',
                    bpm: 132
                },
                'progressive-journey': {
                    kick: 'offbeat',
                    hihat: 'rolling',
                    bpm: 133
                }
            };
            
            const combo = combos[comboName];
            if (!combo) return;
            
            // Set BPM
            document.getElementById('technoBPM').value = combo.bpm;
            if (typeof updateTechnoBPM === 'function') {
                updateTechnoBPM(combo.bpm);
            }
            
            // Load patterns
            loadTechnoKickPattern(combo.kick);
            loadTechnoHatPattern(combo.hihat);
            
            // Play preview
            setTimeout(() => playTechnoPattern(), 200);
            
            console.log(`Loaded techno combo: ${comboName}`);
        }
        
        /**
         * Randomize techno kick pattern
         */
        function randomizeTechnoKickPattern() {
            const patterns = ['four-floor', 'hard', 'offbeat', 'double', 'minimal', 'tribal', 'acid', 'industrial'];
            const random = patterns[Math.floor(Math.random() * patterns.length)];
            loadTechnoKickPattern(random);
        }
        
        /**
         * Randomize techno hi-hat pattern
         */
        function randomizeTechnoHiHatPattern() {
            const patterns = ['closed', 'open', '16ths', 'offbeat', 'minimal', 'rolling', 'syncopated', 'industrial'];
            const random = patterns[Math.floor(Math.random() * patterns.length)];
            loadTechnoHatPattern(random);
        }
        
        /**
         * Randomize all techno patterns
         */
        function randomizeAllTechnoPatterns() {
            randomizeTechnoKickPattern();
            setTimeout(() => randomizeTechnoHiHatPattern(), 100);
            setTimeout(() => playTechnoPattern(), 300);
        }

        // Initialize sequencer on load
        window.addEventListener('DOMContentLoaded', () => {
            initTechnoSequencer();
            
            // First-time user detection for techno
            const hasVisited = localStorage.getItem('techno-creator-visited');
            if (!hasVisited) {
                setTimeout(() => {
                    if (confirm('‚ö° Welcome to Techno Creator! Would you like a quick tour of the features?')) {
                        startTechnoTutorial();
                    }
                }, 2000);
                localStorage.setItem('techno-creator-visited', 'true');
            }
        });

        // ============================================
        // TECHNO INTERACTIVE FEATURES
        // ============================================
        
        function startTechnoTutorial() {
            const steps = [
                {
                    title: "‚ö° Welcome to Techno Creator!",
                    text: "Industrial-grade techno production with live guidance!"
                },
                {
                    title: "üéπ Sequence Generator",
                    text: "Generate hypnotic acid basslines and minimal progressions",
                    element: ".tool-section"
                },
                {
                    title: "‚ö° Live Guidance",
                    text: "Follow the 7-step workflow in the guidance panel",
                    element: "#guidancePanel"
                },
                {
                    title: "üî• Pattern Types",
                    text: "Choose from Acid, Minimal, Hard, Industrial, Detroit, or Dub Techno",
                    element: "#technoPatternType"
                },
                {
                    title: "üéµ BPM Styles",
                    text: "Adjust BPM and watch the style change from Dub Techno (120) to Hardcore (150+)",
                    element: "#technoBPM"
                },
                {
                    title: "‚úÖ Ready to Create!",
                    text: "Start making industrial techno tracks now!"
                }
            ];
            
            showTechnoTutorialStep(0, steps);
        }

        let technoTutorialStep = 0;
        function showTechnoTutorialStep(index, steps) {
            if (index >= steps.length) {
                showTechnoAchievement("Tutorial Complete!", "Create hypnotic techno! ‚ö°");
                return;
            }
            
            const step = steps[index];
            const confirmed = confirm(`${step.title}\n\n${step.text}\n\n${index < steps.length - 1 ? '‚ñ∂ Click OK for next step' : '‚úì Click OK to finish'}`);
            
            if (confirmed && index < steps.length - 1) {
                showTechnoTutorialStep(index + 1, steps);
            }
        }

        function showTechnoAchievement(title, text) {
            const achievement = document.createElement('div');
            achievement.className = 'achievement';
            achievement.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: linear-gradient(135deg, #00ff00, #00cc00);
                color: #000;
                padding: 20px;
                border-radius: 5px;
                box-shadow: 0 0 30px rgba(0, 255, 0, 0.5);
                z-index: 9999;
                transform: translateX(400px);
                transition: transform 0.5s ease;
                min-width: 300px;
                font-family: 'Courier New', monospace;
                font-weight: bold;
            `;
            achievement.innerHTML = `
                <div style="font-size: 1.2em; margin-bottom: 5px;">üèÜ ${title}</div>
                <div style="font-size: 0.9em;">${text}</div>
            `;
            
            document.body.appendChild(achievement);
            setTimeout(() => achievement.style.transform = 'translateX(0)', 100);
            setTimeout(() => {
                achievement.style.transform = 'translateX(400px)';
                setTimeout(() => achievement.remove(), 500);
            }, 3000);
        }

        // Achievement tracking for techno
        let technoAchievements = {
            firstSequence: false,
            firstLoop: false,
            firstRadio: false
        };

        const savedTechnoAchievements = localStorage.getItem('techno-achievements');
        if (savedTechnoAchievements) {
            technoAchievements = JSON.parse(savedTechnoAchievements);
        }

        function checkTechnoAchievement(type) {
            if (!technoAchievements[type]) {
                technoAchievements[type] = true;
                switch(type) {
                    case 'firstSequence':
                        showTechnoAchievement("Sequence Generated!", "Your first techno sequence! üéµ");
                        break;
                    case 'firstLoop':
                        showTechnoAchievement("Loop Playing!", "Hypnotic techno groove! ‚ö°");
                        break;
                    case 'firstRadio':
                        showTechnoAchievement("Broadcasting!", "Live on Techno Radio 24/7! üìª");
                        break;
                }
                localStorage.setItem('techno-achievements', JSON.stringify(technoAchievements));
            }
        }

        // Enhance existing functions with achievements
        const originalGenerateTechnoSequence = window.generateTechnoSequence;
        window.generateTechnoSequence = function() {
            if (originalGenerateTechnoSequence) originalGenerateTechnoSequence();
            checkTechnoAchievement('firstSequence');
        };

        const originalPlayTechnoLoop = window.playTechnoLoop;
        window.playTechnoLoop = function() {
            if (originalPlayTechnoLoop) originalPlayTechnoLoop();
            checkTechnoAchievement('firstLoop');
        };

        const originalExportTechnoToRadio = window.exportTechnoToRadio;
        window.exportTechnoToRadio = function() {
            if (originalExportTechnoToRadio) originalExportTechnoToRadio();
            checkTechnoAchievement('firstRadio');
        };

        // ============================================
        // TECHNO PRESET SYSTEM
        // ============================================
        
        let technoPresets = {};
        
        function saveTechnoPreset(slot) {
            const presetName = prompt(`üíæ Name your techno preset (Slot ${slot}):`, `Techno ${slot}`);
            if (!presetName) return;
            
            const preset = {
                name: presetName,
                timestamp: new Date().toISOString(),
                parameters: {
                    bpm: parseInt(document.getElementById('technoBPM')?.value || 128),
                    acidFreq: parseInt(document.getElementById('acidFreq')?.value || 110),
                    acidRes: parseFloat(document.getElementById('acidRes')?.value || 0.7),
                    // Add more techno-specific parameters
                }
            };
            
            technoPresets[`slot${slot}`] = preset;
            localStorage.setItem('techno-presets', JSON.stringify(technoPresets));
            showTechnoToast(`‚úÖ Preset "${presetName}" saved!`, 'success');
        }

        function loadTechnoPreset(slot) {
            const preset = technoPresets[`slot${slot}`];
            if (!preset) {
                showTechnoToast(`‚ùå No preset in slot ${slot}`, 'error');
                return;
            }
            
            const params = preset.parameters;
            if (document.getElementById('technoBPM')) {
                document.getElementById('technoBPM').value = params.bpm || 128;
            }
            // Load other parameters...
            
            showTechnoToast(`‚úÖ Loaded "${preset.name}"`, 'success');
        }

        function showTechnoToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 25px;
                background: ${type === 'success' ? '#00ff00' : type === 'error' ? '#ff00ff' : '#00ffff'};
                color: #000;
                border-radius: 8px;
                font-weight: bold;
                box-shadow: 0 0 30px rgba(0, 255, 0, 0.7);
                z-index: 10000;
                font-family: 'Courier New', monospace;
                animation: slideIn 0.3s ease;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        const savedTechnoPresets = localStorage.getItem('techno-presets');
        if (savedTechnoPresets) {
            technoPresets = JSON.parse(savedTechnoPresets);
        }

        // ============================================
        // TECHNO KEYBOARD SHORTCUTS
        // ============================================
        
        const technoShortcuts = {
            ' ': () => { // Space - Play/Pause
                const playBtn = document.querySelector('button[onclick*="playTechno"]');
                if (playBtn) playBtn.click();
            },
            's': (e) => { // S - Save preset
                if (e.ctrlKey || e.metaKey) return;
                const slot = prompt('Save to slot (1-9):', '1');
                if (slot && /^[1-9]$/.test(slot)) {
                    saveTechnoPreset(parseInt(slot));
                }
            },
            'g': () => { // G - Generate sequence
                const genBtn = document.querySelector('button[onclick*="generate"]');
                if (genBtn) genBtn.click();
            },
            'h': () => { // H - Show help
                alert(`‚ö° TECHNO KEYBOARD SHORTCUTS:

SPACE     - Play/Pause
S         - Save preset
G         - Generate sequence
1-9       - Load preset
H         - Show this help
ESC       - Close modals`);
            }
        };

        // Number keys for techno presets
        for (let i = 1; i <= 9; i++) {
            technoShortcuts[i.toString()] = () => loadTechnoPreset(i);
        }

        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
            
            const handler = technoShortcuts[e.key];
            if (handler) {
                e.preventDefault();
                handler(e);
            }
        });
    </script>

    <!-- Tour Button for Techno -->
    <button id="technoTourButton" class="tour-button" onclick="startTechnoTutorial()" 
            style="position: fixed; bottom: 100px; left: 20px; background: linear-gradient(135deg, #00ff00, #00ffff); color: #000; padding: 15px 25px; border-radius: 50px; border: none; font-weight: bold; font-size: 1em; cursor: pointer; box-shadow: 0 0 20px rgba(0, 255, 0, 0.5); z-index: 999; font-family: 'Courier New', monospace; display: none;">
        ‚ö° TAKE TOUR
    </button>

    <!-- Techno Quick Actions -->
    <div style="position: fixed; bottom: 20px; right: 20px; display: flex; flex-direction: column; gap: 10px; z-index: 998;">
        <button onclick="saveTechnoPreset(prompt('Slot (1-9):', '1'))" 
                style="padding: 15px 25px; background: linear-gradient(135deg, #00ff00, #00ffff); color: #000; border: none; border-radius: 50px; font-weight: bold; cursor: pointer; box-shadow: 0 0 20px rgba(0, 255, 0, 0.5); font-family: 'Courier New', monospace;">
            üíæ SAVE
        </button>
        <button onclick="alert('‚ö° TECHNO TIPS:\\n\\nBPM: 128-135 for classic techno\\n140-150 for hard techno\\n\\nAcid bass: High resonance = classic 303 sound\\n\\nPattern length: 16-32 steps for hypnotic loops')" 
                style="padding: 15px 25px; background: linear-gradient(135deg, #ff00ff, #00ffff); color: #000; border: none; border-radius: 50px; font-weight: bold; cursor: pointer; box-shadow: 0 0 20px rgba(255, 0, 255, 0.5); font-family: 'Courier New', monospace;">
            üí° TIPS
        </button>
    </div>

    <!-- Keyboard Shortcuts Panel for Techno -->
    <div style="position: fixed; bottom: 160px; left: 20px; background: #1a1a1a; border: 2px solid #00ff00; border-radius: 12px; padding: 15px; max-width: 250px; box-shadow: 0 0 30px rgba(0, 255, 0, 0.3); z-index: 999; font-family: 'Courier New', monospace; font-size: 0.85em;" id="technoShortcuts">
        <h3 style="color: #00ff00; margin-bottom: 10px; font-size: 1.1em; cursor: pointer;" onclick="this.parentElement.style.height = this.parentElement.style.height === '45px' ? 'auto' : '45px'">
            ‚å®Ô∏è SHORTCUTS ‚ñº
        </h3>
        <div>
            <div style="display: flex; justify-content: space-between; margin: 5px 0; padding: 5px 0; border-bottom: 1px solid #333;">
                <span style="background: #0a0a0a; color: #00ff00; padding: 2px 8px; border-radius: 4px; font-weight: bold;">SPACE</span>
                <span style="color: #00cc00;">Play</span>
            </div>
            <div style="display: flex; justify-content: space-between; margin: 5px 0; padding: 5px 0; border-bottom: 1px solid #333;">
                <span style="background: #0a0a0a; color: #00ff00; padding: 2px 8px; border-radius: 4px; font-weight: bold;">S</span>
                <span style="color: #00cc00;">Save</span>
            </div>
            <div style="display: flex; justify-content: space-between; margin: 5px 0; padding: 5px 0; border-bottom: 1px solid #333;">
                <span style="background: #0a0a0a; color: #00ff00; padding: 2px 8px; border-radius: 4px; font-weight: bold;">G</span>
                <span style="color: #00cc00;">Generate</span>
            </div>
            <div style="display: flex; justify-content: space-between; margin: 5px 0; padding: 5px 0; border-bottom: 1px solid #333;">
                <span style="background: #0a0a0a; color: #00ff00; padding: 2px 8px; border-radius: 4px; font-weight: bold;">1-9</span>
                <span style="color: #00cc00;">Load</span>
            </div>
            <div style="display: flex; justify-content: space-between; margin: 5px 0; padding: 5px 0;">
                <span style="background: #0a0a0a; color: #00ff00; padding: 2px 8px; border-radius: 4px; font-weight: bold;">H</span>
                <span style="color: #00cc00;">Help</span>
            </div>
        </div>
    </div>

    <!-- Theme Manager Script -->
    <script src="/js/theme-manager.js"></script>
    <script>
        // Initialize theme manager
        const themeManager = new ThemeManager({
            toggleButtonId: 'theme-toggle',
            showToast: true
        });
        themeManager.init();
    </script>

</body>
</html>

