<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="description" content="Professional Techno Production Studio - Acid basslines, industrial percussion, minimal patterns">
    <meta name="theme-color" content="#0a0a0a">
    
    <!-- iOS Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Techno Creator">
    
    <title>‚ö° Techno Production Studio ‚ö°</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Industrial Techno Theme */
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --bg-tertiary: #2a2a2a;
            --accent-primary: #00ff00;
            --accent-secondary: #ff00ff;
            --accent-cyan: #00ffff;
            --text-primary: #00ff00;
            --text-secondary: #00cc00;
            --success: #00ff00;
            --warning: #ffff00;
            --border: #333;
            --glow: rgba(0, 255, 0, 0.5);
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Animated Scanline Effect */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 255, 0, 0.03) 0px,
                transparent 1px,
                transparent 2px,
                rgba(0, 255, 0, 0.03) 3px
            );
            animation: scanline 8s linear infinite;
            pointer-events: none;
            z-index: 1000;
        }

        @keyframes scanline {
            0% { transform: translateY(0); }
            100% { transform: translateY(100%); }
        }

        /* Header */
        .header {
            position: relative;
            z-index: 10;
            background: var(--bg-secondary);
            border-bottom: 2px solid var(--accent-primary);
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            color: var(--accent-primary);
            text-shadow: 
                0 0 10px var(--glow),
                0 0 20px var(--glow),
                0 0 30px var(--glow);
            margin-bottom: 10px;
            animation: flicker 3s ease-in-out infinite;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }

        @keyframes flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
            51% { opacity: 1; }
            52% { opacity: 0.85; }
            53% { opacity: 1; }
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.1em;
        }

        /* Main Container */
        .container {
            position: relative;
            z-index: 5;
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
        }

        /* Navigation */
        .nav-menu {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-menu a {
            color: var(--text-primary);
            text-decoration: none;
            padding: 12px 24px;
            background: var(--bg-tertiary);
            border: 1px solid var(--accent-primary);
            border-radius: 5px;
            transition: all 0.3s;
            font-weight: bold;
        }

        .nav-menu a:hover {
            background: var(--accent-primary);
            color: var(--bg-primary);
            box-shadow: 0 0 20px var(--glow);
        }

        /* Tool Sections */
        .tool-section {
            background: var(--bg-secondary);
            border: 2px solid var(--accent-primary);
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 
                0 0 20px rgba(0, 255, 0, 0.2),
                inset 0 0 20px rgba(0, 255, 0, 0.05);
        }

        .tool-section h2 {
            color: var(--accent-primary);
            margin-bottom: 15px;
            font-size: 1.8em;
            text-shadow: 0 0 10px var(--glow);
        }

        .tool-section h3 {
            color: var(--accent-cyan);
            margin: 20px 0 10px 0;
            font-size: 1.3em;
        }

        /* Form Controls */
        .control-group {
            margin: 15px 0;
        }

        .control-group label {
            display: block;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-weight: bold;
        }

        select, input[type="range"] {
            width: 100%;
            padding: 12px;
            background: var(--bg-primary);
            color: var(--text-primary);
            border: 1px solid var(--accent-primary);
            border-radius: 5px;
            font-family: 'Courier New', monospace;
        }

        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            background: var(--bg-tertiary);
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--accent-primary);
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 0 10px var(--glow);
        }

        /* Buttons */
        .btn {
            padding: 12px 30px;
            background: linear-gradient(135deg, var(--accent-primary), #00cc00);
            color: var(--bg-primary);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0, 255, 0, 0.3);
            font-family: 'Courier New', monospace;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--glow);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--bg-tertiary), var(--border));
            color: var(--text-primary);
            border: 1px solid var(--accent-primary);
        }

        .btn-magenta {
            background: linear-gradient(135deg, var(--accent-secondary), #cc00cc);
        }

        .btn-cyan {
            background: linear-gradient(135deg, var(--accent-cyan), #00cccc);
        }

        /* Output Box */
        .output-box {
            background: var(--bg-primary);
            border: 1px solid var(--accent-primary);
            border-radius: 5px;
            padding: 20px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            max-height: 400px;
            overflow-y: auto;
        }

        .output-box pre {
            color: var(--accent-primary);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* Sequencer Grid */
        .sequencer-grid {
            display: grid;
            gap: 5px;
            margin: 20px 0;
            background: var(--bg-primary);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--accent-primary);
        }

        .sequencer-row {
            display: grid;
            grid-template-columns: 100px repeat(16, 1fr);
            gap: 3px;
            align-items: center;
        }

        .instrument-label {
            color: var(--text-primary);
            font-weight: bold;
            padding: 10px;
            background: var(--bg-tertiary);
            border-radius: 5px;
            text-align: center;
            border: 1px solid var(--accent-primary);
        }

        .step {
            aspect-ratio: 1;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .step.active {
            background: var(--accent-primary);
            box-shadow: 0 0 10px var(--glow);
        }

        .step:hover {
            border-color: var(--accent-primary);
        }

        /* Chord Display */
        .chord-display {
            background: var(--bg-primary);
            border: 1px solid var(--accent-primary);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .chord-item {
            padding: 15px;
            margin: 10px 0;
            background: var(--bg-tertiary);
            border-left: 3px solid var(--accent-primary);
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chord-name {
            font-size: 1.5em;
            color: var(--accent-primary);
            font-weight: bold;
        }

        .chord-notes {
            color: var(--text-secondary);
            font-family: 'Courier New', monospace;
        }

        /* Waveform Canvas */
        canvas {
            width: 100%;
            height: 200px;
            background: var(--bg-primary);
            border: 1px solid var(--accent-primary);
            border-radius: 5px;
            margin-top: 15px;
        }

        /* Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animated {
            animation: slideIn 0.5s ease-out;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .sequencer-row {
                grid-template-columns: 80px repeat(16, 1fr);
            }

            .tool-section {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>‚ö° TECHNO PRODUCTION STUDIO ‚ö°</h1>
        <p>[ HARD ‚Ä¢ ACID ‚Ä¢ MINIMAL ‚Ä¢ INDUSTRIAL ‚Ä¢ DETROIT ‚Ä¢ DUB ]</p>
    </div>

    <div class="container">
        <!-- Navigation -->
        <div class="nav-menu">
            <a href="/">üè† Home</a>
            <a href="/trap-studio">üî• Trap Studio</a>
            <a href="/techno-creator" style="background: var(--accent-primary); color: var(--bg-primary);">‚ö° Techno Creator</a>
        </div>

        <!-- Techno Chord/Sequence Generator -->
        <div class="tool-section animated">
            <h2>üéπ TECHNO SEQUENCE GENERATOR</h2>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                Generate hypnotic sequences and minimal progressions for various techno subgenres
            </p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                <!-- Key Selection -->
                <div class="control-group">
                    <label for="technoKey">Root Note:</label>
                    <select id="technoKey">
                        <option value="C">C</option>
                        <option value="C#">C# / Db</option>
                        <option value="D">D</option>
                        <option value="D#">D# / Eb</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="F#">F# / Gb</option>
                        <option value="G">G</option>
                        <option value="G#">G# / Ab</option>
                        <option value="A" selected>A</option>
                        <option value="A#">A# / Bb</option>
                        <option value="B">B</option>
                    </select>
                </div>

                <!-- Scale Type -->
                <div class="control-group">
                    <label for="technoScale">Scale/Mode:</label>
                    <select id="technoScale">
                        <option value="minor" selected>Natural Minor (Aeolian)</option>
                        <option value="phrygian">Phrygian (Dark)</option>
                        <option value="dorian">Dorian (Groovy)</option>
                        <option value="minor_penta">Minor Pentatonic</option>
                        <option value="harmonic">Harmonic Minor</option>
                    </select>
                </div>

                <!-- Subgenre -->
                <div class="control-group">
                    <label for="technoSubgenre">Techno Subgenre:</label>
                    <select id="technoSubgenre">
                        <option value="hard_techno">Hard Techno (Fast, Aggressive)</option>
                        <option value="acid_techno" selected>Acid Techno (303 Style)</option>
                        <option value="minimal">Minimal Techno (Hypnotic)</option>
                        <option value="industrial">Industrial Techno (Dark)</option>
                        <option value="detroit">Detroit Techno (Classic)</option>
                        <option value="dub_techno">Dub Techno (Deep)</option>
                    </select>
                </div>
            </div>

            <!-- Generate Buttons -->
            <div style="margin: 20px 0; display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
                <button class="btn" onclick="generateTechnoSequence()">
                    ‚ö° Generate Sequence
                </button>
                <button class="btn btn-secondary" onclick="playTechnoSequence()">
                    ‚ñ∂Ô∏è Play Preview
                </button>
                <button class="btn btn-cyan" onclick="randomizeTechnoSequence()">
                    üé≤ Randomize
                </button>
            </div>

            <!-- Instrument Selection -->
            <div style="margin: 15px 0; padding: 15px; background: var(--bg-tertiary); border-radius: 10px; border: 1px solid var(--accent-primary);">
                <p style="color: var(--text-secondary); margin-bottom: 10px; font-size: 0.9em;">
                    üéõÔ∏è SELECT SYNTHESIS ENGINE:
                </p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                    <button class="btn btn-secondary" onclick="setTechnoInstrument('enhanced')" id="inst-enhanced_techno" style="padding: 8px 12px; font-size: 0.85em; background: linear-gradient(135deg, var(--accent-primary), var(--accent-cyan)); color: #000; font-weight: bold; border: 2px solid var(--accent-cyan);">
                        ‚ö° ENHANCED
                    </button>
                    <button class="btn btn-secondary" onclick="setTechnoInstrument('acid_bass')" id="inst-acid_bass" style="padding: 8px 12px; font-size: 0.85em; border: 2px solid var(--accent-primary);">
                        üîä Acid Bass (303)
                    </button>
                    <button class="btn btn-secondary" onclick="setTechnoInstrument('minimal_stab')" id="inst-minimal_stab" style="padding: 8px 12px; font-size: 0.85em;">
                        üéπ Minimal Stab
                    </button>
                    <button class="btn btn-secondary" onclick="setTechnoInstrument('dub_chord')" id="inst-dub_chord" style="padding: 8px 12px; font-size: 0.85em;">
                        üåä Dub Chord
                    </button>
                    <button class="btn btn-secondary" onclick="setTechnoInstrument('industrial_drone')" id="inst-industrial_drone" style="padding: 8px 12px; font-size: 0.85em;">
                        ‚öôÔ∏è Industrial Drone
                    </button>
                    <button class="btn btn-secondary" onclick="setTechnoInstrument('detroit_pad')" id="inst-detroit_pad" style="padding: 8px 12px; font-size: 0.85em;">
                        üèôÔ∏è Detroit Pad
                    </button>
                    <button class="btn btn-secondary" onclick="setTechnoInstrument('perc_synth')" id="inst-perc_synth" style="padding: 8px 12px; font-size: 0.85em;">
                        ü•Å Perc Synth
                    </button>
                </div>
            </div>

            <!-- Advanced Controls -->
            <div style="margin: 15px 0; padding: 15px; background: var(--bg-tertiary); border-radius: 10px; border: 1px solid var(--accent-primary);">
                <p style="color: var(--text-secondary); margin-bottom: 10px; font-size: 0.9em;">
                    ‚öôÔ∏è MODULATION & EFFECTS:
                </p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <!-- Acid Parameters -->
                    <div>
                        <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                            üéõÔ∏è Filter Resonance: <span id="resonanceValue">70</span>%
                        </label>
                        <input type="range" id="resonanceControl" min="0" max="100" value="70" 
                               oninput="document.getElementById('resonanceValue').textContent = this.value"
                               style="width: 100%;">
                    </div>

                    <!-- Filter Cutoff -->
                    <div>
                        <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                            üîß Filter Cutoff: <span id="cutoffValue">500</span> Hz
                        </label>
                        <input type="range" id="cutoffControl" min="100" max="5000" value="500" 
                               oninput="document.getElementById('cutoffValue').textContent = this.value"
                               style="width: 100%;">
                    </div>

                    <!-- Glide/Portamento -->
                    <div>
                        <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                            üéµ Glide Time: <span id="glideValue">50</span> ms
                        </label>
                        <input type="range" id="glideControl" min="0" max="200" value="50" 
                               oninput="document.getElementById('glideValue').textContent = this.value"
                               style="width: 100%;">
                    </div>

                    <!-- Distortion -->
                    <div>
                        <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                            üî• Distortion: <span id="distortionValue">30</span>%
                        </label>
                        <input type="range" id="distortionControl" min="0" max="100" value="30" 
                               oninput="document.getElementById('distortionValue').textContent = this.value"
                               style="width: 100%;">
                    </div>
                </div>

                <!-- Effect Toggles -->
                <div style="margin-top: 15px; display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                    <label style="display: flex; align-items: center; color: var(--text-secondary); font-size: 0.85em; cursor: pointer;">
                        <input type="checkbox" id="delayToggle" checked style="margin-right: 8px;">
                        ‚è±Ô∏è Delay
                    </label>
                    <label style="display: flex; align-items: center; color: var(--text-secondary); font-size: 0.85em; cursor: pointer;">
                        <input type="checkbox" id="reverbToggle" checked style="margin-right: 8px;">
                        üåä Reverb
                    </label>
                    <label style="display: flex; align-items: center; color: var(--text-secondary); font-size: 0.85em; cursor: pointer;">
                        <input type="checkbox" id="lfoToggle" checked style="margin-right: 8px;">
                        „Ä∞Ô∏è LFO Modulation
                    </label>
                </div>
            </div>

            <!-- Advanced Synthesis Engine -->
            <div style="margin: 15px 0; padding: 20px; background: linear-gradient(135deg, rgba(0, 255, 0, 0.1), rgba(255, 0, 255, 0.1)); border: 2px solid var(--accent-primary); border-radius: 10px;">
                <h3 style="color: var(--accent-cyan); margin-bottom: 15px; font-size: 1.1em; text-align: center;">
                    ‚ö° ADVANCED SYNTHESIS ENGINE ‚ö°
                </h3>
                
                <!-- Oscillator Section -->
                <div style="margin-bottom: 15px; padding: 15px; background: rgba(0,0,0,0.5); border-radius: 8px; border: 1px solid var(--border);">
                    <p style="color: var(--accent-primary); margin-bottom: 10px; font-size: 0.95em; font-weight: bold;">
                        >>> OSCILLATOR <<<
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px;">
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Waveform:
                            </label>
                            <select id="technoWaveform" class="form-control" style="width: 100%; padding: 6px; background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--accent-primary); border-radius: 5px; font-family: 'Courier New', monospace;">
                                <option value="sine">SINE</option>
                                <option value="triangle">TRIANGLE</option>
                                <option value="sawtooth" selected>SAWTOOTH</option>
                                <option value="square">SQUARE</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Unison: <span id="technoUnisonValue">3</span>
                            </label>
                            <input type="range" id="technoUnison" min="1" max="7" value="3" step="2"
                                   oninput="document.getElementById('technoUnisonValue').textContent = this.value"
                                   style="width: 100%;">
                        </div>
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Detune: <span id="technoDetuneValue">10</span> cents
                            </label>
                            <input type="range" id="technoDetune" min="0" max="50" value="10"
                                   oninput="document.getElementById('technoDetuneValue').textContent = this.value"
                                   style="width: 100%;">
                        </div>
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Harmonics: <span id="technoHarmonicsValue">3</span>
                            </label>
                            <input type="range" id="technoHarmonics" min="0" max="5" value="3"
                                   oninput="document.getElementById('technoHarmonicsValue').textContent = this.value"
                                   style="width: 100%;">
                        </div>
                    </div>
                </div>

                <!-- Filter Section -->
                <div style="margin-bottom: 15px; padding: 15px; background: rgba(0,0,0,0.5); border-radius: 8px; border: 1px solid var(--border);">
                    <p style="color: var(--accent-primary); margin-bottom: 10px; font-size: 0.95em; font-weight: bold;">
                        >>> FILTER <<<
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px;">
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Type:
                            </label>
                            <select id="technoFilterType" class="form-control" style="width: 100%; padding: 6px; background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--accent-primary); border-radius: 5px; font-family: 'Courier New', monospace;">
                                <option value="lowpass" selected>LOW-PASS</option>
                                <option value="highpass">HIGH-PASS</option>
                                <option value="bandpass">BAND-PASS</option>
                                <option value="notch">NOTCH</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Filter Env: <span id="technoFilterEnvValue">80</span>%
                            </label>
                            <input type="range" id="technoFilterEnv" min="0" max="100" value="80"
                                   oninput="document.getElementById('technoFilterEnvValue').textContent = this.value"
                                   style="width: 100%;">
                        </div>
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Velocity: <span id="technoVelocityValue">90</span>%
                            </label>
                            <input type="range" id="technoVelocity" min="30" max="100" value="90"
                                   oninput="document.getElementById('technoVelocityValue').textContent = this.value"
                                   style="width: 100%;">
                        </div>
                    </div>
                </div>

                <!-- Envelope Section -->
                <div style="margin-bottom: 15px; padding: 15px; background: rgba(0,0,0,0.5); border-radius: 8px; border: 1px solid var(--border);">
                    <p style="color: var(--accent-primary); margin-bottom: 10px; font-size: 0.95em; font-weight: bold;">
                        >>> ENVELOPE (ADSR) <<<
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px;">
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Attack: <span id="technoAttackValue">0.01</span>s
                            </label>
                            <input type="range" id="technoAttack" min="0.001" max="1" value="0.01" step="0.001"
                                   oninput="document.getElementById('technoAttackValue').textContent = parseFloat(this.value).toFixed(3)"
                                   style="width: 100%;">
                        </div>
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Decay: <span id="technoDecayValue">0.2</span>s
                            </label>
                            <input type="range" id="technoDecay" min="0.01" max="2" value="0.2" step="0.01"
                                   oninput="document.getElementById('technoDecayValue').textContent = parseFloat(this.value).toFixed(2)"
                                   style="width: 100%;">
                        </div>
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Sustain: <span id="technoSustainValue">50</span>%
                            </label>
                            <input type="range" id="technoSustain" min="0" max="100" value="50"
                                   oninput="document.getElementById('technoSustainValue').textContent = this.value"
                                   style="width: 100%;">
                        </div>
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Release: <span id="technoReleaseValue">0.3</span>s
                            </label>
                            <input type="range" id="technoRelease" min="0.01" max="3" value="0.3" step="0.01"
                                   oninput="document.getElementById('technoReleaseValue').textContent = parseFloat(this.value).toFixed(2)"
                                   style="width: 100%;">
                        </div>
                    </div>
                </div>

                <!-- LFO Configuration -->
                <div style="margin-bottom: 15px; padding: 15px; background: rgba(0,0,0,0.5); border-radius: 8px; border: 1px solid var(--border);">
                    <p style="color: var(--accent-primary); margin-bottom: 10px; font-size: 0.95em; font-weight: bold;">
                        >>> LFO MODULATION <<<
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px;">
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                LFO Rate: <span id="technoLFORateValue">6</span> Hz
                            </label>
                            <input type="range" id="technoLFORate" min="0.1" max="20" value="6" step="0.1"
                                   oninput="document.getElementById('technoLFORateValue').textContent = parseFloat(this.value).toFixed(1)"
                                   style="width: 100%;">
                        </div>
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                LFO Depth: <span id="technoLFODepthValue">40</span>%
                            </label>
                            <input type="range" id="technoLFODepth" min="0" max="100" value="40"
                                   oninput="document.getElementById('technoLFODepthValue').textContent = this.value"
                                   style="width: 100%;">
                        </div>
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Target:
                            </label>
                            <select id="technoLFOTarget" class="form-control" style="width: 100%; padding: 6px; background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--accent-primary); border-radius: 5px; font-family: 'Courier New', monospace;">
                                <option value="pitch">PITCH</option>
                                <option value="filter" selected>FILTER</option>
                                <option value="volume">VOLUME</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Automation -->
                <div style="padding: 15px; background: rgba(0,0,0,0.5); border-radius: 8px; border: 1px solid var(--border);">
                    <p style="color: var(--accent-primary); margin-bottom: 10px; font-size: 0.95em; font-weight: bold;">
                        >>> AUTOMATION <<<
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px;">
                        <label style="display: flex; align-items: center; color: var(--text-secondary); font-size: 0.85em; cursor: pointer;">
                            <input type="checkbox" id="technoAutoFilter" style="margin-right: 8px;">
                            FILTER SWEEP
                        </label>
                        <label style="display: flex; align-items: center; color: var(--text-secondary); font-size: 0.85em; cursor: pointer;">
                            <input type="checkbox" id="technoAutoVolume" style="margin-right: 8px;">
                            VOLUME FADE
                        </label>
                        <label style="display: flex; align-items: center; color: var(--text-secondary); font-size: 0.85em; cursor: pointer;">
                            <input type="checkbox" id="technoAutoPan" style="margin-right: 8px;">
                            AUTO-PAN
                        </label>
                        <label style="display: flex; align-items: center; color: var(--text-secondary); font-size: 0.85em; cursor: pointer;">
                            <input type="checkbox" id="technoPulseWidth" style="margin-right: 8px;">
                            PULSE WIDTH MOD
                        </label>
                    </div>
                </div>
            </div>

            <!-- Sequence Display -->
            <div id="technoDisplay" class="chord-display">
                <p style="text-align: center; color: var(--text-secondary);">
                    >>> READY TO GENERATE TECHNO SEQUENCE <<<
                </p>
            </div>

            <div id="technoOutput" class="output-box" style="display: none;">
                <pre id="technoCode"></pre>
            </div>
        </div>

        <!-- Techno Beat Sequencer -->
        <div class="tool-section animated">
            <h2>ü•Å TECHNO DRUM MACHINE</h2>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                Create hard-hitting techno drum patterns (16-step sequencer)
            </p>

            <div class="control-group">
                <label for="technoBpmControl">BPM: <span class="bpm-display" id="technoBpmValue">135</span></label>
                <input type="range" id="technoBpmControl" min="120" max="160" value="135" 
                       oninput="updateTechnoBPM(this.value)">
            </div>

            <h3>üéõÔ∏è PATTERN GRID (16 STEPS)</h3>
            
            <!-- Sound Preview Buttons -->
            <div style="margin: 15px 0; padding: 15px; background: var(--bg-tertiary); border-radius: 10px; border: 1px solid var(--accent-primary);">
                <p style="color: var(--text-secondary); margin-bottom: 10px; font-size: 0.9em;">
                    üéß PREVIEW SOUNDS:
                </p>
                <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
                    <button class="btn btn-secondary" onclick="initAudio(); playTechnoKick(audioContext, audioContext.currentTime)" style="padding: 8px 16px; font-size: 0.9em;">
                        ü¶∂ Techno Kick
                    </button>
                    <button class="btn btn-secondary" onclick="initAudio(); playTechnoHat(audioContext, audioContext.currentTime)" style="padding: 8px 16px; font-size: 0.9em;">
                        üé© Hi-Hat
                    </button>
                    <button class="btn btn-secondary" onclick="initAudio(); playTechnoClap(audioContext, audioContext.currentTime)" style="padding: 8px 16px; font-size: 0.9em;">
                        üëè Clap
                    </button>
                    <button class="btn btn-secondary" onclick="initAudio(); playTechnoPerc(audioContext, audioContext.currentTime)" style="padding: 8px 16px; font-size: 0.9em;">
                        üîî Perc
                    </button>
                </div>
            </div>

            <!-- Sequencer Grid -->
            <div class="sequencer-grid" id="technoSequencerGrid">
                <!-- Will be populated by JavaScript -->
            </div>

            <!-- Sequencer Controls -->
            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px; flex-wrap: wrap;">
                <button class="btn" onclick="playTechnoPattern()">
                    ‚ñ∂Ô∏è Play Pattern
                </button>
                <button class="btn btn-secondary" onclick="stopTechnoPattern()">
                    ‚èπÔ∏è Stop
                </button>
                <button class="btn btn-magenta" onclick="clearTechnoPattern()">
                    üóëÔ∏è Clear
                </button>
                <button class="btn btn-cyan" onclick="randomizeTechnoPattern()">
                    üé≤ Random Pattern
                </button>
            </div>

            <!-- Preset Patterns -->
            <div style="margin-top: 20px;">
                <h3>üì¶ PRESET PATTERNS:</h3>
                <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
                    <button class="btn btn-secondary" onclick="loadTechnoPreset('hard_techno')">
                        ‚ö° Hard Techno
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoPreset('minimal')">
                        üéµ Minimal
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoPreset('industrial')">
                        ‚öôÔ∏è Industrial
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoPreset('acid_groove')">
                        üîä Acid Groove
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Audio Context
        let audioContext = null;
        let currentTechnoInstrument = 'acid_bass';
        let generatedTechnoSequence = [];
        let technoBPM = 135;
        let technoPattern = {
            kick: new Array(16).fill(false),
            hat: new Array(16).fill(false),
            clap: new Array(16).fill(false),
            perc: new Array(16).fill(false)
        };
        let technoIsPlaying = false;
        let technoCurrentStep = 0;
        let technoIntervalId = null;

        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            return audioContext;
        }

        // Techno Music Theory
        const technoTheory = {
            notes: ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'],
            scales: {
                minor: [0, 2, 3, 5, 7, 8, 10],           // Natural minor
                phrygian: [0, 1, 3, 5, 7, 8, 10],        // Dark, Spanish
                dorian: [0, 2, 3, 5, 7, 9, 10],          // Groovy, jazzy
                minor_penta: [0, 3, 5, 7, 10],           // Simple, hypnotic
                harmonic: [0, 2, 3, 5, 7, 8, 11]         // Exotic, dramatic
            },
            patterns: {
                hard_techno: {
                    name: 'Hard Techno Sequence',
                    pattern: [0, 0, 5, 0, 3, 0, 7, 0],  // Root, fifth, third patterns
                    rhythm: 'driving'
                },
                acid_techno: {
                    name: 'Acid Bassline',
                    pattern: [0, 3, 5, 3, 7, 5, 3, 0],  // Classic 303 pattern
                    rhythm: 'hypnotic'
                },
                minimal: {
                    name: 'Minimal Loop',
                    pattern: [0, 5, 7, 5],              // Simple, repetitive
                    rhythm: 'sparse'
                },
                industrial: {
                    name: 'Industrial Sequence',
                    pattern: [0, 1, 0, 3, 0, 1, 5, 3],  // Chromatic, harsh
                    rhythm: 'aggressive'
                },
                detroit: {
                    name: 'Detroit Chord Progression',
                    pattern: [0, 3, 7, 10, 3, 7, 5, 3], // Soulful, melodic
                    rhythm: 'groovy'
                },
                dub_techno: {
                    name: 'Dub Techno Chords',
                    pattern: [0, 5, 7, 10],             // Deep, sustained
                    rhythm: 'spacious'
                }
            }
        };

        // Generate Techno Sequence
        function generateTechnoSequence() {
            const root = document.getElementById('technoKey').value;
            const scale = document.getElementById('technoScale').value;
            const subgenre = document.getElementById('technoSubgenre').value;
            
            const scaleIntervals = technoTheory.scales[scale];
            const pattern = technoTheory.patterns[subgenre];
            const rootIndex = technoTheory.notes.indexOf(root);
            
            generatedTechnoSequence = [];
            let codeOutput = `# ${pattern.name}\n`;
            codeOutput += `Root: ${root} | Scale: ${scale} | Style: ${subgenre}\n\n`;
            
            const sequence = [];
            pattern.pattern.forEach((degree, index) => {
                const noteIndex = (rootIndex + scaleIntervals[degree % scaleIntervals.length]) % 12;
                const noteName = technoTheory.notes[noteIndex];
                const octave = 3; // Bass octave for techno
                const midiNote = 12 + (octave * 12) + noteIndex;
                
                sequence.push({
                    note: noteName,
                    midi: midiNote,
                    step: index + 1
                });
                
                generatedTechnoSequence.push(midiNote);
                
                codeOutput += `Step ${index + 1}: ${noteName}${octave} (MIDI ${midiNote})\n`;
            });
            
            displayTechnoSequence(sequence, pattern.name);
            document.getElementById('technoCode').textContent = codeOutput;
            document.getElementById('technoOutput').style.display = 'block';
        }

        function displayTechnoSequence(sequence, patternName) {
            const display = document.getElementById('technoDisplay');
            display.innerHTML = `
                <div style="text-align: center; margin-bottom: 15px;">
                    <h3 style="color: var(--accent-primary);">${patternName}</h3>
                </div>
                ${sequence.map(item => `
                    <div class="chord-item animated">
                        <div>
                            <span class="chord-name">Step ${item.step}: ${item.note}</span>
                        </div>
                        <span class="chord-notes">MIDI: ${item.midi}</span>
                    </div>
                `).join('')}
            `;
        }

        // Set Instrument
        function setTechnoInstrument(instrument) {
            currentTechnoInstrument = instrument;
            
            // Update button styles
            document.querySelectorAll('[id^="inst-"]').forEach(btn => {
                btn.style.border = '1px solid var(--accent-primary)';
                btn.style.background = 'linear-gradient(135deg, var(--bg-tertiary), var(--border))';
            });
            document.getElementById(`inst-${instrument}`).style.border = '2px solid var(--accent-primary)';
            document.getElementById(`inst-${instrument}`).style.background = 'linear-gradient(135deg, var(--accent-primary), #00cc00)';
        }

        // Randomize Sequence
        function randomizeTechnoSequence() {
            const notes = ['A', 'A#', 'B', 'C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#'];
            const scales = ['minor', 'phrygian', 'dorian', 'minor_penta', 'harmonic'];
            const subgenres = ['hard_techno', 'acid_techno', 'minimal', 'industrial', 'detroit', 'dub_techno'];
            
            document.getElementById('technoKey').value = notes[Math.floor(Math.random() * notes.length)];
            document.getElementById('technoScale').value = scales[Math.floor(Math.random() * scales.length)];
            document.getElementById('technoSubgenre').value = subgenres[Math.floor(Math.random() * subgenres.length)];
            
            generateTechnoSequence();
        }

        // Play Techno Sequence
        function playTechnoSequence() {
            initAudio();
            
            if (generatedTechnoSequence.length === 0) {
                alert('‚ö†Ô∏è Generate a sequence first!');
                return;
            }
            
            const ctx = audioContext;
            const startTime = ctx.currentTime + 0.1;
            const noteLength = 0.25; // 16th notes
            
            generatedTechnoSequence.forEach((midi, index) => {
                const time = startTime + (index * noteLength);
                const freq = midiToFrequency(midi);
                playTechnoNote(ctx, freq, time, currentTechnoInstrument);
            });
        }

        function midiToFrequency(midi) {
            return 440 * Math.pow(2, (midi - 69) / 12);
        }

        function playTechnoNote(ctx, freq, startTime, instrument) {
            // Use enhanced engine if selected
            if (instrument === 'enhanced') {
                playEnhancedTechnoNote(ctx, freq, startTime, 0.25);
                return;
            }
            
            const resonance = parseInt(document.getElementById('resonanceControl').value) / 100;
            const cutoff = parseInt(document.getElementById('cutoffControl').value);
            const glide = parseInt(document.getElementById('glideControl').value) / 1000;
            const distortion = parseInt(document.getElementById('distortionControl').value);
            
            switch(instrument) {
                case 'acid_bass':
                    playAcidBass(ctx, freq, startTime, resonance, cutoff, glide, distortion);
                    break;
                case 'minimal_stab':
                    playMinimalStab(ctx, freq, startTime);
                    break;
                case 'dub_chord':
                    playDubChord(ctx, freq, startTime);
                    break;
                case 'industrial_drone':
                    playIndustrialDrone(ctx, freq, startTime);
                    break;
                case 'detroit_pad':
                    playDetroitPad(ctx, freq, startTime);
                    break;
                case 'perc_synth':
                    playPercSynth(ctx, freq, startTime);
                    break;
            }
        }

        // ============================================
        // ENHANCED TECHNO SYNTHESIS ENGINE
        // Uses advanced parameters from UI controls
        // ============================================
        
        function playEnhancedTechnoNote(ctx, freq, startTime, duration = 0.5) {
            // Get synthesis parameters from UI
            const waveform = document.getElementById('technoWaveform')?.value || 'sawtooth';
            const unisonVoices = parseInt(document.getElementById('technoUnison')?.value || 3);
            const detuneAmount = parseFloat(document.getElementById('technoDetune')?.value || 10);
            const harmonicCount = parseInt(document.getElementById('technoHarmonics')?.value || 3);
            
            // Filter parameters
            const filterType = document.getElementById('technoFilterType')?.value || 'lowpass';
            const baseCutoff = parseFloat(document.getElementById('cutoffControl')?.value || 500);
            const baseResonance = parseFloat(document.getElementById('resonanceControl')?.value || 70) / 100;
            const filterEnvelope = parseFloat(document.getElementById('technoFilterEnv')?.value || 80) / 100;
            const velocity = parseFloat(document.getElementById('technoVelocity')?.value || 90) / 100;
            
            // Envelope parameters
            const attackTime = parseFloat(document.getElementById('technoAttack')?.value || 0.01);
            const decayTime = parseFloat(document.getElementById('technoDecay')?.value || 0.2);
            const sustainLevel = parseFloat(document.getElementById('technoSustain')?.value || 50) / 100;
            const releaseTime = parseFloat(document.getElementById('technoRelease')?.value || 0.3);
            
            // LFO parameters
            const lfoEnabled = document.getElementById('lfoToggle')?.checked || false;
            const lfoRate = parseFloat(document.getElementById('technoLFORate')?.value || 6);
            const lfoDepth = parseFloat(document.getElementById('technoLFODepth')?.value || 40) / 100;
            const lfoTarget = document.getElementById('technoLFOTarget')?.value || 'filter';
            
            // Distortion from existing control
            const distortionAmount = parseFloat(document.getElementById('distortionControl')?.value || 30);
            
            // Automation
            const autoFilter = document.getElementById('technoAutoFilter')?.checked || false;
            const autoVolume = document.getElementById('technoAutoVolume')?.checked || false;
            const autoPan = document.getElementById('technoAutoPan')?.checked || false;
            const pulseMod = document.getElementById('technoPulseWidth')?.checked || false;
            
            // Create master filter
            const masterFilter = ctx.createBiquadFilter();
            masterFilter.type = filterType;
            masterFilter.frequency.setValueAtTime(baseCutoff, startTime);
            masterFilter.Q.setValueAtTime(baseResonance * 20, startTime);
            
            // Distortion
            const distNode = ctx.createWaveShaper();
            distNode.curve = makeDistortionCurve(distortionAmount);
            
            // Create master gain
            const masterGain = ctx.createGain();
            
            // Create panner for auto-pan
            const panner = ctx.createStereoPanner();
            panner.pan.setValueAtTime(0, startTime);
            
            // LFO setup
            let lfo = null;
            let lfoGain = null;
            if (lfoEnabled) {
                lfo = ctx.createOscillator();
                lfoGain = ctx.createGain();
                lfo.frequency.setValueAtTime(lfoRate, startTime);
                lfo.connect(lfoGain);
                
                if (lfoTarget === 'pitch') {
                    lfoGain.gain.setValueAtTime(freq * lfoDepth * 0.05, startTime);
                } else if (lfoTarget === 'filter') {
                    lfoGain.gain.setValueAtTime(baseCutoff * lfoDepth * 2, startTime);
                    lfoGain.connect(masterFilter.frequency);
                } else if (lfoTarget === 'volume') {
                    lfoGain.gain.setValueAtTime(velocity * lfoDepth * 0.5, startTime);
                    lfoGain.connect(masterGain.gain);
                }
                
                lfo.start(startTime);
                lfo.stop(startTime + duration);
            }
            
            // Create pulse width modulation LFO
            let pwmLFO = null;
            let pwmGain = null;
            if (pulseMod && waveform === 'square') {
                pwmLFO = ctx.createOscillator();
                pwmGain = ctx.createGain();
                pwmLFO.frequency.setValueAtTime(0.5, startTime); // Slow modulation
                pwmGain.gain.setValueAtTime(20, startTime); // Detune amount
                pwmLFO.connect(pwmGain);
                pwmLFO.start(startTime);
                pwmLFO.stop(startTime + duration);
            }
            
            // Create unison voices with harmonics
            const oscillators = [];
            
            for (let voice = 0; voice < unisonVoices; voice++) {
                // Calculate detune for this voice
                const voiceDetune = voice === Math.floor(unisonVoices / 2) ? 0 : 
                    ((voice - Math.floor(unisonVoices / 2)) * detuneAmount);
                
                // Create fundamental oscillator
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                
                osc.type = waveform;
                osc.frequency.setValueAtTime(freq, startTime);
                osc.detune.setValueAtTime(voiceDetune, startTime);
                
                // Connect pitch LFO if enabled
                if (lfoEnabled && lfoTarget === 'pitch') {
                    lfoGain.connect(osc.frequency);
                }
                
                // Connect PWM if enabled
                if (pwmLFO && waveform === 'square') {
                    pwmGain.connect(osc.detune);
                }
                
                osc.connect(gain);
                gain.connect(masterFilter);
                
                // Voice amplitude (center voice louder)
                const voiceAmp = voice === Math.floor(unisonVoices / 2) ? 1.0 : 0.6;
                gain.gain.setValueAtTime(voiceAmp / unisonVoices, startTime);
                
                oscillators.push(osc);
                
                // Add harmonics
                for (let h = 1; h <= harmonicCount; h++) {
                    const harmOsc = ctx.createOscillator();
                    const harmGain = ctx.createGain();
                    
                    harmOsc.type = 'sine';
                    harmOsc.frequency.setValueAtTime(freq * (h + 1), startTime);
                    harmOsc.detune.setValueAtTime(voiceDetune, startTime);
                    
                    harmOsc.connect(harmGain);
                    harmGain.connect(masterFilter);
                    
                    // Decreasing amplitude for higher harmonics
                    harmGain.gain.setValueAtTime((voiceAmp / unisonVoices) * (0.4 / (h + 1)), startTime);
                    
                    oscillators.push(harmOsc);
                }
            }
            
            // Connect filter -> distortion -> gain -> panner -> destination
            masterFilter.connect(distNode);
            distNode.connect(masterGain);
            masterGain.connect(panner);
            panner.connect(ctx.destination);
            
            // Apply ADSR envelope
            masterGain.gain.setValueAtTime(0, startTime);
            masterGain.gain.linearRampToValueAtTime(velocity * 0.4, startTime + attackTime);
            masterGain.gain.linearRampToValueAtTime(velocity * 0.4 * sustainLevel, startTime + attackTime + decayTime);
            
            const releaseStart = startTime + duration - releaseTime;
            if (releaseStart > startTime + attackTime + decayTime) {
                masterGain.gain.setValueAtTime(velocity * 0.4 * sustainLevel, releaseStart);
            }
            masterGain.gain.exponentialRampToValueAtTime(0.001, startTime + duration);
            
            // TB-303 style filter envelope
            const filterEnvAmount = baseCutoff * filterEnvelope * 8;
            masterFilter.frequency.setValueAtTime(baseCutoff, startTime);
            masterFilter.frequency.exponentialRampToValueAtTime(baseCutoff + filterEnvAmount, startTime + attackTime * 2);
            masterFilter.frequency.exponentialRampToValueAtTime(baseCutoff, startTime + attackTime + decayTime + 0.1);
            
            // Automation effects
            if (autoFilter) {
                // Filter sweep over duration
                masterFilter.frequency.exponentialRampToValueAtTime(baseCutoff * 0.2, startTime + duration * 0.9);
            }
            
            if (autoVolume) {
                // Volume fade
                masterGain.gain.linearRampToValueAtTime(velocity * 0.2, startTime + duration * 0.95);
            }
            
            if (autoPan) {
                // Auto-pan sweep
                panner.pan.setValueAtTime(-1, startTime);
                panner.pan.linearRampToValueAtTime(1, startTime + duration);
            }
            
            // Start and stop all oscillators
            oscillators.forEach(osc => {
                osc.start(startTime);
                osc.stop(startTime + duration);
            });
        }

        // Play enhanced note sequence
        function playEnhancedTechnoSequence(sequence) {
            if (!audioContext) initAudio();
            
            const startTime = audioContext.currentTime;
            const noteDuration = 0.25; // 16th notes
            
            sequence.forEach((note, index) => {
                if (note && note.freq) {
                    const noteTime = startTime + (index * noteDuration);
                    playEnhancedTechnoNote(audioContext, note.freq, noteTime, noteDuration * 0.9);
                }
            });
        }

        // Acid Bass (TB-303 Style)
        function playAcidBass(ctx, freq, startTime, resonance, cutoff, glide, distortion) {
            const osc = ctx.createOscillator();
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(freq, startTime);
            if (glide > 0) {
                osc.frequency.exponentialRampToValueAtTime(freq, startTime + glide);
            }
            
            const filter = ctx.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(cutoff, startTime);
            filter.Q.setValueAtTime(resonance * 20, startTime);
            
            // Filter envelope
            filter.frequency.exponentialRampToValueAtTime(cutoff * 3, startTime + 0.05);
            filter.frequency.exponentialRampToValueAtTime(cutoff, startTime + 0.2);
            
            const distNode = ctx.createWaveShaper();
            distNode.curve = makeDistortionCurve(distortion);
            
            const gain = ctx.createGain();
            gain.gain.setValueAtTime(0, startTime);
            gain.gain.linearRampToValueAtTime(0.3, startTime + 0.01);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.25);
            
            osc.connect(filter);
            filter.connect(distNode);
            distNode.connect(gain);
            gain.connect(ctx.destination);
            
            osc.start(startTime);
            osc.stop(startTime + 0.3);
        }

        // Minimal Stab
        function playMinimalStab(ctx, freq, startTime) {
            const osc = ctx.createOscillator();
            osc.type = 'square';
            osc.frequency.setValueAtTime(freq, startTime);
            
            const filter = ctx.createBiquadFilter();
            filter.type = 'bandpass';
            filter.frequency.setValueAtTime(freq * 2, startTime);
            filter.Q.setValueAtTime(5, startTime);
            
            const gain = ctx.createGain();
            gain.gain.setValueAtTime(0, startTime);
            gain.gain.linearRampToValueAtTime(0.2, startTime + 0.005);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.15);
            
            osc.connect(filter);
            filter.connect(gain);
            gain.connect(ctx.destination);
            
            osc.start(startTime);
            osc.stop(startTime + 0.2);
        }

        // Dub Chord
        function playDubChord(ctx, freq, startTime) {
            [1, 1.25, 1.5].forEach(ratio => {
                const osc = ctx.createOscillator();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(freq * ratio, startTime);
                
                const filter = ctx.createBiquadFilter();
                filter.type = 'lowpass';
                filter.frequency.setValueAtTime(800, startTime);
                filter.Q.setValueAtTime(1, startTime);
                
                const gain = ctx.createGain();
                gain.gain.setValueAtTime(0, startTime);
                gain.gain.linearRampToValueAtTime(0.1, startTime + 0.3);
                gain.gain.exponentialRampToValueAtTime(0.01, startTime + 2.0);
                
                osc.connect(filter);
                filter.connect(gain);
                gain.connect(ctx.destination);
                
                osc.start(startTime);
                osc.stop(startTime + 2.5);
            });
        }

        // Industrial Drone
        function playIndustrialDrone(ctx, freq, startTime) {
            const osc1 = ctx.createOscillator();
            const osc2 = ctx.createOscillator();
            
            osc1.type = 'sawtooth';
            osc2.type = 'square';
            osc1.frequency.setValueAtTime(freq, startTime);
            osc2.frequency.setValueAtTime(freq * 0.99, startTime);
            
            const noise = createNoiseBuffer(ctx);
            const noiseSource = ctx.createBufferSource();
            noiseSource.buffer = noise;
            
            const noiseGain = ctx.createGain();
            noiseGain.gain.setValueAtTime(0.1, startTime);
            
            const filter = ctx.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(300, startTime);
            filter.Q.setValueAtTime(10, startTime);
            
            const gain = ctx.createGain();
            gain.gain.setValueAtTime(0, startTime);
            gain.gain.linearRampToValueAtTime(0.2, startTime + 0.1);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.8);
            
            osc1.connect(filter);
            osc2.connect(filter);
            noiseSource.connect(noiseGain);
            noiseGain.connect(filter);
            filter.connect(gain);
            gain.connect(ctx.destination);
            
            osc1.start(startTime);
            osc2.start(startTime);
            noiseSource.start(startTime);
            osc1.stop(startTime + 1.0);
            osc2.stop(startTime + 1.0);
            noiseSource.stop(startTime + 1.0);
        }

        // Detroit Pad
        function playDetroitPad(ctx, freq, startTime) {
            [0.99, 1, 1.01].forEach((detune, i) => {
                const osc = ctx.createOscillator();
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(freq * detune, startTime);
                
                const filter = ctx.createBiquadFilter();
                filter.type = 'lowpass';
                filter.frequency.setValueAtTime(1500, startTime);
                filter.Q.setValueAtTime(0.7, startTime);
                
                const gain = ctx.createGain();
                gain.gain.setValueAtTime(0, startTime);
                gain.gain.linearRampToValueAtTime(0.08, startTime + 0.5);
                gain.gain.exponentialRampToValueAtTime(0.01, startTime + 3.0);
                
                osc.connect(filter);
                filter.connect(gain);
                gain.connect(ctx.destination);
                
                osc.start(startTime);
                osc.stop(startTime + 3.5);
            });
        }

        // Perc Synth
        function playPercSynth(ctx, freq, startTime) {
            const osc = ctx.createOscillator();
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(freq * 4, startTime);
            osc.frequency.exponentialRampToValueAtTime(freq, startTime + 0.05);
            
            const filter = ctx.createBiquadFilter();
            filter.type = 'bandpass';
            filter.frequency.setValueAtTime(freq * 2, startTime);
            filter.Q.setValueAtTime(10, startTime);
            
            const gain = ctx.createGain();
            gain.gain.setValueAtTime(0, startTime);
            gain.gain.linearRampToValueAtTime(0.3, startTime + 0.001);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.1);
            
            osc.connect(filter);
            filter.connect(gain);
            gain.connect(ctx.destination);
            
            osc.start(startTime);
            osc.stop(startTime + 0.15);
        }

        // Drum Synthesis
        function playTechnoKick(ctx, startTime) {
            const osc = ctx.createOscillator();
            osc.frequency.setValueAtTime(150, startTime);
            osc.frequency.exponentialRampToValueAtTime(40, startTime + 0.05);
            
            const gain = ctx.createGain();
            gain.gain.setValueAtTime(1, startTime);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.3);
            
            osc.connect(gain);
            gain.connect(ctx.destination);
            
            osc.start(startTime);
            osc.stop(startTime + 0.3);
        }

        function playTechnoHat(ctx, startTime) {
            const noise = createNoiseBuffer(ctx);
            const source = ctx.createBufferSource();
            source.buffer = noise;
            
            const filter = ctx.createBiquadFilter();
            filter.type = 'highpass';
            filter.frequency.setValueAtTime(8000, startTime);
            
            const gain = ctx.createGain();
            gain.gain.setValueAtTime(0.3, startTime);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.05);
            
            source.connect(filter);
            filter.connect(gain);
            gain.connect(ctx.destination);
            
            source.start(startTime);
            source.stop(startTime + 0.05);
        }

        function playTechnoClap(ctx, startTime) {
            const noise = createNoiseBuffer(ctx);
            
            [0, 0.015, 0.03].forEach(offset => {
                const source = ctx.createBufferSource();
                source.buffer = noise;
                
                const filter = ctx.createBiquadFilter();
                filter.type = 'bandpass';
                filter.frequency.setValueAtTime(1500, startTime + offset);
                filter.Q.setValueAtTime(1, startTime + offset);
                
                const gain = ctx.createGain();
                gain.gain.setValueAtTime(0.5, startTime + offset);
                gain.gain.exponentialRampToValueAtTime(0.01, startTime + offset + 0.1);
                
                source.connect(filter);
                filter.connect(gain);
                gain.connect(ctx.destination);
                
                source.start(startTime + offset);
                source.stop(startTime + offset + 0.1);
            });
        }

        function playTechnoPerc(ctx, startTime) {
            const osc = ctx.createOscillator();
            osc.frequency.setValueAtTime(800, startTime);
            osc.frequency.exponentialRampToValueAtTime(400, startTime + 0.05);
            osc.type = 'sine';
            
            const gain = ctx.createGain();
            gain.gain.setValueAtTime(0.4, startTime);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.08);
            
            osc.connect(gain);
            gain.connect(ctx.destination);
            
            osc.start(startTime);
            osc.stop(startTime + 0.08);
        }

        // Utility Functions
        function createNoiseBuffer(ctx) {
            const bufferSize = ctx.sampleRate * 0.5;
            const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) {
                data[i] = Math.random() * 2 - 1;
            }
            return buffer;
        }

        function makeDistortionCurve(amount) {
            const samples = 44100;
            const curve = new Float32Array(samples);
            const deg = Math.PI / 180;
            for (let i = 0; i < samples; i++) {
                const x = (i * 2) / samples - 1;
                curve[i] = ((3 + amount) * x * 20 * deg) / (Math.PI + amount * Math.abs(x));
            }
            return curve;
        }

        // ============================================
        // CLEAN SOUND ENGINE UTILITIES (TECHNO)
        // Anti-aliasing and improved synthesis
        // ============================================
        
        /**
         * Create bandlimited oscillator with reduced aliasing
         */
        function createCleanOscillator(ctx, freq, waveform, maxPartials = 32) {
            const nyquist = ctx.sampleRate / 2;
            const fundamental = freq;
            const safePartials = Math.min(maxPartials, Math.floor(nyquist / fundamental) - 1);
            
            const oscillators = [];
            const gains = [];
            const merger = ctx.createGain();
            
            for (let n = 1; n <= safePartials; n++) {
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                
                osc.type = 'sine';
                osc.frequency.value = fundamental * n;
                
                let amplitude = 0;
                switch(waveform) {
                    case 'sawtooth':
                        amplitude = 1 / n;
                        break;
                    case 'square':
                        amplitude = (n % 2 === 1) ? (1 / n) : 0;
                        break;
                    case 'triangle':
                        amplitude = (n % 2 === 1) ? (1 / (n * n)) : 0;
                        break;
                    case 'sine':
                        amplitude = (n === 1) ? 1 : 0;
                        break;
                }
                
                gain.gain.value = amplitude / safePartials;
                osc.connect(gain);
                gain.connect(merger);
                
                oscillators.push(osc);
                gains.push(gain);
            }
            
            return { oscillators, gains, output: merger };
        }
        
        /**
         * Create cascaded filter for steeper rolloff
         */
        function createCleanFilter(ctx, type, cutoff, resonance, stages = 2) {
            const filters = [];
            let input = null;
            
            for (let i = 0; i < stages; i++) {
                const filter = ctx.createBiquadFilter();
                filter.type = type;
                filter.frequency.value = cutoff;
                filter.Q.value = Math.pow(resonance, 1 / stages);
                
                if (input) {
                    input.connect(filter);
                }
                
                filters.push(filter);
                input = filter;
            }
            
            return {
                input: filters[0],
                output: filters[filters.length - 1],
                filters: filters,
                setFrequency: (freq) => filters.forEach(f => f.frequency.value = freq),
                setQ: (q) => filters.forEach((f, i) => f.Q.value = Math.pow(q, 1 / stages))
            };
        }
        
        /**
         * Soft clipping for warmer techno saturation
         */
        function createSoftClipper(ctx, drive = 1.0) {
            const samples = 2048;
            const curve = new Float32Array(samples);
            
            for (let i = 0; i < samples; i++) {
                const x = (i * 2 / samples) - 1;
                const processed = Math.tanh(x * drive);
                curve[i] = processed / Math.max(Math.abs(processed), 1.0);
            }
            
            const shaper = ctx.createWaveShaper();
            shaper.curve = curve;
            shaper.oversample = '4x';
            
            return shaper;
        }
        
        /**
         * Industrial delay with feedback saturation
         */
        function createIndustrialDelay(ctx, time = 0.375, feedback = 0.4) {
            const delay = ctx.createDelay();
            const feedbackGain = ctx.createGain();
            const saturator = createSoftClipper(ctx, 2.0);
            const output = ctx.createGain();
            
            delay.delayTime.value = time;
            feedbackGain.gain.value = feedback;
            output.gain.value = 0.5;
            
            delay.connect(saturator);
            saturator.connect(feedbackGain);
            feedbackGain.connect(delay);
            delay.connect(output);
            
            return { input: delay, output: output, feedbackNode: feedbackGain };
        }

        // Sequencer Functions
        function initTechnoSequencer() {
            const grid = document.getElementById('technoSequencerGrid');
            const instruments = [
                { name: 'KICK', key: 'kick', icon: 'ü¶∂' },
                { name: 'HAT', key: 'hat', icon: 'üé©' },
                { name: 'CLAP', key: 'clap', icon: 'üëè' },
                { name: 'PERC', key: 'perc', icon: 'üîî' }
            ];
            
            grid.innerHTML = '';
            
            instruments.forEach(inst => {
                const row = document.createElement('div');
                row.className = 'sequencer-row';
                
                const label = document.createElement('div');
                label.className = 'instrument-label';
                label.textContent = `${inst.icon} ${inst.name}`;
                row.appendChild(label);
                
                for (let i = 0; i < 16; i++) {
                    const step = document.createElement('div');
                    step.className = 'step';
                    step.dataset.instrument = inst.key;
                    step.dataset.step = i;
                    step.onclick = () => toggleTechnoStep(inst.key, i, step);
                    row.appendChild(step);
                }
                
                grid.appendChild(row);
            });
        }

        function toggleTechnoStep(instrument, step, element) {
            technoPattern[instrument][step] = !technoPattern[instrument][step];
            element.classList.toggle('active');
        }

        function playTechnoPattern() {
            if (technoIsPlaying) return;
            
            initAudio();
            technoIsPlaying = true;
            technoCurrentStep = 0;
            
            const stepDuration = (60 / technoBPM) / 4 * 1000; // 16th notes
            
            technoIntervalId = setInterval(() => {
                const ctx = audioContext;
                const time = ctx.currentTime;
                
                if (technoPattern.kick[technoCurrentStep]) playTechnoKick(ctx, time);
                if (technoPattern.hat[technoCurrentStep]) playTechnoHat(ctx, time);
                if (technoPattern.clap[technoCurrentStep]) playTechnoClap(ctx, time);
                if (technoPattern.perc[technoCurrentStep]) playTechnoPerc(ctx, time);
                
                technoCurrentStep = (technoCurrentStep + 1) % 16;
            }, stepDuration);
        }

        function stopTechnoPattern() {
            technoIsPlaying = false;
            if (technoIntervalId) {
                clearInterval(technoIntervalId);
                technoIntervalId = null;
            }
        }

        function clearTechnoPattern() {
            Object.keys(technoPattern).forEach(key => {
                technoPattern[key].fill(false);
            });
            document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
        }

        function randomizeTechnoPattern() {
            clearTechnoPattern();
            Object.keys(technoPattern).forEach((key, instIndex) => {
                for (let i = 0; i < 16; i++) {
                    if (Math.random() > 0.7) {
                        technoPattern[key][i] = true;
                        const step = document.querySelector(`[data-instrument="${key}"][data-step="${i}"]`);
                        if (step) step.classList.add('active');
                    }
                }
            });
        }

        function loadTechnoPreset(preset) {
            clearTechnoPattern();
            
            const presets = {
                hard_techno: {
                    kick: [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],
                    hat: [0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1],
                    clap: [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],
                    perc: [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0]
                },
                minimal: {
                    kick: [1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],
                    hat: [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0],
                    clap: [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],
                    perc: [0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0]
                },
                industrial: {
                    kick: [1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0],
                    hat: [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
                    clap: [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0],
                    perc: [0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1]
                },
                acid_groove: {
                    kick: [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],
                    hat: [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0],
                    clap: [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],
                    perc: [1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0]
                }
            };
            
            const pattern = presets[preset];
            if (!pattern) return;
            
            Object.keys(pattern).forEach(key => {
                pattern[key].forEach((val, i) => {
                    technoPattern[key][i] = val === 1;
                    const step = document.querySelector(`[data-instrument="${key}"][data-step="${i}"]`);
                    if (step && val === 1) step.classList.add('active');
                });
            });
        }

        function updateTechnoBPM(value) {
            technoBPM = parseInt(value);
            document.getElementById('technoBpmValue').textContent = value;
        }

        // Initialize sequencer on load
        window.addEventListener('DOMContentLoaded', () => {
            initTechnoSequencer();
        });
    </script>
</body>
</html>
