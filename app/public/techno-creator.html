<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="description" content="HAOS.fm Techno Creator - Acid basslines, industrial percussion, T78-style hard driving techno">
    <meta name="theme-color" content="#FF6B35">
    
    <!-- iOS Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="HAOS.fm Techno">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/images/haos-logo-white.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/haos-logo-white.png">
    
    <title>‚ö° HAOS.fm - Techno Creator | Industrial Synthesis Studio</title>
    
    <!-- Google Fonts - HAOS.fm Typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Space+Mono:wght@400;700&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- HAOS.fm Brand CSS -->
    <link rel="stylesheet" href="/css/haos-brand.css">
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* HAOS.fm Techno Theme - Uses Brand Variables */
            --bg-primary: var(--haos-vinyl-black);
            --bg-secondary: var(--haos-tape-brown);
            --bg-tertiary: #1a1410;
            --accent-primary: var(--haos-acid-green);
            --accent-secondary: var(--haos-groove-orange);
            --accent-cyan: var(--haos-909-cyan);
            --accent-gold: var(--haos-turntable-gold);
            --accent-magenta: #FF1493;
            --text-primary: var(--haos-acid-green);
            --text-secondary: var(--haos-sepia-cream);
            --success: var(--haos-acid-green);
            --warning: #ffff00;
            --border: var(--haos-dust-gray);
            --glow: rgba(57, 255, 20, 0.5);
        }

        body {
            font-family: var(--haos-font-body);
            background: linear-gradient(135deg, var(--haos-vinyl-black) 0%, var(--haos-tape-brown) 50%, var(--haos-vinyl-black) 100%);
            color: var(--haos-sepia-cream);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }
        
        /* Vinyl texture overlay */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iMzAwIj48ZmlsdGVyIGlkPSJhIj48ZmVUdXJidWxlbmNlIGJhc2VGcmVxdWVuY3k9Ii43NSIgc3RpdGNoVGlsZXM9InN0aXRjaCIgdHlwZT0iZnJhY3RhbE5vaXNlIi8+PGZlQ29sb3JNYXRyaXggdHlwZT0ic2F0dXJhdGUiIHZhbHVlcz0iMCIvPjwvZmlsdGVyPjxwYXRoIGQ9Ik0wIDBoMzAwdjMwMEgweiIgZmlsdGVyPSJ1cmwoI2EpIiBvcGFjaXR5PSIuMDUiLz48L3N2Zz4=');
            opacity: 0.03;
            mix-blend-mode: overlay;
            pointer-events: none;
            z-index: 1;
        }

        /* Animated Scanline Effect */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 255, 0, 0.03) 0px,
                transparent 1px,
                transparent 2px,
                rgba(0, 255, 0, 0.03) 3px
            );
            animation: scanline 8s linear infinite;
            pointer-events: none;
            z-index: 1000;
        }

        @keyframes scanline {
            0% { transform: translateY(0); }
            100% { transform: translateY(100%); }
        }

        /* Header */
        .header {
            position: relative;
            z-index: 10;
            background: var(--bg-secondary);
            border-bottom: 2px solid var(--accent-primary);
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            color: var(--accent-primary);
            text-shadow: 
                0 0 10px var(--glow),
                0 0 20px var(--glow),
                0 0 30px var(--glow);
            margin-bottom: 10px;
            animation: flicker 3s ease-in-out infinite;
            font-family: var(--haos-font-display), 'Bebas Neue', Arial, sans-serif;
            font-weight: normal;
            letter-spacing: 2px;
        }

        @keyframes flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
            51% { opacity: 1; }
            52% { opacity: 0.85; }
            53% { opacity: 1; }
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.1em;
        }

        /* Main Container */
        .container {
            position: relative;
            z-index: 5;
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
        }

        /* Navigation */
        .nav-menu {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-menu a {
            color: var(--text-primary);
            text-decoration: none;
            padding: 12px 24px;
            background: var(--bg-tertiary);
            border: 1px solid var(--accent-primary);
            border-radius: 5px;
            transition: all 0.3s;
            font-weight: bold;
        }

        .nav-menu a:hover {
            background: var(--accent-primary);
            color: var(--bg-primary);
            box-shadow: 0 0 20px var(--glow);
        }

        /* Tool Sections with HAOS Styling */
        .tool-section {
            background: linear-gradient(135deg, rgba(74, 60, 46, 0.4), rgba(10, 10, 10, 0.6));
            border: 2px solid transparent;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--haos-shadow-lg);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .tool-section::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(135deg, var(--haos-groove-orange), var(--haos-turntable-gold), var(--haos-acid-green));
            border-radius: 16px;
            z-index: -1;
            opacity: 0.3;
        }
        
        .tool-section:hover::before {
            opacity: 0.6;
        }

        .tool-section h2 {
            font-family: var(--haos-font-display);
            color: var(--haos-turntable-gold);
            margin-bottom: 15px;
            font-size: 2em;
            text-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        .tool-section h3 {
            font-family: var(--haos-font-display);
            color: var(--haos-909-cyan);
            margin: 20px 0 10px 0;
            font-size: 1.4em;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        /* Form Controls */
        .control-group {
            margin: 15px 0;
        }

        .control-group label {
            display: block;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-weight: bold;
        }

        select, input[type="range"] {
            width: 100%;
            padding: 12px;
            background: var(--bg-primary);
            color: var(--text-primary);
            border: 1px solid var(--accent-primary);
            border-radius: 5px;
            font-family: 'Courier New', monospace;
        }

        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            background: var(--bg-tertiary);
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--accent-primary);
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 0 10px var(--glow);
        }

        /* Buttons with HAOS Styling */
        .btn {
            padding: 12px 30px;
            background: linear-gradient(135deg, var(--haos-groove-orange), #FF8C42);
            color: var(--haos-vinyl-black);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
            font-family: var(--haos-font-display);
            margin: 5px;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(255, 107, 53, 0.6);
            background: linear-gradient(135deg, #FF8C42, var(--haos-groove-orange));
        }

        .btn-secondary {
            background: linear-gradient(135deg, rgba(74, 60, 46, 0.6), rgba(26, 20, 16, 0.8));
            color: var(--haos-sepia-cream);
            border: 1px solid var(--haos-turntable-gold);
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.2);
        }
        
        .btn-secondary:hover {
            background: linear-gradient(135deg, rgba(74, 60, 46, 0.8), rgba(26, 20, 16, 0.9));
            border-color: var(--haos-groove-orange);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
        }

        .btn-magenta {
            background: linear-gradient(135deg, #FF1493, #CC1177);
            box-shadow: 0 4px 15px rgba(255, 20, 147, 0.4);
        }

        .btn-cyan {
            background: linear-gradient(135deg, var(--haos-909-cyan), #00B8D4);
            box-shadow: 0 4px 15px rgba(0, 217, 255, 0.4);
        }

        /* Output Box */
        .output-box {
            background: var(--bg-primary);
            border: 1px solid var(--accent-primary);
            border-radius: 5px;
            padding: 20px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            max-height: 400px;
            overflow-y: auto;
        }

        .output-box pre {
            color: var(--accent-primary);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* Sequencer Grid */
        .sequencer-grid {
            display: grid;
            gap: 5px;
            margin: 20px 0;
            background: var(--bg-primary);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--accent-primary);
        }

        .sequencer-row {
            display: grid;
            grid-template-columns: 100px repeat(16, 1fr);
            gap: 3px;
            align-items: center;
        }

        .instrument-label {
            color: var(--text-primary);
            font-weight: bold;
            padding: 10px;
            background: var(--bg-tertiary);
            border-radius: 5px;
            text-align: center;
            border: 1px solid var(--accent-primary);
        }

        .step {
            aspect-ratio: 1;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .step.active {
            background: var(--accent-primary);
            box-shadow: 0 0 10px var(--glow);
        }

        .step.playing {
            border: 2px solid var(--accent-cyan);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.8);
            animation: pulse 0.3s ease-in-out;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .step:hover {
            border-color: var(--accent-primary);
        }

        /* Chord Display */
        .chord-display {
            background: var(--bg-primary);
            border: 1px solid var(--accent-primary);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .chord-item {
            padding: 15px;
            margin: 10px 0;
            background: var(--bg-tertiary);
            border-left: 3px solid var(--accent-primary);
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chord-name {
            font-size: 1.5em;
            color: var(--accent-primary);
            font-weight: bold;
        }

        .chord-notes {
            color: var(--text-secondary);
            font-family: 'Courier New', monospace;
        }

        /* Waveform Canvas */
        canvas {
            width: 100%;
            height: 200px;
            background: var(--bg-primary);
            border: 1px solid var(--accent-primary);
            border-radius: 5px;
            margin-top: 15px;
        }

        /* Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animated {
            animation: slideIn 0.5s ease-out;
        }

        /* ============================================
           LIVE GUIDANCE SYSTEM (Techno Theme)
           ============================================ */
        
        .guidance-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            max-height: 500px;
            background: linear-gradient(135deg, rgba(10, 10, 10, 0.98), rgba(26, 26, 26, 0.98));
            border: 2px solid var(--accent-primary);
            border-radius: 5px;
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.5);
            z-index: 1000;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .guidance-panel.minimized {
            width: 60px;
            height: 60px;
        }

        .guidance-header {
            background: linear-gradient(135deg, var(--accent-primary), #00cc00);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            color: #000;
            font-weight: bold;
        }

        .guidance-header h3 {
            margin: 0;
            font-size: 1em;
            color: #000;
        }

        .guidance-content {
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .guidance-panel.minimized .guidance-content {
            display: none;
        }

        .guidance-tip {
            background: var(--bg-tertiary);
            border-left: 4px solid var(--accent-cyan);
            padding: 12px;
            margin-bottom: 12px;
            border-radius: 3px;
            animation: slideIn 0.3s ease-out;
        }

        .guidance-tip-title {
            font-weight: bold;
            color: var(--accent-primary);
            margin-bottom: 5px;
            font-size: 0.95em;
        }

        .guidance-tip-text {
            color: var(--text-secondary);
            font-size: 0.85em;
            line-height: 1.4;
        }

        .guidance-step {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(0, 255, 0, 0.1);
            border-radius: 3px;
            border: 1px solid var(--border);
        }

        .guidance-step-number {
            background: var(--accent-primary);
            color: #000;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
            margin-right: 12px;
        }

        .guidance-step-text {
            font-size: 0.9em;
            color: var(--text-primary);
        }

        /* Enhanced Tooltips */
        .info-tooltip {
            display: inline-block;
            width: 18px;
            height: 18px;
            background: var(--accent-cyan);
            color: var(--bg-primary);
            border-radius: 3px;
            text-align: center;
            line-height: 18px;
            font-size: 0.75em;
            font-weight: bold;
            cursor: help;
            margin-left: 5px;
            position: relative;
        }

        .info-tooltip:hover::after {
            content: attr(data-tip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-primary);
            color: var(--text-primary);
            padding: 10px 15px;
            border-radius: 3px;
            border: 2px solid var(--accent-cyan);
            width: max-content;
            max-width: 250px;
            font-size: 0.85rem;
            font-weight: normal;
            z-index: 1000;
            white-space: normal;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }

        .info-tooltip:hover::before {
            content: '';
            position: absolute;
            bottom: 110%;
            left: 50%;
            transform: translateX(-50%);
            border: 8px solid transparent;
            border-top-color: var(--accent-cyan);
        }

        /* Live Feedback Indicators */
        .live-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: var(--success);
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse-indicator 2s infinite;
        }

        @keyframes pulse-indicator {
            0%, 100% { opacity: 1; box-shadow: 0 0 5px var(--success); }
            50% { opacity: 0.5; box-shadow: 0 0 15px var(--success); }
        }

        .value-display {
            display: inline-block;
            background: rgba(0, 255, 0, 0.2);
            border: 1px solid var(--accent-primary);
            padding: 4px 12px;
            border-radius: 3px;
            font-weight: bold;
            color: var(--accent-cyan);
            margin-left: 10px;
            min-width: 60px;
            text-align: center;
        }

        .control-label-enhanced {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .control-description {
            font-size: 0.8em;
            color: var(--text-secondary);
            font-style: italic;
            margin-top: 4px;
        }

        /* Section Headers with Icons */
        .section-header-enhanced {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
        }

        .section-icon {
            font-size: 2.5em;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .section-info {
            flex: 1;
        }

        .section-title {
            font-size: 1.8em;
            color: var(--accent-primary);
            margin: 0;
        }

        .section-subtitle {
            color: var(--text-secondary);
            font-size: 0.95em;
            margin-top: 5px;
        }

        /* Quick Action Buttons */
        .quick-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 15px 0;
        }

        .quick-action-btn {
            flex: 1;
            min-width: 150px;
            padding: 12px 20px;
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 3px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }

        .quick-action-btn:hover {
            border-color: var(--accent-cyan);
            background: rgba(0, 255, 255, 0.1);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        }

        .quick-action-btn.active {
            border-color: var(--accent-primary);
            background: rgba(0, 255, 0, 0.2);
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
        }

        /* Mode Selector Tabs */
        .mode-selector {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            padding: 10px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            border: 1px solid var(--accent-primary);
            justify-content: center;
            flex-wrap: wrap;
        }

        .mode-tab {
            flex: 1;
            min-width: 120px;
            padding: 12px 20px;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 3px;
            color: var(--text-secondary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            font-family: 'Courier New', monospace;
        }

        .mode-tab:hover {
            border-color: var(--accent-cyan);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        }

        .mode-tab.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: var(--bg-primary);
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
        }

        .mode-tab .mode-icon {
            font-size: 1.5em;
            display: block;
            margin-bottom: 5px;
        }

        .mode-tab .mode-name {
            font-size: 0.95em;
            display: block;
        }

        .mode-tab .mode-desc {
            font-size: 0.75em;
            opacity: 0.7;
            display: block;
            margin-top: 3px;
        }

        /* Control Visibility by Mode */
        .control-group[data-mode="pro"],
        .control-group[data-mode="advanced"] {
            display: none;
        }

        .mode-basic .control-group[data-mode="basic"] {
            display: block;
        }

        .mode-pro .control-group[data-mode="basic"],
        .mode-pro .control-group[data-mode="pro"] {
            display: block;
        }

        .mode-advanced .control-group {
            display: block;
        }

        /* Mode Indicator Badge */
        .mode-badge {
            position: fixed;
            top: 80px;
            right: 20px;
            background: var(--accent-primary);
            color: var(--bg-primary);
            padding: 8px 16px;
            border-radius: 3px;
            font-size: 0.85em;
            font-weight: 600;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
            z-index: 999;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: 'Courier New', monospace;
        }

        .mode-badge .badge-icon {
            font-size: 1.2em;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .sequencer-row {
                grid-template-columns: 80px repeat(16, 1fr);
            }

            .tool-section {
                padding: 20px;
            }
            
            .guidance-panel {
                width: 90%;
                right: 5%;
            }
        }

        /* ============================================
           MODERN UI ENHANCEMENTS
           ============================================ */

        /* Glass Morphism Effects */
        .glass-panel {
            background: rgba(26, 26, 26, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 255, 0, 0.2);
            border-radius: 12px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        /* Modern Card Design */
        .modern-card {
            background: linear-gradient(145deg, #1a1a1a, #141414);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(0, 255, 0, 0.1);
            border: 1px solid rgba(0, 255, 0, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .modern-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 0, 0.1), transparent);
            transition: left 0.5s;
        }

        .modern-card:hover {
            transform: translateY(-5px);
            box-shadow: 
                0 15px 40px rgba(0, 255, 0, 0.2),
                inset 0 1px 0 rgba(0, 255, 0, 0.2);
            border-color: var(--accent-cyan);
        }

        .modern-card:hover::before {
            left: 100%;
        }

        /* Tab System */
        .tab-container {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            padding: 10px;
            background: var(--bg-primary);
            border-radius: 10px;
        }

        .tab-button {
            padding: 12px 24px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .tab-button::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--accent-primary);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .tab-button:hover {
            background: rgba(0, 255, 0, 0.1);
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }

        .tab-button.active {
            background: linear-gradient(135deg, rgba(0, 255, 0, 0.2), rgba(0, 255, 255, 0.1));
            border-color: var(--accent-cyan);
            color: var(--accent-cyan);
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
        }

        .tab-button.active::before {
            transform: scaleX(1);
        }

        .tab-content {
            display: none;
            animation: fadeInUp 0.4s ease-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Enhanced Sequencer Grid */
        .sequencer-grid {
            background: var(--bg-primary);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid var(--accent-primary);
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.2);
            position: relative;
        }

        .sequencer-grid::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, 
                transparent, 
                var(--accent-primary) 50%, 
                transparent
            );
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* Modern Button Styles */
        .btn-modern {
            position: relative;
            padding: 14px 32px;
            background: linear-gradient(145deg, var(--accent-primary), #00cc00);
            color: #000;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 700;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 4px 15px rgba(0, 255, 0, 0.3),
                inset 0 -2px 5px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-modern::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn-modern:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-modern:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 
                0 8px 25px rgba(0, 255, 0, 0.5),
                inset 0 -2px 5px rgba(0, 0, 0, 0.2);
        }

        .btn-modern:active {
            transform: translateY(-1px) scale(0.98);
        }

        /* Icon Buttons */
        .icon-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-tertiary);
            border: 2px solid var(--accent-primary);
            color: var(--accent-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.5em;
        }

        .icon-btn:hover {
            background: var(--accent-primary);
            color: #000;
            transform: rotate(15deg) scale(1.1);
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.6);
        }

        /* Progress Bars */
        .progress-bar {
            width: 100%;
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-cyan));
            border-radius: 10px;
            transition: width 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.3),
                transparent
            );
            animation: progress-shine 2s infinite;
        }

        @keyframes progress-shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Tooltips */
        [data-tooltip] {
            position: relative;
            cursor: help;
        }

        [data-tooltip]::before {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%) scale(0);
            padding: 8px 12px;
            background: rgba(0, 255, 0, 0.95);
            color: #000;
            border-radius: 6px;
            font-size: 0.85em;
            white-space: nowrap;
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: none;
            z-index: 1000;
            font-weight: 600;
        }

        [data-tooltip]::after {
            content: '';
            position: absolute;
            bottom: 115%;
            left: 50%;
            transform: translateX(-50%) scale(0);
            border: 6px solid transparent;
            border-top-color: rgba(0, 255, 0, 0.95);
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: none;
        }

        [data-tooltip]:hover::before,
        [data-tooltip]:hover::after {
            transform: translateX(-50%) scale(1);
            opacity: 1;
        }

        /* Collapsible Sections */
        .collapsible-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: var(--bg-secondary);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid var(--border);
        }

        .collapsible-header:hover {
            background: rgba(0, 255, 0, 0.05);
            border-color: var(--accent-primary);
        }

        .collapsible-icon {
            transition: transform 0.3s ease;
            font-size: 1.2em;
        }

        .collapsible-header.active .collapsible-icon {
            transform: rotate(180deg);
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .collapsible-content.active {
            max-height: 2000px;
        }

        /* Workspace Layout */
        .workspace {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
            padding: 20px;
            max-width: 1800px;
            margin: 0 auto;
        }

        .main-area {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .sidebar {
            position: sticky;
            top: 20px;
            height: fit-content;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
        }

        /* Custom Scrollbar */
        .sidebar::-webkit-scrollbar {
            width: 8px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: var(--bg-primary);
            border-radius: 10px;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: var(--accent-primary);
            border-radius: 10px;
        }

        .sidebar::-webkit-scrollbar-thumb:hover {
            background: var(--accent-cyan);
        }

        /* Responsive Workspace */
        @media (max-width: 1200px) {
            .workspace {
                grid-template-columns: 1fr;
            }

            .sidebar {
                position: relative;
                top: 0;
                max-height: none;
            }
        }

        /* Status Indicators */
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            animation: pulse-dot 2s infinite;
        }

        .status-dot.active {
            background: var(--accent-primary);
            box-shadow: 0 0 10px var(--accent-primary);
        }

        .status-dot.inactive {
            background: var(--border);
        }

        @keyframes pulse-dot {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.7;
            }
        }

        /* Loading Spinner */
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--bg-tertiary);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Notification Toast */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, rgba(0, 255, 0, 0.95), rgba(0, 255, 255, 0.95));
            color: #000;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 255, 0, 0.4);
            font-weight: 600;
            z-index: 10000;
            animation: slideInRight 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* ============================================
           CUSTOM DRUM SELECTOR DROPDOWN SYSTEM
           ============================================ */
        
        .drum-selector-container {
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.6), rgba(26, 26, 26, 0.8));
            border-radius: 12px;
            border: 2px solid transparent;
            background-clip: padding-box;
            position: relative;
            overflow: visible;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .drum-selector-container::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-cyan), var(--accent-secondary));
            border-radius: 12px;
            z-index: -1;
            opacity: 0.5;
            transition: opacity 0.3s;
        }

        .drum-selector-container:hover::before {
            opacity: 1;
            animation: border-glow 3s linear infinite;
        }

        @keyframes border-glow {
            0%, 100% { filter: hue-rotate(0deg); }
            50% { filter: hue-rotate(60deg); }
        }

        .drum-selector-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(0, 255, 0, 0.2);
        }

        .drum-selector-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .drum-icon {
            font-size: 2em;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }

        .drum-label {
            font-size: 1.2em;
            font-weight: bold;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 1px;
        }

        .custom-dropdown {
            position: relative;
            width: 100%;
        }

        .dropdown-button {
            width: 100%;
            padding: 16px 50px 16px 20px;
            background: linear-gradient(135deg, rgba(10, 10, 10, 0.9), rgba(26, 26, 26, 0.9));
            border: 2px solid var(--accent-primary);
            border-radius: 10px;
            color: var(--accent-primary);
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: 'Courier New', monospace;
            position: relative;
            overflow: hidden;
        }

        .dropdown-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 0, 0.2), transparent);
            transition: left 0.6s;
        }

        .dropdown-button:hover::before {
            left: 100%;
        }

        .dropdown-button:hover {
            transform: translateY(-3px);
            box-shadow: 
                0 8px 25px rgba(0, 255, 0, 0.4),
                inset 0 1px 0 rgba(0, 255, 0, 0.3);
            border-color: var(--accent-cyan);
        }

        .dropdown-button.active {
            background: linear-gradient(135deg, rgba(0, 255, 0, 0.15), rgba(0, 255, 255, 0.1));
            border-color: var(--accent-cyan);
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.3);
        }

        .dropdown-current {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .dropdown-icon {
            font-size: 1.8em;
        }

        .dropdown-text {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .dropdown-name {
            font-size: 1em;
            color: var(--accent-primary);
        }

        .dropdown-desc {
            font-size: 0.75em;
            color: var(--text-secondary);
            font-weight: normal;
        }

        .dropdown-arrow {
            position: absolute;
            right: 20px;
            font-size: 1.2em;
            transition: transform 0.3s;
            color: var(--accent-cyan);
        }

        .dropdown-button.active .dropdown-arrow {
            transform: rotate(180deg);
        }

        .dropdown-menu {
            position: absolute;
            top: calc(100% + 8px);
            left: 0;
            right: 0;
            background: linear-gradient(135deg, rgba(10, 10, 10, 0.98), rgba(26, 26, 26, 0.98));
            border: 2px solid var(--accent-primary);
            border-radius: 10px;
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 9999;
            backdrop-filter: blur(10px);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.8);
        }

        .dropdown-menu.active {
            max-height: 500px;
            opacity: 1;
            transform: translateY(0);
            z-index: 10000;
            box-shadow: 
                0 15px 50px rgba(0, 0, 0, 0.8),
                0 0 30px rgba(0, 255, 0, 0.2);
        }

        .dropdown-option {
            padding: 16px 20px;
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 1px solid rgba(0, 255, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
        }

        .dropdown-option:last-child {
            border-bottom: none;
        }

        .dropdown-option::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 4px;
            height: 100%;
            background: var(--accent-primary);
            transform: scaleY(0);
            transition: transform 0.2s;
        }

        .dropdown-option:hover::before {
            transform: scaleY(1);
        }

        .dropdown-option:hover {
            background: linear-gradient(90deg, rgba(0, 255, 0, 0.15), transparent);
            padding-left: 28px;
        }

        .dropdown-option.selected {
            background: linear-gradient(90deg, rgba(0, 255, 0, 0.2), rgba(0, 255, 255, 0.1));
            border-left: 4px solid var(--accent-cyan);
            padding-left: 24px;
        }

        .dropdown-option-icon {
            font-size: 2em;
            min-width: 40px;
            text-align: center;
        }

        .dropdown-option-text {
            flex: 1;
        }

        .dropdown-option-name {
            font-size: 1em;
            font-weight: bold;
            color: var(--accent-primary);
            margin-bottom: 4px;
        }

        .dropdown-option.selected .dropdown-option-name {
            color: var(--accent-cyan);
        }

        .dropdown-option-desc {
            font-size: 0.8em;
            color: var(--text-secondary);
        }

        .dropdown-option-check {
            font-size: 1.5em;
            color: var(--accent-cyan);
            opacity: 0;
            transform: scale(0);
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .dropdown-option.selected .dropdown-option-check {
            opacity: 1;
            transform: scale(1);
        }

        .test-button {
            padding: 10px 20px;
            background: linear-gradient(135deg, var(--accent-secondary), #ff6600);
            color: #000;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .test-button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(255, 102, 0, 0.5);
        }

        .test-button:active {
            transform: scale(0.95);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .drum-selector-container {
                padding: 15px;
            }

            .dropdown-button {
                padding: 14px 45px 14px 16px;
                font-size: 1em;
            }

            .drum-icon {
                font-size: 1.5em;
            }

            .drum-label {
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <!-- Mode Indicator Badge -->
    <div class="mode-badge" id="modeBadge">
        <span class="badge-icon">üéöÔ∏è</span>
        <span id="modeText">BASIC MODE</span>
    </div>

    <!-- Modern Header with HAOS Branding -->
    <div class="header" style="background: linear-gradient(135deg, rgba(10, 10, 10, 0.95) 0%, rgba(74, 60, 46, 0.95) 50%, rgba(10, 10, 10, 0.95) 100%); border-bottom: 3px solid var(--haos-groove-orange); padding: 25px 20px; backdrop-filter: blur(10px); box-shadow: var(--haos-shadow-lg);">
        <div style="display: flex; justify-content: space-between; align-items: center; max-width: 1800px; margin: 0 auto; flex-wrap: wrap; gap: 20px;">
            <!-- Logo and Title -->
            <div style="flex: 1;">
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                    <a href="/" style="text-decoration: none;">
                        <img src="/images/haos-logo-white.png" alt="HAOS.fm" style="height: 50px; width: auto; filter: drop-shadow(0 0 15px rgba(255, 107, 53, 0.6));">
                    </a>
                    <div style="border-left: 4px solid var(--haos-groove-orange); padding-left: 15px;">
                        <h1 class="haos-display-md" style="margin: 0; background: linear-gradient(135deg, var(--haos-acid-green), var(--haos-909-cyan)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                            TECHNO STUDIO
                        </h1>
                        <p class="haos-mono" style="margin: 5px 0 0 0; color: var(--haos-sepia-cream); font-size: 0.75rem; letter-spacing: 3px;">
                            INDUSTRIAL SYNTHESIS ‚Ä¢ 303 ACID ‚Ä¢ T78 STYLE
                        </p>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-left: 69px;">
                    <span style="width: 8px; height: 8px; background: var(--haos-acid-green); border-radius: 50%; box-shadow: 0 0 10px var(--haos-acid-green); animation: pulse-dot 2s infinite;"></span>
                    <span class="haos-label">HARD</span>
                    <span style="color: var(--haos-dust-gray);">‚Ä¢</span>
                    <span class="haos-label">ACID</span>
                    <span style="color: var(--haos-dust-gray);">‚Ä¢</span>
                    <span class="haos-label">MINIMAL</span>
                    <span style="color: var(--haos-dust-gray);">‚Ä¢</span>
                    <span class="haos-label">INDUSTRIAL</span>
                    <span style="color: var(--haos-dust-gray);">‚Ä¢</span>
                    <span class="haos-label">DUB</span>
                </div>
            </div>
            
            <!-- Navigation Icons -->
            <div style="display: flex; gap: 12px; align-items: center;">
                <a href="/" class="icon-btn" data-tooltip="‚Üê Back to Home" style="padding: 12px 16px; background: linear-gradient(135deg, rgba(255, 107, 53, 0.2), rgba(212, 175, 55, 0.2)); border: 1px solid var(--haos-groove-orange); border-radius: 8px; color: var(--haos-sepia-cream); text-decoration: none; transition: all 0.3s;">
                    <i class="fas fa-home" style="margin-right: 8px;"></i>HOME
                </a>
                <button id="theme-toggle" class="icon-btn" data-tooltip="Toggle Theme" aria-label="Toggle theme" style="padding: 12px; background: rgba(0, 0, 0, 0.4); border: 1px solid var(--haos-turntable-gold); border-radius: 8px; cursor: pointer;">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="icon-btn" data-tooltip="Settings" onclick="showTechnoNotification('‚öôÔ∏è Settings coming soon!')" style="padding: 12px; background: rgba(0, 0, 0, 0.4); border: 1px solid var(--haos-turntable-gold); border-radius: 8px; cursor: pointer;">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </div>
    </div>
                    <i class="fas fa-cog"></i>
                </button>
                <button class="icon-btn" data-tooltip="Help" onclick="toggleGuidance()">
                    <i class="fas fa-question"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Live Guidance Panel -->
    <div class="guidance-panel" id="guidancePanel">
        <div class="guidance-header" onclick="toggleGuidance()">
            <h3>‚ö° TECHNO GUIDE</h3>
            <span id="guidanceToggle">‚àí</span>
        </div>
        <div class="guidance-content" id="guidanceContent">
            <div class="guidance-tip">
                <div class="guidance-tip-title">üéØ TECHNO WORKFLOW</div>
                <div class="guidance-tip-text">Build hypnotic sequences and driving rhythms</div>
            </div>
            
            <div class="guidance-step">
                <div class="guidance-step-number">1</div>
                <div class="guidance-step-text">Choose a <strong>techno style</strong> (Acid, Minimal, Industrial)</div>
            </div>
            
            <div class="guidance-step">
                <div class="guidance-step-number">2</div>
                <div class="guidance-step-text">Generate a <strong>bassline</strong> or melodic sequence</div>
            </div>
            
            <div class="guidance-step">
                <div class="guidance-step-number">3</div>
                <div class="guidance-step-text">Add <strong>drum patterns</strong> - kick on every beat</div>
            </div>
            
            <div class="guidance-step">
                <div class="guidance-step-number">4</div>
                <div class="guidance-step-text">Set <strong>BPM</strong> (120-140 for techno)</div>
            </div>
            
            <div class="guidance-step">
                <div class="guidance-step-number">5</div>
                <div class="guidance-step-text">Tweak <strong>synthesis</strong> for movement and texture</div>
            </div>
            
            <div class="guidance-step">
                <div class="guidance-step-number">6</div>
                <div class="guidance-step-text">Click <strong>"Play Loop"</strong> to hear the groove</div>
            </div>
            
            <div class="guidance-step">
                <div class="guidance-step-number">7</div>
                <div class="guidance-step-text">Use <strong>"Send to Radio"</strong> to broadcast your techno!</div>
            </div>
            
            <div class="guidance-tip" style="background: rgba(0, 255, 255, 0.1); border-left-color: var(--accent-cyan);">
                <div class="guidance-tip-title">‚ö° TECHNO TIPS</div>
                <div class="guidance-tip-text">
                    ‚Ä¢ 4/4 kick pattern = foundation<br>
                    ‚Ä¢ Acid = TB-303 style squelch<br>
                    ‚Ä¢ Minimal = less is more<br>
                    ‚Ä¢ Industrial = harsh textures<br>
                    ‚Ä¢ Filter automation = movement
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Mode Selector -->
        <div class="mode-selector" id="modeSelector">
            <div class="mode-tab active" data-mode="basic" onclick="switchMode('basic')" title="Perfect for beginners - Essential controls only">
                <span class="mode-icon">üéØ</span>
                <div style="display: flex; flex-direction: column; align-items: flex-start;">
                    <span class="mode-name">BASIC</span>
                    <span class="mode-desc">Essential controls ‚Ä¢ Quick start</span>
                </div>
            </div>
            <div class="mode-tab" data-mode="pro" onclick="switchMode('pro')" title="For intermediate producers - Advanced synthesis controls">
                <span class="mode-icon">üéõÔ∏è</span>
                <div style="display: flex; flex-direction: column; align-items: flex-start;">
                    <span class="mode-name">PRO</span>
                    <span class="mode-desc">Production tools ‚Ä¢ More parameters</span>
                </div>
            </div>
            <div class="mode-tab" data-mode="advanced" onclick="switchMode('advanced')" title="For experts - Full modular synthesis control">
                <span class="mode-icon">‚ö°</span>
                <div style="display: flex; flex-direction: column; align-items: flex-start;">
                    <span class="mode-name">ADVANCED</span>
                    <span class="mode-desc">Full control ‚Ä¢ All features unlocked</span>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="nav-menu">
            <a href="/"><i class="fas fa-home"></i> Home</a>
            <a href="/trap-studio.html"><i class="fas fa-fire"></i> Trap Studio</a>
            <a href="/techno-creator.html" style="background: var(--accent-primary); color: var(--bg-primary);"><i class="fas fa-bolt"></i> Techno Creator</a>
            <a href="/radio.html" style="background: linear-gradient(135deg, #ff00ff, #00ff00); color: #000; font-weight: bold;"><i class="fas fa-broadcast-tower"></i> Radio 24/7</a>
            <button onclick="openArtistModal()" style="background: linear-gradient(135deg, #ff006e, #8338ec); color: #fff; border: none; padding: 12px 24px; border-radius: 5px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(255, 0, 110, 0.4); transition: all 0.3s;">
                <i class="fas fa-star"></i> Add Favorite Artist
            </button>
        </div>

        <!-- Beginner-Friendly Workflow Navigation -->
        <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid var(--accent-primary);">
            <h3 style="color: var(--accent-primary); margin-bottom: 15px; text-align: center; font-family: var(--haos-font-display);">
                üéì YOUR CREATIVE WORKFLOW
            </h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 15px;">
                <div style="text-align: center; padding: 10px; background: rgba(57,255,20,0.1); border-radius: 8px; border: 1px solid var(--accent-primary);">
                    <div style="font-size: 2em; margin-bottom: 5px;">1Ô∏è‚É£</div>
                    <div style="color: var(--accent-primary); font-weight: bold;">Start Here</div>
                    <div style="font-size: 0.8em; color: rgba(255,255,255,0.6);">Quick Start</div>
                </div>
                <div style="text-align: center; padding: 10px; background: rgba(255,107,53,0.1); border-radius: 8px; border: 1px solid var(--accent-secondary);">
                    <div style="font-size: 2em; margin-bottom: 5px;">2Ô∏è‚É£</div>
                    <div style="color: var(--accent-secondary); font-weight: bold;">Add Sounds</div>
                    <div style="font-size: 0.8em; color: rgba(255,255,255,0.6);">Drums & Bass</div>
                </div>
                <div style="text-align: center; padding: 10px; background: rgba(0,255,255,0.1); border-radius: 8px; border: 1px solid var(--accent-cyan);">
                    <div style="font-size: 2em; margin-bottom: 5px;">3Ô∏è‚É£</div>
                    <div style="color: var(--accent-cyan); font-weight: bold;">Customize</div>
                    <div style="font-size: 0.8em; color: rgba(255,255,255,0.6);">Make It Yours</div>
                </div>
                <div style="text-align: center; padding: 10px; background: rgba(255,215,0,0.1); border-radius: 8px; border: 1px solid var(--accent-gold);">
                    <div style="font-size: 2em; margin-bottom: 5px;">4Ô∏è‚É£</div>
                    <div style="color: var(--accent-gold); font-weight: bold;">Record & Share</div>
                    <div style="font-size: 0.8em; color: rgba(255,255,255,0.6);">Finish Track</div>
                </div>
            </div>
        </div>

        <!-- Modern Tab Navigation - Reorganized for Beginners -->
        <div class="tab-container">
            <!-- BEGINNER SECTION -->
            <button class="tab-button active" onclick="switchTab('quickstart')" data-tab="quickstart" title="Perfect for beginners - start making music in 30 seconds">
                <span>üöÄ</span>
                <span>Quick Start</span>
                <span style="font-size: 0.7em; color: var(--accent-primary);">NEW</span>
            </button>
            <button class="tab-button" onclick="switchTab('patterns')" data-tab="patterns" title="Pre-made patterns to get you started">
                <span>ÔøΩ</span>
                <span>Patterns</span>
            </button>
            
            <!-- SOUND CREATION -->
            <button class="tab-button" onclick="switchTab('drums')" data-tab="drums" title="Create drum beats">
                <span>ü•Å</span>
                <span>Drums</span>
            </button>
            <button class="tab-button" onclick="switchTab('bass')" data-tab="bass" title="Add bass lines">
                <span>üîä</span>
                <span>Bass</span>
            </button>
            <button class="tab-button" onclick="switchTab('melody')" data-tab="melody" title="Create melodies">
                <span>üéπ</span>
                <span>Melody</span>
            </button>
            <button class="tab-button" onclick="switchTab('strings')" data-tab="strings" title="Add atmospheric strings">
                <span>üéª</span>
                <span>Strings</span>
            </button>
            
            <!-- AI & MODULAR -->
            <button class="tab-button" onclick="switchTab('generator')" data-tab="generator" title="AI sequence generation">
                <span>ü§ñ</span>
                <span>AI Generator</span>
                <span style="font-size: 0.7em; color: var(--accent-magenta);">AI</span>
            </button>
            <button class="tab-button" onclick="switchTab('synthesis')" data-tab="synthesis" title="Modular synthesis - ARP 2600">
                <span>üéõÔ∏è</span>
                <span>Modular</span>
                <span style="font-size: 0.7em; color: var(--accent-gold);">2600</span>
            </button>
            
            <!-- ADVANCED TOOLS -->
            <button class="tab-button" onclick="switchTab('sequencer')" data-tab="sequencer" title="Advanced pattern sequencer">
                <span>ÔøΩÔ∏è</span>
                <span>Sequencer</span>
                <span style="font-size: 0.7em; color: var(--accent-cyan);">PRO</span>
            </button>
            <button class="tab-button" onclick="switchTab('effects')" data-tab="effects" title="Add effects and polish">
                <span>‚ú®</span>
                <span>Effects</span>
            </button>
            <button class="tab-button" onclick="switchTab('recorder')" data-tab="recorder" title="Record your creation">
                <span>üéôÔ∏è</span>
                <span>Record</span>
            </button>
            <button class="tab-button" onclick="switchTab('arrangement')" data-tab="arrangement" title="Arrange full track">
                <span>üé¨</span>
                <span>Arrange</span>
                <span style="font-size: 0.7em; color: var(--accent-cyan);">PRO</span>
            </button>
        </div>

        <!-- Tab Content: QUICK START (NEW - Default Tab for Beginners) -->
        <div id="tab-quickstart" class="tab-content active modern-card">
            <h2 style="color: var(--accent-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 12px;">
                <span style="font-size: 1.5em;">üöÄ</span>
                QUICK START - Make Music in 30 Seconds!
            </h2>
            
            <p style="color: var(--text-secondary); margin-bottom: 30px; font-size: 1.1em;">
                Welcome! Click a button below to instantly create your first techno beat. No experience needed! üéâ
            </p>

            <!-- Instant Beat Templates -->
            <div style="background: linear-gradient(135deg, rgba(57,255,20,0.1), rgba(255,107,53,0.1)); padding: 30px; border-radius: 15px; margin-bottom: 30px; border: 2px solid var(--accent-primary);">
                <h3 style="color: var(--accent-primary); margin-bottom: 20px; text-align: center;">
                    üéµ ONE-CLICK BEAT STARTERS
                </h3>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 25px;">
                    <!-- Template 1: Classic Techno -->
                    <div onclick="loadQuickTemplate('classic')" style="background: rgba(0,0,0,0.5); padding: 25px; border-radius: 12px; cursor: pointer; border: 2px solid var(--accent-primary); transition: all 0.3s;" 
                         onmouseover="this.style.transform='scale(1.05)'; this.style.borderColor='var(--accent-secondary)'"
                         onmouseout="this.style.transform='scale(1)'; this.style.borderColor='var(--accent-primary)'">
                        <div style="font-size: 3em; text-align: center; margin-bottom: 10px;">üí•</div>
                        <h4 style="color: var(--accent-primary); text-align: center; margin-bottom: 10px;">Classic Techno</h4>
                        <p style="color: rgba(255,255,255,0.7); text-align: center; font-size: 0.9em;">
                            Four-on-the-floor kick with driving hi-hats
                        </p>
                        <div style="text-align: center; margin-top: 15px; color: var(--accent-secondary); font-weight: bold;">
                            135 BPM ‚Ä¢ Beginner
                        </div>
                    </div>

                    <!-- Template 2: Acid House -->
                    <div onclick="loadQuickTemplate('acid')" style="background: rgba(0,0,0,0.5); padding: 25px; border-radius: 12px; cursor: pointer; border: 2px solid var(--accent-primary); transition: all 0.3s;"
                         onmouseover="this.style.transform='scale(1.05)'; this.style.borderColor='var(--accent-secondary)'"
                         onmouseout="this.style.transform='scale(1)'; this.style.borderColor='var(--accent-primary)'">
                        <div style="font-size: 3em; text-align: center; margin-bottom: 10px;">üß™</div>
                        <h4 style="color: var(--accent-primary); text-align: center; margin-bottom: 10px;">Acid Squelch</h4>
                        <p style="color: rgba(255,255,255,0.7); text-align: center; font-size: 0.9em;">
                            TB-303 bass with resonant filter sweeps
                        </p>
                        <div style="text-align: center; margin-top: 15px; color: var(--accent-secondary); font-weight: bold;">
                            128 BPM ‚Ä¢ Beginner
                        </div>
                    </div>

                    <!-- Template 3: Industrial -->
                    <div onclick="loadQuickTemplate('industrial')" style="background: rgba(0,0,0,0.5); padding: 25px; border-radius: 12px; cursor: pointer; border: 2px solid var(--accent-primary); transition: all 0.3s;"
                         onmouseover="this.style.transform='scale(1.05)'; this.style.borderColor='var(--accent-secondary)'"
                         onmouseout="this.style.transform='scale(1)'; this.style.borderColor='var(--accent-primary)'">
                        <div style="font-size: 3em; text-align: center; margin-bottom: 10px;">‚öôÔ∏è</div>
                        <h4 style="color: var(--accent-primary); text-align: center; margin-bottom: 10px;">Industrial Hard</h4>
                        <p style="color: rgba(255,255,255,0.7); text-align: center; font-size: 0.9em;">
                            Heavy kicks with metallic percussion
                        </p>
                        <div style="text-align: center; margin-top: 15px; color: var(--accent-secondary); font-weight: bold;">
                            140 BPM ‚Ä¢ Intermediate
                        </div>
                    </div>

                    <!-- Template 4: Minimal -->
                    <div onclick="loadQuickTemplate('minimal')" style="background: rgba(0,0,0,0.5); padding: 25px; border-radius: 12px; cursor: pointer; border: 2px solid var(--accent-primary); transition: all 0.3s;"
                         onmouseover="this.style.transform='scale(1.05)'; this.style.borderColor='var(--accent-secondary)'"
                         onmouseout="this.style.transform='scale(1)'; this.style.borderColor='var(--accent-primary)'">
                        <div style="font-size: 3em; text-align: center; margin-bottom: 10px;">üéØ</div>
                        <h4 style="color: var(--accent-primary); text-align: center; margin-bottom: 10px;">Minimal Groove</h4>
                        <p style="color: rgba(255,255,255,0.7); text-align: center; font-size: 0.9em;">
                            Sparse drums with hypnotic bass
                        </p>
                        <div style="text-align: center; margin-top: 15px; color: var(--accent-secondary); font-weight: bold;">
                            125 BPM ‚Ä¢ Beginner
                        </div>
                    </div>
                </div>

                <!-- Play Controls -->
                <div style="text-align: center;">
                    <button class="btn" onclick="playQuickStart()" style="font-size: 1.2em; padding: 15px 40px; background: linear-gradient(135deg, var(--accent-primary), var(--accent-cyan));">
                        ‚ñ∂Ô∏è PLAY YOUR BEAT
                    </button>
                    <button class="btn btn-secondary" onclick="stopQuickStart()" style="font-size: 1.2em; padding: 15px 40px; margin-left: 15px;">
                        ‚èπÔ∏è STOP
                    </button>
                </div>
            </div>

            <!-- Next Steps Guide -->
            <div style="background: rgba(0,0,0,0.3); padding: 25px; border-radius: 12px; border: 2px solid var(--accent-cyan);">
                <h3 style="color: var(--accent-cyan); margin-bottom: 20px;">
                    üìö NEXT STEPS - What to Do Next
                </h3>
                
                <div style="display: grid; gap: 15px;">
                    <div style="background: rgba(57,255,20,0.1); padding: 20px; border-radius: 10px; border-left: 4px solid var(--accent-primary);">
                        <h4 style="color: var(--accent-primary); margin-bottom: 10px;">‚úèÔ∏è Step 1: Customize Your Beat</h4>
                        <p style="color: rgba(255,255,255,0.7); margin-bottom: 10px;">
                            Click the <strong>"Drums"</strong> tab to change individual drum sounds and patterns
                        </p>
                        <button class="btn btn-small" onclick="switchTab('drums')">Go to Drums ‚Üí</button>
                    </div>

                    <div style="background: rgba(255,107,53,0.1); padding: 20px; border-radius: 10px; border-left: 4px solid var(--accent-secondary);">
                        <h4 style="color: var(--accent-secondary); margin-bottom: 10px;">üé∏ Step 2: Add Bass Line</h4>
                        <p style="color: rgba(255,255,255,0.7); margin-bottom: 10px;">
                            Click the <strong>"Bass"</strong> tab to add a powerful bassline with TB-303 sounds
                        </p>
                        <button class="btn btn-small btn-secondary" onclick="switchTab('bass')">Go to Bass ‚Üí</button>
                    </div>

                    <div style="background: rgba(0,255,255,0.1); padding: 20px; border-radius: 10px; border-left: 4px solid var(--accent-cyan);">
                        <h4 style="color: var(--accent-cyan); margin-bottom: 10px;">üéπ Step 3: Create Melodies</h4>
                        <p style="color: rgba(255,255,255,0.7); margin-bottom: 10px;">
                            Click the <strong>"Melody"</strong> tab to add synth leads and atmospheric sounds
                        </p>
                        <button class="btn btn-small btn-cyan" onclick="switchTab('melody')">Go to Melody ‚Üí</button>
                    </div>

                    <div style="background: rgba(255,215,0,0.1); padding: 20px; border-radius: 10px; border-left: 4px solid var(--accent-gold);">
                        <h4 style="color: var(--accent-gold); margin-bottom: 10px;">üéôÔ∏è Step 4: Record Your Track</h4>
                        <p style="color: rgba(255,255,255,0.7); margin-bottom: 10px;">
                            When you're happy, click <strong>"Record"</strong> to save your creation
                        </p>
                        <button class="btn btn-small" onclick="switchTab('recorder')" style="background: var(--accent-gold); color: #000;">Go to Record ‚Üí</button>
                    </div>
                </div>
            </div>

            <!-- Tips for Beginners -->
            <div style="background: linear-gradient(135deg, rgba(255,20,147,0.1), rgba(138,56,236,0.1)); padding: 20px; border-radius: 12px; margin-top: 25px; border: 2px solid #FF1493;">
                <h4 style="color: #FF1493; margin-bottom: 15px;">üí° PRO TIPS FOR BEGINNERS</h4>
                <ul style="color: rgba(255,255,255,0.8); line-height: 1.8; padding-left: 20px;">
                    <li><strong>Start Simple:</strong> Use one of the templates above - don't start from scratch</li>
                    <li><strong>One Thing at a Time:</strong> Focus on drums first, then add bass, then melody</li>
                    <li><strong>BPM Matters:</strong> 125-135 BPM is perfect for techno. Lower = deeper, higher = harder</li>
                    <li><strong>Listen to Presets:</strong> Try different drum and bass sounds to find your style</li>
                    <li><strong>Save Often:</strong> Use the Record tab to save your work as you go</li>
                    <li><strong>Experiment:</strong> There are no mistakes in electronic music - just happy accidents! üéµ</li>
                </ul>
            </div>
        </div>

        <!-- Tab Content: PATTERNS (Preset Patterns Library) -->
        <div id="tab-patterns" class="tab-content modern-card">
            <h2 style="color: var(--accent-secondary); margin-bottom: 20px; display: flex; align-items: center; gap: 12px;">
                <span style="font-size: 1.5em;">ÔøΩ</span>
                PATTERN LIBRARY
            </h2>
            
            <p style="color: var(--text-secondary); margin-bottom: 25px;">
                Browse and load pre-made drum patterns to kickstart your track
            </p>

            <div id="patternLibraryContent">
                <!-- Will be populated with pattern cards -->
            </div>
        </div>

        <!-- Tab Content: DRUMS (Simplified Drum Creation) -->
        <div id="tab-drums" class="tab-content modern-card">
            <h2 style="color: var(--accent-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 12px;">
                <span style="font-size: 1.5em;">ü•Å</span>
                DRUM MACHINE
            </h2>
            
            <p style="color: var(--text-secondary); margin-bottom: 25px;">
                Create your drum patterns using our easy step sequencer
            </p>

            <!-- Simple 4x4 Drum Grid -->
            <div style="background: rgba(0,0,0,0.3); padding: 25px; border-radius: 12px; margin-bottom: 25px;">
                <h3 style="color: var(--accent-primary); margin-bottom: 20px;">üéõÔ∏è Step Sequencer (16 Steps)</h3>
                
                <!-- Kick Row -->
                <div style="margin-bottom: 20px;">
                    <div style="color: var(--accent-primary); font-weight: bold; margin-bottom: 10px;">üí• KICK DRUM</div>
                    <div id="kickSteps" style="display: grid; grid-template-columns: repeat(16, 1fr); gap: 5px;">
                        <!-- Steps will be generated -->
                    </div>
                </div>

                <!-- Snare/Clap Row -->
                <div style="margin-bottom: 20px;">
                    <div style="color: var(--accent-secondary); font-weight: bold; margin-bottom: 10px;">üëè CLAP/SNARE</div>
                    <div id="clapSteps" style="display: grid; grid-template-columns: repeat(16, 1fr); gap: 5px;">
                        <!-- Steps will be generated -->
                    </div>
                </div>

                <!-- Hi-Hat Row -->
                <div style="margin-bottom: 20px;">
                    <div style="color: var(--accent-cyan); font-weight: bold; margin-bottom: 10px;">üé© HI-HAT</div>
                    <div id="hatSteps" style="display: grid; grid-template-columns: repeat(16, 1fr); gap: 5px;">
                        <!-- Steps will be generated -->
                    </div>
                </div>

                <!-- Percussion Row -->
                <div>
                    <div style="color: var(--accent-gold); font-weight: bold; margin-bottom: 10px;">üîî PERCUSSION</div>
                    <div id="percSteps" style="display: grid; grid-template-columns: repeat(16, 1fr); gap: 5px;">
                        <!-- Steps will be generated -->
                    </div>
                </div>
            </div>

            <!-- Drum Sound Selection -->
            <div style="background: rgba(0,0,0,0.3); padding: 25px; border-radius: 12px;">
                <h3 style="color: var(--accent-cyan); margin-bottom: 20px;">üîä Drum Sounds</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <!-- Drum sound selectors will be added -->
                </div>
            </div>
        </div>

        <!-- Tab Content: BASS (Simplified Bass Creation) -->
        <div id="tab-bass" class="tab-content modern-card">
            <h2 style="color: var(--accent-secondary); margin-bottom: 20px; display: flex; align-items: center; gap: 12px;">
                <span style="font-size: 1.5em;">üîä</span>
                BASS SYNTHESIZER
            </h2>
            
            <p style="color: var(--text-secondary); margin-bottom: 25px;">
                Create powerful basslines with classic TB-303 acid sounds
            </p>

            <!-- Bass Preset Cards -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 25px;">
                <div onclick="loadBassPreset('acid')" style="background: rgba(57,255,20,0.1); padding: 20px; border-radius: 12px; cursor: pointer; border: 2px solid var(--accent-primary); transition: all 0.3s;">
                    <h4 style="color: var(--accent-primary); margin-bottom: 10px;">üß™ Acid Squelch</h4>
                    <p style="color: rgba(255,255,255,0.7); font-size: 0.9em;">Classic 303 with resonant filter sweeps</p>
                </div>
                <div onclick="loadBassPreset('deep')" style="background: rgba(255,107,53,0.1); padding: 20px; border-radius: 12px; cursor: pointer; border: 2px solid var(--accent-secondary); transition: all 0.3s;">
                    <h4 style="color: var(--accent-secondary); margin-bottom: 10px;">üåä Deep Sub</h4>
                    <p style="color: rgba(255,255,255,0.7); font-size: 0.9em;">Warm sub-bass for foundation</p>
                </div>
                <div onclick="loadBassPreset('plucky')" style="background: rgba(0,255,255,0.1); padding: 20px; border-radius: 12px; cursor: pointer; border: 2px solid var(--accent-cyan); transition: all 0.3s;">
                    <h4 style="color: var(--accent-cyan); margin-bottom: 10px;">üé∏ Plucky Lead</h4>
                    <p style="color: rgba(255,255,255,0.7); font-size: 0.9em;">Short, punchy bass notes</p>
                </div>
            </div>

            <!-- Simple Bass Pattern Creator -->
            <div style="background: rgba(0,0,0,0.3); padding: 25px; border-radius: 12px;">
                <h3 style="color: var(--accent-primary); margin-bottom: 20px;">üéπ Bass Pattern</h3>
                <div id="bassPatternGrid">
                    <!-- Bass pattern grid will be generated -->
                </div>
            </div>
        </div>

        <!-- Tab Content: MELODY (Simplified Melody Creation) -->
        <div id="tab-melody" class="tab-content modern-card">
            <h2 style="color: var(--accent-cyan); margin-bottom: 20px; display: flex; align-items: center; gap: 12px;">
                <span style="font-size: 1.5em;">üéπ</span>
                MELODY & LEADS
            </h2>
            
            <p style="color: var(--text-secondary); margin-bottom: 25px;">
                Add atmospheric melodies and lead synths to your track
            </p>

            <!-- Quick melody templates -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <button class="btn" onclick="playMelodyTemplate('arpeggio')">
                    üéº Arpeggio Pattern
                </button>
                <button class="btn btn-secondary" onclick="playMelodyTemplate('pad')">
                    üåä Atmospheric Pad
                </button>
                <button class="btn btn-cyan" onclick="playMelodyTemplate('lead')">
                    üé∏ Lead Melody
                </button>
            </div>
        </div>

        <!-- Tab Content: Sequencer (Advanced - Previously Main) -->
        <div id="tab-sequencer" class="tab-content modern-card">
            <h2 style="color: var(--accent-cyan); margin-bottom: 20px; display: flex; align-items: center; gap: 12px;">
                <span style="font-size: 1.5em;">üéõÔ∏è</span>
                ADVANCED SEQUENCER
                <span style="font-size: 0.7em; padding: 4px 12px; background: var(--accent-cyan); color: #000; border-radius: 12px;">PRO</span>
            </h2>
            
            <div style="display: grid; grid-template-columns: 1fr auto; gap: 20px; margin-bottom: 25px;">
                <div>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">
                        Full 8-track pattern sequencer for advanced users
                    </p>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <div style="background: rgba(0, 255, 0, 0.1); padding: 8px 16px; border-radius: 6px; border: 1px solid rgba(0, 255, 0, 0.3);">
                            <span style="color: var(--accent-primary); font-weight: bold;">BPM:</span>
                            <span id="currentBPM" style="color: var(--text-primary); margin-left: 5px;">135</span>
                        </div>
                        <div style="background: rgba(0, 255, 255, 0.1); padding: 8px 16px; border-radius: 6px; border: 1px solid rgba(0, 255, 255, 0.3);">
                            <span style="color: var(--accent-cyan); font-weight: bold;">Steps:</span>
                            <span style="color: var(--text-primary); margin-left: 5px;">16</span>
                        </div>
                        <div style="background: rgba(255, 0, 255, 0.1); padding: 8px 16px; border-radius: 6px; border: 1px solid rgba(255, 0, 255, 0.3);">
                            <span style="color: var(--accent-secondary); font-weight: bold;">Tracks:</span>
                            <span style="color: var(--text-primary); margin-left: 5px;">8</span>
                        </div>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <label style="color: var(--text-secondary);">BPM:</label>
                    <input type="range" id="technoBPM" min="110" max="160" value="135" 
                           oninput="updateTechnoBPM(this.value)" 
                           style="width: 150px;">
                    <span id="bpmDisplay" style="color: var(--accent-primary); font-weight: bold; min-width: 40px;">135</span>
                </div>
            </div>

            <!-- Preset Patterns -->
            <div class="collapsible-header" onclick="toggleCollapsible(this)" style="margin-bottom: 15px;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 1.2em;">üì¶</span>
                    <h3 style="margin: 0; color: var(--accent-primary);">PRESET PATTERNS</h3>
                </div>
                <span class="collapsible-icon">‚ñº</span>
            </div>
            <div class="collapsible-content active" style="margin-bottom: 25px;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px; padding: 15px; background: var(--bg-primary); border-radius: 8px;">
                    <!-- T78 STYLE PRESETS -->
                    <button class="btn" onclick="loadTechnoPreset('t78_rolling')" style="display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 15px; background: linear-gradient(135deg, #ff0040, #ff4070); border: 2px solid #ff0040;">
                        <span style="font-size: 2em;">üî•</span>
                        <span style="font-weight: bold;">T78 Rolling</span>
                        <span style="font-size: 0.8em; color: rgba(255,255,255,0.9);">148 BPM ‚Ä¢ Driving</span>
                    </button>
                    <button class="btn" onclick="loadTechnoPreset('t78_peak')" style="display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 15px; background: linear-gradient(135deg, #ff006e, #ff3090); border: 2px solid #ff006e;">
                        <span style="font-size: 2em;">üí•</span>
                        <span style="font-weight: bold;">T78 Peak Time</span>
                        <span style="font-size: 0.8em; color: rgba(255,255,255,0.9);">150 BPM ‚Ä¢ Hard</span>
                    </button>
                    <button class="btn" onclick="loadTechnoPreset('t78_hypnotic')" style="display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 15px; background: linear-gradient(135deg, #9d00ff, #bd30ff); border: 2px solid #9d00ff;">
                        <span style="font-size: 2em;">üåÄ</span>
                        <span style="font-weight: bold;">T78 Hypnotic</span>
                        <span style="font-size: 0.8em; color: rgba(255,255,255,0.9);">146 BPM ‚Ä¢ Loop</span>
                    </button>
                    
                    <!-- ORIGINAL PRESETS -->
                    <button class="btn btn-secondary" onclick="loadTechnoPreset('hard_techno')" style="display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 15px;">
                        <span style="font-size: 2em;">‚ö°</span>
                        <span style="font-weight: bold;">Hard Techno</span>
                        <span style="font-size: 0.8em; color: var(--text-secondary);">140-150 BPM</span>
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoPreset('minimal')" style="display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 15px;">
                        <span style="font-size: 2em;">üéµ</span>
                        <span style="font-weight: bold;">Minimal</span>
                        <span style="font-size: 0.8em; color: var(--text-secondary);">128-132 BPM</span>
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoPreset('industrial')" style="display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 15px;">
                        <span style="font-size: 2em;">‚öôÔ∏è</span>
                        <span style="font-weight: bold;">Industrial</span>
                        <span style="font-size: 0.8em; color: var(--text-secondary);">135-145 BPM</span>
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoPreset('acid_groove')" style="display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 15px;">
                        <span style="font-size: 2em;">üîä</span>
                        <span style="font-weight: bold;">Acid Groove</span>
                        <span style="font-size: 0.8em; color: var(--text-secondary);">128-138 BPM</span>
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoPreset('dub_techno')" style="display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 15px;">
                        <span style="font-size: 2em;">üåä</span>
                        <span style="font-weight: bold;">Dub Techno</span>
                        <span style="font-size: 0.8em; color: var(--text-secondary);">118-125 BPM</span>
                    </button>
                </div>
            </div>

            <!-- Sequencer Grid (keep existing) -->

        <!-- Tab Content: Generator -->
        <div id="tab-generator" class="tab-content modern-card">
            <h2 style="color: var(--accent-cyan); margin-bottom: 20px; display: flex; align-items: center; gap: 12px;">
                <span style="font-size: 1.5em;">üéπ</span>
                SEQUENCE GENERATOR
            </h2>
            <p style="color: var(--text-secondary); margin-bottom: 25px;">
                Generate hypnotic sequences and minimal progressions for various techno subgenres
            </p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                <!-- Key Selection -->
                <div class="control-group">
                    <label for="technoKey">Root Note:</label>
                    <select id="technoKey">
                        <option value="C">C</option>
                        <option value="C#">C# / Db</option>
                        <option value="D">D</option>
                        <option value="D#">D# / Eb</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="F#">F# / Gb</option>
                        <option value="G">G</option>
                        <option value="G#">G# / Ab</option>
                        <option value="A" selected>A</option>
                        <option value="A#">A# / Bb</option>
                        <option value="B">B</option>
                    </select>
                </div>

                <!-- Scale Type -->
                <div class="control-group">
                    <label for="technoScale">Scale/Mode:</label>
                    <select id="technoScale">
                        <option value="minor" selected>Natural Minor (Aeolian)</option>
                        <option value="phrygian">Phrygian (Dark)</option>
                        <option value="dorian">Dorian (Groovy)</option>
                        <option value="minor_penta">Minor Pentatonic</option>
                        <option value="harmonic">Harmonic Minor</option>
                    </select>
                </div>

                <!-- Subgenre -->
                <div class="control-group">
                    <label for="technoSubgenre">Techno Subgenre:</label>
                    <select id="technoSubgenre">
                        <option value="t78_style">T78 Style (Hard, Driving, 145-150 BPM)</option>
                        <option value="hard_techno">Hard Techno (Fast, Aggressive)</option>
                        <option value="acid_techno" selected>Acid Techno (303 Style)</option>
                        <option value="minimal">Minimal Techno (Hypnotic)</option>
                        <option value="industrial">Industrial Techno (Dark)</option>
                        <option value="detroit">Detroit Techno (Classic)</option>
                        <option value="dub_techno">Dub Techno (Deep)</option>
                    </select>
                </div>
            </div>

            <!-- Generate Buttons -->
            <div style="margin: 20px 0; display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
                <button class="btn" onclick="generateTechnoSequence()">
                    ‚ö° Generate Sequence
                </button>
                <button class="btn btn-secondary" onclick="playTechnoSequence()">
                    ‚ñ∂Ô∏è Play Preview
                </button>
                <button class="btn btn-cyan" onclick="randomizeTechnoSequence()">
                    üé≤ Randomize
                </button>
            </div>

            <!-- Instrument Selection -->
            <div style="margin: 15px 0; padding: 15px; background: var(--bg-tertiary); border-radius: 10px; border: 1px solid var(--accent-primary);">
                <p style="color: var(--text-secondary); margin-bottom: 10px; font-size: 0.9em;">
                    üéõÔ∏è SELECT SYNTHESIS ENGINE:
                </p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                    <button class="btn btn-secondary" onclick="setTechnoInstrument('enhanced')" id="inst-enhanced_techno" style="padding: 8px 12px; font-size: 0.85em; background: linear-gradient(135deg, var(--accent-primary), var(--accent-cyan)); color: #000; font-weight: bold; border: 2px solid var(--accent-cyan);">
                        ‚ö° ENHANCED
                    </button>
                    <button class="btn btn-secondary" onclick="setTechnoInstrument('acid_bass')" id="inst-acid_bass" style="padding: 8px 12px; font-size: 0.85em; border: 2px solid var(--accent-primary);">
                        üîä Acid Bass (303)
                    </button>
                    <button class="btn btn-secondary" onclick="setTechnoInstrument('minimal_stab')" id="inst-minimal_stab" style="padding: 8px 12px; font-size: 0.85em;">
                        üéπ Minimal Stab
                    </button>
                    <button class="btn btn-secondary" onclick="setTechnoInstrument('dub_chord')" id="inst-dub_chord" style="padding: 8px 12px; font-size: 0.85em;">
                        üåä Dub Chord
                    </button>
                    <button class="btn btn-secondary" onclick="setTechnoInstrument('industrial_drone')" id="inst-industrial_drone" style="padding: 8px 12px; font-size: 0.85em;">
                        ‚öôÔ∏è Industrial Drone
                    </button>
                    <button class="btn btn-secondary" onclick="setTechnoInstrument('detroit_pad')" id="inst-detroit_pad" style="padding: 8px 12px; font-size: 0.85em;">
                        üèôÔ∏è Detroit Pad
                    </button>
                    <button class="btn btn-secondary" onclick="setTechnoInstrument('perc_synth')" id="inst-perc_synth" style="padding: 8px 12px; font-size: 0.85em;">
                        ü•Å Perc Synth
                    </button>
                </div>
            </div>

            <!-- Advanced Controls -->
            <div style="margin: 15px 0; padding: 15px; background: var(--bg-tertiary); border-radius: 10px; border: 1px solid var(--accent-primary);">
                <p style="color: var(--text-secondary); margin-bottom: 10px; font-size: 0.9em;">
                    ‚öôÔ∏è MODULATION & EFFECTS:
                </p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <!-- Acid Parameters -->
                    <div>
                        <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                            üéõÔ∏è Filter Resonance: <span id="resonanceValue">70</span>%
                        </label>
                        <input type="range" id="resonanceControl" min="0" max="100" value="70" 
                               oninput="document.getElementById('resonanceValue').textContent = this.value"
                               style="width: 100%;">
                    </div>

                    <!-- Filter Cutoff -->
                    <div>
                        <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                            üîß Filter Cutoff: <span id="cutoffValue">500</span> Hz
                        </label>
                        <input type="range" id="cutoffControl" min="100" max="5000" value="500" 
                               oninput="document.getElementById('cutoffValue').textContent = this.value"
                               style="width: 100%;">
                    </div>

                    <!-- Glide/Portamento -->
                    <div>
                        <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                            üéµ Glide Time: <span id="glideValue">50</span> ms
                        </label>
                        <input type="range" id="glideControl" min="0" max="200" value="50" 
                               oninput="document.getElementById('glideValue').textContent = this.value"
                               style="width: 100%;">
                    </div>

                    <!-- Distortion -->
                    <div>
                        <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                            üî• Distortion: <span id="distortionValue">30</span>%
                        </label>
                        <input type="range" id="distortionControl" min="0" max="100" value="30" 
                               oninput="document.getElementById('distortionValue').textContent = this.value"
                               style="width: 100%;">
                    </div>
                </div>

                <!-- Effect Toggles -->
                <div style="margin-top: 15px; display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                    <label style="display: flex; align-items: center; color: var(--text-secondary); font-size: 0.85em; cursor: pointer;">
                        <input type="checkbox" id="delayToggle" checked style="margin-right: 8px;">
                        ‚è±Ô∏è Delay
                    </label>
                    <label style="display: flex; align-items: center; color: var(--text-secondary); font-size: 0.85em; cursor: pointer;">
                        <input type="checkbox" id="reverbToggle" checked style="margin-right: 8px;">
                        üåä Reverb
                    </label>
                    <label style="display: flex; align-items: center; color: var(--text-secondary); font-size: 0.85em; cursor: pointer;">
                        <input type="checkbox" id="lfoToggle" checked style="margin-right: 8px;">
                        „Ä∞Ô∏è LFO Modulation
                    </label>
                </div>
            </div>

            <!-- Advanced Synthesis Engine -->
            <div style="margin: 15px 0; padding: 20px; background: linear-gradient(135deg, rgba(0, 255, 0, 0.1), rgba(255, 0, 255, 0.1)); border: 2px solid var(--accent-primary); border-radius: 10px;">
                <h3 style="color: var(--accent-cyan); margin-bottom: 15px; font-size: 1.1em; text-align: center;">
                    ‚ö° ADVANCED SYNTHESIS ENGINE ‚ö°
                </h3>
                
                <!-- Oscillator Section -->
                <div style="margin-bottom: 15px; padding: 15px; background: rgba(0,0,0,0.5); border-radius: 8px; border: 1px solid var(--border);">
                    <p style="color: var(--accent-primary); margin-bottom: 10px; font-size: 0.95em; font-weight: bold;">
                        >>> OSCILLATOR <<<
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px;">
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Waveform:
                            </label>
                            <select id="technoWaveform" class="form-control" style="width: 100%; padding: 6px; background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--accent-primary); border-radius: 5px; font-family: 'Courier New', monospace;">
                                <option value="sine">SINE</option>
                                <option value="triangle">TRIANGLE</option>
                                <option value="sawtooth" selected>SAWTOOTH</option>
                                <option value="square">SQUARE</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Unison: <span id="technoUnisonValue">3</span>
                            </label>
                            <input type="range" id="technoUnison" min="1" max="7" value="3" step="2"
                                   oninput="document.getElementById('technoUnisonValue').textContent = this.value"
                                   style="width: 100%;">
                        </div>
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Detune: <span id="technoDetuneValue">10</span> cents
                            </label>
                            <input type="range" id="technoDetune" min="0" max="50" value="10"
                                   oninput="document.getElementById('technoDetuneValue').textContent = this.value"
                                   style="width: 100%;">
                        </div>
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Harmonics: <span id="technoHarmonicsValue">3</span>
                            </label>
                            <input type="range" id="technoHarmonics" min="0" max="5" value="3"
                                   oninput="document.getElementById('technoHarmonicsValue').textContent = this.value"
                                   style="width: 100%;">
                        </div>
                    </div>
                </div>

                <!-- Filter Section -->
                <div style="margin-bottom: 15px; padding: 15px; background: rgba(0,0,0,0.5); border-radius: 8px; border: 1px solid var(--border);">
                    <p style="color: var(--accent-primary); margin-bottom: 10px; font-size: 0.95em; font-weight: bold;">
                        >>> FILTER <<<
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px;">
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Type:
                            </label>
                            <select id="technoFilterType" class="form-control" style="width: 100%; padding: 6px; background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--accent-primary); border-radius: 5px; font-family: 'Courier New', monospace;">
                                <option value="lowpass" selected>LOW-PASS</option>
                                <option value="highpass">HIGH-PASS</option>
                                <option value="bandpass">BAND-PASS</option>
                                <option value="notch">NOTCH</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Filter Env: <span id="technoFilterEnvValue">80</span>%
                            </label>
                            <input type="range" id="technoFilterEnv" min="0" max="100" value="80"
                                   oninput="document.getElementById('technoFilterEnvValue').textContent = this.value"
                                   style="width: 100%;">
                        </div>
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Velocity: <span id="technoVelocityValue">90</span>%
                            </label>
                            <input type="range" id="technoVelocity" min="30" max="100" value="90"
                                   oninput="document.getElementById('technoVelocityValue').textContent = this.value"
                                   style="width: 100%;">
                        </div>
                    </div>
                </div>

                <!-- Envelope Section -->
                <div style="margin-bottom: 15px; padding: 15px; background: rgba(0,0,0,0.5); border-radius: 8px; border: 1px solid var(--border);">
                    <p style="color: var(--accent-primary); margin-bottom: 10px; font-size: 0.95em; font-weight: bold;">
                        >>> ENVELOPE (ADSR) <<<
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px;">
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Attack: <span id="technoAttackValue">0.01</span>s
                            </label>
                            <input type="range" id="technoAttack" min="0.001" max="1" value="0.01" step="0.001"
                                   oninput="document.getElementById('technoAttackValue').textContent = parseFloat(this.value).toFixed(3)"
                                   style="width: 100%;">
                        </div>
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Decay: <span id="technoDecayValue">0.2</span>s
                            </label>
                            <input type="range" id="technoDecay" min="0.01" max="2" value="0.2" step="0.01"
                                   oninput="document.getElementById('technoDecayValue').textContent = parseFloat(this.value).toFixed(2)"
                                   style="width: 100%;">
                        </div>
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Sustain: <span id="technoSustainValue">50</span>%
                            </label>
                            <input type="range" id="technoSustain" min="0" max="100" value="50"
                                   oninput="document.getElementById('technoSustainValue').textContent = this.value"
                                   style="width: 100%;">
                        </div>
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Release: <span id="technoReleaseValue">0.3</span>s
                            </label>
                            <input type="range" id="technoRelease" min="0.01" max="3" value="0.3" step="0.01"
                                   oninput="document.getElementById('technoReleaseValue').textContent = parseFloat(this.value).toFixed(2)"
                                   style="width: 100%;">
                        </div>
                    </div>
                </div>

                <!-- LFO Configuration -->
                <div style="margin-bottom: 15px; padding: 15px; background: rgba(0,0,0,0.5); border-radius: 8px; border: 1px solid var(--border);">
                    <p style="color: var(--accent-primary); margin-bottom: 10px; font-size: 0.95em; font-weight: bold;">
                        >>> LFO MODULATION <<<
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px;">
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                LFO Rate: <span id="technoLFORateValue">6</span> Hz
                            </label>
                            <input type="range" id="technoLFORate" min="0.1" max="20" value="6" step="0.1"
                                   oninput="document.getElementById('technoLFORateValue').textContent = parseFloat(this.value).toFixed(1)"
                                   style="width: 100%;">
                        </div>
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                LFO Depth: <span id="technoLFODepthValue">40</span>%
                            </label>
                            <input type="range" id="technoLFODepth" min="0" max="100" value="40"
                                   oninput="document.getElementById('technoLFODepthValue').textContent = this.value"
                                   style="width: 100%;">
                        </div>
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px;">
                                Target:
                            </label>
                            <select id="technoLFOTarget" class="form-control" style="width: 100%; padding: 6px; background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--accent-primary); border-radius: 5px; font-family: 'Courier New', monospace;">
                                <option value="pitch">PITCH</option>
                                <option value="filter" selected>FILTER</option>
                                <option value="volume">VOLUME</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Automation -->
                <div style="padding: 15px; background: rgba(0,0,0,0.5); border-radius: 8px; border: 1px solid var(--border);">
                    <p style="color: var(--accent-primary); margin-bottom: 10px; font-size: 0.95em; font-weight: bold;">
                        >>> AUTOMATION <<<
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px;">
                        <label style="display: flex; align-items: center; color: var(--text-secondary); font-size: 0.85em; cursor: pointer;">
                            <input type="checkbox" id="technoAutoFilter" style="margin-right: 8px;">
                            FILTER SWEEP
                        </label>
                        <label style="display: flex; align-items: center; color: var(--text-secondary); font-size: 0.85em; cursor: pointer;">
                            <input type="checkbox" id="technoAutoVolume" style="margin-right: 8px;">
                            VOLUME FADE
                        </label>
                        <label style="display: flex; align-items: center; color: var(--text-secondary); font-size: 0.85em; cursor: pointer;">
                            <input type="checkbox" id="technoAutoPan" style="margin-right: 8px;">
                            AUTO-PAN
                        </label>
                        <label style="display: flex; align-items: center; color: var(--text-secondary); font-size: 0.85em; cursor: pointer;">
                            <input type="checkbox" id="technoPulseWidth" style="margin-right: 8px;">
                            PULSE WIDTH MOD
                        </label>
                    </div>
                </div>
            </div>

            <!-- Sequence Display -->
            <div id="technoDisplay" class="chord-display">
                <p style="text-align: center; color: var(--text-secondary);">
                    >>> READY TO GENERATE TECHNO SEQUENCE <<<
                </p>
            </div>

            <div id="technoOutput" class="output-box" style="display: none;">
                <pre id="technoCode"></pre>
            </div>
        </div>

        <!-- Techno Beat Sequencer -->
        <div class="tool-section animated">
            <h2>ü•Å TECHNO DRUM MACHINE</h2>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                Create hard-hitting techno drum patterns (16-step sequencer)
            </p>

            <div class="control-group">
                <label for="technoBpmControl">BPM: <span class="bpm-display" id="technoBpmValue">135</span></label>
                <input type="range" id="technoBpmControl" min="120" max="160" value="135" 
                       oninput="updateTechnoBPM(this.value)">
            </div>

            <!-- 2600 DRUM SYNTHESIS VARIATIONS -->
            <div class="collapsible-header active" onclick="toggleCollapsible(this)" style="margin: 25px 0 15px 0;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 1.2em;">ü•Å</span>
                    <h3 style="margin: 0; color: var(--accent-primary);">2600 DRUM SYNTHESIS VARIATIONS</h3>
                </div>
                <span class="collapsible-icon">‚ñº</span>
            </div>
            <div class="collapsible-content active" style="margin-bottom: 25px;">
                <div style="padding: 20px; background: var(--bg-primary); border-radius: 8px;">
                    <p style="color: var(--text-secondary); margin-bottom: 20px; font-size: 0.9em;">
                        üéõÔ∏è Classic analog drum synthesis using virtual 2600 patching ‚Ä¢ VCO ‚Üí VCF ‚Üí VCA routing
                    </p>

                    <!-- KICK VARIATIONS -->
                    <div class="drum-selector-container">
                        <div class="drum-selector-header">
                            <div class="drum-selector-title">
                                <span class="drum-icon">üí•</span>
                                <span class="drum-label">KICK DRUM</span>
                            </div>
                            <button class="test-button" onclick="testDrumSound('kick')">‚ñ∂Ô∏è TEST</button>
                        </div>
                        <div class="custom-dropdown">
                            <div class="dropdown-button" onclick="toggleDropdown('kick-dropdown')">
                                <div class="dropdown-current">
                                    <span class="dropdown-icon" id="kick-icon">üí•</span>
                                    <div class="dropdown-text">
                                        <span class="dropdown-name" id="kick-name">CLASSIC 808</span>
                                        <span class="dropdown-desc" id="kick-desc">150Hz ‚Üí 40Hz sweep</span>
                                    </div>
                                </div>
                                <span class="dropdown-arrow">‚ñº</span>
                            </div>
                            <div class="dropdown-menu" id="kick-dropdown">
                                <div class="dropdown-option selected" onclick="selectDrumVariation('kick', 'classic', 'üí•', 'CLASSIC 808', '150Hz ‚Üí 40Hz sweep ‚Ä¢ Balanced punch')">
                                    <span class="dropdown-option-icon">üí•</span>
                                    <div class="dropdown-option-text">
                                        <div class="dropdown-option-name">CLASSIC 808</div>
                                        <div class="dropdown-option-desc">150Hz ‚Üí 40Hz sweep ‚Ä¢ Balanced punch</div>
                                    </div>
                                    <span class="dropdown-option-check">‚úì</span>
                                </div>
                                <div class="dropdown-option" onclick="selectDrumVariation('kick', 'deep', 'üîä', 'DEEP SUB', '60Hz sub bass punch ‚Ä¢ Maximum low end')">
                                    <span class="dropdown-option-icon">üîä</span>
                                    <div class="dropdown-option-text">
                                        <div class="dropdown-option-name">DEEP SUB</div>
                                        <div class="dropdown-option-desc">60Hz sub bass punch ‚Ä¢ Maximum low end</div>
                                    </div>
                                    <span class="dropdown-option-check">‚úì</span>
                                </div>
                                <div class="dropdown-option" onclick="selectDrumVariation('kick', 'hard', '‚ö°', 'HARD TECHNO', '180Hz bright attack ‚Ä¢ Industrial strength')">
                                    <span class="dropdown-option-icon">‚ö°</span>
                                    <div class="dropdown-option-text">
                                        <div class="dropdown-option-name">HARD TECHNO</div>
                                        <div class="dropdown-option-desc">180Hz bright attack ‚Ä¢ Industrial strength</div>
                                    </div>
                                    <span class="dropdown-option-check">‚úì</span>
                                </div>
                                <div class="dropdown-option" onclick="selectDrumVariation('kick', 'industrial', '‚öôÔ∏è', 'INDUSTRIAL', 'Distorted + noise layer ‚Ä¢ Raw power')">
                                    <span class="dropdown-option-icon">‚öôÔ∏è</span>
                                    <div class="dropdown-option-text">
                                        <div class="dropdown-option-name">INDUSTRIAL</div>
                                        <div class="dropdown-option-desc">Distorted + noise layer ‚Ä¢ Raw power</div>
                                    </div>
                                    <span class="dropdown-option-check">‚úì</span>
                                </div>
                                <div class="dropdown-option" onclick="selectDrumVariation('kick', 'acid', 'üß™', 'ACID KICK', '200Hz‚Üí30Hz sweep ‚Ä¢ TB-303 character')">
                                    <span class="dropdown-option-icon">üß™</span>
                                    <div class="dropdown-option-text">
                                        <div class="dropdown-option-name">ACID KICK</div>
                                        <div class="dropdown-option-desc">200Hz‚Üí30Hz sweep ‚Ä¢ TB-303 character</div>
                                    </div>
                                    <span class="dropdown-option-check">‚úì</span>
                                </div>
                                <div class="dropdown-option" onclick="selectDrumVariation('kick', 'minimal', '‚¨ú', 'MINIMAL', '100Hz pure sine ‚Ä¢ Clean & tight')">
                                    <span class="dropdown-option-icon">‚¨ú</span>
                                    <div class="dropdown-option-text">
                                        <div class="dropdown-option-name">MINIMAL</div>
                                        <div class="dropdown-option-desc">100Hz pure sine ‚Ä¢ Clean & tight</div>
                                    </div>
                                    <span class="dropdown-option-check">‚úì</span>
                                </div>
                                <div class="dropdown-option" onclick="selectDrumVariation('kick', 'rumble', 'üåä', 'RUMBLE KICK', '50Hz sub earthquake ‚Ä¢ Bass heavy')">
                                    <span class="dropdown-option-icon">üåä</span>
                                    <div class="dropdown-option-text">
                                        <div class="dropdown-option-name">RUMBLE KICK</div>
                                        <div class="dropdown-option-desc">50Hz sub earthquake ‚Ä¢ Bass heavy</div>
                                    </div>
                                    <span class="dropdown-option-check">‚úì</span>
                                </div>
                                <div class="dropdown-option" onclick="selectDrumVariation('kick', 'tribal', 'üî•', 'TRIBAL', '120Hz tonal ‚Ä¢ Ethnic groove')">
                                    <span class="dropdown-option-icon">üî•</span>
                                    <div class="dropdown-option-text">
                                        <div class="dropdown-option-name">TRIBAL</div>
                                        <div class="dropdown-option-desc">120Hz tonal ‚Ä¢ Ethnic groove</div>
                                    </div>
                                    <span class="dropdown-option-check">‚úì</span>
                                </div>
                                <div class="dropdown-option" onclick="selectDrumVariation('kick', 'distorted', 'üé∏', 'DISTORTED', 'Overdrive + saturation ‚Ä¢ Aggressive')">
                                    <span class="dropdown-option-icon">üé∏</span>
                                    <div class="dropdown-option-text">
                                        <div class="dropdown-option-name">DISTORTED</div>
                                        <div class="dropdown-option-desc">Overdrive + saturation ‚Ä¢ Aggressive</div>
                                    </div>
                                    <span class="dropdown-option-check">‚úì</span>
                                </div>
                                <div class="dropdown-option" onclick="selectDrumVariation('kick', 'fm', 'üì°', 'FM SYNTHESIS', 'FM modulated ‚Ä¢ Metallic punch')">
                                    <span class="dropdown-option-icon">üì°</span>
                                    <div class="dropdown-option-text">
                                        <div class="dropdown-option-name">FM SYNTHESIS</div>
                                        <div class="dropdown-option-desc">FM modulated ‚Ä¢ Metallic punch</div>
                                    </div>
                                    <span class="dropdown-option-check">‚úì</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- HI-HAT DROPDOWN -->
                    <div class="drum-selector-container">
                        <div class="drum-selector-header">
                            <div class="drum-selector-title">
                                <span class="drum-icon">üé©</span>
                                <span class="drum-label">HI-HAT</span>
                            </div>
                            <button class="test-button" onclick="testDrumSound('hat')">‚ñ∂Ô∏è TEST</button>
                        </div>
                        <div class="custom-dropdown">
                            <div class="dropdown-button" onclick="toggleDropdown('hat-dropdown')">
                                <div class="dropdown-current">
                                    <span class="dropdown-icon" id="hat-icon">‚ú®</span>
                                    <div class="dropdown-text">
                                        <span class="dropdown-name" id="hat-name">CLASSIC</span>
                                        <span class="dropdown-desc" id="hat-desc">8kHz highpass crisp</span>
                                    </div>
                                </div>
                                <span class="dropdown-arrow">‚ñº</span>
                            </div>
                            <div class="dropdown-menu" id="hat-dropdown">
                                <div class="dropdown-option selected" onclick="selectDrumVariation('hat', 'classic', '‚ú®', 'CLASSIC', '8kHz highpass crisp ‚Ä¢ Balanced tone')">
                                    <span class="dropdown-option-icon">‚ú®</span>
                                    <div class="dropdown-option-text">
                                        <div class="dropdown-option-name">CLASSIC</div>
                                        <div class="dropdown-option-desc">8kHz highpass crisp ‚Ä¢ Balanced tone</div>
                                    </div>
                                    <span class="dropdown-option-check">‚úì</span>
                                </div>
                                <div class="dropdown-option" onclick="selectDrumVariation('hat', 'bright', 'üíé', 'BRIGHT', '12kHz shimmer ‚Ä¢ Crystal clear')">
                                    <span class="dropdown-option-icon">üíé</span>
                                    <div class="dropdown-option-text">
                                        <div class="dropdown-option-name">BRIGHT</div>
                                        <div class="dropdown-option-desc">12kHz shimmer ‚Ä¢ Crystal clear</div>
                                    </div>
                                    <span class="dropdown-option-check">‚úì</span>
                                </div>
                                <div class="dropdown-option" onclick="selectDrumVariation('hat', 'metallic', 'üî©', 'METALLIC', 'Ring modulation ‚Ä¢ Complex harmonics')">
                                    <span class="dropdown-option-icon">üî©</span>
                                    <div class="dropdown-option-text">
                                        <div class="dropdown-option-name">METALLIC</div>
                                        <div class="dropdown-option-desc">Ring modulation ‚Ä¢ Complex harmonics</div>
                                    </div>
                                    <span class="dropdown-option-check">‚úì</span>
                                </div>
                                <div class="dropdown-option" onclick="selectDrumVariation('hat', 'open', 'üåä', 'OPEN', 'Long decay wash ‚Ä¢ Sustained release')">
                                    <span class="dropdown-option-icon">üåä</span>
                                    <div class="dropdown-option-text">
                                        <div class="dropdown-option-name">OPEN</div>
                                        <div class="dropdown-option-desc">Long decay wash ‚Ä¢ Sustained release</div>
                                    </div>
                                    <span class="dropdown-option-check">‚úì</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- CLAP/SNARE DROPDOWN -->
                    <div class="drum-selector-container">
                        <div class="drum-selector-header">
                            <div class="drum-selector-title">
                                <span class="drum-icon">üëè</span>
                                <span class="drum-label">CLAP / SNARE</span>
                            </div>
                            <button class="test-button" onclick="testDrumSound('clap')">‚ñ∂Ô∏è TEST</button>
                        </div>
                        <div class="custom-dropdown">
                            <div class="dropdown-button" onclick="toggleDropdown('clap-dropdown')">
                                <div class="dropdown-current">
                                    <span class="dropdown-icon" id="clap-icon">üëè</span>
                                    <div class="dropdown-text">
                                        <span class="dropdown-name" id="clap-name">CLASSIC CLAP</span>
                                        <span class="dropdown-desc" id="clap-desc">Triple hit @ 1.5kHz</span>
                                    </div>
                                </div>
                                <span class="dropdown-arrow">‚ñº</span>
                            </div>
                            <div class="dropdown-menu" id="clap-dropdown">
                                <div class="dropdown-option selected" onclick="selectDrumVariation('clap', 'classic', 'üëè', 'CLASSIC CLAP', 'Triple hit @ 1.5kHz ‚Ä¢ Vintage sound')">
                                    <span class="dropdown-option-icon">üëè</span>
                                    <div class="dropdown-option-text">
                                        <div class="dropdown-option-name">CLASSIC CLAP</div>
                                        <div class="dropdown-option-desc">Triple hit @ 1.5kHz ‚Ä¢ Vintage sound</div>
                                    </div>
                                    <span class="dropdown-option-check">‚úì</span>
                                </div>
                                <div class="dropdown-option" onclick="selectDrumVariation('clap', 'tight', 'üéØ', 'TIGHT', 'Short 50ms snap ‚Ä¢ Punchy attack')">
                                    <span class="dropdown-option-icon">üéØ</span>
                                    <div class="dropdown-option-text">
                                        <div class="dropdown-option-name">TIGHT</div>
                                        <div class="dropdown-option-desc">Short 50ms snap ‚Ä¢ Punchy attack</div>
                                    </div>
                                    <span class="dropdown-option-check">‚úì</span>
                                </div>
                                <div class="dropdown-option" onclick="selectDrumVariation('clap', 'snare', 'ü•Å', 'SNARE', '200Hz body + noise ‚Ä¢ Full bodied')">
                                    <span class="dropdown-option-icon">ü•Å</span>
                                    <div class="dropdown-option-text">
                                        <div class="dropdown-option-name">SNARE</div>
                                        <div class="dropdown-option-desc">200Hz body + noise ‚Ä¢ Full bodied</div>
                                    </div>
                                    <span class="dropdown-option-check">‚úì</span>
                                </div>
                                <div class="dropdown-option" onclick="selectDrumVariation('clap', 'reverb', 'üèõÔ∏è', 'REVERB CLAP', 'Wide stereo tail ‚Ä¢ Spacious ambience')">
                                    <span class="dropdown-option-icon">üèõÔ∏è</span>
                                    <div class="dropdown-option-text">
                                        <div class="dropdown-option-name">REVERB CLAP</div>
                                        <div class="dropdown-option-desc">Wide stereo tail ‚Ä¢ Spacious ambience</div>
                                    </div>
                                    <span class="dropdown-option-check">‚úì</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- PERCUSSION DROPDOWN -->
                    <div class="drum-selector-container">
                        <div class="drum-selector-header">
                            <div class="drum-selector-title">
                                <span class="drum-icon">üîî</span>
                                <span class="drum-label">PERCUSSION</span>
                            </div>
                            <button class="test-button" onclick="testDrumSound('perc')">‚ñ∂Ô∏è TEST</button>
                        </div>
                        <div class="custom-dropdown">
                            <div class="dropdown-button" onclick="toggleDropdown('perc-dropdown')">
                                <div class="dropdown-current">
                                    <span class="dropdown-icon" id="perc-icon">üéØ</span>
                                    <div class="dropdown-text">
                                        <span class="dropdown-name" id="perc-name">TOM</span>
                                        <span class="dropdown-desc" id="perc-desc">800Hz ‚Üí 400Hz</span>
                                    </div>
                                </div>
                                <span class="dropdown-arrow">‚ñº</span>
                            </div>
                            <div class="dropdown-menu" id="perc-dropdown">
                                <div class="dropdown-option selected" onclick="selectDrumVariation('perc', 'tom', 'üéØ', 'TOM', '800Hz ‚Üí 400Hz ‚Ä¢ Pitched drum')">
                                    <span class="dropdown-option-icon">üéØ</span>
                                    <div class="dropdown-option-text">
                                        <div class="dropdown-option-name">TOM</div>
                                        <div class="dropdown-option-desc">800Hz ‚Üí 400Hz ‚Ä¢ Pitched drum</div>
                                    </div>
                                    <span class="dropdown-option-check">‚úì</span>
                                </div>
                                <div class="dropdown-option" onclick="selectDrumVariation('perc', 'rim', 'üéµ', 'RIM SHOT', '2kHz metallic click ‚Ä¢ Sharp attack')">
                                    <span class="dropdown-option-icon">üéµ</span>
                                    <div class="dropdown-option-text">
                                        <div class="dropdown-option-name">RIM SHOT</div>
                                        <div class="dropdown-option-desc">2kHz metallic click ‚Ä¢ Sharp attack</div>
                                    </div>
                                    <span class="dropdown-option-check">‚úì</span>
                                </div>
                                <div class="dropdown-option" onclick="selectDrumVariation('perc', 'conga', 'ü•Å', 'CONGA', '350Hz resonant ‚Ä¢ Latin groove')">
                                    <span class="dropdown-option-icon">ü•Å</span>
                                    <div class="dropdown-option-text">
                                        <div class="dropdown-option-name">CONGA</div>
                                        <div class="dropdown-option-desc">350Hz resonant ‚Ä¢ Latin groove</div>
                                    </div>
                                    <span class="dropdown-option-check">‚úì</span>
                                </div>
                                <div class="dropdown-option" onclick="selectDrumVariation('perc', 'cowbell', 'üîî', 'COWBELL', '800Hz + harmonics ‚Ä¢ MORE COWBELL!')">
                                    <span class="dropdown-option-icon">üîî</span>
                                    <div class="dropdown-option-text">
                                        <div class="dropdown-option-name">COWBELL</div>
                                        <div class="dropdown-option-desc">800Hz + harmonics ‚Ä¢ MORE COWBELL!</div>
                                    </div>
                                    <span class="dropdown-option-check">‚úì</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- RIDE CYMBAL DROPDOWN -->
                    <div class="drum-selector-container">
                        <div class="drum-selector-header">
                            <div class="drum-selector-title">
                                <span class="drum-icon">üîî</span>
                                <span class="drum-label">RIDE CYMBAL</span>
                            </div>
                            <button class="test-button" onclick="testDrumSound('ride')">‚ñ∂Ô∏è TEST</button>
                        </div>
                        <div class="custom-dropdown">
                            <div class="dropdown-button" onclick="toggleDropdown('ride-dropdown')">
                                <div class="dropdown-current">
                                    <span class="dropdown-icon" id="ride-icon">üîî</span>
                                    <div class="dropdown-text">
                                        <span class="dropdown-name" id="ride-name">CLASSIC RIDE</span>
                                        <span class="dropdown-desc" id="ride-desc">4kHz bell tone</span>
                                    </div>
                                </div>
                                <span class="dropdown-arrow">‚ñº</span>
                            </div>
                            <div class="dropdown-menu" id="ride-dropdown">
                                <div class="dropdown-option selected" onclick="selectDrumVariation('ride', 'classic', 'üîî', 'CLASSIC RIDE', '4kHz bell tone ‚Ä¢ Balanced sustain')">
                                    <span class="dropdown-option-icon">üîî</span>
                                    <div class="dropdown-option-text">
                                        <div class="dropdown-option-name">CLASSIC RIDE</div>
                                        <div class="dropdown-option-desc">4kHz bell tone ‚Ä¢ Balanced sustain</div>
                                    </div>
                                    <span class="dropdown-option-check">‚úì</span>
                                </div>
                                <div class="dropdown-option" onclick="selectDrumVariation('ride', 'bright', '‚ú®', 'BRIGHT RIDE', '5kHz shimmer ‚Ä¢ Crystal definition')">
                                    <span class="dropdown-option-icon">‚ú®</span>
                                    <div class="dropdown-option-text">
                                        <div class="dropdown-option-name">BRIGHT RIDE</div>
                                        <div class="dropdown-option-desc">5kHz shimmer ‚Ä¢ Crystal definition</div>
                                    </div>
                                    <span class="dropdown-option-check">‚úì</span>
                                </div>
                                <div class="dropdown-option" onclick="selectDrumVariation('ride', 'dark', 'üåô', 'DARK RIDE', '3.2kHz warm wash ‚Ä¢ Deep resonance')">
                                    <span class="dropdown-option-icon">üåô</span>
                                    <div class="dropdown-option-text">
                                        <div class="dropdown-option-name">DARK RIDE</div>
                                        <div class="dropdown-option-desc">3.2kHz warm wash ‚Ä¢ Deep resonance</div>
                                    </div>
                                    <span class="dropdown-option-check">‚úì</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- CRASH CYMBAL DROPDOWN -->
                    <div class="drum-selector-container">
                        <div class="drum-selector-header">
                            <div class="drum-selector-title">
                                <span class="drum-icon">üí•</span>
                                <span class="drum-label">CRASH CYMBAL</span>
                            </div>
                            <button class="test-button" onclick="testDrumSound('crash')">‚ñ∂Ô∏è TEST</button>
                        </div>
                        <div class="custom-dropdown">
                            <div class="dropdown-button" onclick="toggleDropdown('crash-dropdown')">
                                <div class="dropdown-current">
                                    <span class="dropdown-icon" id="crash-icon">üí•</span>
                                    <div class="dropdown-text">
                                        <span class="dropdown-name" id="crash-name">CLASSIC CRASH</span>
                                        <span class="dropdown-desc" id="crash-desc">6kHz explosive</span>
                                    </div>
                                </div>
                                <span class="dropdown-arrow">‚ñº</span>
                            </div>
                            <div class="dropdown-menu" id="crash-dropdown">
                                <div class="dropdown-option selected" onclick="selectDrumVariation('crash', 'classic', 'üí•', 'CLASSIC CRASH', '6kHz explosive ‚Ä¢ Powerful impact')">
                                    <span class="dropdown-option-icon">üí•</span>
                                    <div class="dropdown-option-text">
                                        <div class="dropdown-option-name">CLASSIC CRASH</div>
                                        <div class="dropdown-option-desc">6kHz explosive ‚Ä¢ Powerful impact</div>
                                    </div>
                                    <span class="dropdown-option-check">‚úì</span>
                                </div>
                                <div class="dropdown-option" onclick="selectDrumVariation('crash', 'splash', 'üí¶', 'SPLASH CRASH', '7kHz bright burst ‚Ä¢ Quick attack')">
                                    <span class="dropdown-option-icon">üí¶</span>
                                    <div class="dropdown-option-text">
                                        <div class="dropdown-option-name">SPLASH CRASH</div>
                                        <div class="dropdown-option-desc">7kHz bright burst ‚Ä¢ Quick attack</div>
                                    </div>
                                    <span class="dropdown-option-check">‚úì</span>
                                </div>
                                <div class="dropdown-option" onclick="selectDrumVariation('crash', 'dark', 'üåë', 'DARK CRASH', '5kHz deep wash ‚Ä¢ Long sustain')">
                                    <span class="dropdown-option-icon">üåë</span>
                                    <div class="dropdown-option-text">
                                        <div class="dropdown-option-name">DARK CRASH</div>
                                        <div class="dropdown-option-desc">5kHz deep wash ‚Ä¢ Long sustain</div>
                                    </div>
                                    <span class="dropdown-option-check">‚úì</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <h3>üéõÔ∏è PATTERN GRID (16 STEPS)</h3>
            
            <!-- Sound Preview Buttons -->
            <div style="margin: 15px 0; padding: 15px; background: var(--bg-tertiary); border-radius: 10px; border: 1px solid var(--accent-primary);">
                <p style="color: var(--text-secondary); margin-bottom: 10px; font-size: 0.9em;">
                    üéß PREVIEW SOUNDS:
                </p>
                <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
                    <button class="btn btn-secondary" onclick="initAudio(); playTechnoKick(audioContext, audioContext.currentTime)" style="padding: 8px 16px; font-size: 0.9em;">
                        ü¶∂ Techno Kick
                    </button>
                    <button class="btn btn-secondary" onclick="initAudio(); playTechnoHat(audioContext, audioContext.currentTime)" style="padding: 8px 16px; font-size: 0.9em;">
                        üé© Hi-Hat
                    </button>
                    <button class="btn btn-secondary" onclick="initAudio(); playTechnoClap(audioContext, audioContext.currentTime)" style="padding: 8px 16px; font-size: 0.9em;">
                        üëè Clap
                    </button>
                    <button class="btn btn-secondary" onclick="initAudio(); playTechnoPerc(audioContext, audioContext.currentTime)" style="padding: 8px 16px; font-size: 0.9em;">
                        üîî Perc
                    </button>
                </div>
            </div>

            <!-- Kick Pattern Variations (Pro Mode) -->
            <div class="control-group" data-mode="pro" style="margin: 20px 0; padding: 15px; background: var(--bg-tertiary); border-radius: 3px; border: 1px solid var(--accent-cyan);">
                <label style="display: block; margin-bottom: 10px; color: var(--accent-cyan);">
                    ü¶∂ KICK PATTERN VARIATIONS:
                </label>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px;">
                    <button class="btn btn-secondary" onclick="loadTechnoKickPattern('four-floor')" style="padding: 8px 12px; font-size: 0.85em;">
                        üéµ Four Floor
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoKickPattern('hard')" style="padding: 8px 12px; font-size: 0.85em;">
                        üí™ Hard Techno
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoKickPattern('offbeat')" style="padding: 8px 12px; font-size: 0.85em;">
                        ‚ö° Offbeat
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoKickPattern('double')" style="padding: 8px 12px; font-size: 0.85em;">
                        ‚úåÔ∏è Double
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoKickPattern('minimal')" style="padding: 8px 12px; font-size: 0.85em;">
                        ‚óΩ Minimal
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoKickPattern('tribal')" style="padding: 8px 12px; font-size: 0.85em;">
                        üåç Tribal
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoKickPattern('acid')" style="padding: 8px 12px; font-size: 0.85em;">
                        üî• Acid
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoKickPattern('industrial')" style="padding: 8px 12px; font-size: 0.85em;">
                        ‚öôÔ∏è Industrial
                    </button>
                </div>
            </div>

            <!-- Hi-Hat Pattern Variations (Pro Mode) -->
            <div class="control-group" data-mode="pro" style="margin: 20px 0; padding: 15px; background: var(--bg-tertiary); border-radius: 3px; border: 1px solid var(--accent-cyan);">
                <label style="display: block; margin-bottom: 10px; color: var(--accent-cyan);">
                    üé© HI-HAT PATTERN VARIATIONS:
                </label>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px;">
                    <button class="btn btn-secondary" onclick="loadTechnoHatPattern('closed')" style="padding: 8px 12px; font-size: 0.85em;">
                        üîí Closed 8ths
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoHatPattern('open')" style="padding: 8px 12px; font-size: 0.85em;">
                        üîì Open
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoHatPattern('16ths')" style="padding: 8px 12px; font-size: 0.85em;">
                        ‚ö° 16th Notes
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoHatPattern('offbeat')" style="padding: 8px 12px; font-size: 0.85em;">
                        üéµ Offbeat
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoHatPattern('minimal')" style="padding: 8px 12px; font-size: 0.85em;">
                        ‚óΩ Minimal
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoHatPattern('rolling')" style="padding: 8px 12px; font-size: 0.85em;">
                        üåÄ Rolling
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoHatPattern('syncopated')" style="padding: 8px 12px; font-size: 0.85em;">
                        üé∂ Syncopated
                    </button>
                    <button class="btn btn-secondary" onclick="loadTechnoHatPattern('industrial')" style="padding: 8px 12px; font-size: 0.85em;">
                        ‚öôÔ∏è Industrial
                    </button>
                </div>
            </div>

            <!-- ============================================ -->
            <!-- EXPERT MODE: PATTERN COMBINATOR & INTELLIGENT BEAT GENERATOR -->
            <!-- ============================================ -->
            <div class="control-group" data-mode="advanced" style="margin: 30px 0; padding: 25px; background: linear-gradient(135deg, rgba(0, 255, 65, 0.15), rgba(0, 191, 255, 0.15)); border: 2px solid var(--accent-cyan); border-radius: 15px;">
                <h3 style="color: var(--accent-cyan); margin-bottom: 20px; font-size: 1.3em; text-align: center;">
                    üß† Intelligent Techno Generator - Expert Mode
                </h3>
                
                <p style="color: var(--text-secondary); text-align: center; margin-bottom: 25px; font-size: 0.95em;">
                    Generate complete techno patterns based on style, instruments, and complexity!
                </p>

                <!-- Style-Based Beat Generation -->
                <div style="margin-bottom: 25px; padding: 20px; background: var(--bg-secondary); border-radius: 10px;">
                    <h4 style="color: var(--accent-cyan); margin-bottom: 15px; font-size: 1.1em;">
                        üéØ Style-Based Auto-Generation
                    </h4>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <!-- Genre Selection -->
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.9em; margin-bottom: 8px;">
                                üéº Techno Style:
                            </label>
                            <select id="technoGenreStyle" class="form-control" style="width: 100%; padding: 10px; background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border); border-radius: 8px; font-size: 0.95em;">
                                <option value="detroit">üöó Detroit Techno</option>
                                <option value="minimal">‚óΩ Minimal Techno</option>
                                <option value="industrial">‚öôÔ∏è Industrial</option>
                                <option value="acid">üî• Acid Techno</option>
                                <option value="hard">üí• Hard Techno</option>
                                <option value="tribal">ü•Å Tribal</option>
                                <option value="progressive">üåä Progressive</option>
                            </select>
                        </div>
                        
                        <!-- Complexity Level -->
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.9em; margin-bottom: 8px;">
                                ‚öôÔ∏è Complexity:
                            </label>
                            <select id="technoComplexityLevel" class="form-control" style="width: 100%; padding: 10px; background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border); border-radius: 8px; font-size: 0.95em;">
                                <option value="minimal">‚óΩ Minimal</option>
                                <option value="simple">üü¢ Simple</option>
                                <option value="moderate" selected>üü° Moderate</option>
                                <option value="complex">üü† Complex</option>
                                <option value="chaotic">üî¥ Chaotic</option>
                            </select>
                        </div>
                        
                        <!-- Energy Level -->
                        <div>
                            <label style="display: block; color: var(--text-secondary); font-size: 0.9em; margin-bottom: 8px;">
                                ‚ö° Energy Level:
                            </label>
                            <input type="range" id="technoEnergyLevel" min="1" max="10" value="7" 
                                   style="width: 100%; margin-top: 10px;"
                                   oninput="document.getElementById('technoEnergyValue').textContent = this.value">
                            <div style="text-align: center; color: var(--accent-cyan); font-weight: bold; margin-top: 5px;">
                                <span id="technoEnergyValue">7</span> / 10
                            </div>
                        </div>
                    </div>

                    <!-- Instrument Selection -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: var(--text-secondary); font-size: 0.9em; margin-bottom: 10px;">
                            üéπ Select Active Instruments:
                        </label>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                            <label style="display: flex; align-items: center; padding: 10px; background: var(--bg-tertiary); border-radius: 8px; cursor: pointer;">
                                <input type="checkbox" id="techno_inst_kick" checked style="margin-right: 10px;">
                                <span>ü•Å Kick</span>
                            </label>
                            <label style="display: flex; align-items: center; padding: 10px; background: var(--bg-tertiary); border-radius: 8px; cursor: pointer;">
                                <input type="checkbox" id="techno_inst_snare" checked style="margin-right: 10px;">
                                <span>üëè Snare</span>
                            </label>
                            <label style="display: flex; align-items: center; padding: 10px; background: var(--bg-tertiary); border-radius: 8px; cursor: pointer;">
                                <input type="checkbox" id="techno_inst_hihat" checked style="margin-right: 10px;">
                                <span>üé© Hi-Hat</span>
                            </label>
                            <label style="display: flex; align-items: center; padding: 10px; background: var(--bg-tertiary); border-radius: 8px; cursor: pointer;">
                                <input type="checkbox" id="techno_inst_perc" style="margin-right: 10px;">
                                <span>üéµ Percussion</span>
                            </label>
                        </div>
                    </div>

                    <!-- Generate Button -->
                    <div style="text-align: center;">
                        <button class="btn" onclick="generateIntelligentTechno()" style="font-size: 1.1em; padding: 15px 40px; background: linear-gradient(135deg, var(--accent-cyan), #00ffff); color: #000; font-weight: bold; box-shadow: 0 5px 20px rgba(0, 255, 255, 0.4);">
                            üß† Generate Techno
                        </button>
                    </div>
                </div>

                <!-- Pattern Combination Library -->
                <div style="padding: 20px; background: var(--bg-secondary); border-radius: 10px;">
                    <h4 style="color: var(--accent-cyan); margin-bottom: 15px; font-size: 1.1em;">
                        üé® Techno Pattern Presets
                    </h4>
                    <p style="color: var(--text-secondary); font-size: 0.85em; margin-bottom: 15px;">
                        Classic techno combinations. Click to apply!
                    </p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                        <button class="btn btn-secondary" onclick="loadTechnoCombo('four-floor-classic')" style="padding: 12px;">
                            üéµ Four-on-Floor Classic
                            <div style="font-size: 0.75em; opacity: 0.8;">Detroit Style</div>
                        </button>
                        <button class="btn btn-secondary" onclick="loadTechnoCombo('minimal-groove')" style="padding: 12px;">
                            ‚óΩ Minimal Groove
                            <div style="font-size: 0.75em; opacity: 0.8;">Sparse & Deep</div>
                        </button>
                        <button class="btn btn-secondary" onclick="loadTechnoCombo('industrial-assault')" style="padding: 12px;">
                            ‚öôÔ∏è Industrial Assault
                            <div style="font-size: 0.75em; opacity: 0.8;">Hard & Heavy</div>
                        </button>
                        <button class="btn btn-secondary" onclick="loadTechnoCombo('acid-rave')" style="padding: 12px;">
                            üî• Acid Rave
                            <div style="font-size: 0.75em; opacity: 0.8;">303 Vibes</div>
                        </button>
                        <button class="btn btn-secondary" onclick="loadTechnoCombo('tribal-ritual')" style="padding: 12px;">
                            ü•Å Tribal Ritual
                            <div style="font-size: 0.75em; opacity: 0.8;">Percussive Energy</div>
                        </button>
                        <button class="btn btn-secondary" onclick="loadTechnoCombo('progressive-journey')" style="padding: 12px;">
                            üåä Progressive Journey
                            <div style="font-size: 0.75em; opacity: 0.8;">Build & Release</div>
                        </button>
                    </div>
                </div>

                <!-- Pattern Randomizer -->
                <div style="margin-top: 20px; padding: 20px; background: var(--bg-tertiary); border-radius: 10px; text-align: center;">
                    <h4 style="color: var(--accent-cyan); margin-bottom: 15px; font-size: 1em;">
                        üé≤ Pattern Randomizer
                    </h4>
                    <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                        <button class="btn btn-secondary" onclick="randomizeTechnoKickPattern()">
                            ü•Å Random Kick
                        </button>
                        <button class="btn btn-secondary" onclick="randomizeTechnoHiHatPattern()">
                            üé© Random Hi-Hat
                        </button>
                        <button class="btn btn-secondary" onclick="randomizeAllTechnoPatterns()">
                            üé≤ Randomize All
                        </button>
                    </div>
                </div>
            </div>

            <!-- Sequencer Grid -->
            <div class="sequencer-grid" id="technoSequencerGrid">
                <!-- Will be populated by JavaScript -->
            </div>

            <!-- Sequencer Controls -->
            <div style="display: flex; gap: 12px; justify-content: center; margin-top: 25px; flex-wrap: wrap;">
                <button class="btn-modern" onclick="playTechnoPattern()" data-tooltip="Play the current pattern">
                    ‚ñ∂Ô∏è Play
                </button>
                <button class="btn btn-secondary" onclick="stopTechnoPattern()" data-tooltip="Stop playback">
                    ‚èπÔ∏è Stop
                </button>
                <button class="btn btn-cyan" onclick="randomizeTechnoPattern()" data-tooltip="Generate random pattern">
                    üé≤ Random
                </button>
                <button class="btn btn-magenta" onclick="clearTechnoPattern()" data-tooltip="Clear all steps">
                    üóëÔ∏è Clear
                </button>
                <button class="btn" onclick="openPresetManager()" style="background: linear-gradient(135deg, #9d4edd, #7209b7); color: #fff; font-weight: bold;" data-tooltip="Save & Load Presets">
                    üíæ Presets
                </button>
                <button class="btn" onclick="exportTechnoToRadio()" style="background: linear-gradient(135deg, #00ff00, #00ffff); color: #000; font-weight: bold;" data-tooltip="Send to Radio 24/7">
                    üìª Send to Radio
                </button>
            </div>
            
            <!-- TB-303 ACID BASS SYNTHESIZER -->
            <h2 style="color: var(--accent-cyan); margin-bottom: 20px; margin-top: 40px; display: flex; align-items: center; gap: 12px;">
                <span style="font-size: 1.5em;">üß™</span>
                TB-303 ACID BASS SYNTHESIZER
            </h2>
            <p style="color: var(--text-secondary); margin-bottom: 25px;">
                Classic Roland TB-303 Bass Line emulation (Behringer TD-3 style) ‚Ä¢ Create squelchy acid basslines
            </p>

            <!-- 303 Sequencer Section -->
            <div class="collapsible-header active" onclick="toggleCollapsible(this)" style="margin-bottom: 15px;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 1.2em;">üéπ</span>
                    <h3 style="margin: 0; color: var(--accent-primary);">ACID SEQUENCER (16 STEPS)</h3>
                </div>
                <span class="collapsible-icon">‚ñº</span>
            </div>
            <div class="collapsible-content active" style="margin-bottom: 25px;">
                <div style="padding: 20px; background: var(--bg-primary); border-radius: 8px;">
                    
                    <!-- Pattern Controls -->
                    <div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; align-items: center;">
                        <button class="btn-modern" onclick="play303Pattern()">‚ñ∂Ô∏è Play Acid</button>
                        <button class="btn btn-secondary" onclick="stop303Pattern()">‚èπÔ∏è Stop</button>
                        <button class="btn btn-cyan" onclick="randomize303()">üé≤ Randomize</button>
                        <button class="btn btn-magenta" onclick="clear303()">üóëÔ∏è Clear</button>
                        
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <label style="color: var(--text-secondary);">Tempo:</label>
                            <input type="number" id="acid303Bpm" value="130" min="60" max="200" style="width: 70px; padding: 8px; background: var(--bg-tertiary); border: 1px solid var(--border); color: var(--text-primary); border-radius: 5px;">
                            <span style="color: var(--text-secondary);">BPM</span>
                        </div>
                    </div>

                    <!-- 303 Step Grid -->
                    <div id="acid303Grid" style="display: grid; grid-template-columns: repeat(16, 1fr); gap: 8px; margin-bottom: 25px;">
                        <!-- Will be populated by JavaScript -->
                    </div>

                    <!-- Note and Parameter Controls per Step -->
                    <div style="background: var(--bg-tertiary); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-cyan); margin-bottom: 15px;">SELECTED STEP CONTROLS</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                            
                            <div>
                                <label style="color: var(--text-secondary); display: block; margin-bottom: 8px;">
                                    Note <span id="selected303Step" style="color: var(--accent-primary);">#1</span>
                                </label>
                                <select id="acid303Note" onchange="update303Note()" style="width: 100%; padding: 10px; background: var(--bg-primary); border: 1px solid var(--accent-primary); color: var(--text-primary); border-radius: 5px;">
                                    <option value="C2">C2 (65Hz)</option>
                                    <option value="C#2">C#2 (69Hz)</option>
                                    <option value="D2">D2 (73Hz)</option>
                                    <option value="D#2">D#2 (78Hz)</option>
                                    <option value="E2">E2 (82Hz)</option>
                                    <option value="F2">F2 (87Hz)</option>
                                    <option value="F#2">F#2 (92Hz)</option>
                                    <option value="G2">G2 (98Hz)</option>
                                    <option value="G#2">G#2 (104Hz)</option>
                                    <option value="A2">A2 (110Hz)</option>
                                    <option value="A#2">A#2 (117Hz)</option>
                                    <option value="B2">B2 (123Hz)</option>
                                    <option value="C3" selected>C3 (131Hz)</option>
                                    <option value="C#3">C#3 (139Hz)</option>
                                    <option value="D3">D3 (147Hz)</option>
                                    <option value="D#3">D#3 (156Hz)</option>
                                    <option value="E3">E3 (165Hz)</option>
                                    <option value="F3">F3 (175Hz)</option>
                                    <option value="F#3">F#3 (185Hz)</option>
                                    <option value="G3">G3 (196Hz)</option>
                                </select>
                            </div>

                            <div>
                                <label style="color: var(--text-secondary); display: block; margin-bottom: 8px;">
                                    <input type="checkbox" id="acid303Accent" onchange="update303Accent()" style="margin-right: 8px;">
                                    Accent (Emphasis)
                                </label>
                                <label style="color: var(--text-secondary); display: block; margin-bottom: 8px;">
                                    <input type="checkbox" id="acid303Slide" onchange="update303Slide()" style="margin-right: 8px;">
                                    Slide (Glide to next note)
                                </label>
                                <label style="color: var(--text-secondary); display: block; margin-bottom: 8px;">
                                    <input type="checkbox" id="acid303Gate" onchange="update303Gate()" style="margin-right: 8px;">
                                    Long Gate (Sustained)
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 303 Synth Parameters -->
            <div class="collapsible-header active" onclick="toggleCollapsible(this)" style="margin-bottom: 15px;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 1.2em;">üéõÔ∏è</span>
                    <h3 style="margin: 0; color: var(--accent-primary);">SYNTHESIZER CONTROLS</h3>
                </div>
                <span class="collapsible-icon">‚ñº</span>
            </div>
            <div class="collapsible-content active" style="margin-bottom: 25px;">
                <div style="padding: 20px; background: var(--bg-primary); border-radius: 8px;">
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px;">
                        
                        <!-- VCF SECTION -->
                        <div style="background: var(--bg-tertiary); padding: 20px; border-radius: 8px; border: 2px solid var(--accent-cyan);">
                            <h4 style="color: var(--accent-cyan); margin-bottom: 15px; text-align: center;">üîä VCF (FILTER)</h4>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="color: var(--text-secondary); font-size: 0.9em; display: block; margin-bottom: 8px;">
                                    Cutoff Frequency
                                </label>
                                <input type="range" id="acid303Cutoff" min="100" max="8000" value="800" step="10" 
                                       oninput="update303Synth('cutoff', this.value)"
                                       style="width: 100%;">
                                <span id="acid303CutoffVal" style="color: var(--accent-cyan); font-weight: bold; font-size: 1.1em;">800 Hz</span>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="color: var(--text-secondary); font-size: 0.9em; display: block; margin-bottom: 8px;">
                                    Resonance (Q)
                                </label>
                                <input type="range" id="acid303Resonance" min="0" max="30" value="15" step="0.5" 
                                       oninput="update303Synth('resonance', this.value)"
                                       style="width: 100%;">
                                <span id="acid303ResonanceVal" style="color: var(--accent-cyan); font-weight: bold; font-size: 1.1em;">15.0</span>
                            </div>
                            
                            <div>
                                <label style="color: var(--text-secondary); font-size: 0.9em; display: block; margin-bottom: 8px;">
                                    Envelope Amount
                                </label>
                                <input type="range" id="acid303EnvMod" min="0" max="100" value="70" 
                                       oninput="update303Synth('envMod', this.value)"
                                       style="width: 100%;">
                                <span id="acid303EnvModVal" style="color: var(--accent-cyan); font-weight: bold; font-size: 1.1em;">70%</span>
                            </div>
                        </div>

                        <!-- VCA / ENVELOPE -->
                        <div style="background: var(--bg-tertiary); padding: 20px; border-radius: 8px; border: 2px solid var(--accent-primary);">
                            <h4 style="color: var(--accent-primary); margin-bottom: 15px; text-align: center;">‚ö° ENVELOPE</h4>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="color: var(--text-secondary); font-size: 0.9em; display: block; margin-bottom: 8px;">
                                    Decay Time
                                </label>
                                <input type="range" id="acid303Decay" min="0.01" max="2.0" value="0.3" step="0.01" 
                                       oninput="update303Synth('decay', this.value)"
                                       style="width: 100%;">
                                <span id="acid303DecayVal" style="color: var(--accent-primary); font-weight: bold; font-size: 1.1em;">0.30s</span>
                            </div>
                            
                            <div>
                                <label style="color: var(--text-secondary); font-size: 0.9em; display: block; margin-bottom: 8px;">
                                    Accent Level
                                </label>
                                <input type="range" id="acid303AccentLevel" min="0" max="100" value="50" 
                                       oninput="update303Synth('accentLevel', this.value)"
                                       style="width: 100%;">
                                <span id="acid303AccentLevelVal" style="color: var(--accent-primary); font-weight: bold; font-size: 1.1em;">50%</span>
                            </div>
                        </div>

                        <!-- WAVEFORM & TUNING -->
                        <div style="background: var(--bg-tertiary); padding: 20px; border-radius: 8px; border: 2px solid var(--accent-secondary);">
                            <h4 style="color: var(--accent-secondary); margin-bottom: 15px; text-align: center;">üéµ OSCILLATOR</h4>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="color: var(--text-secondary); font-size: 0.9em; display: block; margin-bottom: 8px;">
                                    Waveform
                                </label>
                                <select id="acid303Wave" onchange="update303Synth('waveform', this.value)" 
                                        style="width: 100%; padding: 10px; background: var(--bg-primary); border: 1px solid var(--accent-secondary); color: var(--text-primary); border-radius: 5px;">
                                    <option value="sawtooth" selected>Sawtooth (Classic)</option>
                                    <option value="square">Square (Alternative)</option>
                                </select>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="color: var(--text-secondary); font-size: 0.9em; display: block; margin-bottom: 8px;">
                                    Tuning (Fine)
                                </label>
                                <input type="range" id="acid303Tune" min="-100" max="100" value="0" 
                                       oninput="update303Synth('tuning', this.value)"
                                       style="width: 100%;">
                                <span id="acid303TuneVal" style="color: var(--accent-secondary); font-weight: bold; font-size: 1.1em;">0 cents</span>
                            </div>
                            
                            <div>
                                <label style="color: var(--text-secondary); font-size: 0.9em; display: block; margin-bottom: 8px;">
                                    Volume
                                </label>
                                <input type="range" id="acid303Volume" min="0" max="100" value="70" 
                                       oninput="update303Synth('volume', this.value)"
                                       style="width: 100%;">
                                <span id="acid303VolumeVal" style="color: var(--accent-secondary); font-weight: bold; font-size: 1.1em;">70%</span>
                            </div>
                        </div>

                        <!-- DISTORTION & EFFECTS -->
                        <div style="background: var(--bg-tertiary); padding: 20px; border-radius: 8px; border: 2px solid #ff00ff;">
                            <h4 style="color: #ff00ff; margin-bottom: 15px; text-align: center;">üî• EFFECTS</h4>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="color: var(--text-secondary); font-size: 0.9em; display: block; margin-bottom: 8px;">
                                    Distortion
                                </label>
                                <input type="range" id="acid303Distortion" min="0" max="100" value="20" 
                                       oninput="update303Synth('distortion', this.value)"
                                       style="width: 100%;">
                                <span id="acid303DistortionVal" style="color: #ff00ff; font-weight: bold; font-size: 1.1em;">20%</span>
                            </div>
                            
                            <div>
                                <label style="color: var(--text-secondary); font-size: 0.9em; display: block; margin-bottom: 8px;">
                                    Delay Mix
                                </label>
                                <input type="range" id="acid303Delay" min="0" max="100" value="0" 
                                       oninput="update303Synth('delay', this.value)"
                                       style="width: 100%;">
                                <span id="acid303DelayVal" style="color: #ff00ff; font-weight: bold; font-size: 1.1em;">0%</span>
                            </div>
                        </div>
                    </div>

                    <!-- 303 Preset Patterns -->
                    <div style="margin-top: 30px; padding-top: 25px; border-top: 2px solid var(--border);">
                        <h4 style="color: var(--accent-cyan); margin-bottom: 15px;">üéπ CLASSIC ACID PATTERNS</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px;">
                            <button class="btn btn-secondary" onclick="load303Pattern('classic303')">üß™ Classic 303</button>
                            <button class="btn btn-secondary" onclick="load303Pattern('squelch')">üí¶ Squelchy</button>
                            <button class="btn btn-secondary" onclick="load303Pattern('driving')">‚ö° Driving Bass</button>
                            <button class="btn btn-secondary" onclick="load303Pattern('minimal')">‚¨ú Minimal</button>
                            <button class="btn btn-secondary" onclick="load303Pattern('acidhouse')">üè† Acid House</button>
                            <button class="btn btn-secondary" onclick="load303Pattern('psy')">üåÄ Psy Trance</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Content: Synthesis (2600 Patching) -->
        <div id="tab-synthesis" class="tab-content modern-card">
            <h2 style="color: var(--accent-cyan); margin-bottom: 20px; display: flex; align-items: center; gap: 12px;">
                <span style="font-size: 1.5em;">üîä</span>
                MODULAR SYNTHESIS - ARP 2600
            </h2>
            <p style="color: var(--text-secondary); margin-bottom: 25px;">
                Classic analog modeling with virtual patching ‚Ä¢ Create and save custom techno sounds
            </p>

            <!-- 2600 Preset Library -->
            <div class="collapsible-header active" onclick="toggleCollapsible(this)" style="margin-bottom: 15px;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 1.2em;">üéõÔ∏è</span>
                    <h3 style="margin: 0; color: var(--accent-primary);">CLASSIC 2600 PATCHES</h3>
                </div>
                <span class="collapsible-icon">‚ñº</span>
            </div>
            <div class="collapsible-content active" style="margin-bottom: 25px;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; padding: 20px; background: var(--bg-primary); border-radius: 8px;">
                    
                    <!-- Acid Bass Patch -->
                    <div class="modern-card" onclick="load2600Patch('acid_bass')" style="cursor: pointer; padding: 20px; text-align: center;">
                        <div style="font-size: 3em; margin-bottom: 10px;">üîä</div>
                        <h4 style="color: var(--accent-primary); margin-bottom: 8px;">TB-303 ACID</h4>
                        <p style="font-size: 0.85em; color: var(--text-secondary); margin-bottom: 12px;">
                            Resonant filter sweep<br>Classic acid squelch
                        </p>
                        <div style="background: rgba(0, 255, 0, 0.1); padding: 6px; border-radius: 4px; font-size: 0.8em; color: var(--accent-primary);">
                            VCO ‚Üí VCF ‚Üí VCA
                        </div>
                    </div>

                    <!-- Techno Bass -->
                    <div class="modern-card" onclick="load2600Patch('techno_bass')" style="cursor: pointer; padding: 20px; text-align: center;">
                        <div style="font-size: 3em; margin-bottom: 10px;">üé∏</div>
                        <h4 style="color: var(--accent-primary); margin-bottom: 8px;">TECHNO BASS</h4>
                        <p style="font-size: 0.85em; color: var(--text-secondary); margin-bottom: 12px;">
                            Deep sub bass<br>Sawtooth + filter
                        </p>
                        <div style="background: rgba(0, 255, 255, 0.1); padding: 6px; border-radius: 4px; font-size: 0.8em; color: var(--accent-cyan);">
                            VCO1+VCO2 ‚Üí LPF
                        </div>
                    </div>

                    <!-- Pad Patch -->
                    <div class="modern-card" onclick="load2600Patch('pad')" style="cursor: pointer; padding: 20px; text-align: center;">
                        <div style="font-size: 3em; margin-bottom: 10px;">üåä</div>
                        <h4 style="color: var(--accent-primary); margin-bottom: 8px;">DUB PAD</h4>
                        <p style="font-size: 0.85em; color: var(--text-secondary); margin-bottom: 12px;">
                            Lush atmospheres<br>LFO modulation
                        </p>
                        <div style="background: rgba(255, 0, 255, 0.1); padding: 6px; border-radius: 4px; font-size: 0.8em; color: var(--accent-secondary);">
                            VCO ‚Üí LFO ‚Üí VCF
                        </div>
                    </div>

                    <!-- Lead Synth -->
                    <div class="modern-card" onclick="load2600Patch('lead')" style="cursor: pointer; padding: 20px; text-align: center;">
                        <div style="font-size: 3em; margin-bottom: 10px;">üéπ</div>
                        <h4 style="color: var(--accent-primary); margin-bottom: 8px;">LEAD SYNTH</h4>
                        <p style="font-size: 0.85em; color: var(--text-secondary); margin-bottom: 12px;">
                            Bright lead tones<br>High resonance
                        </p>
                        <div style="background: rgba(0, 255, 0, 0.1); padding: 6px; border-radius: 4px; font-size: 0.8em; color: var(--accent-primary);">
                            PWM ‚Üí HPF ‚Üí Res
                        </div>
                    </div>

                    <!-- Sequencer Patch -->
                    <div class="modern-card" onclick="load2600Patch('sequencer')" style="cursor: pointer; padding: 20px; text-align: center;">
                        <div style="font-size: 3em; margin-bottom: 10px;">ÔøΩÔ∏è</div>
                        <h4 style="color: var(--accent-primary); margin-bottom: 8px;">SEQUENCER</h4>
                        <p style="font-size: 0.85em; color: var(--text-secondary); margin-bottom: 12px;">
                            Arpeggio patterns<br>16-step seq
                        </p>
                        <div style="background: rgba(0, 255, 255, 0.1); padding: 6px; border-radius: 4px; font-size: 0.8em; color: var(--accent-cyan);">
                            ARP ‚Üí VCO ‚Üí ENV
                        </div>
                    </div>

                    <!-- Industrial Drone -->
                    <div class="modern-card" onclick="load2600Patch('industrial')" style="cursor: pointer; padding: 20px; text-align: center;">
                        <div style="font-size: 3em; margin-bottom: 10px;">‚öôÔ∏è</div>
                        <h4 style="color: var(--accent-primary); margin-bottom: 8px;">INDUSTRIAL</h4>
                        <p style="font-size: 0.85em; color: var(--text-secondary); margin-bottom: 12px;">
                            Harsh textures<br>Noise + distortion
                        </p>
                        <div style="background: rgba(255, 0, 255, 0.1); padding: 6px; border-radius: 4px; font-size: 0.8em; color: var(--accent-secondary);">
                            NOISE ‚Üí VCF ‚Üí OD
                        </div>
                    </div>
                </div>
            </div>

            <!-- Current Patch Display -->
            <div style="background: var(--bg-secondary); padding: 20px; border-radius: 12px; border: 2px solid var(--accent-cyan); margin-bottom: 25px;">
                <h3 style="color: var(--accent-cyan); margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                    <span>üìã</span>
                    <span>CURRENT PATCH</span>
                    <span id="currentPatchName" style="color: var(--accent-primary); margin-left: auto;">None</span>
                </h3>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div>
                        <label style="color: var(--text-secondary); font-size: 0.9em; display: block; margin-bottom: 8px;">VCO 1 Frequency</label>
                        <input type="range" id="vco1Freq" min="20" max="880" value="220" oninput="update2600Param('vco1Freq', this.value)">
                        <span id="vco1FreqVal" style="color: var(--accent-primary); font-weight: bold;">220 Hz</span>
                    </div>
                    
                    <div>
                        <label style="color: var(--text-secondary); font-size: 0.9em; display: block; margin-bottom: 8px;">VCO 2 Frequency</label>
                        <input type="range" id="vco2Freq" min="20" max="880" value="220" oninput="update2600Param('vco2Freq', this.value)">
                        <span id="vco2FreqVal" style="color: var(--accent-primary); font-weight: bold;">220 Hz</span>
                    </div>
                    
                    <div>
                        <label style="color: var(--text-secondary); font-size: 0.9em; display: block; margin-bottom: 8px;">Filter Cutoff</label>
                        <input type="range" id="filterCutoff" min="100" max="5000" value="1000" oninput="update2600Param('filterCutoff', this.value)">
                        <span id="filterCutoffVal" style="color: var(--accent-cyan); font-weight: bold;">1000 Hz</span>
                    </div>
                    
                    <div>
                        <label style="color: var(--text-secondary); font-size: 0.9em; display: block; margin-bottom: 8px;">Resonance</label>
                        <input type="range" id="resonance" min="0" max="30" value="5" step="0.5" oninput="update2600Param('resonance', this.value)">
                        <span id="resonanceVal" style="color: var(--accent-cyan); font-weight: bold;">5.0</span>
                    </div>
                </div>
            </div>

            <!-- Custom Preset Management -->
            <div class="collapsible-header" onclick="toggleCollapsible(this)" style="margin-bottom: 15px;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 1.2em;">üíæ</span>
                    <h3 style="margin: 0; color: var(--accent-primary);">CUSTOM PRESETS</h3>
                </div>
                <span class="collapsible-icon">‚ñº</span>
            </div>
            <div class="collapsible-content" style="margin-bottom: 25px;">
                <div style="padding: 20px; background: var(--bg-primary); border-radius: 8px;">
                    <div style="display: flex; gap: 12px; margin-bottom: 15px; flex-wrap: wrap;">
                        <button class="btn btn-cyan" onclick="save2600Preset()">
                            üíæ Save Current Settings
                        </button>
                        <button class="btn btn-secondary" onclick="export2600Preset()">
                            üì§ Export Preset
                        </button>
                        <button class="btn btn-secondary" onclick="import2600Preset()">
                            üì• Import Preset
                        </button>
                    </div>
                    
                    <div id="custom2600Presets" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 12px;">
                        <p style="color: var(--text-secondary); padding: 20px; text-align: center;">
                            No custom presets yet.<br>Create and save your own patches!
                        </p>
                    </div>
                </div>
            </div>

            <!-- Test Sound -->
            <div style="display: flex; gap: 12px; justify-content: center;">
                <button class="btn-modern" onclick="test2600Sound()">
                    üîä Test Sound
                </button>
                <button class="btn btn-secondary" onclick="apply2600ToSequencer()">
                    ‚ûï Add to Sequencer
                </button>
            </div>
        </div>

        <!-- Tab Content: String Machine -->
        <div id="tab-strings" class="tab-content modern-card">
            <h2 style="color: var(--accent-cyan); margin-bottom: 20px; display: flex; align-items: center; gap: 12px;">
                <span style="font-size: 1.5em;">üéª</span>
                STRING MACHINE - LUSH ENSEMBLE SYNTHESIS
            </h2>
            <p style="color: var(--text-secondary); margin-bottom: 25px;">
                Classic string synthesizer emulation ‚Ä¢ Rich chorused textures for ambient techno
            </p>

            <!-- String Preset Library -->
            <div class="collapsible-header active" onclick="toggleCollapsible(this)" style="margin-bottom: 15px;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 1.2em;">üéº</span>
                    <h3 style="margin: 0; color: var(--accent-primary);">STRING PRESETS</h3>
                </div>
                <span class="collapsible-icon">‚ñº</span>
            </div>
            <div class="collapsible-content active" style="margin-bottom: 25px;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; padding: 20px; background: var(--bg-primary); border-radius: 8px;">
                    
                    <div class="modern-card" onclick="loadStringPreset('lush_strings')" style="cursor: pointer; padding: 20px; text-align: center;">
                        <div style="font-size: 3em; margin-bottom: 10px;">üéª</div>
                        <h4 style="color: var(--accent-primary); margin-bottom: 8px;">LUSH STRINGS</h4>
                        <p style="font-size: 0.85em; color: var(--text-secondary); margin-bottom: 12px;">
                            Classic ensemble<br>Violin + Viola + Cello
                        </p>
                        <div style="background: rgba(0, 255, 0, 0.1); padding: 6px; border-radius: 4px; font-size: 0.8em; color: var(--accent-primary);">
                            3 Sections ‚Ä¢ Chorus
                        </div>
                    </div>

                    <div class="modern-card" onclick="loadStringPreset('techno_pad')" style="cursor: pointer; padding: 20px; text-align: center;">
                        <div style="font-size: 3em; margin-bottom: 10px;">üåä</div>
                        <h4 style="color: var(--accent-primary); margin-bottom: 8px;">TECHNO PAD</h4>
                        <p style="font-size: 0.85em; color: var(--text-secondary); margin-bottom: 12px;">
                            Wide detuned layers<br>Perfect for buildups
                        </p>
                        <div style="background: rgba(0, 255, 255, 0.1); padding: 6px; border-radius: 4px; font-size: 0.8em; color: var(--accent-cyan);">
                            Heavy Chorus ‚Ä¢ Slow Attack
                        </div>
                    </div>

                    <div class="modern-card" onclick="loadStringPreset('dark_ambient')" style="cursor: pointer; padding: 20px; text-align: center;">
                        <div style="font-size: 3em; margin-bottom: 10px;">üåë</div>
                        <h4 style="color: var(--accent-primary); margin-bottom: 8px;">DARK AMBIENT</h4>
                        <p style="font-size: 0.85em; color: var(--text-secondary); margin-bottom: 12px;">
                            Low frequency wash<br>Viola + Cello only
                        </p>
                        <div style="background: rgba(255, 0, 255, 0.1); padding: 6px; border-radius: 4px; font-size: 0.8em; color: var(--accent-secondary);">
                            Dark ‚Ä¢ Deep Reverb
                        </div>
                    </div>

                    <div class="modern-card" onclick="loadStringPreset('brass_section')" style="cursor: pointer; padding: 20px; text-align: center;">
                        <div style="font-size: 3em; margin-bottom: 10px;">üé∫</div>
                        <h4 style="color: var(--accent-primary); margin-bottom: 8px;">BRASS SECTION</h4>
                        <p style="font-size: 0.85em; color: var(--text-secondary); margin-bottom: 12px;">
                            Bright brass stabs<br>Punchy attack
                        </p>
                        <div style="background: rgba(255, 255, 0, 0.1); padding: 6px; border-radius: 4px; font-size: 0.8em; color: var(--accent-gold);">
                            Fast Attack ‚Ä¢ Vibrato
                        </div>
                    </div>

                    <div class="modern-card" onclick="loadStringPreset('ethereal_wash')" style="cursor: pointer; padding: 20px; text-align: center;">
                        <div style="font-size: 3em; margin-bottom: 10px;">‚ú®</div>
                        <h4 style="color: var(--accent-primary); margin-bottom: 8px;">ETHEREAL WASH</h4>
                        <p style="font-size: 0.85em; color: var(--text-secondary); margin-bottom: 12px;">
                            Spacious atmosphere<br>Heavy reverb + chorus
                        </p>
                        <div style="background: rgba(0, 255, 255, 0.1); padding: 6px; border-radius: 4px; font-size: 0.8em; color: var(--accent-cyan);">
                            Very Slow ‚Ä¢ Ambient
                        </div>
                    </div>
                </div>
            </div>

            <!-- String Controls -->
            <div style="background: var(--bg-secondary); padding: 20px; border-radius: 12px; border: 2px solid var(--accent-cyan); margin-bottom: 25px;">
                <h3 style="color: var(--accent-cyan); margin-bottom: 15px;">üéöÔ∏è STRING CONTROLS</h3>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <div>
                        <label style="color: var(--text-secondary); font-size: 0.9em; display: block; margin-bottom: 8px;">
                            <input type="checkbox" id="stringViolin" checked onchange="updateStringSection('violin', this.checked)"> Violin
                        </label>
                        <label style="color: var(--text-secondary); font-size: 0.9em; display: block; margin-bottom: 8px;">
                            <input type="checkbox" id="stringViola" checked onchange="updateStringSection('viola', this.checked)"> Viola
                        </label>
                        <label style="color: var(--text-secondary); font-size: 0.9em; display: block; margin-bottom: 8px;">
                            <input type="checkbox" id="stringCello" checked onchange="updateStringSection('cello', this.checked)"> Cello
                        </label>
                        <label style="color: var(--text-secondary); font-size: 0.9em; display: block; margin-bottom: 8px;">
                            <input type="checkbox" id="stringBrass" onchange="updateStringSection('brass', this.checked)"> Brass
                        </label>
                    </div>
                    
                    <div>
                        <label style="color: var(--text-secondary); font-size: 0.9em; display: block; margin-bottom: 8px;">Attack Time</label>
                        <input type="range" id="stringAttack" min="0.01" max="3" value="0.8" step="0.01" oninput="updateStringEnvelope()">
                        <span id="stringAttackVal" style="color: var(--accent-primary); font-weight: bold;">0.8s</span>
                    </div>
                    
                    <div>
                        <label style="color: var(--text-secondary); font-size: 0.9em; display: block; margin-bottom: 8px;">Release Time</label>
                        <input type="range" id="stringRelease" min="0.01" max="4" value="1.2" step="0.01" oninput="updateStringEnvelope()">
                        <span id="stringReleaseVal" style="color: var(--accent-primary); font-weight: bold;">1.2s</span>
                    </div>
                    
                    <div>
                        <label style="color: var(--text-secondary); font-size: 0.9em; display: block; margin-bottom: 8px;">Chorus Depth</label>
                        <input type="range" id="stringChorus" min="0" max="1" value="0.5" step="0.01" oninput="updateStringChorus()">
                        <span id="stringChorusVal" style="color: var(--accent-cyan); font-weight: bold;">50%</span>
                    </div>
                    
                    <div>
                        <label style="color: var(--text-secondary); font-size: 0.9em; display: block; margin-bottom: 8px;">Reverb Mix</label>
                        <input type="range" id="stringReverb" min="0" max="1" value="0.35" step="0.01" oninput="updateStringReverb()">
                        <span id="stringReverbVal" style="color: var(--accent-cyan); font-weight: bold;">35%</span>
                    </div>
                    
                    <div>
                        <label style="color: var(--text-secondary); font-size: 0.9em; display: block; margin-bottom: 8px;">Master Volume</label>
                        <input type="range" id="stringVolume" min="0" max="1" value="0.7" step="0.01" oninput="updateStringVolume()">
                        <span id="stringVolumeVal" style="color: var(--accent-primary); font-weight: bold;">70%</span>
                    </div>
                </div>
            </div>

            <!-- Modulation Control -->
            <div style="background: var(--bg-tertiary); padding: 20px; border-radius: 12px; border: 2px dashed var(--accent-magenta); margin-bottom: 25px;">
                <h3 style="color: var(--accent-magenta); margin-bottom: 15px;">üîó MODULATE ARP-2600 WITH STRINGS</h3>
                <p style="color: var(--text-secondary); margin-bottom: 15px; font-size: 0.9em;">
                    Use the string output to modulate the ARP-2600 filter cutoff for dynamic timbral changes
                </p>
                
                <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                    <label style="display: flex; align-items: center; gap: 8px; color: var(--text-primary); cursor: pointer;">
                        <input type="checkbox" id="enableStringMod" onchange="toggleStringModulation(this.checked)" style="width: 20px; height: 20px;">
                        <span style="font-weight: bold;">Enable Modulation</span>
                    </label>
                    
                    <div style="flex: 1; min-width: 200px;">
                        <label style="color: var(--text-secondary); font-size: 0.9em; display: block; margin-bottom: 8px;">Modulation Amount</label>
                        <input type="range" id="stringModAmount" min="0" max="1" value="0.5" step="0.01" oninput="updateStringModAmount()">
                        <span id="stringModAmountVal" style="color: var(--accent-magenta); font-weight: bold;">50%</span>
                    </div>
                </div>
            </div>

            <!-- Test Chords -->
            <div style="text-align: center;">
                <h3 style="color: var(--accent-cyan); margin-bottom: 15px;">üéπ TEST CHORDS</h3>
                <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
                    <button class="btn-modern" onclick="playStringChord('Cm')">
                        Cm (Minor)
                    </button>
                    <button class="btn-modern" onclick="playStringChord('Am')">
                        Am (Minor)
                    </button>
                    <button class="btn-modern" onclick="playStringChord('Dm')">
                        Dm (Minor)
                    </button>
                    <button class="btn btn-cyan" onclick="playStringChord('C')">
                        C (Major)
                    </button>
                    <button class="btn btn-cyan" onclick="playStringChord('F')">
                        F (Major)
                    </button>
                    <button class="btn btn-cyan" onclick="playStringChord('G')">
                        G (Major)
                    </button>
                    <button class="btn btn-secondary" onclick="playStringProgression()">
                        üéµ Play Progression
                    </button>
                </div>
            </div>
        </div>

        <!-- Tab Content: Recorder -->
        <div id="tab-recorder" class="tab-content modern-card">
            <h2 style="color: var(--accent-magenta); margin-bottom: 20px; display: flex; align-items: center; gap: 12px;">
                <span style="font-size: 1.5em;">üéôÔ∏è</span>
                AUDIO RECORDER
            </h2>
            
            <p style="color: var(--text-secondary); margin-bottom: 25px;">
                Record audio with beat matching and store recordings for synchronized playback
            </p>

            <!-- Recorder Controls -->
            <div style="background: rgba(0,0,0,0.3); padding: 25px; border-radius: 12px; margin-bottom: 25px; border: 2px solid var(--accent-magenta);">
                <h3 style="color: var(--accent-primary); margin-bottom: 20px;">‚öôÔ∏è Recording Settings</h3>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px;">
                    <div>
                        <label style="color: var(--accent-secondary); display: block; margin-bottom: 8px;">BPM</label>
                        <input type="number" id="recorderBPM" value="135" min="60" max="200" 
                               style="width: 100%; padding: 10px; background: rgba(0,0,0,0.5); border: 1px solid var(--accent-primary); color: var(--text-primary); border-radius: 6px;">
                    </div>
                    
                    <div>
                        <label style="color: var(--accent-secondary); display: block; margin-bottom: 8px;">Time Signature</label>
                        <select id="recorderTimeSig" style="width: 100%; padding: 10px; background: rgba(0,0,0,0.5); border: 1px solid var(--accent-primary); color: var(--text-primary); border-radius: 6px;">
                            <option value="4">4/4</option>
                            <option value="3">3/4</option>
                            <option value="6">6/8</option>
                        </select>
                    </div>
                    
                    <div>
                        <label style="color: var(--accent-secondary); display: block; margin-bottom: 8px;">
                            <input type="checkbox" id="recorderQuantize" checked style="margin-right: 8px;">
                            Quantize to Beat
                        </label>
                        <label style="color: var(--accent-secondary); display: block; margin-top: 10px;">
                            <input type="checkbox" id="recorderMetronome" style="margin-right: 8px;">
                            Metronome Click
                        </label>
                    </div>
                </div>
                
                <!-- Input Level Meter -->
                <div style="margin-bottom: 20px;">
                    <label style="color: var(--accent-secondary); display: block; margin-bottom: 8px;">Input Level</label>
                    <div style="height: 20px; background: rgba(0,0,0,0.5); border-radius: 10px; overflow: hidden; border: 1px solid var(--accent-primary);">
                        <div id="recorderLevelBar" style="height: 100%; width: 0%; background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary)); transition: width 0.1s; box-shadow: 0 0 10px var(--accent-primary);"></div>
                    </div>
                </div>
                
                <!-- Status Display -->
                <div id="recorderStatus" style="text-align: center; padding: 20px; background: rgba(0,0,0,0.5); border-radius: 10px; margin-bottom: 20px; border: 2px solid var(--accent-cyan);">
                    <div id="recorderTime" style="font-size: 2.5em; font-family: var(--haos-font-mono); color: var(--accent-primary); margin-bottom: 10px;">00:00:00</div>
                    <div id="recorderStatusText" style="color: rgba(255,255,255,0.7);">Ready to Record</div>
                    <div id="recorderBeatInfo" style="color: var(--accent-secondary); margin-top: 10px; font-family: var(--haos-font-mono);"></div>
                </div>
                
                <!-- Control Buttons -->
                <div style="display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;">
                    <button id="recorderInitBtn" class="btn btn-secondary" onclick="initRecorder()">
                        üé§ Initialize Microphone
                    </button>
                    <button id="recorderStartBtn" class="btn" onclick="startRecording()" disabled style="background: linear-gradient(135deg, #FF1493, #FF6B35);">
                        ‚è∫ Start Recording
                    </button>
                    <button id="recorderPauseBtn" class="btn btn-secondary" onclick="pauseRecording()" disabled>
                        ‚è∏ Pause
                    </button>
                    <button id="recorderStopBtn" class="btn btn-cyan" onclick="stopRecording()" disabled>
                        ‚èπ Stop
                    </button>
                </div>
            </div>

            <!-- Recordings List -->
            <div style="background: rgba(0,0,0,0.3); padding: 25px; border-radius: 12px; border: 2px solid var(--accent-cyan);">
                <h3 style="color: var(--accent-cyan); margin-bottom: 20px;">üíø Your Recordings</h3>
                <div id="recordingsList" style="display: grid; gap: 15px;">
                    <div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.5);">
                        <div style="font-size: 3em; margin-bottom: 15px;">üéôÔ∏è</div>
                        <h4>No Recordings Yet</h4>
                        <p>Start recording to see your tracks here</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Content: ARRANGEMENT (Previously DAW) -->
        <div id="tab-arrangement" class="tab-content modern-card">
            <h2 style="color: var(--accent-cyan); margin-bottom: 20px; display: flex; align-items: center; gap: 12px;">
                <span style="font-size: 1.5em;">üé¨</span>
                DAW ARRANGEMENT BUILDER
            </h2>
            <p style="color: var(--text-secondary); margin-bottom: 25px;">Build complete tracks by arranging patterns on the timeline</p>
                
                <!-- Pattern Snapshot Controls -->
                <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                    <button class="btn btn-cyan" onclick="savePatternSnapshot()">
                        üíæ Save Current Pattern
                    </button>
                    <button class="btn btn-secondary" onclick="toggleArrangementMode()">
                        <span id="arrangementModeText">üé¨ Enter Arrangement Mode</span>
                    </button>
                    <button class="btn btn-magenta" onclick="playArrangement()">
                        ‚ñ∂Ô∏è Play Arrangement
                    </button>
                    <button class="btn btn-secondary" onclick="stopArrangement()">
                        ‚èπÔ∏è Stop
                    </button>
                    <button class="btn" onclick="exportArrangement()">
                        üíø Export Track
                    </button>
                </div>
                
                <!-- Saved Patterns Library -->
                <div id="patternLibrary" style="background: var(--bg-tertiary); padding: 15px; border-radius: 5px; margin-bottom: 15px;">
                    <h4 style="color: var(--accent-primary); margin-bottom: 10px;">üìö Saved Patterns:</h4>
                    <div id="patternList" style="display: flex; flex-wrap: wrap; gap: 10px;">
                        <p style="color: var(--text-secondary);">No patterns saved yet. Create a pattern and click "Save Current Pattern".</p>
                    </div>
                </div>
                
                <!-- Timeline Grid -->
                <div id="arrangementTimeline" style="background: var(--bg-secondary); padding: 15px; border-radius: 5px; border: 1px solid var(--accent-primary);">
                    <h4 style="color: var(--accent-cyan); margin-bottom: 10px;">üìä Timeline (16 Bars):</h4>
                    <div id="timelineGrid" style="display: grid; grid-template-columns: repeat(16, 1fr); gap: 5px;">
                        <!-- Will be populated by JavaScript -->
                    </div>
                    <div id="timelineInfo" style="margin-top: 10px; color: var(--text-secondary); font-size: 0.9em;">
                        Drag patterns from library to timeline to build your track. Each slot = 1 bar.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Audio Context
        let audioContext = null;
        let currentTechnoInstrument = 'acid_bass';
        let generatedTechnoSequence = [];
        let technoBPM = 135;
        let technoPattern = {
            kick: new Array(16).fill(false),
            hat: new Array(16).fill(false),
            clap: new Array(16).fill(false),
            perc: new Array(16).fill(false),
            dub_chord: new Array(16).fill(false),
            bass: new Array(16).fill(false),
            synth: new Array(16).fill(false),
            fx: new Array(16).fill(false)
        };
        let technoIsPlaying = false;
        let technoCurrentStep = 0;
        let technoIntervalId = null;
        
        // DAW arrangement system
        let technoArrangement = {
            patterns: [], // Array of pattern snapshots
            timeline: [],  // Array of {patternId, startBar, endBar}
            currentBar: 0,
            isArrangementMode: false
        };

        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            return audioContext;
        }

        // ============================================
        // LIVE GUIDANCE SYSTEM (Techno)
        // ============================================
        
        function toggleGuidance() {
            const panel = document.getElementById('guidancePanel');
            const toggle = document.getElementById('guidanceToggle');
            panel.classList.toggle('minimized');
            toggle.textContent = panel.classList.contains('minimized') ? '+' : '‚àí';
        }

        // ============================================
        // QUICK START TEMPLATES FOR BEGINNERS
        // ============================================
        
        let currentQuickTemplate = null;
        let quickStartPlaying = false;
        
        function loadQuickTemplate(templateName) {
            console.log(`üöÄ Loading Quick Start Template: ${templateName}`);
            
            // Define template patterns
            const templates = {
                classic: {
                    name: 'Classic Techno',
                    bpm: 135,
                    kick: [1,0,0,0, 1,0,0,0, 1,0,0,0, 1,0,0,0],
                    clap: [0,0,0,0, 1,0,0,0, 0,0,0,0, 1,0,0,0],
                    hat: [0,0,1,0, 0,0,1,0, 0,0,1,0, 0,0,1,0],
                    perc: [0,0,0,1, 0,0,0,0, 0,0,0,1, 0,0,0,0]
                },
                acid: {
                    name: 'Acid Squelch',
                    bpm: 128,
                    kick: [1,0,0,0, 1,0,0,0, 1,0,0,0, 1,0,0,0],
                    clap: [0,0,0,0, 1,0,0,0, 0,0,0,0, 1,0,0,0],
                    hat: [1,0,1,0, 1,0,1,0, 1,0,1,0, 1,0,1,0],
                    perc: [0,1,0,1, 0,1,0,1, 0,1,0,1, 0,1,0,1]
                },
                industrial: {
                    name: 'Industrial Hard',
                    bpm: 140,
                    kick: [1,0,0,0, 1,0,0,1, 1,0,0,0, 1,0,0,1],
                    clap: [0,0,1,0, 0,0,1,0, 0,0,1,0, 0,0,1,0],
                    hat: [1,1,0,1, 1,1,0,1, 1,1,0,1, 1,1,0,1],
                    perc: [0,0,0,0, 0,1,0,0, 0,0,0,0, 0,1,0,0]
                },
                minimal: {
                    name: 'Minimal Groove',
                    bpm: 125,
                    kick: [1,0,0,0, 0,0,0,0, 1,0,0,0, 0,0,0,0],
                    clap: [0,0,0,0, 1,0,0,0, 0,0,0,0, 1,0,0,0],
                    hat: [0,0,1,0, 0,0,1,0, 0,0,1,0, 0,0,1,0],
                    perc: [0,0,0,0, 0,0,0,1, 0,0,0,0, 0,0,0,1]
                }
            };
            
            const template = templates[templateName];
            if (!template) return;
            
            // Update BPM
            technoBPM = template.bpm;
            document.getElementById('technoBPM').value = template.bpm;
            updateTechnoBPM(template.bpm);
            
            // Load pattern into sequencer
            technoPattern.kick = template.kick.map(v => v === 1);
            technoPattern.clap = template.clap.map(v => v === 1);
            technoPattern.hat = template.hat.map(v => v === 1);
            technoPattern.perc = template.perc.map(v => v === 1);
            
            // Update visual grid if it exists
            updateTechnoGrid();
            
            currentQuickTemplate = templateName;
            
            showToast(`‚úì Loaded ${template.name} template!`, 'success');
            console.log(`üéµ Template loaded: ${template.name} at ${template.bpm} BPM`);
        }
        
        function playQuickStart() {
            if (!currentQuickTemplate) {
                showToast('‚ö†Ô∏è Please select a template first!', 'warning');
                return;
            }
            
            if (!technoIsPlaying) {
                playTechnoSequencer();
                quickStartPlaying = true;
                showToast('‚ñ∂Ô∏è Playing your beat!', 'info');
            }
        }
        
        function stopQuickStart() {
            if (technoIsPlaying) {
                stopTechnoSequencer();
                quickStartPlaying = false;
                showToast('‚èπÔ∏è Stopped', 'info');
            }
        }
        
        // Initialize drum step buttons
        function initializeDrumSteps() {
            const tracks = ['kick', 'clap', 'hat', 'perc'];
            
            tracks.forEach(track => {
                const container = document.getElementById(`${track}Steps`);
                if (!container) return;
                
                container.innerHTML = '';
                for (let i = 0; i < 16; i++) {
                    const step = document.createElement('div');
                    step.style.cssText = `
                        width: 100%;
                        aspect-ratio: 1;
                        background: rgba(0,0,0,0.5);
                        border: 2px solid var(--accent-primary);
                        border-radius: 6px;
                        cursor: pointer;
                        transition: all 0.2s;
                    `;
                    step.onclick = () => toggleDrumStep(track, i);
                    step.dataset.track = track;
                    step.dataset.step = i;
                    container.appendChild(step);
                }
            });
        }
        
        function toggleDrumStep(track, step) {
            technoPattern[track][step] = !technoPattern[track][step];
            updateDrumStepVisuals();
            showToast(`${track.toUpperCase()} step ${step + 1} ${technoPattern[track][step] ? 'ON' : 'OFF'}`, 'info');
        }
        
        function updateDrumStepVisuals() {
            const tracks = ['kick', 'clap', 'hat', 'perc'];
            const colors = {
                kick: 'var(--accent-primary)',
                clap: 'var(--accent-secondary)',
                hat: 'var(--accent-cyan)',
                perc: 'var(--accent-gold)'
            };
            
            tracks.forEach(track => {
                const container = document.getElementById(`${track}Steps`);
                if (!container) return;
                
                const steps = container.querySelectorAll('div');
                steps.forEach((step, i) => {
                    if (technoPattern[track][i]) {
                        step.style.background = colors[track];
                        step.style.boxShadow = `0 0 15px ${colors[track]}`;
                    } else {
                        step.style.background = 'rgba(0,0,0,0.5)';
                        step.style.boxShadow = 'none';
                    }
                });
            });
        }
        
        function loadBassPreset(presetName) {
            showToast(`üîä Loading ${presetName} bass preset`, 'info');
            // Bass preset loading logic will be integrated with TB-303
        }
        
        function playMelodyTemplate(templateName) {
            showToast(`üéπ Playing ${templateName} melody`, 'info');
            // Melody template logic
        }
        
        // Initialize on page load
        window.addEventListener('DOMContentLoaded', () => {
            initializeDrumSteps();
            // Load default template
            loadQuickTemplate('classic');
        });

        // ============================================
        // MODERN UI FUNCTIONS
        // ============================================
        
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab content
            const selectedTab = document.getElementById(`tab-${tabName}`);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
            
            // Add active class to clicked button
            const selectedButton = document.querySelector(`[data-tab="${tabName}"]`);
            if (selectedButton) {
                selectedButton.classList.add('active');
            }
            
            console.log(`üéõÔ∏è Switched to ${tabName} tab`);
            showTechnoNotification(`Switched to ${tabName.toUpperCase()} section`);
        }
        
        function toggleCollapsible(header) {
            header.classList.toggle('active');
            const content = header.nextElementSibling;
            if (content && content.classList.contains('collapsible-content')) {
                content.classList.toggle('active');
            }
        }
        
        function updateTechnoBPM(value) {
            document.getElementById('currentBPM').textContent = value;
            document.getElementById('bpmDisplay').textContent = value;
            technoBPPM = parseInt(value);
            console.log(`üéµ BPM updated to: ${value}`);
        }

        // ============================================
        // ARP 2600 PATCHING SYSTEM
        // ============================================
        
        let current2600Patch = {
            name: 'None',
            vco1Freq: 220,
            vco2Freq: 220,
            filterCutoff: 1000,
            resonance: 5.0,
            waveform1: 'sawtooth',
            waveform2: 'square',
            lfoRate: 2,
            envelope: { attack: 0.01, decay: 0.2, sustain: 0.5, release: 0.3 }
        };
        
        let custom2600Presets = [];
        
        // Load 2600 patch presets
        function load2600Patch(patchName) {
            console.log(`üéõÔ∏è Loading 2600 patch: ${patchName}`);
            
            const patches = {
                acid_bass: {
                    name: 'TB-303 Acid',
                    vco1Freq: 110,
                    vco2Freq: 109.5,
                    filterCutoff: 400,
                    resonance: 12.0,
                    waveform1: 'sawtooth',
                    waveform2: 'square',
                    lfoRate: 4,
                    envelope: { attack: 0.001, decay: 0.15, sustain: 0.3, release: 0.1 }
                },
                techno_bass: {
                    name: 'Techno Bass',
                    vco1Freq: 55,
                    vco2Freq: 55.2,
                    filterCutoff: 200,
                    resonance: 8.0,
                    waveform1: 'sawtooth',
                    waveform2: 'sawtooth',
                    lfoRate: 0.5,
                    envelope: { attack: 0.01, decay: 0.3, sustain: 0.5, release: 0.2 }
                },
                pad: {
                    name: 'Dub Pad',
                    vco1Freq: 220,
                    vco2Freq: 219.5,
                    filterCutoff: 1200,
                    resonance: 3.0,
                    waveform1: 'sine',
                    waveform2: 'triangle',
                    lfoRate: 0.3,
                    envelope: { attack: 0.5, decay: 0.2, sustain: 0.8, release: 1.0 }
                },
                lead: {
                    name: 'Lead Synth',
                    vco1Freq: 440,
                    vco2Freq: 440,
                    filterCutoff: 2000,
                    resonance: 9.5,
                    waveform1: 'square',
                    waveform2: 'square',
                    lfoRate: 6,
                    envelope: { attack: 0.01, decay: 0.1, sustain: 0.7, release: 0.2 }
                },
                sequencer: {
                    name: 'Sequencer',
                    vco1Freq: 110,
                    vco2Freq: 330,
                    filterCutoff: 800,
                    resonance: 6.0,
                    waveform1: 'sawtooth',
                    waveform2: 'square',
                    lfoRate: 8,
                    envelope: { attack: 0.001, decay: 0.1, sustain: 0.2, release: 0.05 }
                },
                industrial: {
                    name: 'Industrial Drone',
                    vco1Freq: 65,
                    vco2Freq: 64.7,
                    filterCutoff: 300,
                    resonance: 15.0,
                    waveform1: 'sawtooth',
                    waveform2: 'square',
                    lfoRate: 1.5,
                    envelope: { attack: 0.05, decay: 0.3, sustain: 0.6, release: 0.5 }
                }
            };
            
            const patch = patches[patchName];
            if (!patch) {
                console.error(`‚ùå Patch not found: ${patchName}`);
                return;
            }
            
            current2600Patch = { ...patch };
            
            // Update UI controls
            document.getElementById('vco1Freq').value = patch.vco1Freq;
            document.getElementById('vco2Freq').value = patch.vco2Freq;
            document.getElementById('filterCutoff').value = patch.filterCutoff;
            document.getElementById('resonance').value = patch.resonance;
            
            document.getElementById('vco1FreqVal').textContent = `${patch.vco1Freq} Hz`;
            document.getElementById('vco2FreqVal').textContent = `${patch.vco2Freq} Hz`;
            document.getElementById('filterCutoffVal').textContent = `${patch.filterCutoff} Hz`;
            document.getElementById('resonanceVal').textContent = patch.resonance.toFixed(1);
            
            document.getElementById('currentPatchName').textContent = patch.name;
            
            showTechnoNotification(`‚úÖ Loaded: ${patch.name}`);
            console.log(`‚úÖ Patch loaded:`, patch);
        }
        
        function update2600Param(param, value) {
            current2600Patch[param] = parseFloat(value);
            
            // Update display
            const displays = {
                vco1Freq: 'vco1FreqVal',
                vco2Freq: 'vco2FreqVal',
                filterCutoff: 'filterCutoffVal',
                resonance: 'resonanceVal'
            };
            
            if (displays[param]) {
                const suffix = param.includes('Freq') || param.includes('Cutoff') ? ' Hz' : '';
                const val = param === 'resonance' ? parseFloat(value).toFixed(1) : Math.round(value);
                document.getElementById(displays[param]).textContent = val + suffix;
            }
            
            console.log(`üéöÔ∏è ${param}: ${value}`);
        }
        
        function test2600Sound() {
            console.log('üîä Testing 2600 sound with current patch');
            initAudio();
            
            const ctx = audioContext;
            const now = ctx.currentTime;
            
            // Create oscillators
            const osc1 = ctx.createOscillator();
            const osc2 = ctx.createOscillator();
            
            osc1.type = current2600Patch.waveform1;
            osc2.type = current2600Patch.waveform2;
            osc1.frequency.value = current2600Patch.vco1Freq;
            osc2.frequency.value = current2600Patch.vco2Freq;
            
            // Create filter
            const filter = ctx.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.value = current2600Patch.filterCutoff;
            filter.Q.value = current2600Patch.resonance;
            
            // Create envelope
            const env = current2600Patch.envelope;
            const gain = ctx.createGain();
            gain.gain.setValueAtTime(0, now);
            gain.gain.linearRampToValueAtTime(1, now + env.attack);
            gain.gain.linearRampToValueAtTime(env.sustain, now + env.attack + env.decay);
            gain.gain.linearRampToValueAtTime(0, now + env.attack + env.decay + 1.0 + env.release);
            
            // Connect audio graph
            osc1.connect(filter);
            osc2.connect(filter);
            filter.connect(gain);
            gain.connect(ctx.destination);
            
            // Play
            osc1.start(now);
            osc2.start(now);
            osc1.stop(now + env.attack + env.decay + 1.0 + env.release);
            osc2.stop(now + env.attack + env.decay + 1.0 + env.release);
            
            showTechnoNotification('üîä Playing test sound');
        }
        
        function save2600Preset() {
            const name = prompt('Name your custom 2600 preset:', `Custom ${custom2600Presets.length + 1}`);
            if (!name) return;
            
            const preset = {
                ...current2600Patch,
                name: name,
                id: Date.now(),
                created: new Date().toISOString()
            };
            
            custom2600Presets.push(preset);
            localStorage.setItem('techno-2600-presets', JSON.stringify(custom2600Presets));
            
            updateCustom2600PresetList();
            showTechnoNotification(`üíæ Saved: ${name}`);
            console.log('üíæ Saved custom preset:', preset);
        }
        
        function updateCustom2600PresetList() {
            const container = document.getElementById('custom2600Presets');
            
            if (custom2600Presets.length === 0) {
                container.innerHTML = `
                    <p style="color: var(--text-secondary); padding: 20px; text-align: center;">
                        No custom presets yet.<br>Create and save your own patches!
                    </p>
                `;
                return;
            }
            
            container.innerHTML = custom2600Presets.map((preset, index) => `
                <div class="modern-card" style="padding: 15px; cursor: pointer;" onclick="loadCustom2600Preset(${index})">
                    <div style="font-size: 1.5em; margin-bottom: 8px;">üéõÔ∏è</div>
                    <h4 style="color: var(--accent-cyan); margin-bottom: 5px; font-size: 0.9em;">${preset.name}</h4>
                    <div style="font-size: 0.75em; color: var(--text-secondary);">
                        ${preset.vco1Freq}Hz / ${preset.vco2Freq}Hz
                    </div>
                    <button onclick="event.stopPropagation(); deleteCustom2600Preset(${index})" 
                            style="margin-top: 8px; padding: 4px 10px; background: var(--accent-secondary); color: #000; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8em;">
                        üóëÔ∏è Delete
                    </button>
                </div>
            `).join('');
        }
        
        function loadCustom2600Preset(index) {
            const preset = custom2600Presets[index];
            if (!preset) return;
            
            current2600Patch = { ...preset };
            
            // Update UI
            document.getElementById('vco1Freq').value = preset.vco1Freq;
            document.getElementById('vco2Freq').value = preset.vco2Freq;
            document.getElementById('filterCutoff').value = preset.filterCutoff;
            document.getElementById('resonance').value = preset.resonance;
            
            document.getElementById('vco1FreqVal').textContent = `${preset.vco1Freq} Hz`;
            document.getElementById('vco2FreqVal').textContent = `${preset.vco2Freq} Hz`;
            document.getElementById('filterCutoffVal').textContent = `${preset.filterCutoff} Hz`;
            document.getElementById('resonanceVal').textContent = preset.resonance.toFixed(1);
            
            document.getElementById('currentPatchName').textContent = preset.name;
            
            showTechnoNotification(`‚úÖ Loaded: ${preset.name}`);
        }
        
        function deleteCustom2600Preset(index) {
            if (!confirm(`Delete preset "${custom2600Presets[index].name}"?`)) return;
            
            const deleted = custom2600Presets.splice(index, 1)[0];
            localStorage.setItem('techno-2600-presets', JSON.stringify(custom2600Presets));
            
            updateCustom2600PresetList();
            showTechnoNotification(`üóëÔ∏è Deleted: ${deleted.name}`);
        }
        
        function export2600Preset() {
            const data = JSON.stringify(current2600Patch, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `2600-patch-${current2600Patch.name.replace(/\s+/g, '-')}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showTechnoNotification('üì§ Preset exported!');
        }
        
        function import2600Preset() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'application/json';
            
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const preset = JSON.parse(event.target.result);
                        custom2600Presets.push(preset);
                        localStorage.setItem('techno-2600-presets', JSON.stringify(custom2600Presets));
                        updateCustom2600PresetList();
                        showTechnoNotification(`üì• Imported: ${preset.name}`);
                    } catch (err) {
                        alert('‚ùå Invalid preset file');
                        console.error('Import error:', err);
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        function apply2600ToSequencer() {
            showTechnoNotification('‚ûï 2600 patch applied to sequencer (feature coming soon)');
            console.log('Applying 2600 patch to sequencer:', current2600Patch);
            // TODO: Integrate with sequencer playback
        }
        
        // Load saved custom presets on page load
        window.addEventListener('DOMContentLoaded', () => {
            const saved = localStorage.getItem('techno-2600-presets');
            if (saved) {
                try {
                    custom2600Presets = JSON.parse(saved);
                    updateCustom2600PresetList();
                    console.log(`üìö Loaded ${custom2600Presets.length} custom 2600 presets`);
                } catch (err) {
                    console.error('Error loading custom presets:', err);
                }
            }
        });

        // ============================================
        // 2600 DRUM SYNTHESIS VARIATIONS
        // ============================================
        
        let drumVariations = {
            kick: 'classic',
            hat: 'classic',
            clap: 'classic',
            perc: 'tom',
            ride: 'classic',
            crash: 'classic'
        };
        
        function setDrumVariation(drumType, variation) {
            drumVariations[drumType] = variation;
            console.log(`ü•Å Set ${drumType} variation to: ${variation}`);
            showTechnoNotification(`${drumType.toUpperCase()}: ${variation} style selected`);
        }
        
        function testDrumSound(drumType) {
            initAudio();
            const ctx = audioContext;
            const now = ctx.currentTime;
            
            switch(drumType) {
                case 'kick':
                    playTechnoKick2600(ctx, now);
                    break;
                case 'hat':
                    playTechnoHat2600(ctx, now);
                    break;
                case 'clap':
                    playTechnoClap2600(ctx, now);
                    break;
                case 'perc':
                    playTechnoPerc2600(ctx, now);
                    break;
                case 'ride':
                    playTechnoRide2600(ctx, now);
                    break;
                case 'crash':
                    playTechnoCrash2600(ctx, now);
                    break;
            }
        }

        // ============================================
        // DROPDOWN SELECTOR FUNCTIONS
        // ============================================
        
        function toggleDropdown(dropdownId) {
            const dropdown = document.getElementById(dropdownId);
            const button = dropdown.previousElementSibling;
            
            // Close all other dropdowns
            document.querySelectorAll('.dropdown-menu').forEach(menu => {
                if (menu.id !== dropdownId) {
                    menu.classList.remove('active');
                    menu.previousElementSibling.classList.remove('active');
                }
            });
            
            // Toggle current dropdown
            dropdown.classList.toggle('active');
            button.classList.toggle('active');
        }

        function selectDrumVariation(drumType, variation, icon, name, desc) {
            // Update the drum variation
            setDrumVariation(drumType, variation);
            
            // Update button display
            document.getElementById(`${drumType}-icon`).textContent = icon;
            document.getElementById(`${drumType}-name`).textContent = name;
            document.getElementById(`${drumType}-desc`).textContent = desc.split('‚Ä¢')[0].trim();
            
            // Update selected state in dropdown
            const dropdown = document.getElementById(`${drumType}-dropdown`);
            dropdown.querySelectorAll('.dropdown-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            // Close dropdown
            dropdown.classList.remove('active');
            dropdown.previousElementSibling.classList.remove('active');
            
            // Auto-play test sound
            setTimeout(() => testDrumSound(drumType), 100);
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.custom-dropdown')) {
                document.querySelectorAll('.dropdown-menu').forEach(menu => {
                    menu.classList.remove('active');
                    menu.previousElementSibling.classList.remove('active');
                });
            }
        });
        
        // Enhanced 2600-style kick drum with variations
        function playTechnoKick2600(ctx, startTime) {
            const variation = drumVariations.kick;
            let startFreq, endFreq, duration, clickGain, bodyGain;
            
            switch(variation) {
                case 'deep':
                    startFreq = 100;
                    endFreq = 30;
                    duration = 0.5;
                    clickGain = 0.3;
                    bodyGain = 1.2;
                    break;
                case 'hard':
                    startFreq = 180;
                    endFreq = 50;
                    duration = 0.25;
                    clickGain = 0.8;
                    bodyGain = 1.0;
                    break;
                case 'industrial':
                    startFreq = 150;
                    endFreq = 40;
                    duration = 0.3;
                    clickGain = 1.0;
                    bodyGain = 0.8;
                    break;
                default: // classic
                    startFreq = 150;
                    endFreq = 40;
                    duration = 0.3;
                    clickGain = 0.5;
                    bodyGain = 1.0;
            }
            
            // Main body oscillator
            const osc = ctx.createOscillator();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(startFreq, startTime);
            osc.frequency.exponentialRampToValueAtTime(endFreq, startTime + 0.05);
            
            // Body envelope
            const gain = ctx.createGain();
            gain.gain.setValueAtTime(bodyGain, startTime);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + duration);
            
            // Click layer (attack transient)
            const clickOsc = ctx.createOscillator();
            clickOsc.type = 'triangle';
            clickOsc.frequency.setValueAtTime(startFreq * 2, startTime);
            clickOsc.frequency.exponentialRampToValueAtTime(startFreq, startTime + 0.005);
            
            const clickGainNode = ctx.createGain();
            clickGainNode.gain.setValueAtTime(clickGain, startTime);
            clickGainNode.gain.exponentialRampToValueAtTime(0.01, startTime + 0.02);
            
            // Industrial noise layer
            if (variation === 'industrial') {
                const noise = createNoiseBuffer(ctx);
                const noiseSource = ctx.createBufferSource();
                noiseSource.buffer = noise;
                
                const noiseFilter = ctx.createBiquadFilter();
                noiseFilter.type = 'lowpass';
                noiseFilter.frequency.setValueAtTime(200, startTime);
                noiseFilter.Q.setValueAtTime(5, startTime);
                
                const noiseGain = ctx.createGain();
                noiseGain.gain.setValueAtTime(0.3, startTime);
                noiseGain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.1);
                
                noiseSource.connect(noiseFilter);
                noiseFilter.connect(noiseGain);
                noiseGain.connect(ctx.destination);
                
                noiseSource.start(startTime);
                noiseSource.stop(startTime + 0.1);
            }
            
            // Connect main signal chain
            osc.connect(gain);
            clickOsc.connect(clickGainNode);
            gain.connect(ctx.destination);
            clickGainNode.connect(ctx.destination);
            
            osc.start(startTime);
            osc.stop(startTime + duration);
            clickOsc.start(startTime);
            clickOsc.stop(startTime + 0.02);
        }
        
        // Enhanced 2600-style hi-hat with variations
        function playTechnoHat2600(ctx, startTime) {
            const variation = drumVariations.hat;
            const noise = createNoiseBuffer(ctx);
            const source = ctx.createBufferSource();
            source.buffer = noise;
            
            let filterFreq, duration, gainLevel, resonance;
            
            switch(variation) {
                case 'bright':
                    filterFreq = 12000;
                    duration = 0.04;
                    gainLevel = 0.35;
                    resonance = 1.5;
                    break;
                case 'metallic':
                    filterFreq = 10000;
                    duration = 0.06;
                    gainLevel = 0.4;
                    resonance = 8;
                    break;
                case 'open':
                    filterFreq = 9000;
                    duration = 0.15;
                    gainLevel = 0.3;
                    resonance = 2;
                    break;
                default: // classic
                    filterFreq = 8000;
                    duration = 0.05;
                    gainLevel = 0.3;
                    resonance = 1;
            }
            
            const filter = ctx.createBiquadFilter();
            filter.type = 'highpass';
            filter.frequency.setValueAtTime(filterFreq, startTime);
            filter.Q.setValueAtTime(resonance, startTime);
            
            const gain = ctx.createGain();
            gain.gain.setValueAtTime(gainLevel, startTime);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + duration);
            
            // Add metallic ring modulation for metallic variation
            if (variation === 'metallic') {
                const ringOsc = ctx.createOscillator();
                ringOsc.frequency.setValueAtTime(3000, startTime);
                ringOsc.type = 'square';
                
                const ringGain = ctx.createGain();
                ringGain.gain.setValueAtTime(0.2, startTime);
                ringGain.gain.exponentialRampToValueAtTime(0.01, startTime + duration);
                
                ringOsc.connect(ringGain);
                ringGain.connect(ctx.destination);
                
                ringOsc.start(startTime);
                ringOsc.stop(startTime + duration);
            }
            
            source.connect(filter);
            filter.connect(gain);
            gain.connect(ctx.destination);
            
            source.start(startTime);
            source.stop(startTime + duration);
        }
        
        // Enhanced 2600-style clap/snare with variations
        function playTechnoClap2600(ctx, startTime) {
            const variation = drumVariations.clap;
            const noise = createNoiseBuffer(ctx);
            
            let filterFreq, hits, hitSpacing, duration, gainLevel;
            
            switch(variation) {
                case 'tight':
                    filterFreq = 2000;
                    hits = [0];
                    hitSpacing = 0;
                    duration = 0.05;
                    gainLevel = 0.6;
                    break;
                case 'snare':
                    filterFreq = 1000;
                    hits = [0, 0.01];
                    hitSpacing = 0.01;
                    duration = 0.12;
                    gainLevel = 0.5;
                    // Add body tone
                    const bodyOsc = ctx.createOscillator();
                    bodyOsc.type = 'triangle';
                    bodyOsc.frequency.setValueAtTime(200, startTime);
                    bodyOsc.frequency.exponentialRampToValueAtTime(100, startTime + 0.05);
                    
                    const bodyGain = ctx.createGain();
                    bodyGain.gain.setValueAtTime(0.4, startTime);
                    bodyGain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.08);
                    
                    bodyOsc.connect(bodyGain);
                    bodyGain.connect(ctx.destination);
                    
                    bodyOsc.start(startTime);
                    bodyOsc.stop(startTime + 0.08);
                    break;
                case 'reverb':
                    filterFreq = 1500;
                    hits = [0, 0.015, 0.03, 0.05, 0.07];
                    hitSpacing = 0.015;
                    duration = 0.2;
                    gainLevel = 0.4;
                    break;
                default: // classic
                    filterFreq = 1500;
                    hits = [0, 0.015, 0.03];
                    hitSpacing = 0.015;
                    duration = 0.1;
                    gainLevel = 0.5;
            }
            
            hits.forEach(offset => {
                const source = ctx.createBufferSource();
                source.buffer = noise;
                
                const filter = ctx.createBiquadFilter();
                filter.type = 'bandpass';
                filter.frequency.setValueAtTime(filterFreq, startTime + offset);
                filter.Q.setValueAtTime(1, startTime + offset);
                
                const gain = ctx.createGain();
                gain.gain.setValueAtTime(gainLevel, startTime + offset);
                gain.gain.exponentialRampToValueAtTime(0.01, startTime + offset + duration);
                
                source.connect(filter);
                filter.connect(gain);
                gain.connect(ctx.destination);
                
                source.start(startTime + offset);
                source.stop(startTime + offset + duration);
            });
        }
        
        // Enhanced 2600-style percussion with variations
        function playTechnoPerc2600(ctx, startTime) {
            const variation = drumVariations.perc;
            
            switch(variation) {
                case 'rim':
                    // Rim shot - high pitched metallic click
                    const rimOsc1 = ctx.createOscillator();
                    const rimOsc2 = ctx.createOscillator();
                    rimOsc1.type = 'square';
                    rimOsc2.type = 'square';
                    rimOsc1.frequency.setValueAtTime(2000, startTime);
                    rimOsc2.frequency.setValueAtTime(3000, startTime);
                    
                    const rimGain = ctx.createGain();
                    rimGain.gain.setValueAtTime(0.4, startTime);
                    rimGain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.03);
                    
                    rimOsc1.connect(rimGain);
                    rimOsc2.connect(rimGain);
                    rimGain.connect(ctx.destination);
                    
                    rimOsc1.start(startTime);
                    rimOsc2.start(startTime);
                    rimOsc1.stop(startTime + 0.03);
                    rimOsc2.stop(startTime + 0.03);
                    break;
                    
                case 'conga':
                    // Conga - resonant mid-range tom
                    const congaOsc = ctx.createOscillator();
                    congaOsc.type = 'sine';
                    congaOsc.frequency.setValueAtTime(350, startTime);
                    congaOsc.frequency.exponentialRampToValueAtTime(200, startTime + 0.08);
                    
                    const congaFilter = ctx.createBiquadFilter();
                    congaFilter.type = 'bandpass';
                    congaFilter.frequency.setValueAtTime(350, startTime);
                    congaFilter.Q.setValueAtTime(3, startTime);
                    
                    const congaGain = ctx.createGain();
                    congaGain.gain.setValueAtTime(0.5, startTime);
                    congaGain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.12);
                    
                    congaOsc.connect(congaFilter);
                    congaFilter.connect(congaGain);
                    congaGain.connect(ctx.destination);
                    
                    congaOsc.start(startTime);
                    congaOsc.stop(startTime + 0.12);
                    break;
                    
                case 'cowbell':
                    // Cowbell - 800Hz fundamental with harmonics
                    const bellOsc1 = ctx.createOscillator();
                    const bellOsc2 = ctx.createOscillator();
                    bellOsc1.type = 'square';
                    bellOsc2.type = 'square';
                    bellOsc1.frequency.setValueAtTime(800, startTime);
                    bellOsc2.frequency.setValueAtTime(540, startTime); // Major 6th below
                    
                    const bellFilter = ctx.createBiquadFilter();
                    bellFilter.type = 'bandpass';
                    bellFilter.frequency.setValueAtTime(800, startTime);
                    bellFilter.Q.setValueAtTime(2, startTime);
                    
                    const bellGain = ctx.createGain();
                    bellGain.gain.setValueAtTime(0.4, startTime);
                    bellGain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.15);
                    
                    bellOsc1.connect(bellFilter);
                    bellOsc2.connect(bellFilter);
                    bellFilter.connect(bellGain);
                    bellGain.connect(ctx.destination);
                    
                    bellOsc1.start(startTime);
                    bellOsc2.start(startTime);
                    bellOsc1.stop(startTime + 0.15);
                    bellOsc2.stop(startTime + 0.15);
                    break;
                    
                default: // tom
                    const tomOsc = ctx.createOscillator();
                    tomOsc.type = 'sine';
                    tomOsc.frequency.setValueAtTime(800, startTime);
                    tomOsc.frequency.exponentialRampToValueAtTime(400, startTime + 0.05);
                    
                    const tomGain = ctx.createGain();
                    tomGain.gain.setValueAtTime(0.4, startTime);
                    tomGain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.08);
                    
                    tomOsc.connect(tomGain);
                    tomGain.connect(ctx.destination);
                    
                    tomOsc.start(startTime);
                    tomOsc.stop(startTime + 0.08);
            }
        }

        function playTechnoRide2600(ctx, startTime) {
            const variation = drumVariations.ride;
            
            let tone, decay, bellAmount;
            switch(variation) {
                case 'bright':
                    tone = 5000;
                    decay = 1.3;
                    bellAmount = 0.4;
                    break;
                case 'dark':
                    tone = 3200;
                    decay = 1.8;
                    bellAmount = 0.2;
                    break;
                default: // classic
                    tone = 4000;
                    decay = 1.5;
                    bellAmount = 0.3;
            }
            
            // Create metallic ride sound using multiple square waves
            const frequencies = [tone * 0.8, tone * 1.0, tone * 1.25, tone * 1.5];
            const oscillators = frequencies.map(freq => {
                const osc = ctx.createOscillator();
                osc.type = 'square';
                osc.frequency.setValueAtTime(freq, startTime);
                return osc;
            });
            
            // Bell component
            const bellOsc = ctx.createOscillator();
            bellOsc.type = 'sine';
            bellOsc.frequency.setValueAtTime(tone * 2, startTime);
            
            // Noise for shimmer
            const noise = createNoiseBuffer(ctx);
            const noiseSource = ctx.createBufferSource();
            noiseSource.buffer = noise;
            
            // Filters
            const rideFilter = ctx.createBiquadFilter();
            rideFilter.type = 'bandpass';
            rideFilter.frequency.setValueAtTime(tone, startTime);
            rideFilter.Q.setValueAtTime(1.5, startTime);
            
            const noiseFilter = ctx.createBiquadFilter();
            noiseFilter.type = 'bandpass';
            noiseFilter.frequency.setValueAtTime(tone * 1.5, startTime);
            noiseFilter.Q.setValueAtTime(0.8, startTime);
            
            // Gains
            const rideGain = ctx.createGain();
            rideGain.gain.setValueAtTime(0.08, startTime);
            rideGain.gain.exponentialRampToValueAtTime(0.001, startTime + decay);
            
            const bellGain = ctx.createGain();
            bellGain.gain.setValueAtTime(bellAmount * 0.3, startTime);
            bellGain.gain.exponentialRampToValueAtTime(0.001, startTime + decay * 0.4);
            
            const noiseGain = ctx.createGain();
            noiseGain.gain.setValueAtTime(0.15, startTime);
            noiseGain.gain.exponentialRampToValueAtTime(0.001, startTime + decay);
            
            // Connect
            oscillators.forEach(osc => osc.connect(rideGain));
            rideGain.connect(rideFilter);
            bellOsc.connect(bellGain);
            noiseSource.connect(noiseFilter);
            noiseFilter.connect(noiseGain);
            rideFilter.connect(ctx.destination);
            bellGain.connect(ctx.destination);
            noiseGain.connect(ctx.destination);
            
            // Start/stop
            oscillators.forEach(osc => osc.start(startTime));
            bellOsc.start(startTime);
            noiseSource.start(startTime);
            
            oscillators.forEach(osc => osc.stop(startTime + decay));
            bellOsc.stop(startTime + decay * 0.4);
            noiseSource.stop(startTime + decay);
        }

        function playTechnoCrash2600(ctx, startTime) {
            const variation = drumVariations.crash;
            
            let tone, decay, splash;
            switch(variation) {
                case 'splash':
                    tone = 7000;
                    decay = 1.8;
                    splash = 0.8;
                    break;
                case 'dark':
                    tone = 5000;
                    decay = 3.0;
                    splash = 0.3;
                    break;
                default: // classic
                    tone = 6000;
                    decay = 2.5;
                    splash = 0.5;
            }
            
            // Create complex metallic crash using multiple square waves
            const frequencies = [tone * 0.5, tone * 0.7, tone * 1.0, tone * 1.4, tone * 1.7, tone * 2.1];
            const oscillators = frequencies.map(freq => {
                const osc = ctx.createOscillator();
                osc.type = 'square';
                osc.frequency.setValueAtTime(freq, startTime);
                return osc;
            });
            
            // Noise for wash
            const noise = createNoiseBuffer(ctx);
            const noiseSource = ctx.createBufferSource();
            noiseSource.buffer = noise;
            
            // Splash noise (higher frequency burst)
            const splashNoise = createNoiseBuffer(ctx);
            const splashSource = ctx.createBufferSource();
            splashSource.buffer = splashNoise;
            
            // Filters
            const crashFilter = ctx.createBiquadFilter();
            crashFilter.type = 'highpass';
            crashFilter.frequency.setValueAtTime(tone * 0.5, startTime);
            crashFilter.Q.setValueAtTime(1, startTime);
            
            const noiseFilter = ctx.createBiquadFilter();
            noiseFilter.type = 'bandpass';
            noiseFilter.frequency.setValueAtTime(tone, startTime);
            noiseFilter.Q.setValueAtTime(0.5, startTime);
            
            const splashFilter = ctx.createBiquadFilter();
            splashFilter.type = 'highpass';
            splashFilter.frequency.setValueAtTime(tone * 2, startTime);
            splashFilter.Q.setValueAtTime(2, startTime);
            
            // Gains
            const crashGain = ctx.createGain();
            crashGain.gain.setValueAtTime(0.12, startTime);
            crashGain.gain.exponentialRampToValueAtTime(0.001, startTime + decay);
            
            const noiseGain = ctx.createGain();
            noiseGain.gain.setValueAtTime(0.35, startTime);
            noiseGain.gain.exponentialRampToValueAtTime(0.001, startTime + decay);
            
            const splashGain = ctx.createGain();
            splashGain.gain.setValueAtTime(splash * 0.5, startTime);
            splashGain.gain.exponentialRampToValueAtTime(0.001, startTime + 0.3);
            
            // Connect
            oscillators.forEach(osc => osc.connect(crashGain));
            crashGain.connect(crashFilter);
            noiseSource.connect(noiseFilter);
            noiseFilter.connect(noiseGain);
            splashSource.connect(splashFilter);
            splashFilter.connect(splashGain);
            crashFilter.connect(ctx.destination);
            noiseGain.connect(ctx.destination);
            splashGain.connect(ctx.destination);
            
            // Start/stop
            oscillators.forEach(osc => osc.start(startTime));
            noiseSource.start(startTime);
            splashSource.start(startTime);
            
            oscillators.forEach(osc => osc.stop(startTime + decay));
            noiseSource.stop(startTime + decay);
            splashSource.stop(startTime + 0.3);
        }

        function updateGuidance(type, value) {
            const content = document.getElementById('guidanceContent');
            let tip = '';
            
            switch(type) {
                case 'bpm':
                    const bpmNum = parseInt(value);
                    let bpmStyle = '';
                    if (bpmNum < 120) bpmStyle = 'Slow/Dub Techno';
                    else if (bpmNum < 130) bpmStyle = 'Classic Techno';
                    else if (bpmNum < 140) bpmStyle = 'Acid/Hard Techno';
                    else if (bpmNum < 150) bpmStyle = 'Hard Techno';
                    else bpmStyle = 'Hardcore/Gabber';
                    
                    if (document.getElementById('bpmStyle')) {
                        document.getElementById('bpmStyle').textContent = bpmStyle;
                    }
                    
                    tip = `
                        <div class="guidance-tip" style="background: rgba(0, 255, 0, 0.15); border-left-color: var(--accent-primary);">
                            <div class="guidance-tip-title">‚ö° BPM: ${value} - ${bpmStyle}</div>
                            <div class="guidance-tip-text">
                                ${bpmNum < 120 ? 'üåä Deep, atmospheric dub techno territory' :
                                  bpmNum < 130 ? 'üéµ Classic Detroit/Berlin techno tempo' :
                                  bpmNum < 140 ? 'üî• Peak time energy - acid and hard techno' :
                                  bpmNum < 150 ? '‚ö° Hard techno - industrial power' :
                                  'üíÄ Hardcore/gabber - extreme intensity'}
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'pattern':
                    tip = `
                        <div class="guidance-tip" style="background: rgba(0, 255, 255, 0.15); border-left-color: var(--accent-cyan);">
                            <div class="guidance-tip-title">üéµ Pattern: ${value}</div>
                            <div class="guidance-tip-text">
                                ${value === 'acid_techno' ? 'üß™ TB-303 style squelchy basslines' :
                                  value === 'minimal_techno' ? '‚ú® Less is more - subtle variations' :
                                  value === 'hard_techno' ? '‚ö° Aggressive, driving energy' :
                                  value === 'industrial' ? 'üè≠ Harsh, metallic textures' :
                                  value === 'detroit' ? 'üöó Soulful, futuristic grooves' :
                                  value === 'dub_techno' ? 'üåä Deep, spacious atmospheres' : 
                                  'Experimental techno style'}
                            </div>
                        </div>
                    `;
                    break;
            }
            
            if (tip) {
                // Add tip at the top of guidance content
                const existingContent = content.innerHTML;
                content.innerHTML = tip + existingContent;
                
                // Keep only last 5 tips
                const tips = content.querySelectorAll('.guidance-tip');
                if (tips.length > 5) {
                    tips[tips.length - 1].remove();
                }
            }
        }

        // Techno Music Theory
        const technoTheory = {
            notes: ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'],
            scales: {
                minor: [0, 2, 3, 5, 7, 8, 10],           // Natural minor
                phrygian: [0, 1, 3, 5, 7, 8, 10],        // Dark, Spanish
                dorian: [0, 2, 3, 5, 7, 9, 10],          // Groovy, jazzy
                minor_penta: [0, 3, 5, 7, 10],           // Simple, hypnotic
                harmonic: [0, 2, 3, 5, 7, 8, 11]         // Exotic, dramatic
            },
            patterns: {
                hard_techno: {
                    name: 'Hard Techno Sequence',
                    pattern: [0, 0, 5, 0, 3, 0, 7, 0],  // Root, fifth, third patterns
                    rhythm: 'driving'
                },
                acid_techno: {
                    name: 'Acid Bassline',
                    pattern: [0, 3, 5, 3, 7, 5, 3, 0],  // Classic 303 pattern
                    rhythm: 'hypnotic'
                },
                minimal: {
                    name: 'Minimal Loop',
                    pattern: [0, 5, 7, 5],              // Simple, repetitive
                    rhythm: 'sparse'
                },
                industrial: {
                    name: 'Industrial Sequence',
                    pattern: [0, 1, 0, 3, 0, 1, 5, 3],  // Chromatic, harsh
                    rhythm: 'aggressive'
                },
                detroit: {
                    name: 'Detroit Chord Progression',
                    pattern: [0, 3, 7, 10, 3, 7, 5, 3], // Soulful, melodic
                    rhythm: 'groovy'
                },
                dub_techno: {
                    name: 'Dub Techno Chords',
                    pattern: [0, 5, 7, 10],             // Deep, sustained
                    rhythm: 'spacious'
                }
            }
        };

        // Generate Techno Sequence
        function generateTechnoSequence() {
            const root = document.getElementById('technoKey').value;
            const scale = document.getElementById('technoScale').value;
            const subgenre = document.getElementById('technoSubgenre').value;
            
            const scaleIntervals = technoTheory.scales[scale];
            const pattern = technoTheory.patterns[subgenre];
            const rootIndex = technoTheory.notes.indexOf(root);
            
            generatedTechnoSequence = [];
            let codeOutput = `# ${pattern.name}\n`;
            codeOutput += `Root: ${root} | Scale: ${scale} | Style: ${subgenre}\n\n`;
            
            const sequence = [];
            pattern.pattern.forEach((degree, index) => {
                const noteIndex = (rootIndex + scaleIntervals[degree % scaleIntervals.length]) % 12;
                const noteName = technoTheory.notes[noteIndex];
                const octave = 3; // Bass octave for techno
                const midiNote = 12 + (octave * 12) + noteIndex;
                
                sequence.push({
                    note: noteName,
                    midi: midiNote,
                    step: index + 1
                });
                
                generatedTechnoSequence.push(midiNote);
                
                codeOutput += `Step ${index + 1}: ${noteName}${octave} (MIDI ${midiNote})\n`;
            });
            
            displayTechnoSequence(sequence, pattern.name);
            document.getElementById('technoCode').textContent = codeOutput;
            document.getElementById('technoOutput').style.display = 'block';
        }

        function displayTechnoSequence(sequence, patternName) {
            const display = document.getElementById('technoDisplay');
            display.innerHTML = `
                <div style="text-align: center; margin-bottom: 15px;">
                    <h3 style="color: var(--accent-primary);">${patternName}</h3>
                </div>
                ${sequence.map(item => `
                    <div class="chord-item animated">
                        <div>
                            <span class="chord-name">Step ${item.step}: ${item.note}</span>
                        </div>
                        <span class="chord-notes">MIDI: ${item.midi}</span>
                    </div>
                `).join('')}
            `;
        }

        // Set Instrument
        function setTechnoInstrument(instrument) {
            currentTechnoInstrument = instrument;
            
            // Update button styles
            document.querySelectorAll('[id^="inst-"]').forEach(btn => {
                btn.style.border = '1px solid var(--accent-primary)';
                btn.style.background = 'linear-gradient(135deg, var(--bg-tertiary), var(--border))';
            });
            document.getElementById(`inst-${instrument}`).style.border = '2px solid var(--accent-primary)';
            document.getElementById(`inst-${instrument}`).style.background = 'linear-gradient(135deg, var(--accent-primary), #00cc00)';
        }

        // Randomize Sequence
        function randomizeTechnoSequence() {
            const notes = ['A', 'A#', 'B', 'C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#'];
            const scales = ['minor', 'phrygian', 'dorian', 'minor_penta', 'harmonic'];
            const subgenres = ['hard_techno', 'acid_techno', 'minimal', 'industrial', 'detroit', 'dub_techno'];
            
            document.getElementById('technoKey').value = notes[Math.floor(Math.random() * notes.length)];
            document.getElementById('technoScale').value = scales[Math.floor(Math.random() * scales.length)];
            document.getElementById('technoSubgenre').value = subgenres[Math.floor(Math.random() * subgenres.length)];
            
            generateTechnoSequence();
        }

        // Play Techno Sequence
        function playTechnoSequence() {
            initAudio();
            
            if (generatedTechnoSequence.length === 0) {
                alert('‚ö†Ô∏è Generate a sequence first!');
                return;
            }
            
            const ctx = audioContext;
            const startTime = ctx.currentTime + 0.1;
            const noteLength = 0.25; // 16th notes
            
            generatedTechnoSequence.forEach((midi, index) => {
                const time = startTime + (index * noteLength);
                const freq = midiToFrequency(midi);
                playTechnoNote(ctx, freq, time, currentTechnoInstrument);
            });
        }

        function midiToFrequency(midi) {
            return 440 * Math.pow(2, (midi - 69) / 12);
        }

        function playTechnoNote(ctx, freq, startTime, instrument) {
            // Use enhanced engine if selected
            if (instrument === 'enhanced') {
                playEnhancedTechnoNote(ctx, freq, startTime, 0.25);
                return;
            }
            
            const resonance = parseInt(document.getElementById('resonanceControl').value) / 100;
            const cutoff = parseInt(document.getElementById('cutoffControl').value);
            const glide = parseInt(document.getElementById('glideControl').value) / 1000;
            const distortion = parseInt(document.getElementById('distortionControl').value);
            
            switch(instrument) {
                case 'acid_bass':
                    playAcidBass(ctx, freq, startTime, resonance, cutoff, glide, distortion);
                    break;
                case 'minimal_stab':
                    playMinimalStab(ctx, freq, startTime);
                    break;
                case 'dub_chord':
                    playDubChord(ctx, freq, startTime);
                    break;
                case 'industrial_drone':
                    playIndustrialDrone(ctx, freq, startTime);
                    break;
                case 'detroit_pad':
                    playDetroitPad(ctx, freq, startTime);
                    break;
                case 'perc_synth':
                    playPercSynth(ctx, freq, startTime);
                    break;
            }
        }

        // ============================================
        // ENHANCED TECHNO SYNTHESIS ENGINE
        // Uses advanced parameters from UI controls
        // ============================================
        
        function playEnhancedTechnoNote(ctx, freq, startTime, duration = 0.5) {
            // Get synthesis parameters from UI
            const waveform = document.getElementById('technoWaveform')?.value || 'sawtooth';
            const unisonVoices = parseInt(document.getElementById('technoUnison')?.value || 3);
            const detuneAmount = parseFloat(document.getElementById('technoDetune')?.value || 10);
            const harmonicCount = parseInt(document.getElementById('technoHarmonics')?.value || 3);
            
            // Filter parameters
            const filterType = document.getElementById('technoFilterType')?.value || 'lowpass';
            const baseCutoff = parseFloat(document.getElementById('cutoffControl')?.value || 500);
            const baseResonance = parseFloat(document.getElementById('resonanceControl')?.value || 70) / 100;
            const filterEnvelope = parseFloat(document.getElementById('technoFilterEnv')?.value || 80) / 100;
            const velocity = parseFloat(document.getElementById('technoVelocity')?.value || 90) / 100;
            
            // Envelope parameters
            const attackTime = parseFloat(document.getElementById('technoAttack')?.value || 0.01);
            const decayTime = parseFloat(document.getElementById('technoDecay')?.value || 0.2);
            const sustainLevel = parseFloat(document.getElementById('technoSustain')?.value || 50) / 100;
            const releaseTime = parseFloat(document.getElementById('technoRelease')?.value || 0.3);
            
            // LFO parameters
            const lfoEnabled = document.getElementById('lfoToggle')?.checked || false;
            const lfoRate = parseFloat(document.getElementById('technoLFORate')?.value || 6);
            const lfoDepth = parseFloat(document.getElementById('technoLFODepth')?.value || 40) / 100;
            const lfoTarget = document.getElementById('technoLFOTarget')?.value || 'filter';
            
            // Distortion from existing control
            const distortionAmount = parseFloat(document.getElementById('distortionControl')?.value || 30);
            
            // Automation
            const autoFilter = document.getElementById('technoAutoFilter')?.checked || false;
            const autoVolume = document.getElementById('technoAutoVolume')?.checked || false;
            const autoPan = document.getElementById('technoAutoPan')?.checked || false;
            const pulseMod = document.getElementById('technoPulseWidth')?.checked || false;
            
            // Create master filter
            const masterFilter = ctx.createBiquadFilter();
            masterFilter.type = filterType;
            masterFilter.frequency.setValueAtTime(baseCutoff, startTime);
            masterFilter.Q.setValueAtTime(baseResonance * 20, startTime);
            
            // Distortion
            const distNode = ctx.createWaveShaper();
            distNode.curve = makeDistortionCurve(distortionAmount);
            
            // Create master gain
            const masterGain = ctx.createGain();
            
            // Create panner for auto-pan
            const panner = ctx.createStereoPanner();
            panner.pan.setValueAtTime(0, startTime);
            
            // LFO setup
            let lfo = null;
            let lfoGain = null;
            if (lfoEnabled) {
                lfo = ctx.createOscillator();
                lfoGain = ctx.createGain();
                lfo.frequency.setValueAtTime(lfoRate, startTime);
                lfo.connect(lfoGain);
                
                if (lfoTarget === 'pitch') {
                    lfoGain.gain.setValueAtTime(freq * lfoDepth * 0.05, startTime);
                } else if (lfoTarget === 'filter') {
                    lfoGain.gain.setValueAtTime(baseCutoff * lfoDepth * 2, startTime);
                    lfoGain.connect(masterFilter.frequency);
                } else if (lfoTarget === 'volume') {
                    lfoGain.gain.setValueAtTime(velocity * lfoDepth * 0.5, startTime);
                    lfoGain.connect(masterGain.gain);
                }
                
                lfo.start(startTime);
                lfo.stop(startTime + duration);
            }
            
            // Create pulse width modulation LFO
            let pwmLFO = null;
            let pwmGain = null;
            if (pulseMod && waveform === 'square') {
                pwmLFO = ctx.createOscillator();
                pwmGain = ctx.createGain();
                pwmLFO.frequency.setValueAtTime(0.5, startTime); // Slow modulation
                pwmGain.gain.setValueAtTime(20, startTime); // Detune amount
                pwmLFO.connect(pwmGain);
                pwmLFO.start(startTime);
                pwmLFO.stop(startTime + duration);
            }
            
            // Create unison voices with harmonics
            const oscillators = [];
            
            for (let voice = 0; voice < unisonVoices; voice++) {
                // Calculate detune for this voice
                const voiceDetune = voice === Math.floor(unisonVoices / 2) ? 0 : 
                    ((voice - Math.floor(unisonVoices / 2)) * detuneAmount);
                
                // Create fundamental oscillator
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                
                osc.type = waveform;
                osc.frequency.setValueAtTime(freq, startTime);
                osc.detune.setValueAtTime(voiceDetune, startTime);
                
                // Connect pitch LFO if enabled
                if (lfoEnabled && lfoTarget === 'pitch') {
                    lfoGain.connect(osc.frequency);
                }
                
                // Connect PWM if enabled
                if (pwmLFO && waveform === 'square') {
                    pwmGain.connect(osc.detune);
                }
                
                osc.connect(gain);
                gain.connect(masterFilter);
                
                // Voice amplitude (center voice louder)
                const voiceAmp = voice === Math.floor(unisonVoices / 2) ? 1.0 : 0.6;
                gain.gain.setValueAtTime(voiceAmp / unisonVoices, startTime);
                
                oscillators.push(osc);
                
                // Add harmonics
                for (let h = 1; h <= harmonicCount; h++) {
                    const harmOsc = ctx.createOscillator();
                    const harmGain = ctx.createGain();
                    
                    harmOsc.type = 'sine';
                    harmOsc.frequency.setValueAtTime(freq * (h + 1), startTime);
                    harmOsc.detune.setValueAtTime(voiceDetune, startTime);
                    
                    harmOsc.connect(harmGain);
                    harmGain.connect(masterFilter);
                    
                    // Decreasing amplitude for higher harmonics
                    harmGain.gain.setValueAtTime((voiceAmp / unisonVoices) * (0.4 / (h + 1)), startTime);
                    
                    oscillators.push(harmOsc);
                }
            }
            
            // Connect filter -> distortion -> gain -> panner -> destination
            masterFilter.connect(distNode);
            distNode.connect(masterGain);
            masterGain.connect(panner);
            panner.connect(ctx.destination);
            
            // Apply ADSR envelope
            masterGain.gain.setValueAtTime(0, startTime);
            masterGain.gain.linearRampToValueAtTime(velocity * 0.4, startTime + attackTime);
            masterGain.gain.linearRampToValueAtTime(velocity * 0.4 * sustainLevel, startTime + attackTime + decayTime);
            
            const releaseStart = startTime + duration - releaseTime;
            if (releaseStart > startTime + attackTime + decayTime) {
                masterGain.gain.setValueAtTime(velocity * 0.4 * sustainLevel, releaseStart);
            }
            masterGain.gain.exponentialRampToValueAtTime(0.001, startTime + duration);
            
            // TB-303 style filter envelope
            const filterEnvAmount = baseCutoff * filterEnvelope * 8;
            masterFilter.frequency.setValueAtTime(baseCutoff, startTime);
            masterFilter.frequency.exponentialRampToValueAtTime(baseCutoff + filterEnvAmount, startTime + attackTime * 2);
            masterFilter.frequency.exponentialRampToValueAtTime(baseCutoff, startTime + attackTime + decayTime + 0.1);
            
            // Automation effects
            if (autoFilter) {
                // Filter sweep over duration
                masterFilter.frequency.exponentialRampToValueAtTime(baseCutoff * 0.2, startTime + duration * 0.9);
            }
            
            if (autoVolume) {
                // Volume fade
                masterGain.gain.linearRampToValueAtTime(velocity * 0.2, startTime + duration * 0.95);
            }
            
            if (autoPan) {
                // Auto-pan sweep
                panner.pan.setValueAtTime(-1, startTime);
                panner.pan.linearRampToValueAtTime(1, startTime + duration);
            }
            
            // Start and stop all oscillators
            oscillators.forEach(osc => {
                osc.start(startTime);
                osc.stop(startTime + duration);
            });
        }

        // Play enhanced note sequence
        function playEnhancedTechnoSequence(sequence) {
            if (!audioContext) initAudio();
            
            const startTime = audioContext.currentTime;
            const noteDuration = 0.25; // 16th notes
            
            sequence.forEach((note, index) => {
                if (note && note.freq) {
                    const noteTime = startTime + (index * noteDuration);
                    playEnhancedTechnoNote(audioContext, note.freq, noteTime, noteDuration * 0.9);
                }
            });
        }

        // Acid Bass (TB-303 Style)
        function playAcidBass(ctx, freq, startTime, resonance, cutoff, glide, distortion) {
            const osc = ctx.createOscillator();
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(freq, startTime);
            if (glide > 0) {
                osc.frequency.exponentialRampToValueAtTime(freq, startTime + glide);
            }
            
            const filter = ctx.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(cutoff, startTime);
            filter.Q.setValueAtTime(resonance * 20, startTime);
            
            // Filter envelope
            filter.frequency.exponentialRampToValueAtTime(cutoff * 3, startTime + 0.05);
            filter.frequency.exponentialRampToValueAtTime(cutoff, startTime + 0.2);
            
            const distNode = ctx.createWaveShaper();
            distNode.curve = makeDistortionCurve(distortion);
            
            const gain = ctx.createGain();
            gain.gain.setValueAtTime(0, startTime);
            gain.gain.linearRampToValueAtTime(0.3, startTime + 0.01);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.25);
            
            osc.connect(filter);
            filter.connect(distNode);
            distNode.connect(gain);
            gain.connect(ctx.destination);
            
            osc.start(startTime);
            osc.stop(startTime + 0.3);
        }

        // Minimal Stab
        function playMinimalStab(ctx, freq, startTime) {
            const osc = ctx.createOscillator();
            osc.type = 'square';
            osc.frequency.setValueAtTime(freq, startTime);
            
            const filter = ctx.createBiquadFilter();
            filter.type = 'bandpass';
            filter.frequency.setValueAtTime(freq * 2, startTime);
            filter.Q.setValueAtTime(5, startTime);
            
            const gain = ctx.createGain();
            gain.gain.setValueAtTime(0, startTime);
            gain.gain.linearRampToValueAtTime(0.2, startTime + 0.005);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.15);
            
            osc.connect(filter);
            filter.connect(gain);
            gain.connect(ctx.destination);
            
            osc.start(startTime);
            osc.stop(startTime + 0.2);
        }

        // Dub Chord
        function playDubChord(ctx, freq, startTime) {
            [1, 1.25, 1.5].forEach(ratio => {
                const osc = ctx.createOscillator();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(freq * ratio, startTime);
                
                const filter = ctx.createBiquadFilter();
                filter.type = 'lowpass';
                filter.frequency.setValueAtTime(800, startTime);
                filter.Q.setValueAtTime(1, startTime);
                
                const gain = ctx.createGain();
                gain.gain.setValueAtTime(0, startTime);
                gain.gain.linearRampToValueAtTime(0.1, startTime + 0.3);
                gain.gain.exponentialRampToValueAtTime(0.01, startTime + 2.0);
                
                osc.connect(filter);
                filter.connect(gain);
                gain.connect(ctx.destination);
                
                osc.start(startTime);
                osc.stop(startTime + 2.5);
            });
        }

        // Techno Bass
        function playTechnoBass(ctx, freq, startTime) {
            const osc = ctx.createOscillator();
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(freq, startTime);
            
            const filter = ctx.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(200, startTime);
            filter.frequency.exponentialRampToValueAtTime(800, startTime + 0.1);
            filter.frequency.exponentialRampToValueAtTime(150, startTime + 0.3);
            filter.Q.setValueAtTime(8, startTime);
            
            const gain = ctx.createGain();
            gain.gain.setValueAtTime(0.3, startTime);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.5);
            
            osc.connect(filter);
            filter.connect(gain);
            gain.connect(ctx.destination);
            
            osc.start(startTime);
            osc.stop(startTime + 0.6);
        }

        // Techno Synth
        function playTechnoSynth(ctx, freq, startTime) {
            const osc = ctx.createOscillator();
            osc.type = 'square';
            osc.frequency.setValueAtTime(freq, startTime);
            
            const filter = ctx.createBiquadFilter();
            filter.type = 'bandpass';
            filter.frequency.setValueAtTime(1000, startTime);
            filter.Q.setValueAtTime(5, startTime);
            
            const gain = ctx.createGain();
            gain.gain.setValueAtTime(0.15, startTime);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.3);
            
            osc.connect(filter);
            filter.connect(gain);
            gain.connect(ctx.destination);
            
            osc.start(startTime);
            osc.stop(startTime + 0.4);
        }

        // Techno FX
        function playTechnoFX(ctx, startTime) {
            const osc = ctx.createOscillator();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(2000, startTime);
            osc.frequency.exponentialRampToValueAtTime(4000, startTime + 0.2);
            
            const gain = ctx.createGain();
            gain.gain.setValueAtTime(0.1, startTime);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.2);
            
            osc.connect(gain);
            gain.connect(ctx.destination);
            
            osc.start(startTime);
            osc.stop(startTime + 0.25);
        }

        // Industrial Drone
        function playIndustrialDrone(ctx, freq, startTime) {
            const osc1 = ctx.createOscillator();
            const osc2 = ctx.createOscillator();
            
            osc1.type = 'sawtooth';
            osc2.type = 'square';
            osc1.frequency.setValueAtTime(freq, startTime);
            osc2.frequency.setValueAtTime(freq * 0.99, startTime);
            
            const noise = createNoiseBuffer(ctx);
            const noiseSource = ctx.createBufferSource();
            noiseSource.buffer = noise;
            
            const noiseGain = ctx.createGain();
            noiseGain.gain.setValueAtTime(0.1, startTime);
            
            const filter = ctx.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(300, startTime);
            filter.Q.setValueAtTime(10, startTime);
            
            const gain = ctx.createGain();
            gain.gain.setValueAtTime(0, startTime);
            gain.gain.linearRampToValueAtTime(0.2, startTime + 0.1);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.8);
            
            osc1.connect(filter);
            osc2.connect(filter);
            noiseSource.connect(noiseGain);
            noiseGain.connect(filter);
            filter.connect(gain);
            gain.connect(ctx.destination);
            
            osc1.start(startTime);
            osc2.start(startTime);
            noiseSource.start(startTime);
            osc1.stop(startTime + 1.0);
            osc2.stop(startTime + 1.0);
            noiseSource.stop(startTime + 1.0);
        }

        // Detroit Pad
        function playDetroitPad(ctx, freq, startTime) {
            [0.99, 1, 1.01].forEach((detune, i) => {
                const osc = ctx.createOscillator();
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(freq * detune, startTime);
                
                const filter = ctx.createBiquadFilter();
                filter.type = 'lowpass';
                filter.frequency.setValueAtTime(1500, startTime);
                filter.Q.setValueAtTime(0.7, startTime);
                
                const gain = ctx.createGain();
                gain.gain.setValueAtTime(0, startTime);
                gain.gain.linearRampToValueAtTime(0.08, startTime + 0.5);
                gain.gain.exponentialRampToValueAtTime(0.01, startTime + 3.0);
                
                osc.connect(filter);
                filter.connect(gain);
                gain.connect(ctx.destination);
                
                osc.start(startTime);
                osc.stop(startTime + 3.5);
            });
        }

        // Perc Synth
        function playPercSynth(ctx, freq, startTime) {
            const osc = ctx.createOscillator();
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(freq * 4, startTime);
            osc.frequency.exponentialRampToValueAtTime(freq, startTime + 0.05);
            
            const filter = ctx.createBiquadFilter();
            filter.type = 'bandpass';
            filter.frequency.setValueAtTime(freq * 2, startTime);
            filter.Q.setValueAtTime(10, startTime);
            
            const gain = ctx.createGain();
            gain.gain.setValueAtTime(0, startTime);
            gain.gain.linearRampToValueAtTime(0.3, startTime + 0.001);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.1);
            
            osc.connect(filter);
            filter.connect(gain);
            gain.connect(ctx.destination);
            
            osc.start(startTime);
            osc.stop(startTime + 0.15);
        }

        // Drum Synthesis (using 2600 variations)
        function playTechnoKick(ctx, startTime) {
            playTechnoKick2600(ctx, startTime);
        }

        function playTechnoHat(ctx, startTime) {
            playTechnoHat2600(ctx, startTime);
        }

        function playTechnoClap(ctx, startTime) {
            playTechnoClap2600(ctx, startTime);
        }

        function playTechnoPerc(ctx, startTime) {
            playTechnoPerc2600(ctx, startTime);
        }

        // Utility Functions
        function createNoiseBuffer(ctx) {
            const bufferSize = ctx.sampleRate * 0.5;
            const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) {
                data[i] = Math.random() * 2 - 1;
            }
            return buffer;
        }

        function makeDistortionCurve(amount) {
            const samples = 44100;
            const curve = new Float32Array(samples);
            const deg = Math.PI / 180;
            for (let i = 0; i < samples; i++) {
                const x = (i * 2) / samples - 1;
                curve[i] = ((3 + amount) * x * 20 * deg) / (Math.PI + amount * Math.abs(x));
            }
            return curve;
        }

        // ============================================
        // CLEAN SOUND ENGINE UTILITIES (TECHNO)
        // Anti-aliasing and improved synthesis
        // ============================================
        
        /**
         * Create bandlimited oscillator with reduced aliasing
         */
        function createCleanOscillator(ctx, freq, waveform, maxPartials = 32) {
            const nyquist = ctx.sampleRate / 2;
            const fundamental = freq;
            const safePartials = Math.min(maxPartials, Math.floor(nyquist / fundamental) - 1);
            
            const oscillators = [];
            const gains = [];
            const merger = ctx.createGain();
            
            for (let n = 1; n <= safePartials; n++) {
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                
                osc.type = 'sine';
                osc.frequency.value = fundamental * n;
                
                let amplitude = 0;
                switch(waveform) {
                    case 'sawtooth':
                        amplitude = 1 / n;
                        break;
                    case 'square':
                        amplitude = (n % 2 === 1) ? (1 / n) : 0;
                        break;
                    case 'triangle':
                        amplitude = (n % 2 === 1) ? (1 / (n * n)) : 0;
                        break;
                    case 'sine':
                        amplitude = (n === 1) ? 1 : 0;
                        break;
                }
                
                gain.gain.value = amplitude / safePartials;
                osc.connect(gain);
                gain.connect(merger);
                
                oscillators.push(osc);
                gains.push(gain);
            }
            
            return { oscillators, gains, output: merger };
        }
        
        /**
         * Create cascaded filter for steeper rolloff
         */
        function createCleanFilter(ctx, type, cutoff, resonance, stages = 2) {
            const filters = [];
            let input = null;
            
            for (let i = 0; i < stages; i++) {
                const filter = ctx.createBiquadFilter();
                filter.type = type;
                filter.frequency.value = cutoff;
                filter.Q.value = Math.pow(resonance, 1 / stages);
                
                if (input) {
                    input.connect(filter);
                }
                
                filters.push(filter);
                input = filter;
            }
            
            return {
                input: filters[0],
                output: filters[filters.length - 1],
                filters: filters,
                setFrequency: (freq) => filters.forEach(f => f.frequency.value = freq),
                setQ: (q) => filters.forEach((f, i) => f.Q.value = Math.pow(q, 1 / stages))
            };
        }
        
        /**
         * Soft clipping for warmer techno saturation
         */
        function createSoftClipper(ctx, drive = 1.0) {
            const samples = 2048;
            const curve = new Float32Array(samples);
            
            for (let i = 0; i < samples; i++) {
                const x = (i * 2 / samples) - 1;
                const processed = Math.tanh(x * drive);
                curve[i] = processed / Math.max(Math.abs(processed), 1.0);
            }
            
            const shaper = ctx.createWaveShaper();
            shaper.curve = curve;
            shaper.oversample = '4x';
            
            return shaper;
        }
        
        /**
         * Industrial delay with feedback saturation
         */
        function createIndustrialDelay(ctx, time = 0.375, feedback = 0.4) {
            const delay = ctx.createDelay();
            const feedbackGain = ctx.createGain();
            const saturator = createSoftClipper(ctx, 2.0);
            const output = ctx.createGain();
            
            delay.delayTime.value = time;
            feedbackGain.gain.value = feedback;
            output.gain.value = 0.5;
            
            delay.connect(saturator);
            saturator.connect(feedbackGain);
            feedbackGain.connect(delay);
            delay.connect(output);
            
            return { input: delay, output: output, feedbackNode: feedbackGain };
        }

        // ============================================
        // MODE SWITCHING SYSTEM
        // ============================================
        
        let currentMode = 'basic';
        
        function switchMode(mode) {
            currentMode = mode;
            const container = document.querySelector('.container');
            
            // Remove all mode classes
            container.classList.remove('mode-basic', 'mode-pro', 'mode-advanced');
            
            // Add new mode class
            container.classList.add(`mode-${mode}`);
            
            // Update mode tabs
            document.querySelectorAll('.mode-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`.mode-tab[data-mode="${mode}"]`).classList.add('active');
            
            // Update mode badge
            const badges = {
                'basic': 'üéØ BASIC MODE',
                'pro': 'üéõÔ∏è PRO MODE',
                'advanced': '‚ö° ADVANCED MODE'
            };
            document.getElementById('modeText').textContent = badges[mode];
            
            // Save mode preference
            localStorage.setItem('techno-creator-mode', mode);
            
            console.log(`Switched to ${mode} mode`);
        }
        
        // Load saved mode on page load
        window.addEventListener('DOMContentLoaded', () => {
            const savedMode = localStorage.getItem('techno-creator-mode') || 'basic';
            switchMode(savedMode);
            
            // Load saved artists
            updateArtistList();
        });

        // ============================================
        // PRESET MANAGER SYSTEM
        // ============================================
        
        function openPresetManager() {
            const modal = document.getElementById('presetModal');
            modal.style.display = 'flex';
            updatePresetList();
        }
        
        function closePresetManager() {
            const modal = document.getElementById('presetModal');
            modal.style.display = 'none';
            document.getElementById('presetName').value = '';
        }
        
        function savePreset() {
            const name = document.getElementById('presetName').value.trim();
            
            if (!name) {
                alert('‚ö†Ô∏è Please enter a preset name');
                return;
            }
            
            // Get current pattern state
            const preset = {
                id: Date.now(),
                name: name,
                dateCreated: new Date().toISOString(),
                bpm: document.getElementById('technoBpm') ? parseInt(document.getElementById('technoBpm').value) : 130,
                mode: currentMode || 'basic',
                pattern: {
                    kick: [...technoPattern.kick],
                    hat: [...technoPattern.hat],
                    clap: [...technoPattern.clap],
                    perc: [...technoPattern.perc],
                    ride: [...technoPattern.ride],
                    crash: [...technoPattern.crash]
                },
                drumVariations: {
                    kick: currentDrumVariations.kick || 'classic',
                    hat: currentDrumVariations.hat || 'classic',
                    clap: currentDrumVariations.clap || 'classic',
                    perc: currentDrumVariations.perc || 'tom',
                    ride: currentDrumVariations.ride || 'classic',
                    crash: currentDrumVariations.crash || 'classic'
                }
            };
            
            // Get existing presets
            const presets = getPresets();
            
            // Add new preset
            presets.push(preset);
            
            // Save to localStorage
            localStorage.setItem('haos-techno-presets', JSON.stringify(presets));
            
            // Clear input
            document.getElementById('presetName').value = '';
            
            // Update list
            updatePresetList();
            
            // Visual feedback
            const saveBtn = event.target;
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '‚úÖ SAVED!';
            saveBtn.style.background = 'linear-gradient(135deg, #00ff00, #00cc00)';
            setTimeout(() => {
                saveBtn.innerHTML = originalText;
                saveBtn.style.background = 'linear-gradient(135deg, #9d4edd, #7209b7)';
            }, 1500);
            
            console.log(`üíæ Saved preset: ${name}`);
        }
        
        function getPresets() {
            const saved = localStorage.getItem('haos-techno-presets');
            return saved ? JSON.parse(saved) : [];
        }
        
        function loadPreset(presetId) {
            const presets = getPresets();
            const preset = presets.find(p => p.id === presetId);
            
            if (!preset) {
                console.error('Preset not found');
                return;
            }
            
            // Load pattern
            technoPattern.kick = [...preset.pattern.kick];
            technoPattern.hat = [...preset.pattern.hat];
            technoPattern.clap = [...preset.pattern.clap];
            technoPattern.perc = [...preset.pattern.perc];
            technoPattern.ride = [...preset.pattern.ride];
            technoPattern.crash = [...preset.pattern.crash];
            
            // Update grid display
            updateTechnoGrid();
            
            // Set BPM
            if (document.getElementById('technoBpm')) {
                document.getElementById('technoBpm').value = preset.bpm || 130;
            }
            
            // Set mode
            if (preset.mode && typeof switchMode === 'function') {
                switchMode(preset.mode);
            }
            
            // Set drum variations
            if (preset.drumVariations) {
                Object.keys(preset.drumVariations).forEach(drum => {
                    const variation = preset.drumVariations[drum];
                    setDrumVariation(drum, variation);
                });
            }
            
            // Close modal
            closePresetManager();
            
            console.log(`üìÇ Loaded preset: ${preset.name}`);
            
            // Show notification
            alert(`‚úÖ Loaded preset: ${preset.name}`);
        }
        
        function deletePreset(presetId) {
            if (!confirm('Are you sure you want to delete this preset?')) {
                return;
            }
            
            const presets = getPresets();
            const filtered = presets.filter(p => p.id !== presetId);
            localStorage.setItem('haos-techno-presets', JSON.stringify(filtered));
            updatePresetList();
            console.log('üóëÔ∏è Preset deleted');
        }
        
        function updatePresetList() {
            const presets = getPresets();
            const listContainer = document.getElementById('presetList');
            const countBadge = document.getElementById('presetCount');
            
            if (!listContainer) return;
            
            // Update count
            if (countBadge) {
                countBadge.textContent = presets.length;
            }
            
            if (presets.length === 0) {
                listContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary); font-style: italic;">
                        No presets saved yet. Create your first pattern preset!
                    </div>
                `;
                return;
            }
            
            // Sort by date (newest first)
            presets.sort((a, b) => new Date(b.dateCreated) - new Date(a.dateCreated));
            
            // Build preset list HTML
            listContainer.innerHTML = presets.map(preset => {
                const modeEmojis = {
                    'basic': 'üéØ',
                    'pro': 'üéõÔ∏è',
                    'advanced': '‚ö°'
                };
                
                const modeEmoji = modeEmojis[preset.mode] || 'üéµ';
                const date = new Date(preset.dateCreated);
                
                // Count active steps
                const totalSteps = Object.values(preset.pattern).flat().filter(v => v).length;
                
                return `
                    <div style="background: var(--bg-tertiary); border: 1px solid #9d4edd; border-radius: 10px; padding: 18px; margin-bottom: 15px; transition: all 0.3s;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                            <div style="flex: 1;">
                                <div style="font-weight: bold; color: var(--text-primary); font-size: 1.15em; margin-bottom: 6px; font-family: var(--haos-font-mono);">
                                    ${modeEmoji} ${preset.name}
                                </div>
                                <div style="display: flex; gap: 15px; font-size: 0.85em; color: var(--text-secondary); flex-wrap: wrap;">
                                    <span>üéµ ${preset.bpm} BPM</span>
                                    <span>üìä ${totalSteps} steps</span>
                                    <span>üéõÔ∏è ${preset.mode.toUpperCase()}</span>
                                </div>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button onclick="loadPreset(${preset.id})" 
                                        style="background: linear-gradient(135deg, #9d4edd, #7209b7); border: none; color: #fff; padding: 10px 16px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: all 0.2s;"
                                        title="Load this preset">
                                    üìÇ LOAD
                                </button>
                                <button onclick="deletePreset(${preset.id})" 
                                        style="background: var(--bg-secondary); border: 1px solid var(--border); color: #ff4444; padding: 10px 12px; border-radius: 6px; cursor: pointer; transition: all 0.2s;"
                                        title="Delete preset">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                        <div style="font-size: 0.75em; color: var(--text-secondary); margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--border);">
                            Created: ${date.toLocaleDateString()} ${date.toLocaleTimeString()}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function exportAllPresets() {
            const presets = getPresets();
            
            if (presets.length === 0) {
                alert('‚ö†Ô∏è No presets to export');
                return;
            }
            
            const dataStr = JSON.stringify(presets, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `haos-techno-presets-${Date.now()}.json`;
            link.click();
            URL.revokeObjectURL(url);
            
            console.log(`üì§ Exported ${presets.length} presets`);
        }
        
        function importPresets(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedPresets = JSON.parse(e.target.result);
                    
                    if (!Array.isArray(importedPresets)) {
                        alert('‚ö†Ô∏è Invalid preset file format');
                        return;
                    }
                    
                    // Get existing presets
                    const existingPresets = getPresets();
                    
                    // Merge with imported presets (avoid duplicates by ID)
                    const merged = [...existingPresets];
                    let newCount = 0;
                    
                    importedPresets.forEach(preset => {
                        if (!merged.find(p => p.id === preset.id)) {
                            merged.push(preset);
                            newCount++;
                        }
                    });
                    
                    // Save merged presets
                    localStorage.setItem('haos-techno-presets', JSON.stringify(merged));
                    
                    // Update display
                    updatePresetList();
                    
                    alert(`‚úÖ Imported ${newCount} new presets!`);
                    console.log(`üì• Imported ${newCount} presets`);
                    
                } catch (error) {
                    alert('‚ö†Ô∏è Error importing presets: ' + error.message);
                    console.error('Import error:', error);
                }
            };
            reader.readAsText(file);
            
            // Reset file input
            event.target.value = '';
        }

        // ============================================
        // ARTIST MODAL & RADIO 24/7 INTEGRATION
        // ============================================
        
        function openArtistModal() {
            const modal = document.getElementById('artistModal');
            modal.style.display = 'flex';
            updateArtistList();
        }
        
        function closeArtistModal() {
            const modal = document.getElementById('artistModal');
            modal.style.display = 'none';
            
            // Clear form
            document.getElementById('artistName').value = '';
            document.getElementById('artistGenre').selectedIndex = 0;
            document.getElementById('artistYoutubeLink').value = '';
        }
        
        function saveArtist() {
            const name = document.getElementById('artistName').value.trim();
            const genre = document.getElementById('artistGenre').value;
            const youtubeLink = document.getElementById('artistYoutubeLink').value.trim();
            
            // Validation
            if (!name) {
                alert('‚ö†Ô∏è Please enter artist name');
                return;
            }
            
            if (!youtubeLink) {
                alert('‚ö†Ô∏è Please enter YouTube link');
                return;
            }
            
            // Validate YouTube URL
            const youtubePattern = /^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/.+$/;
            if (!youtubePattern.test(youtubeLink)) {
                alert('‚ö†Ô∏è Please enter a valid YouTube URL');
                return;
            }
            
            // Get existing artists
            const artists = getArtists();
            
            // Create new artist object
            const newArtist = {
                id: Date.now(),
                name: name,
                genre: genre,
                youtubeLink: youtubeLink,
                dateAdded: new Date().toISOString(),
                enabled: true
            };
            
            // Add to array
            artists.push(newArtist);
            
            // Save to localStorage
            localStorage.setItem('haos-radio-artists', JSON.stringify(artists));
            
            // Clear form
            document.getElementById('artistName').value = '';
            document.getElementById('artistGenre').selectedIndex = 0;
            document.getElementById('artistYoutubeLink').value = '';
            
            // Update list
            updateArtistList();
            
            // Show success message
            console.log(`‚úÖ Added ${name} to Radio 24/7 playlist!`);
            
            // Optional: Show visual feedback
            const saveBtn = event.target;
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '‚úÖ SAVED!';
            saveBtn.style.background = 'linear-gradient(135deg, #00ff00, #00cc00)';
            setTimeout(() => {
                saveBtn.innerHTML = originalText;
                saveBtn.style.background = 'linear-gradient(135deg, var(--accent-primary), var(--accent-cyan))';
            }, 1500);
        }
        
        function getArtists() {
            const saved = localStorage.getItem('haos-radio-artists');
            return saved ? JSON.parse(saved) : [];
        }
        
        function deleteArtist(artistId) {
            if (!confirm('Are you sure you want to remove this artist from your radio playlist?')) {
                return;
            }
            
            const artists = getArtists();
            const filtered = artists.filter(artist => artist.id !== artistId);
            localStorage.setItem('haos-radio-artists', JSON.stringify(filtered));
            updateArtistList();
            console.log('üóëÔ∏è Artist removed from playlist');
        }
        
        function toggleArtist(artistId) {
            const artists = getArtists();
            const artist = artists.find(a => a.id === artistId);
            if (artist) {
                artist.enabled = !artist.enabled;
                localStorage.setItem('haos-radio-artists', JSON.stringify(artists));
                updateArtistList();
            }
        }
        
        function updateArtistList() {
            const artists = getArtists();
            const listContainer = document.getElementById('savedArtistsList');
            const countBadge = document.getElementById('artistCount');
            
            if (!listContainer) return;
            
            // Update count
            if (countBadge) {
                countBadge.textContent = artists.length;
            }
            
            if (artists.length === 0) {
                listContainer.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: var(--text-secondary); font-style: italic;">
                        No artists added yet. Add your first favorite artist!
                    </div>
                `;
                return;
            }
            
            // Sort by date added (newest first)
            artists.sort((a, b) => new Date(b.dateAdded) - new Date(a.dateAdded));
            
            // Build artist list HTML
            listContainer.innerHTML = artists.map(artist => {
                const genreEmojis = {
                    'techno': '‚ö°',
                    'trap': 'üî•',
                    'house': 'üè†',
                    'dnb': 'ü•Å',
                    'dubstep': 'üéöÔ∏è',
                    'acid': 'üß™',
                    'industrial': 'üè≠',
                    'minimal': 'üéØ',
                    'other': 'üéº'
                };
                
                const emoji = genreEmojis[artist.genre] || 'üéº';
                const enabledStyle = artist.enabled ? 'opacity: 1' : 'opacity: 0.5';
                const enabledBtn = artist.enabled 
                    ? '<span style="color: var(--accent-primary);">‚úì</span>' 
                    : '<span style="color: var(--text-secondary);">‚óã</span>';
                
                return `
                    <div style="background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 10px; padding: 15px; margin-bottom: 12px; ${enabledStyle}; transition: all 0.3s;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                            <div style="flex: 1;">
                                <div style="font-weight: bold; color: var(--text-primary); font-size: 1.1em; margin-bottom: 5px; font-family: var(--haos-font-mono);">
                                    ${emoji} ${artist.name}
                                </div>
                                <div style="color: var(--text-secondary); font-size: 0.85em; text-transform: uppercase; letter-spacing: 1px;">
                                    ${artist.genre}
                                </div>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button onclick="toggleArtist(${artist.id})" 
                                        title="${artist.enabled ? 'Disable in rotation' : 'Enable in rotation'}"
                                        style="background: var(--bg-secondary); border: 1px solid var(--border); color: var(--text-primary); padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 1.2em; transition: all 0.2s;">
                                    ${enabledBtn}
                                </button>
                                <a href="${artist.youtubeLink}" target="_blank" 
                                   style="background: #ff0000; border: none; color: white; padding: 8px 12px; border-radius: 6px; cursor: pointer; text-decoration: none; display: inline-flex; align-items: center; justify-content: center; transition: all 0.2s;"
                                   title="Watch on YouTube">
                                    ‚ñ∂
                                </a>
                                <button onclick="deleteArtist(${artist.id})" 
                                        style="background: var(--bg-secondary); border: 1px solid var(--border); color: #ff4444; padding: 8px 12px; border-radius: 6px; cursor: pointer; transition: all 0.2s;"
                                        title="Remove artist">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                        <div style="font-size: 0.75em; color: var(--text-secondary); margin-top: 8px;">
                            Added: ${new Date(artist.dateAdded).toLocaleDateString()}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ============================================
        // TB-303 ACID BASS SYNTHESIZER
        // ============================================
        
        // 303 State
        let acid303Pattern = [];
        let acid303CurrentStep = 0;
        let acid303IsPlaying = false;
        let acid303Interval = null;
        let acid303Synth = {
            cutoff: 800,
            resonance: 15,
            envMod: 70,
            decay: 0.3,
            accentLevel: 50,
            waveform: 'sawtooth',
            tuning: 0,
            volume: 70,
            distortion: 20,
            delay: 0
        };

        // Initialize 303 Pattern (16 steps)
        function init303Pattern() {
            acid303Pattern = Array(16).fill(null).map(() => ({
                active: false,
                note: 'C3',
                accent: false,
                slide: false,
                gate: false
            }));
            render303Grid();
        }

        // Render 303 Step Grid
        function render303Grid() {
            const grid = document.getElementById('acid303Grid');
            if (!grid) return;
            
            grid.innerHTML = acid303Pattern.map((step, index) => `
                <div onclick="toggle303Step(${index})"
                     style="position: relative; aspect-ratio: 1; background: ${step.active ? 'linear-gradient(135deg, var(--accent-primary), var(--accent-cyan))' : 'var(--bg-tertiary)'}; 
                            border: 2px solid ${index === acid303CurrentStep && acid303IsPlaying ? '#ffff00' : 'var(--border)'}; 
                            border-radius: 8px; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center;
                            transition: all 0.2s; box-shadow: ${step.active ? '0 4px 15px rgba(0, 255, 0, 0.3)' : 'none'};">
                    <div style="font-size: 0.9em; font-weight: bold; color: ${step.active ? '#000' : 'var(--text-secondary)'};margin-bottom: 4px;">
                        ${index + 1}
                    </div>
                    ${step.active ? `
                        <div style="font-size: 0.75em; color: #000; font-weight: bold;">${step.note}</div>
                        <div style="display: flex; gap: 2px; margin-top: 4px;">
                            ${step.accent ? '<span style="font-size: 0.65em; background: #ff0000; color: white; padding: 2px 4px; border-radius: 3px;">A</span>' : ''}
                            ${step.slide ? '<span style="font-size: 0.65em; background: #00ff00; color: black; padding: 2px 4px; border-radius: 3px;">S</span>' : ''}
                            ${step.gate ? '<span style="font-size: 0.65em; background: #0000ff; color: white; padding: 2px 4px; border-radius: 3px;">G</span>' : ''}
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        // Toggle 303 Step
        function toggle303Step(index) {
            acid303Pattern[index].active = !acid303Pattern[index].active;
            acid303CurrentStep = index;
            render303Grid();
            updateStepControls(index);
        }

        // Update Step Controls UI
        function updateStepControls(index) {
            document.getElementById('selected303Step').textContent = `#${index + 1}`;
            document.getElementById('acid303Note').value = acid303Pattern[index].note;
            document.getElementById('acid303Accent').checked = acid303Pattern[index].accent;
            document.getElementById('acid303Slide').checked = acid303Pattern[index].slide;
            document.getElementById('acid303Gate').checked = acid303Pattern[index].gate;
        }

        // Update Note for Current Step
        function update303Note() {
            const step = acid303CurrentStep;
            acid303Pattern[step].note = document.getElementById('acid303Note').value;
            render303Grid();
        }

        function update303Accent() {
            const step = acid303CurrentStep;
            acid303Pattern[step].accent = document.getElementById('acid303Accent').checked;
            render303Grid();
        }

        function update303Slide() {
            const step = acid303CurrentStep;
            acid303Pattern[step].slide = document.getElementById('acid303Slide').checked;
            render303Grid();
        }

        function update303Gate() {
            const step = acid303CurrentStep;
            acid303Pattern[step].gate = document.getElementById('acid303Gate').checked;
            render303Grid();
        }

        // Update 303 Synth Parameters
        function update303Synth(param, value) {
            acid303Synth[param] = parseFloat(value);
            
            // Update display values
            const displays = {
                cutoff: 'acid303CutoffVal',
                resonance: 'acid303ResonanceVal',
                envMod: 'acid303EnvModVal',
                decay: 'acid303DecayVal',
                accentLevel: 'acid303AccentLevelVal',
                tuning: 'acid303TuneVal',
                volume: 'acid303VolumeVal',
                distortion: 'acid303DistortionVal',
                delay: 'acid303DelayVal'
            };
            
            const suffixes = {
                cutoff: ' Hz',
                resonance: '',
                envMod: '%',
                decay: 's',
                accentLevel: '%',
                tuning: ' cents',
                volume: '%',
                distortion: '%',
                delay: '%'
            };
            
            if (displays[param]) {
                const el = document.getElementById(displays[param]);
                if (el) {
                    el.textContent = value + (suffixes[param] || '');
                }
            }
        }

        // Play 303 Pattern
        function play303Pattern() {
            if (!audioContext) initAudio();
            
            acid303IsPlaying = true;
            acid303CurrentStep = 0;
            
            const bpm = parseInt(document.getElementById('acid303Bpm')?.value || 130);
            const stepTime = (60 / bpm) * 1000 / 4; // 16th notes
            
            if (acid303Interval) clearInterval(acid303Interval);
            
            acid303Interval = setInterval(() => {
                const step = acid303Pattern[acid303CurrentStep];
                
                if (step.active) {
                    play303Note(step, audioContext.currentTime);
                }
                
                acid303CurrentStep = (acid303CurrentStep + 1) % 16;
                render303Grid();
            }, stepTime);
            
            console.log('üß™ 303 Acid Bass Playing!');
        }

        // Stop 303 Pattern
        function stop303Pattern() {
            acid303IsPlaying = false;
            if (acid303Interval) {
                clearInterval(acid303Interval);
                acid303Interval = null;
            }
            acid303CurrentStep = 0;
            render303Grid();
            console.log('‚èπÔ∏è 303 Stopped');
        }

        // Play Individual 303 Note
        function play303Note(step, time) {
            if (!audioContext) return;
            
            // Note to frequency conversion
            const noteFreqs = {
                'C2': 65.41, 'C#2': 69.30, 'D2': 73.42, 'D#2': 77.78, 'E2': 82.41, 'F2': 87.31,
                'F#2': 92.50, 'G2': 98.00, 'G#2': 103.83, 'A2': 110.00, 'A#2': 116.54, 'B2': 123.47,
                'C3': 130.81, 'C#3': 138.59, 'D3': 146.83, 'D#3': 155.56, 'E3': 164.81, 'F3': 174.61,
                'F#3': 185.00, 'G3': 196.00
            };
            
            const baseFreq = noteFreqs[step.note] || 130.81;
            const freq = baseFreq * Math.pow(2, acid303Synth.tuning / 1200); // Apply tuning
            
            // VCO (Oscillator)
            const osc = audioContext.createOscillator();
            osc.type = acid303Synth.waveform;
            osc.frequency.setValueAtTime(freq, time);
            
            // VCF (Filter)
            const filter = audioContext.createBiquadFilter();
            filter.type = 'lowpass';
            filter.Q.setValueAtTime(acid303Synth.resonance, time);
            
            // Envelope modulation on filter
            const envelopeAmount = (acid303Synth.envMod / 100) * (acid303Synth.cutoff * 2);
            const accentMultiplier = step.accent ? (1 + acid303Synth.accentLevel / 100) : 1;
            const peakCutoff = Math.min(acid303Synth.cutoff + (envelopeAmount * accentMultiplier), 8000);
            
            filter.frequency.setValueAtTime(peakCutoff, time);
            filter.frequency.exponentialRampToValueAtTime(acid303Synth.cutoff, time + acid303Synth.decay);
            
            // VCA (Envelope)
            const gainNode = audioContext.createGain();
            const baseGain = (acid303Synth.volume / 100) * 0.3;
            const accentedGain = baseGain * accentMultiplier;
            const gateTime = step.gate ? 0.25 : 0.1;
            
            gainNode.gain.setValueAtTime(accentedGain, time);
            gainNode.gain.exponentialRampToValueAtTime(0.001, time + gateTime);
            
            // Distortion
            let currentNode = filter;
            if (acid303Synth.distortion > 0) {
                const distortion = audioContext.createWaveShaper();
                const amount = acid303Synth.distortion / 100;
                const k = amount * 100;
                const samples = 44100;
                const curve = new Float32Array(samples);
                for (let i = 0; i < samples; i++) {
                    const x = (i * 2 / samples) - 1;
                    curve[i] = (3 + k) * x * 20 * (Math.PI / 180) / (Math.PI + k * Math.abs(x));
                }
                distortion.curve = curve;
                distortion.oversample = '4x';
                currentNode.connect(distortion);
                currentNode = distortion;
            }
            
            // Connect chain
            osc.connect(filter);
            currentNode.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            // Start & Stop
            osc.start(time);
            osc.stop(time + gateTime + 0.1);
        }

        // Randomize 303
        function randomize303() {
            const notes = ['C2', 'C#2', 'D2', 'D#2', 'E2', 'F2', 'F#2', 'G2', 'G#2', 'A2', 'A#2', 'B2', 'C3', 'D3', 'E3', 'F3'];
            acid303Pattern.forEach((step, i) => {
                step.active = Math.random() > 0.4;
                step.note = notes[Math.floor(Math.random() * notes.length)];
                step.accent = Math.random() > 0.7;
                step.slide = Math.random() > 0.85;
                step.gate = Math.random() > 0.6;
            });
            render303Grid();
            console.log('üé≤ 303 Pattern Randomized');
        }

        // Clear 303
        function clear303() {
            init303Pattern();
            console.log('üóëÔ∏è 303 Pattern Cleared');
        }

        // Load 303 Preset Patterns
        function load303Pattern(patternName) {
            const patterns = {
                'classic303': {
                    steps: [
                        { active: true, note: 'C3', accent: true, slide: false, gate: false },
                        { active: false, note: 'C3', accent: false, slide: false, gate: false },
                        { active: true, note: 'D#3', accent: false, slide: true, gate: false },
                        { active: false, note: 'C3', accent: false, slide: false, gate: false },
                        { active: true, note: 'C3', accent: false, slide: false, gate: false },
                        { active: false, note: 'C3', accent: false, slide: false, gate: false },
                        { active: true, note: 'G3', accent: true, slide: false, gate: true },
                        { active: false, note: 'C3', accent: false, slide: false, gate: false },
                        { active: true, note: 'C3', accent: false, slide: false, gate: false },
                        { active: false, note: 'C3', accent: false, slide: false, gate: false },
                        { active: true, note: 'D#3', accent: false, slide: true, gate: false },
                        { active: false, note: 'C3', accent: false, slide: false, gate: false },
                        { active: true, note: 'C3', accent: true, slide: false, gate: false },
                        { active: false, note: 'C3', accent: false, slide: false, gate: false },
                        { active: true, note: 'D3', accent: false, slide: false, gate: false },
                        { active: false, note: 'C3', accent: false, slide: false, gate: false }
                    ]
                },
                'squelch': {
                    steps: Array(16).fill(null).map((_, i) => ({
                        active: i % 2 === 0,
                        note: ['C3', 'E3', 'G3', 'C3', 'F3', 'A#2', 'G3', 'C3'][i % 8],
                        accent: i % 4 === 0,
                        slide: i % 3 === 1,
                        gate: false
                    }))
                },
                'driving': {
                    steps: Array(16).fill(null).map((_, i) => ({
                        active: true,
                        note: 'C3',
                        accent: i % 4 === 0,
                        slide: false,
                        gate: i % 2 === 0
                    }))
                },
                'minimal': {
                    steps: Array(16).fill(null).map((_, i) => ({
                        active: [0, 4, 8, 12].includes(i),
                        note: 'C3',
                        accent: i === 0,
                        slide: false,
                        gate: true
                    }))
                },
                'acidhouse': {
                    steps: Array(16).fill(null).map((_, i) => ({
                        active: ![1, 5, 9, 13].includes(i),
                        note: ['C3', 'D#3', 'F3', 'G3'][i % 4],
                        accent: i % 8 === 0,
                        slide: i % 5 === 2,
                        gate: false
                    }))
                },
                'psy': {
                    steps: Array(16).fill(null).map((_, i) => ({
                        active: true,
                        note: ['C3', 'D3', 'E3', 'D3'][i % 4],
                        accent: i % 3 === 0,
                        slide: i % 4 === 3,
                        gate: i % 2 === 1
                    }))
                }
            };
            
            if (patterns[patternName]) {
                acid303Pattern = patterns[patternName].steps;
                render303Grid();
                console.log(`üß™ Loaded 303 pattern: ${patternName}`);
            }
        }

        // Initialize 303 on page load
        window.addEventListener('DOMContentLoaded', () => {
            init303Pattern();
        });

        // ============================================
        // KICK PATTERN VARIATIONS
        // ============================================
        
        const technoKickPatterns = {
            'four-floor': [true, false, false, false, true, false, false, false, true, false, false, false, true, false, false, false],  // Classic four on floor
            'hard': [true, false, false, false, true, false, false, false, true, false, false, false, true, false, true, false],  // Hard techno
            'offbeat': [false, false, true, false, false, false, true, false, false, false, true, false, false, false, true, false],  // Offbeat
            'double': [true, true, false, false, true, true, false, false, true, true, false, false, true, true, false, false],  // Double kicks
            'minimal': [true, false, false, false, false, false, false, false, true, false, false, false, false, false, false, false],  // Minimal
            'tribal': [true, false, false, true, false, true, false, false, true, false, false, true, false, true, false, false],  // Tribal
            'acid': [true, false, true, false, true, false, true, false, true, false, true, false, true, false, true, false],  // Acid
            'industrial': [true, false, false, true, true, false, false, true, true, false, false, true, true, false, false, true]  // Industrial
        };
        
        function loadTechnoKickPattern(patternName) {
            const pattern = technoKickPatterns[patternName];
            if (!pattern) return;
            
            // Clear current kick pattern
            technoPattern.kick.fill(false);
            document.querySelectorAll('[data-instrument="kick"]').forEach(el => {
                el.classList.remove('active');
            });
            
            // Load new pattern
            pattern.forEach((active, index) => {
                if (active) {
                    technoPattern.kick[index] = true;
                    const step = document.querySelector(`[data-instrument="kick"][data-step="${index}"]`);
                    if (step) step.classList.add('active');
                }
            });
            
            console.log(`Loaded ${patternName} kick pattern ü¶∂`);
        }

        // ============================================
        // HI-HAT PATTERN VARIATIONS
        // ============================================
        
        const technoHatPatterns = {
            'closed': [false, true, false, true, false, true, false, true, false, true, false, true, false, true, false, true],  // Closed 8ths
            'open': [false, false, false, false, true, false, false, false, false, false, false, false, true, false, false, false],  // Open
            '16ths': [true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true],  // 16th notes
            'offbeat': [false, true, false, true, false, true, false, true, false, true, false, true, false, true, false, true],  // Offbeat
            'minimal': [false, false, false, true, false, false, false, true, false, false, false, true, false, false, false, true],  // Minimal
            'rolling': [true, false, true, true, false, true, true, false, true, false, true, true, false, true, true, false],  // Rolling
            'syncopated': [true, false, false, true, false, true, false, false, true, false, false, true, false, true, false, false],  // Syncopated
            'industrial': [true, true, false, true, true, false, true, false, true, true, false, true, true, false, true, false]  // Industrial
        };
        
        function loadTechnoHatPattern(patternName) {
            const pattern = technoHatPatterns[patternName];
            if (!pattern) return;
            
            // Clear current hat pattern
            technoPattern.hat.fill(false);
            document.querySelectorAll('[data-instrument="hat"]').forEach(el => {
                el.classList.remove('active');
            });
            
            // Load new pattern
            pattern.forEach((active, index) => {
                if (active) {
                    technoPattern.hat[index] = true;
                    const step = document.querySelector(`[data-instrument="hat"][data-step="${index}"]`);
                    if (step) step.classList.add('active');
                }
            });
            
            console.log(`Loaded ${patternName} hi-hat pattern üé©`);
        }

        // Sequencer Functions
        function initTechnoSequencer() {
            const grid = document.getElementById('technoSequencerGrid');
            const instruments = [
                { name: 'KICK', key: 'kick', icon: 'ü¶∂' },
                { name: 'HAT', key: 'hat', icon: 'üé©' },
                { name: 'CLAP', key: 'clap', icon: 'üëè' },
                { name: 'PERC', key: 'perc', icon: 'üîî' },
                { name: 'DUB CHORD', key: 'dub_chord', icon: 'üåä' },
                { name: 'BASS', key: 'bass', icon: 'üé∏' },
                { name: 'SYNTH', key: 'synth', icon: 'üéπ' },
                { name: 'FX', key: 'fx', icon: '‚ú®' }
            ];
            
            grid.innerHTML = '';
            
            instruments.forEach(inst => {
                const row = document.createElement('div');
                row.className = 'sequencer-row';
                
                const label = document.createElement('div');
                label.className = 'instrument-label';
                label.textContent = `${inst.icon} ${inst.name}`;
                row.appendChild(label);
                
                for (let i = 0; i < 16; i++) {
                    const step = document.createElement('div');
                    step.className = 'step';
                    step.dataset.instrument = inst.key;
                    step.dataset.step = i;
                    step.onclick = () => toggleTechnoStep(inst.key, i, step);
                    row.appendChild(step);
                }
                
                grid.appendChild(row);
            });
        }

        function toggleTechnoStep(instrument, step, element) {
            technoPattern[instrument][step] = !technoPattern[instrument][step];
            element.classList.toggle('active');
        }

        function playTechnoPattern() {
            console.log('üéµ Play button clicked');
            
            if (technoIsPlaying) {
                console.log('‚ö†Ô∏è Already playing, ignoring');
                return;
            }
            
            // Check if there's a pattern to play
            const hasPattern = Object.keys(technoPattern).some(key => 
                technoPattern[key].some(val => val === true)
            );
            
            if (!hasPattern) {
                console.warn('‚ö†Ô∏è No pattern to play! Load a preset or create a pattern first.');
                showTechnoNotification('‚ö†Ô∏è No pattern! Load a preset first.');
                return;
            }
            
            console.log('‚úÖ Pattern found, initializing audio...');
            initAudio();
            technoIsPlaying = true;
            technoCurrentStep = 0;
            
            const stepDuration = (60 / technoBPM) / 4 * 1000; // 16th notes
            console.log(`‚ñ∂Ô∏è Playing at ${technoBPM} BPM (${stepDuration.toFixed(2)}ms per step)`);
            
            technoIntervalId = setInterval(() => {
                const ctx = audioContext;
                const time = ctx.currentTime;
                
                // Play drums
                if (technoPattern.kick[technoCurrentStep]) playTechnoKick(ctx, time);
                if (technoPattern.hat[technoCurrentStep]) playTechnoHat(ctx, time);
                if (technoPattern.clap[technoCurrentStep]) playTechnoClap(ctx, time);
                if (technoPattern.perc[technoCurrentStep]) playTechnoPerc(ctx, time);
                
                // Play melodic elements
                if (technoPattern.dub_chord[technoCurrentStep]) playDubChord(ctx, 220, time);
                if (technoPattern.bass[technoCurrentStep]) playTechnoBass(ctx, 110, time);
                if (technoPattern.synth[technoCurrentStep]) playTechnoSynth(ctx, 440, time);
                if (technoPattern.fx[technoCurrentStep]) playTechnoFX(ctx, time);
                
                // Highlight current step
                document.querySelectorAll('.step').forEach(el => el.classList.remove('playing'));
                document.querySelectorAll(`[data-step="${technoCurrentStep}"]`).forEach(el => {
                    el.classList.add('playing');
                });
                
                technoCurrentStep = (technoCurrentStep + 1) % 16;
            }, stepDuration);
        }

        function stopTechnoPattern() {
            console.log('‚èπÔ∏è Stop button clicked');
            technoIsPlaying = false;
            if (technoIntervalId) {
                clearInterval(technoIntervalId);
                technoIntervalId = null;
            }
            technoCurrentStep = 0;
            
            // Remove playing highlights
            document.querySelectorAll('.step').forEach(el => el.classList.remove('playing'));
            console.log('‚úÖ Playback stopped');
        }

        function clearTechnoPattern() {
            Object.keys(technoPattern).forEach(key => {
                technoPattern[key].fill(false);
            });
            document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
        }

        function randomizeTechnoPattern() {
            clearTechnoPattern();
            Object.keys(technoPattern).forEach((key, instIndex) => {
                for (let i = 0; i < 16; i++) {
                    if (Math.random() > 0.7) {
                        technoPattern[key][i] = true;
                        const step = document.querySelector(`[data-instrument="${key}"][data-step="${i}"]`);
                        if (step) step.classList.add('active');
                    }
                }
            });
        }

        function loadTechnoPreset(preset) {
            console.log(`üéµ Loading techno preset: ${preset}`);
            clearTechnoPattern();
            
            // Set BPM based on preset style
            const bpmSettings = {
                t78_rolling: 148,
                t78_peak: 150,
                t78_hypnotic: 146,
                hard_techno: 145,
                minimal: 130,
                industrial: 140,
                acid_groove: 135,
                dub_techno: 122
            };
            
            if (bpmSettings[preset]) {
                const bpmSlider = document.getElementById('technoBpmControl');
                if (bpmSlider) {
                    bpmSlider.value = bpmSettings[preset];
                    updateTechnoBPM(bpmSettings[preset]);
                }
            }
            
            const presets = {
                // T78 STYLE PRESETS - High energy, driving techno
                t78_rolling: {
                    kick: [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],  // Four on floor driving
                    hat: [0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1],  // Rolling hi-hats (T78 signature)
                    clap: [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,1],  // Syncopated claps
                    perc: [0,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0],  // Industrial percussion
                    dub_chord: [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],  // Minimal chords
                    bass: [1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0],  // Driving bassline
                    synth: [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1],  // Sparse lead stabs
                    fx: [0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0]      // Rhythmic FX
                },
                t78_peak: {
                    kick: [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],  // Relentless four on floor
                    hat: [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],  // Constant hi-hat energy
                    clap: [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],  // Classic placement
                    perc: [0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1],  // Dense percussion layer
                    dub_chord: [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],  // No chords (peak energy)
                    bass: [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0],  // Aggressive rolling bass
                    synth: [0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1],  // Stab pattern
                    fx: [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0]      // Impact FX
                },
                t78_hypnotic: {
                    kick: [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],  // Steady foundation
                    hat: [0,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0],  // Hypnotic hi-hat loop
                    clap: [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],  // Minimal claps
                    perc: [0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1],  // Repeating motif
                    dub_chord: [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],  // Long sustained chord
                    bass: [1,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0],  // Groovy bassline
                    synth: [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0],  // Hypnotic loop
                    fx: [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0]      // Sparse atmospheric FX
                },
                
                // ORIGINAL PRESETS
                hard_techno: {
                    kick: [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],
                    hat: [0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1],
                    clap: [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],
                    perc: [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0],
                    dub_chord: [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                    bass: [1,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0],
                    synth: [0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0],
                    fx: [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0]
                },
                minimal: {
                    kick: [1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],
                    hat: [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0],
                    clap: [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],
                    perc: [0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0],
                    dub_chord: [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                    bass: [1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],
                    synth: [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                    fx: [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
                },
                industrial: {
                    kick: [1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0],
                    hat: [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
                    clap: [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0],
                    perc: [0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1],
                    dub_chord: [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                    bass: [1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0],
                    synth: [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0],
                    fx: [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0]
                },
                acid_groove: {
                    kick: [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],
                    hat: [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0],
                    clap: [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],
                    perc: [1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0],
                    dub_chord: [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                    bass: [1,0,0,0,1,0,0,1,1,0,0,0,1,0,0,1],
                    synth: [0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0],
                    fx: [0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0]
                },
                dub_techno: {
                    kick: [1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],
                    hat: [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0],
                    clap: [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],
                    perc: [0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0],
                    dub_chord: [1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],
                    bass: [1,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0],
                    synth: [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],
                    fx: [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1]
                }
            };
            
            const pattern = presets[preset];
            if (!pattern) {
                console.error(`‚ùå Preset not found: ${preset}`);
                return;
            }
            
            // Set drum variations based on preset
            const drumVariationSettings = {
                t78_rolling: { kick: 'hard', hat: 'metallic', clap: 'tight', perc: 'rim' },
                t78_peak: { kick: 'hard', hat: 'bright', clap: 'tight', perc: 'cowbell' },
                t78_hypnotic: { kick: 'deep', hat: 'metallic', clap: 'classic', perc: 'tom' },
                hard_techno: { kick: 'hard', hat: 'classic', clap: 'classic', perc: 'tom' },
                industrial: { kick: 'industrial', hat: 'metallic', clap: 'snare', perc: 'rim' },
                minimal: { kick: 'classic', hat: 'classic', clap: 'tight', perc: 'tom' },
                acid_groove: { kick: 'classic', hat: 'bright', clap: 'classic', perc: 'tom' },
                dub_techno: { kick: 'deep', hat: 'open', clap: 'reverb', perc: 'conga' }
            };
            
            if (drumVariationSettings[preset]) {
                const settings = drumVariationSettings[preset];
                if (typeof setDrumVariation !== 'undefined') {
                    setDrumVariation('kick', settings.kick);
                    setDrumVariation('hat', settings.hat);
                    setDrumVariation('clap', settings.clap);
                    setDrumVariation('perc', settings.perc);
                }
            }
            
            let stepsActivated = 0;
            Object.keys(pattern).forEach(key => {
                pattern[key].forEach((val, i) => {
                    technoPattern[key][i] = val === 1;
                    const step = document.querySelector(`[data-instrument="${key}"][data-step="${i}"]`);
                    if (step) {
                        if (val === 1) {
                            step.classList.add('active');
                            stepsActivated++;
                        }
                    } else {
                        console.warn(`‚ö†Ô∏è Step element not found: ${key}[${i}]`);
                    }
                });
            });
            
            console.log(`‚úÖ Preset loaded: ${stepsActivated} steps activated`);
            
            // Show visual feedback
            showTechnoNotification(`${preset.replace('_', ' ').toUpperCase()} loaded! Click ‚ñ∂Ô∏è to play.`);
        }

        function updateTechnoBPM(value) {
            technoBPM = parseInt(value);
            document.getElementById('technoBpmValue').textContent = value;
        }

        // Show notification helper
        function showTechnoNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: linear-gradient(135deg, #00ff00, #00ffff);
                color: #000;
                padding: 15px 25px;
                border-radius: 10px;
                box-shadow: 0 4px 20px rgba(0, 255, 0, 0.3);
                z-index: 9999;
                font-weight: bold;
                animation: slideIn 0.3s ease-out;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'fadeOut 0.3s ease-out';
                setTimeout(() => notification.remove(), 300);
            }, 2500);
        }

        // ============================================
        // DAW ARRANGEMENT SYSTEM
        // ============================================
        
        function savePatternSnapshot() {
            // Create a deep copy of the current pattern
            const snapshot = {
                id: Date.now(),
                name: prompt('Name this pattern:', `Pattern ${technoArrangement.patterns.length + 1}`) || `Pattern ${technoArrangement.patterns.length + 1}`,
                timestamp: new Date().toISOString(),
                pattern: JSON.parse(JSON.stringify(technoPattern))
            };
            
            technoArrangement.patterns.push(snapshot);
            updatePatternLibrary();
            showTechnoNotification(`‚úÖ Pattern "${snapshot.name}" saved!`);
            console.log(`üíæ Saved pattern:`, snapshot);
        }
        
        function updatePatternLibrary() {
            const patternList = document.getElementById('patternList');
            
            if (technoArrangement.patterns.length === 0) {
                patternList.innerHTML = '<p style="color: var(--text-secondary);">No patterns saved yet. Create a pattern and click "Save Current Pattern".</p>';
                return;
            }
            
            patternList.innerHTML = technoArrangement.patterns.map((pattern, index) => `
                <div class="pattern-card" style="
                    background: var(--bg-secondary);
                    padding: 10px 15px;
                    border-radius: 5px;
                    border: 1px solid var(--accent-primary);
                    cursor: pointer;
                    transition: all 0.3s;
                " 
                onmouseover="this.style.borderColor='var(--accent-cyan)'; this.style.boxShadow='0 0 15px rgba(0,255,255,0.3)'"
                onmouseout="this.style.borderColor='var(--accent-primary)'; this.style.boxShadow='none'"
                >
                    <div style="font-weight: bold; color: var(--accent-primary); margin-bottom: 5px;">
                        ${pattern.name}
                    </div>
                    <div style="font-size: 0.8em; color: var(--text-secondary); margin-bottom: 8px;">
                        ID: ${pattern.id}
                    </div>
                    <div style="display: flex; gap: 5px;">
                        <button class="btn btn-secondary" style="padding: 5px 10px; font-size: 0.8em;" onclick="loadPatternSnapshot(${index})">
                            üì• Load
                        </button>
                        <button class="btn btn-cyan" style="padding: 5px 10px; font-size: 0.8em;" onclick="addPatternToTimeline(${index})">
                            ‚ûï Add to Timeline
                        </button>
                        <button class="btn btn-magenta" style="padding: 5px 10px; font-size: 0.8em;" onclick="deletePattern(${index})">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        function loadPatternSnapshot(index) {
            const snapshot = technoArrangement.patterns[index];
            if (!snapshot) return;
            
            // Clear current pattern
            clearTechnoPattern();
            
            // Load snapshot pattern
            technoPattern = JSON.parse(JSON.stringify(snapshot.pattern));
            
            // Update UI
            Object.keys(technoPattern).forEach(key => {
                technoPattern[key].forEach((val, i) => {
                    const step = document.querySelector(`[data-instrument="${key}"][data-step="${i}"]`);
                    if (step && val) {
                        step.classList.add('active');
                    }
                });
            });
            
            showTechnoNotification(`‚úÖ Loaded "${snapshot.name}"`);
            console.log(`üì• Loaded pattern:`, snapshot);
        }
        
        function deletePattern(index) {
            if (!confirm(`Delete "${technoArrangement.patterns[index].name}"?`)) return;
            
            const deleted = technoArrangement.patterns.splice(index, 1)[0];
            updatePatternLibrary();
            showTechnoNotification(`üóëÔ∏è Deleted "${deleted.name}"`);
        }
        
        function toggleArrangementMode() {
            technoArrangement.isArrangementMode = !technoArrangement.isArrangementMode;
            const btn = document.getElementById('arrangementModeText');
            
            if (technoArrangement.isArrangementMode) {
                btn.textContent = 'üé¨ Exit Arrangement Mode';
                initializeTimeline();
                showTechnoNotification('üé¨ Arrangement Mode ON - Build your track!');
            } else {
                btn.textContent = 'üé¨ Enter Arrangement Mode';
                showTechnoNotification('üé¨ Arrangement Mode OFF');
            }
        }
        
        function initializeTimeline() {
            const timelineGrid = document.getElementById('timelineGrid');
            timelineGrid.innerHTML = '';
            
            for (let i = 0; i < 16; i++) {
                const slot = document.createElement('div');
                slot.className = 'timeline-slot';
                slot.dataset.bar = i;
                slot.style.cssText = `
                    background: var(--bg-tertiary);
                    border: 1px dashed var(--border);
                    border-radius: 3px;
                    min-height: 60px;
                    padding: 5px;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    cursor: pointer;
                    transition: all 0.3s;
                `;
                slot.innerHTML = `<span style="font-size: 0.7em; color: var(--text-secondary);">Bar ${i + 1}</span>`;
                
                slot.ondragover = (e) => {
                    e.preventDefault();
                    slot.style.background = 'rgba(0, 255, 0, 0.1)';
                    slot.style.borderColor = 'var(--accent-primary)';
                };
                
                slot.ondragleave = () => {
                    slot.style.background = 'var(--bg-tertiary)';
                    slot.style.borderColor = 'var(--border)';
                };
                
                slot.ondrop = (e) => {
                    e.preventDefault();
                    const patternIndex = e.dataTransfer.getData('patternIndex');
                    placePatternOnTimeline(parseInt(patternIndex), i);
                    slot.style.background = 'var(--bg-tertiary)';
                    slot.style.borderColor = 'var(--border)';
                };
                
                timelineGrid.appendChild(slot);
            }
        }
        
        function addPatternToTimeline(patternIndex) {
            if (!technoArrangement.isArrangementMode) {
                showTechnoNotification('‚ö†Ô∏è Enable Arrangement Mode first!');
                return;
            }
            
            // Find next empty slot
            const usedBars = technoArrangement.timeline.map(item => item.bar);
            let nextBar = 0;
            while (usedBars.includes(nextBar) && nextBar < 16) {
                nextBar++;
            }
            
            if (nextBar >= 16) {
                showTechnoNotification('‚ö†Ô∏è Timeline is full!');
                return;
            }
            
            placePatternOnTimeline(patternIndex, nextBar);
        }
        
        function placePatternOnTimeline(patternIndex, bar) {
            const pattern = technoArrangement.patterns[patternIndex];
            if (!pattern) return;
            
            // Add to timeline
            technoArrangement.timeline.push({
                patternId: pattern.id,
                patternIndex: patternIndex,
                bar: bar,
                name: pattern.name
            });
            
            // Update timeline UI
            const slot = document.querySelector(`[data-bar="${bar}"]`);
            if (slot) {
                slot.style.background = 'linear-gradient(135deg, rgba(0, 255, 0, 0.2), rgba(0, 255, 255, 0.2))';
                slot.style.borderColor = 'var(--accent-cyan)';
                slot.innerHTML = `
                    <div style="font-size: 0.7em; color: var(--text-secondary); margin-bottom: 3px;">Bar ${bar + 1}</div>
                    <div style="font-size: 0.8em; color: var(--accent-cyan); font-weight: bold; text-align: center;">${pattern.name}</div>
                    <button onclick="removeFromTimeline(${bar})" style="margin-top: 5px; padding: 2px 8px; font-size: 0.7em; background: var(--accent-secondary); color: #000; border: none; border-radius: 3px; cursor: pointer;">‚úï</button>
                `;
            }
            
            showTechnoNotification(`‚úÖ Added "${pattern.name}" to Bar ${bar + 1}`);
            console.log(`Timeline updated:`, technoArrangement.timeline);
        }
        
        function removeFromTimeline(bar) {
            technoArrangement.timeline = technoArrangement.timeline.filter(item => item.bar !== bar);
            initializeTimeline();
            
            // Re-add remaining patterns
            technoArrangement.timeline.forEach(item => {
                const slot = document.querySelector(`[data-bar="${item.bar}"]`);
                if (slot) {
                    const pattern = technoArrangement.patterns[item.patternIndex];
                    slot.style.background = 'linear-gradient(135deg, rgba(0, 255, 0, 0.2), rgba(0, 255, 255, 0.2))';
                    slot.style.borderColor = 'var(--accent-cyan)';
                    slot.innerHTML = `
                        <div style="font-size: 0.7em; color: var(--text-secondary); margin-bottom: 3px;">Bar ${item.bar + 1}</div>
                        <div style="font-size: 0.8em; color: var(--accent-cyan); font-weight: bold; text-align: center;">${pattern.name}</div>
                        <button onclick="removeFromTimeline(${item.bar})" style="margin-top: 5px; padding: 2px 8px; font-size: 0.7em; background: var(--accent-secondary); color: #000; border: none; border-radius: 3px; cursor: pointer;">‚úï</button>
                    `;
                }
            });
            
            showTechnoNotification(`üóëÔ∏è Removed from Bar ${bar + 1}`);
        }
        
        function playArrangement() {
            if (technoArrangement.timeline.length === 0) {
                showTechnoNotification('‚ö†Ô∏è Timeline is empty! Add patterns first.');
                return;
            }
            
            stopTechnoPattern(); // Stop any current playback
            
            showTechnoNotification('‚ñ∂Ô∏è Playing arrangement...');
            console.log('üé¨ Playing arrangement:', technoArrangement.timeline);
            
            // Sort timeline by bar order
            const sortedTimeline = [...technoArrangement.timeline].sort((a, b) => a.bar - b.bar);
            
            let currentBarIndex = 0;
            
            function playNextBar() {
                if (currentBarIndex >= sortedTimeline.length) {
                    showTechnoNotification('‚úÖ Arrangement complete!');
                    return;
                }
                
                const item = sortedTimeline[currentBarIndex];
                const pattern = technoArrangement.patterns[item.patternIndex];
                
                // Load the pattern
                clearTechnoPattern();
                technoPattern = JSON.parse(JSON.stringify(pattern.pattern));
                
                // Update UI
                Object.keys(technoPattern).forEach(key => {
                    technoPattern[key].forEach((val, i) => {
                        const step = document.querySelector(`[data-instrument="${key}"][data-step="${i}"]`);
                        if (step) {
                            if (val) {
                                step.classList.add('active');
                            } else {
                                step.classList.remove('active');
                            }
                        }
                    });
                });
                
                // Play the pattern for 1 bar (4 beats = 4 loops of 16th notes)
                playTechnoPattern();
                
                const barDuration = (60 / technoBPM) * 4 * 1000; // 4 beats in milliseconds
                
                setTimeout(() => {
                    stopTechnoPattern();
                    currentBarIndex++;
                    playNextBar();
                }, barDuration);
            }
            
            playNextBar();
        }
        
        function stopArrangement() {
            stopTechnoPattern();
            showTechnoNotification('‚èπÔ∏è Arrangement stopped');
        }
        
        function exportArrangement() {
            if (technoArrangement.timeline.length === 0) {
                showTechnoNotification('‚ö†Ô∏è No arrangement to export!');
                return;
            }
            
            const arrangementData = {
                timeline: technoArrangement.timeline,
                patterns: technoArrangement.patterns,
                bpm: technoBPM,
                exportedAt: new Date().toISOString()
            };
            
            // Create downloadable JSON file
            const blob = new Blob([JSON.stringify(arrangementData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `techno-arrangement-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showTechnoNotification('üíø Arrangement exported!');
            console.log('üíø Exported arrangement:', arrangementData);
        }

        // ============================================
        // RADIO INTEGRATION
        // ============================================
        
        /**
         * Export current techno track to Radio 24/7
         * Records the pattern and sends it to the radio queue
         */
        async function exportTechnoToRadio() {
            if (!hasActiveTechnoPattern() && technoSequence.length === 0) {
                alert('‚ö†Ô∏è Create a techno track first!\n\n1. Generate a melodic sequence\n2. Add drum pattern\n3. Click "Send to Radio"');
                return;
            }

            // Show progress
            const originalBtn = event.target;
            const originalText = originalBtn.innerHTML;
            originalBtn.innerHTML = 'üéôÔ∏è Recording...';
            originalBtn.disabled = true;

            try {
                // Record the pattern (8 bars)
                const audioBlob = await recordTechnoTrack();
                
                if (!audioBlob) {
                    throw new Error('Recording failed');
                }

                // Get track metadata
                const trackName = `Techno Track ${new Date().toLocaleTimeString()}`;
                const bpm = technoBPM;
                const instrument = currentTechnoInstrument;
                
                // Send to Radio 24/7
                const success = sendTechnoToRadio({
                    blob: audioBlob,
                    title: trackName,
                    artist: 'Techno Creator',
                    bpm: bpm,
                    instrument: instrument,
                    channel: 'techno' // Techno tracks go to Techno channel
                });

                if (success) {
                    originalBtn.innerHTML = '‚úÖ Sent to Radio!';
                    setTimeout(() => {
                        originalBtn.innerHTML = originalText;
                        originalBtn.disabled = false;
                    }, 2000);
                    
                    // Ask if user wants to open radio
                    if (confirm('üéâ Track sent to Techno Radio!\n\nOpen Radio 24/7 now?')) {
                        window.open('/radio.html', '_blank');
                    }
                } else {
                    throw new Error('Failed to send to radio');
                }
            } catch (error) {
                console.error('Export to radio error:', error);
                originalBtn.innerHTML = '‚ùå Failed';
                setTimeout(() => {
                    originalBtn.innerHTML = originalText;
                    originalBtn.disabled = false;
                }, 2000);
                alert('‚ùå Failed to send to radio. Make sure you have created a track first.');
            }
        }

        /**
         * Check if there's an active techno pattern
         */
        function hasActiveTechnoPattern() {
            return Object.values(technoPattern).some(track => track.some(step => step));
        }

        /**
         * Record the current techno track to audio blob
         */
        async function recordTechnoTrack() {
            return new Promise((resolve, reject) => {
                try {
                    // Initialize audio if needed
                    if (!audioContext) {
                        initAudio();
                    }
                    
                    // Create MediaStreamDestination for recording
                    const destination = audioContext.createMediaStreamDestination();
                    
                    // Start recording
                    const mediaRecorder = new MediaRecorder(destination.stream, {
                        mimeType: 'audio/webm;codecs=opus'
                    });
                    
                    const chunks = [];
                    
                    mediaRecorder.ondataavailable = (e) => {
                        if (e.data.size > 0) {
                            chunks.push(e.data);
                        }
                    };
                    
                    mediaRecorder.onstop = () => {
                        const blob = new Blob(chunks, { type: 'audio/webm' });
                        resolve(blob);
                    };
                    
                    mediaRecorder.onerror = (error) => {
                        reject(error);
                    };
                    
                    // Start recording
                    mediaRecorder.start();
                    
                    // Calculate recording duration (8 bars)
                    const barDuration = (60 / technoBPM) * 4 * 1000; // 4 beats per bar
                    const recordingDuration = barDuration * 8; // 8 bars
                    
                    // Play the pattern with recording destination
                    playTechnoPatternWithDestination(destination, recordingDuration);
                    
                    // Stop recording after duration
                    setTimeout(() => {
                        mediaRecorder.stop();
                    }, recordingDuration + 500); // Add 500ms buffer
                    
                } catch (error) {
                    reject(error);
                }
            });
        }

        /**
         * Play techno pattern with custom destination (for recording)
         */
        function playTechnoPatternWithDestination(destination, duration) {
            const stepTime = (60 / technoBPM) / 4; // 16th note duration in seconds
            let currentStep = 0;
            const totalSteps = Math.ceil(duration / (stepTime * 1000));
            
            const playStep = () => {
                if (currentStep >= totalSteps) return;
                
                const step = currentStep % 16;
                const time = audioContext.currentTime;
                
                // Play drums
                if (technoPattern.kick[step]) {
                    playTechnoKickWithDestination(time, destination);
                }
                if (technoPattern.hat[step]) {
                    playTechnoHatWithDestination(time, destination);
                }
                if (technoPattern.clap[step]) {
                    playTechnoClapWithDestination(time, destination);
                }
                if (technoPattern.perc[step]) {
                    playTechnoPercWithDestination(time, destination);
                }
                
                // Play melodic sequence
                if (technoSequence.length > 0 && step % 4 === 0) {
                    const noteIndex = Math.floor(step / 4) % technoSequence.length;
                    const note = technoSequence[noteIndex];
                    if (note && note.freq) {
                        playTechnoNoteWithDestination(note.freq, time, destination);
                    }
                }
                
                currentStep++;
                setTimeout(playStep, stepTime * 1000);
            };
            
            playStep();
        }

        /**
         * Play techno instruments with custom destination
         */
        function playTechnoKickWithDestination(time, destination) {
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            
            osc.connect(gain);
            gain.connect(destination);
            gain.connect(audioContext.destination);
            
            osc.frequency.setValueAtTime(150, time);
            osc.frequency.exponentialRampToValueAtTime(40, time + 0.5);
            gain.gain.setValueAtTime(1, time);
            gain.gain.exponentialRampToValueAtTime(0.01, time + 0.5);
            
            osc.start(time);
            osc.stop(time + 0.5);
        }

        function playTechnoHatWithDestination(time, destination) {
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            
            osc.type = 'square';
            osc.connect(gain);
            gain.connect(destination);
            gain.connect(audioContext.destination);
            
            osc.frequency.setValueAtTime(10000, time);
            gain.gain.setValueAtTime(0.3, time);
            gain.gain.exponentialRampToValueAtTime(0.01, time + 0.05);
            
            osc.start(time);
            osc.stop(time + 0.05);
        }

        function playTechnoClapWithDestination(time, destination) {
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            
            osc.type = 'square';
            osc.connect(gain);
            gain.connect(destination);
            gain.connect(audioContext.destination);
            
            osc.frequency.setValueAtTime(1000, time);
            gain.gain.setValueAtTime(0.5, time);
            gain.gain.exponentialRampToValueAtTime(0.01, time + 0.1);
            
            osc.start(time);
            osc.stop(time + 0.1);
        }

        function playTechnoPercWithDestination(time, destination) {
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            
            osc.type = 'triangle';
            osc.connect(gain);
            gain.connect(destination);
            gain.connect(audioContext.destination);
            
            osc.frequency.setValueAtTime(800, time);
            gain.gain.setValueAtTime(0.4, time);
            gain.gain.exponentialRampToValueAtTime(0.01, time + 0.15);
            
            osc.start(time);
            osc.stop(time + 0.15);
        }

        function playTechnoNoteWithDestination(freq, time, destination) {
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            const filter = audioContext.createBiquadFilter();
            
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(freq, time);
            
            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(2000, time);
            filter.Q.setValueAtTime(5, time);
            
            osc.connect(filter);
            filter.connect(gain);
            gain.connect(destination);
            gain.connect(audioContext.destination);
            
            gain.gain.setValueAtTime(0.3, time);
            gain.gain.exponentialRampToValueAtTime(0.01, time + 0.5);
            
            osc.start(time);
            osc.stop(time + 0.5);
        }

        /**
         * Send audio blob to Radio 24/7
         */
        function sendTechnoToRadio(trackData) {
            try {
                // Create a unique track object
                const track = {
                    id: Date.now() + Math.random(),
                    title: trackData.title,
                    artist: trackData.artist,
                    bpm: trackData.bpm,
                    instrument: trackData.instrument,
                    url: URL.createObjectURL(trackData.blob),
                    file: new File([trackData.blob], `${trackData.title}.webm`, { type: 'audio/webm' }),
                    channel: trackData.channel,
                    duration: 0, // Will be calculated by Radio
                    source: 'Techno Creator'
                };
                
                // Store in localStorage for Radio to pickup
                const radioQueue = localStorage.getItem('technoQueue');
                let queue = radioQueue ? JSON.parse(radioQueue) : [];
                
                // Add metadata (note: blob URLs can't be persisted)
                queue.push({
                    id: track.id,
                    title: track.title,
                    artist: track.artist,
                    bpm: track.bpm,
                    instrument: track.instrument,
                    channel: track.channel,
                    source: track.source,
                    timestamp: new Date().toISOString()
                });
                
                localStorage.setItem('technoQueue', JSON.stringify(queue));
                
                // Also send via postMessage if Radio is open
                if (window.opener || window.parent !== window) {
                    window.postMessage({
                        type: 'ADD_TO_RADIO',
                        track: track
                    }, '*');
                }
                
                // Dispatch custom event for same-window communication
                window.dispatchEvent(new CustomEvent('technoCreatorTrackExport', {
                    detail: track
                }));
                
                return true;
            } catch (error) {
                console.error('Failed to send to radio:', error);
                return false;
            }
        }

        // ============================================
        // INTELLIGENT TECHNO GENERATOR - EXPERT MODE
        // ============================================
        
        /**
         * Generate an intelligent techno pattern based on style, complexity, and instruments
         */
        function generateIntelligentTechno() {
            const genre = document.getElementById('technoGenreStyle').value;
            const complexity = document.getElementById('technoComplexityLevel').value;
            const energy = parseInt(document.getElementById('technoEnergyLevel').value);
            
            // Get active instruments
            const instruments = {
                kick: document.getElementById('techno_inst_kick').checked,
                snare: document.getElementById('techno_inst_snare').checked,
                hihat: document.getElementById('techno_inst_hihat').checked,
                perc: document.getElementById('techno_inst_perc').checked
            };
            
            console.log(`Generating ${genre} techno | Complexity: ${complexity} | Energy: ${energy}`);
            
            // Clear current pattern
            clearTechnoPattern();
            
            // Generate BPM based on genre and energy
            const bpm = calculateTechnoBPM(genre, energy);
            document.getElementById('technoBPM').value = bpm;
            // Update BPM display if function exists
            if (typeof updateTechnoBPM === 'function') {
                updateTechnoBPM(bpm);
            }
            
            // Generate patterns for each active instrument
            if (instruments.kick) {
                const kickPattern = selectTechnoKickPattern(genre, complexity, energy);
                loadTechnoKickPattern(kickPattern);
            }
            
            if (instruments.hihat) {
                const hihatPattern = selectTechnoHiHatPattern(genre, complexity, energy);
                loadTechnoHatPattern(hihatPattern);
            }
            
            // Play preview
            setTimeout(() => {
                playTechnoPattern();
            }, 300);
            
            // Show notification
            showTechnoGenerationNotification(genre, complexity);
        }
        
        /**
         * Calculate BPM for techno genre
         */
        function calculateTechnoBPM(genre, energy) {
            const bpmRanges = {
                'detroit': { min: 120, max: 130 },
                'minimal': { min: 125, max: 135 },
                'industrial': { min: 135, max: 150 },
                'acid': { min: 130, max: 145 },
                'hard': { min: 140, max: 155 },
                'tribal': { min: 125, max: 140 },
                'progressive': { min: 128, max: 138 }
            };
            
            const range = bpmRanges[genre] || { min: 128, max: 135 };
            const bpm = Math.round(range.min + (range.max - range.min) * (energy / 10));
            return bpm;
        }
        
        /**
         * Select techno kick pattern based on parameters
         */
        function selectTechnoKickPattern(genre, complexity, energy) {
            const patterns = {
                'detroit': {
                    minimal: 'four-floor',
                    simple: 'four-floor',
                    moderate: 'hard',
                    complex: 'double',
                    chaotic: 'offbeat'
                },
                'minimal': {
                    minimal: 'minimal',
                    simple: 'minimal',
                    moderate: 'four-floor',
                    complex: 'offbeat',
                    chaotic: 'double'
                },
                'industrial': {
                    minimal: 'hard',
                    simple: 'industrial',
                    moderate: 'industrial',
                    complex: 'double',
                    chaotic: 'acid'
                },
                'acid': {
                    minimal: 'four-floor',
                    simple: 'acid',
                    moderate: 'acid',
                    complex: 'offbeat',
                    chaotic: 'double'
                },
                'hard': {
                    minimal: 'hard',
                    simple: 'hard',
                    moderate: 'industrial',
                    complex: 'double',
                    chaotic: 'acid'
                },
                'tribal': {
                    minimal: 'four-floor',
                    simple: 'tribal',
                    moderate: 'tribal',
                    complex: 'offbeat',
                    chaotic: 'double'
                },
                'progressive': {
                    minimal: 'minimal',
                    simple: 'four-floor',
                    moderate: 'offbeat',
                    complex: 'double',
                    chaotic: 'hard'
                }
            };
            
            return patterns[genre]?.[complexity] || 'four-floor';
        }
        
        /**
         * Select techno hi-hat pattern based on parameters
         */
        function selectTechnoHiHatPattern(genre, complexity, energy) {
            const patterns = {
                'detroit': {
                    minimal: 'closed',
                    simple: 'closed',
                    moderate: '16ths',
                    complex: 'rolling',
                    chaotic: 'syncopated'
                },
                'minimal': {
                    minimal: 'minimal',
                    simple: 'minimal',
                    moderate: 'closed',
                    complex: 'offbeat',
                    chaotic: '16ths'
                },
                'industrial': {
                    minimal: 'closed',
                    simple: 'industrial',
                    moderate: 'industrial',
                    complex: '16ths',
                    chaotic: 'rolling'
                },
                'acid': {
                    minimal: 'closed',
                    simple: 'offbeat',
                    moderate: '16ths',
                    complex: 'rolling',
                    chaotic: 'syncopated'
                },
                'hard': {
                    minimal: 'closed',
                    simple: '16ths',
                    moderate: 'industrial',
                    complex: 'rolling',
                    chaotic: 'syncopated'
                },
                'tribal': {
                    minimal: 'minimal',
                    simple: 'offbeat',
                    moderate: 'syncopated',
                    complex: 'rolling',
                    chaotic: '16ths'
                },
                'progressive': {
                    minimal: 'minimal',
                    simple: 'closed',
                    moderate: 'offbeat',
                    complex: '16ths',
                    chaotic: 'rolling'
                }
            };
            
            return patterns[genre]?.[complexity] || 'closed';
        }
        
        /**
         * Show techno generation notification
         */
        function showTechnoGenerationNotification(genre, complexity) {
            const notif = document.createElement('div');
            notif.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 20px 30px;
                background: linear-gradient(135deg, var(--accent-cyan), #00ffff);
                color: #000;
                border-radius: 10px;
                box-shadow: 0 10px 30px rgba(0, 255, 255, 0.5);
                z-index: 10000;
                font-weight: bold;
                animation: slideInRight 0.3s ease-out;
            `;
            notif.innerHTML = `üß† Generated ${genre.toUpperCase()} techno<br><small style="opacity:0.8">${complexity} complexity</small>`;
            document.body.appendChild(notif);
            setTimeout(() => {
                notif.style.animation = 'slideOutRight 0.3s ease-out';
                setTimeout(() => document.body.removeChild(notif), 300);
            }, 3000);
        }
        
        /**
         * Load techno pattern combination presets
         */
        function loadTechnoCombo(comboName) {
            const combos = {
                'four-floor-classic': {
                    kick: 'four-floor',
                    hihat: 'closed',
                    bpm: 128
                },
                'minimal-groove': {
                    kick: 'minimal',
                    hihat: 'minimal',
                    bpm: 130
                },
                'industrial-assault': {
                    kick: 'industrial',
                    hihat: 'industrial',
                    bpm: 145
                },
                'acid-rave': {
                    kick: 'acid',
                    hihat: '16ths',
                    bpm: 138
                },
                'tribal-ritual': {
                    kick: 'tribal',
                    hihat: 'syncopated',
                    bpm: 132
                },
                'progressive-journey': {
                    kick: 'offbeat',
                    hihat: 'rolling',
                    bpm: 133
                }
            };
            
            const combo = combos[comboName];
            if (!combo) return;
            
            // Set BPM
            document.getElementById('technoBPM').value = combo.bpm;
            if (typeof updateTechnoBPM === 'function') {
                updateTechnoBPM(combo.bpm);
            }
            
            // Load patterns
            loadTechnoKickPattern(combo.kick);
            loadTechnoHatPattern(combo.hihat);
            
            // Play preview
            setTimeout(() => playTechnoPattern(), 200);
            
            console.log(`Loaded techno combo: ${comboName}`);
        }
        
        /**
         * Randomize techno kick pattern
         */
        function randomizeTechnoKickPattern() {
            const patterns = ['four-floor', 'hard', 'offbeat', 'double', 'minimal', 'tribal', 'acid', 'industrial'];
            const random = patterns[Math.floor(Math.random() * patterns.length)];
            loadTechnoKickPattern(random);
        }
        
        /**
         * Randomize techno hi-hat pattern
         */
        function randomizeTechnoHiHatPattern() {
            const patterns = ['closed', 'open', '16ths', 'offbeat', 'minimal', 'rolling', 'syncopated', 'industrial'];
            const random = patterns[Math.floor(Math.random() * patterns.length)];
            loadTechnoHatPattern(random);
        }
        
        /**
         * Randomize all techno patterns
         */
        function randomizeAllTechnoPatterns() {
            randomizeTechnoKickPattern();
            setTimeout(() => randomizeTechnoHiHatPattern(), 100);
            setTimeout(() => playTechnoPattern(), 300);
        }

        // Initialize sequencer on load
        window.addEventListener('DOMContentLoaded', () => {
            initTechnoSequencer();
            
            // First-time user detection for techno
            const hasVisited = localStorage.getItem('techno-creator-visited');
            if (!hasVisited) {
                setTimeout(() => {
                    if (confirm('‚ö° Welcome to Techno Creator! Would you like a quick tour of the features?')) {
                        startTechnoTutorial();
                    }
                }, 2000);
                localStorage.setItem('techno-creator-visited', 'true');
            }
        });

        // ============================================
        // TECHNO INTERACTIVE FEATURES
        // ============================================
        
        function startTechnoTutorial() {
            const steps = [
                {
                    title: "‚ö° Welcome to Techno Creator!",
                    text: "Industrial-grade techno production with live guidance!"
                },
                {
                    title: "üéπ Sequence Generator",
                    text: "Generate hypnotic acid basslines and minimal progressions",
                    element: ".tool-section"
                },
                {
                    title: "‚ö° Live Guidance",
                    text: "Follow the 7-step workflow in the guidance panel",
                    element: "#guidancePanel"
                },
                {
                    title: "üî• Pattern Types",
                    text: "Choose from Acid, Minimal, Hard, Industrial, Detroit, or Dub Techno",
                    element: "#technoPatternType"
                },
                {
                    title: "üéµ BPM Styles",
                    text: "Adjust BPM and watch the style change from Dub Techno (120) to Hardcore (150+)",
                    element: "#technoBPM"
                },
                {
                    title: "‚úÖ Ready to Create!",
                    text: "Start making industrial techno tracks now!"
                }
            ];
            
            showTechnoTutorialStep(0, steps);
        }

        let technoTutorialStep = 0;
        function showTechnoTutorialStep(index, steps) {
            if (index >= steps.length) {
                showTechnoAchievement("Tutorial Complete!", "Create hypnotic techno! ‚ö°");
                return;
            }
            
            const step = steps[index];
            const confirmed = confirm(`${step.title}\n\n${step.text}\n\n${index < steps.length - 1 ? '‚ñ∂ Click OK for next step' : '‚úì Click OK to finish'}`);
            
            if (confirmed && index < steps.length - 1) {
                showTechnoTutorialStep(index + 1, steps);
            }
        }

        function showTechnoAchievement(title, text) {
            const achievement = document.createElement('div');
            achievement.className = 'achievement';
            achievement.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: linear-gradient(135deg, #00ff00, #00cc00);
                color: #000;
                padding: 20px;
                border-radius: 5px;
                box-shadow: 0 0 30px rgba(0, 255, 0, 0.5);
                z-index: 9999;
                transform: translateX(400px);
                transition: transform 0.5s ease;
                min-width: 300px;
                font-family: 'Courier New', monospace;
                font-weight: bold;
            `;
            achievement.innerHTML = `
                <div style="font-size: 1.2em; margin-bottom: 5px;">üèÜ ${title}</div>
                <div style="font-size: 0.9em;">${text}</div>
            `;
            
            document.body.appendChild(achievement);
            setTimeout(() => achievement.style.transform = 'translateX(0)', 100);
            setTimeout(() => {
                achievement.style.transform = 'translateX(400px)';
                setTimeout(() => achievement.remove(), 500);
            }, 3000);
        }

        // Achievement tracking for techno
        let technoAchievements = {
            firstSequence: false,
            firstLoop: false,
            firstRadio: false
        };

        const savedTechnoAchievements = localStorage.getItem('techno-achievements');
        if (savedTechnoAchievements) {
            technoAchievements = JSON.parse(savedTechnoAchievements);
        }

        function checkTechnoAchievement(type) {
            if (!technoAchievements[type]) {
                technoAchievements[type] = true;
                switch(type) {
                    case 'firstSequence':
                        showTechnoAchievement("Sequence Generated!", "Your first techno sequence! üéµ");
                        break;
                    case 'firstLoop':
                        showTechnoAchievement("Loop Playing!", "Hypnotic techno groove! ‚ö°");
                        break;
                    case 'firstRadio':
                        showTechnoAchievement("Broadcasting!", "Live on Techno Radio 24/7! üìª");
                        break;
                }
                localStorage.setItem('techno-achievements', JSON.stringify(technoAchievements));
            }
        }

        // Enhance existing functions with achievements
        const originalGenerateTechnoSequence = window.generateTechnoSequence;
        window.generateTechnoSequence = function() {
            if (originalGenerateTechnoSequence) originalGenerateTechnoSequence();
            checkTechnoAchievement('firstSequence');
        };

        const originalPlayTechnoLoop = window.playTechnoLoop;
        window.playTechnoLoop = function() {
            if (originalPlayTechnoLoop) originalPlayTechnoLoop();
            checkTechnoAchievement('firstLoop');
        };

        const originalExportTechnoToRadio = window.exportTechnoToRadio;
        window.exportTechnoToRadio = function() {
            if (originalExportTechnoToRadio) originalExportTechnoToRadio();
            checkTechnoAchievement('firstRadio');
        };

        // ============================================
        // TECHNO PRESET SYSTEM
        // ============================================
        
        let technoPresets = {};
        
        function saveTechnoUserPreset(slot) {
            const presetName = prompt(`üíæ Name your techno preset (Slot ${slot}):`, `Techno ${slot}`);
            if (!presetName) return;
            
            const preset = {
                name: presetName,
                timestamp: new Date().toISOString(),
                parameters: {
                    bpm: parseInt(document.getElementById('technoBPM')?.value || 128),
                    acidFreq: parseInt(document.getElementById('acidFreq')?.value || 110),
                    acidRes: parseFloat(document.getElementById('acidRes')?.value || 0.7),
                    // Add more techno-specific parameters
                }
            };
            
            technoPresets[`slot${slot}`] = preset;
            localStorage.setItem('techno-presets', JSON.stringify(technoPresets));
            showTechnoToast(`‚úÖ Preset "${presetName}" saved!`, 'success');
        }

        function loadTechnoUserPreset(slot) {
            const preset = technoPresets[`slot${slot}`];
            if (!preset) {
                showTechnoToast(`‚ùå No preset in slot ${slot}`, 'error');
                return;
            }
            
            const params = preset.parameters;
            if (document.getElementById('technoBPM')) {
                document.getElementById('technoBPM').value = params.bpm || 128;
            }
            // Load other parameters...
            
            showTechnoToast(`‚úÖ Loaded "${preset.name}"`, 'success');
        }

        function showTechnoToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 25px;
                background: ${type === 'success' ? '#00ff00' : type === 'error' ? '#ff00ff' : '#00ffff'};
                color: #000;
                border-radius: 8px;
                font-weight: bold;
                box-shadow: 0 0 30px rgba(0, 255, 0, 0.7);
                z-index: 10000;
                font-family: 'Courier New', monospace;
                animation: slideIn 0.3s ease;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        const savedTechnoPresets = localStorage.getItem('techno-presets');
        if (savedTechnoPresets) {
            technoPresets = JSON.parse(savedTechnoPresets);
        }

        // ============================================
        // TECHNO KEYBOARD SHORTCUTS
        // ============================================
        
        const technoShortcuts = {
            ' ': () => { // Space - Play/Pause
                const playBtn = document.querySelector('button[onclick*="playTechno"]');
                if (playBtn) playBtn.click();
            },
            's': (e) => { // S - Save preset
                if (e.ctrlKey || e.metaKey) return;
                const slot = prompt('Save to slot (1-9):', '1');
                if (slot && /^[1-9]$/.test(slot)) {
                    saveTechnoUserPreset(parseInt(slot));
                }
            },
            'g': () => { // G - Generate sequence
                const genBtn = document.querySelector('button[onclick*="generate"]');
                if (genBtn) genBtn.click();
            },
            'h': () => { // H - Show help
                alert(`‚ö° TECHNO KEYBOARD SHORTCUTS:

SPACE     - Play/Pause
S         - Save preset
G         - Generate sequence
1-9       - Load preset
H         - Show this help
ESC       - Close modals`);
            }
        };

        // Number keys for techno presets
        for (let i = 1; i <= 9; i++) {
            technoShortcuts[i.toString()] = () => loadTechnoUserPreset(i);
        }

        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
            
            const handler = technoShortcuts[e.key];
            if (handler) {
                e.preventDefault();
                handler(e);
            }
        });
    </script>

    <!-- Tour Button for Techno -->
    <button id="technoTourButton" class="tour-button" onclick="startTechnoTutorial()" 
            style="position: fixed; bottom: 100px; left: 20px; background: linear-gradient(135deg, #00ff00, #00ffff); color: #000; padding: 15px 25px; border-radius: 50px; border: none; font-weight: bold; font-size: 1em; cursor: pointer; box-shadow: 0 0 20px rgba(0, 255, 0, 0.5); z-index: 999; font-family: 'Courier New', monospace; display: none;">
        ‚ö° TAKE TOUR
    </button>

    <!-- Techno Quick Actions -->
    <div style="position: fixed; bottom: 20px; right: 20px; display: flex; flex-direction: column; gap: 10px; z-index: 998;">
        <button onclick="saveTechnoUserPreset(prompt('Slot (1-9):', '1'))" 
                style="padding: 15px 25px; background: linear-gradient(135deg, #00ff00, #00ffff); color: #000; border: none; border-radius: 50px; font-weight: bold; cursor: pointer; box-shadow: 0 0 20px rgba(0, 255, 0, 0.5); font-family: 'Courier New', monospace;">
            üíæ SAVE
        </button>
        <button onclick="alert('‚ö° TECHNO TIPS:\\n\\nBPM: 128-135 for classic techno\\n140-150 for hard techno\\n\\nAcid bass: High resonance = classic 303 sound\\n\\nPattern length: 16-32 steps for hypnotic loops')" 
                style="padding: 15px 25px; background: linear-gradient(135deg, #ff00ff, #00ffff); color: #000; border: none; border-radius: 50px; font-weight: bold; cursor: pointer; box-shadow: 0 0 20px rgba(255, 0, 255, 0.5); font-family: 'Courier New', monospace;">
            üí° TIPS
        </button>
    </div>

    <!-- Keyboard Shortcuts Panel for Techno -->
    <div style="position: fixed; bottom: 160px; left: 20px; background: #1a1a1a; border: 2px solid #00ff00; border-radius: 12px; padding: 15px; max-width: 250px; box-shadow: 0 0 30px rgba(0, 255, 0, 0.3); z-index: 999; font-family: 'Courier New', monospace; font-size: 0.85em;" id="technoShortcuts">
        <h3 style="color: #00ff00; margin-bottom: 10px; font-size: 1.1em; cursor: pointer;" onclick="this.parentElement.style.height = this.parentElement.style.height === '45px' ? 'auto' : '45px'">
            ‚å®Ô∏è SHORTCUTS ‚ñº
        </h3>
        <div>
            <div style="display: flex; justify-content: space-between; margin: 5px 0; padding: 5px 0; border-bottom: 1px solid #333;">
                <span style="background: #0a0a0a; color: #00ff00; padding: 2px 8px; border-radius: 4px; font-weight: bold;">SPACE</span>
                <span style="color: #00cc00;">Play</span>
            </div>
            <div style="display: flex; justify-content: space-between; margin: 5px 0; padding: 5px 0; border-bottom: 1px solid #333;">
                <span style="background: #0a0a0a; color: #00ff00; padding: 2px 8px; border-radius: 4px; font-weight: bold;">S</span>
                <span style="color: #00cc00;">Save</span>
            </div>
            <div style="display: flex; justify-content: space-between; margin: 5px 0; padding: 5px 0; border-bottom: 1px solid #333;">
                <span style="background: #0a0a0a; color: #00ff00; padding: 2px 8px; border-radius: 4px; font-weight: bold;">G</span>
                <span style="color: #00cc00;">Generate</span>
            </div>
            <div style="display: flex; justify-content: space-between; margin: 5px 0; padding: 5px 0; border-bottom: 1px solid #333;">
                <span style="background: #0a0a0a; color: #00ff00; padding: 2px 8px; border-radius: 4px; font-weight: bold;">1-9</span>
                <span style="color: #00cc00;">Load</span>
            </div>
            <div style="display: flex; justify-content: space-between; margin: 5px 0; padding: 5px 0;">
                <span style="background: #0a0a0a; color: #00ff00; padding: 2px 8px; border-radius: 4px; font-weight: bold;">H</span>
                <span style="color: #00cc00;">Help</span>
            </div>
        </div>
    </div>

    <!-- Preset Manager Modal -->
    <div id="presetModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); z-index: 10000; align-items: center; justify-content: center;">
        <div style="background: linear-gradient(135deg, #0a0a0a, #1a1a1a); border: 2px solid #9d4edd; border-radius: 20px; max-width: 700px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 0 60px rgba(157, 78, 221, 0.5);">
            <!-- Modal Header -->
            <div style="background: linear-gradient(135deg, #9d4edd, #7209b7); padding: 25px; border-radius: 18px 18px 0 0; position: relative;">
                <h2 style="margin: 0; color: #fff; font-size: 1.8em; display: flex; align-items: center; gap: 12px; font-family: var(--haos-font-display);">
                    <span style="font-size: 1.5em;">üíæ</span>
                    PATTERN PRESET MANAGER
                </h2>
                <p style="margin: 8px 0 0 0; color: rgba(255, 255, 255, 0.8); font-size: 0.9em;">Save and load your techno patterns ‚Ä¢ Export & import presets</p>
                <button onclick="closePresetManager()" style="position: absolute; top: 15px; right: 15px; background: rgba(0, 0, 0, 0.3); border: none; color: #fff; font-size: 1.5em; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s;">
                    ‚úï
                </button>
            </div>

            <!-- Modal Body -->
            <div style="padding: 30px;">
                <!-- Save New Preset Section -->
                <div style="margin-bottom: 30px; padding: 20px; background: rgba(157, 78, 221, 0.1); border: 1px solid #9d4edd; border-radius: 12px;">
                    <h3 style="color: #9d4edd; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                        <span>üíæ</span> Save Current Pattern
                    </h3>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <input type="text" id="presetName" placeholder="Enter preset name (e.g., Hard Techno Loop)" 
                               style="flex: 1; padding: 12px; background: var(--bg-tertiary); border: 2px solid var(--border); border-radius: 8px; color: var(--text-primary); font-size: 1em; font-family: var(--haos-font-mono);"
                               onfocus="this.style.borderColor='#9d4edd'"
                               onblur="this.style.borderColor='var(--border)'">
                        <button onclick="savePreset()" style="padding: 12px 24px; background: linear-gradient(135deg, #9d4edd, #7209b7); color: #fff; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; white-space: nowrap; box-shadow: 0 4px 15px rgba(157, 78, 221, 0.4); transition: all 0.3s;">
                            üíæ SAVE
                        </button>
                    </div>
                    <div style="font-size: 0.85em; color: var(--text-secondary); display: flex; align-items: center; gap: 6px;">
                        <span>üí°</span>
                        <span>Saves current pattern, BPM, drum variations, and mode</span>
                    </div>
                </div>

                <!-- Preset Library -->
                <div>
                    <h3 style="color: #9d4edd; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <span>üìö</span>
                        <span>Saved Presets</span>
                        <span style="font-size: 0.7em; background: #9d4edd; color: #000; padding: 4px 10px; border-radius: 15px; font-weight: bold;" id="presetCount">0</span>
                    </h3>
                    <div id="presetList" style="max-height: 350px; overflow-y: auto;">
                        <div style="text-align: center; padding: 40px; color: var(--text-secondary); font-style: italic;">
                            No presets saved yet. Create your first pattern preset!
                        </div>
                    </div>
                </div>

                <!-- Import/Export Section -->
                <div style="margin-top: 30px; padding-top: 25px; border-top: 2px solid var(--border);">
                    <h3 style="color: #9d4edd; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                        <span>üì§</span> Import / Export
                    </h3>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="exportAllPresets()" style="flex: 1; min-width: 200px; padding: 12px; background: var(--bg-tertiary); border: 2px solid #9d4edd; color: var(--text-primary); border-radius: 8px; font-weight: bold; cursor: pointer; transition: all 0.3s;">
                            üì§ Export All Presets
                        </button>
                        <button onclick="document.getElementById('importFile').click()" style="flex: 1; min-width: 200px; padding: 12px; background: var(--bg-tertiary); border: 2px solid #9d4edd; color: var(--text-primary); border-radius: 8px; font-weight: bold; cursor: pointer; transition: all 0.3s;">
                            üì• Import Presets
                        </button>
                        <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importPresets(event)">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Artist Modal for Radio 24/7 Integration -->
    <div id="artistModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); z-index: 10000; align-items: center; justify-content: center;">
        <div style="background: linear-gradient(135deg, #0a0a0a, #1a1a1a); border: 2px solid var(--accent-primary); border-radius: 20px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 0 60px rgba(0, 255, 0, 0.5);">
            <!-- Modal Header -->
            <div style="background: linear-gradient(135deg, var(--accent-primary), var(--accent-cyan)); padding: 25px; border-radius: 18px 18px 0 0; position: relative;">
                <h2 style="margin: 0; color: #000; font-size: 1.8em; display: flex; align-items: center; gap: 12px; font-family: var(--haos-font-display);">
                    <span style="font-size: 1.5em;">‚≠ê</span>
                    ADD ARTIST TO RADIO 24/7
                </h2>
                <p style="margin: 8px 0 0 0; color: rgba(0, 0, 0, 0.7); font-size: 0.9em;">Customize your radio playlist with favorite artists from YouTube</p>
                <button onclick="closeArtistModal()" style="position: absolute; top: 15px; right: 15px; background: rgba(0, 0, 0, 0.2); border: none; color: #000; font-size: 1.5em; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s;">
                    ‚úï
                </button>
            </div>

            <!-- Modal Body -->
            <div style="padding: 30px;">
                <!-- Artist Name -->
                <div style="margin-bottom: 25px;">
                    <label style="display: block; color: var(--accent-cyan); font-weight: bold; margin-bottom: 10px; font-size: 1.1em; display: flex; align-items: center; gap: 8px;">
                        <span>üé§</span> Artist Name
                    </label>
                    <input type="text" id="artistName" placeholder="e.g., Nina Kraviz, Adam Beyer, Charlotte de Witte" 
                           style="width: 100%; padding: 15px; background: var(--bg-tertiary); border: 2px solid var(--border); border-radius: 10px; color: var(--text-primary); font-size: 1em; font-family: var(--haos-font-mono); transition: all 0.3s;"
                           onfocus="this.style.borderColor='var(--accent-primary)'"
                           onblur="this.style.borderColor='var(--border)'">
                </div>

                <!-- Genre -->
                <div style="margin-bottom: 25px;">
                    <label style="display: block; color: var(--accent-cyan); font-weight: bold; margin-bottom: 10px; font-size: 1.1em; display: flex; align-items: center; gap: 8px;">
                        <span>üéµ</span> Genre
                    </label>
                    <select id="artistGenre" style="width: 100%; padding: 15px; background: var(--bg-tertiary); border: 2px solid var(--border); border-radius: 10px; color: var(--text-primary); font-size: 1em; cursor: pointer;">
                        <option value="techno">‚ö° Techno</option>
                        <option value="trap">üî• Trap</option>
                        <option value="house">üè† House</option>
                        <option value="dnb">ü•Å Drum & Bass</option>
                        <option value="dubstep">üéöÔ∏è Dubstep</option>
                        <option value="acid">üß™ Acid</option>
                        <option value="industrial">üè≠ Industrial</option>
                        <option value="minimal">üéØ Minimal</option>
                        <option value="other">üéº Other</option>
                    </select>
                </div>

                <!-- YouTube Link -->
                <div style="margin-bottom: 25px;">
                    <label style="display: block; color: var(--accent-cyan); font-weight: bold; margin-bottom: 10px; font-size: 1.1em; display: flex; align-items: center; gap: 8px;">
                        <span>üì∫</span> YouTube Mix/Set Link
                    </label>
                    <input type="url" id="artistYoutubeLink" placeholder="https://youtube.com/watch?v=..." 
                           style="width: 100%; padding: 15px; background: var(--bg-tertiary); border: 2px solid var(--border); border-radius: 10px; color: var(--text-primary); font-size: 1em; font-family: var(--haos-font-mono); transition: all 0.3s;"
                           onfocus="this.style.borderColor='var(--accent-primary)'"
                           onblur="this.style.borderColor='var(--border)'">
                    <div style="margin-top: 8px; font-size: 0.85em; color: var(--text-secondary); display: flex; align-items: center; gap: 6px;">
                        <span>üí°</span>
                        <span>Tip: Use DJ sets, live mixes, or essential tracks compilations</span>
                    </div>
                </div>

                <!-- Buttons -->
                <div style="display: flex; gap: 15px; margin-top: 30px;">
                    <button onclick="saveArtist()" style="flex: 1; padding: 16px; background: linear-gradient(135deg, var(--accent-primary), var(--accent-cyan)); color: #000; border: none; border-radius: 10px; font-weight: bold; font-size: 1.1em; cursor: pointer; box-shadow: 0 4px 20px rgba(0, 255, 0, 0.4); transition: all 0.3s; font-family: var(--haos-font-mono); letter-spacing: 1px;">
                        üíæ SAVE TO RADIO
                    </button>
                    <button onclick="closeArtistModal()" style="flex: 0.5; padding: 16px; background: var(--bg-tertiary); color: var(--text-secondary); border: 2px solid var(--border); border-radius: 10px; font-weight: bold; cursor: pointer; transition: all 0.3s;">
                        CANCEL
                    </button>
                </div>

                <!-- Saved Artists List -->
                <div style="margin-top: 35px; padding-top: 25px; border-top: 2px solid var(--border);">
                    <h3 style="color: var(--accent-cyan); margin-bottom: 15px; font-size: 1.3em; display: flex; align-items: center; gap: 10px;">
                        <span>üìª</span>
                        <span>Your Radio Playlist</span>
                        <span style="font-size: 0.7em; background: var(--accent-primary); color: #000; padding: 4px 10px; border-radius: 15px; font-weight: bold;" id="artistCount">0</span>
                    </h3>
                    <div id="savedArtistsList" style="max-height: 300px; overflow-y: auto;">
                        <div style="text-align: center; padding: 30px; color: var(--text-secondary); font-style: italic;">
                            No artists added yet. Add your first favorite artist!
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Synth Manager (must load first) -->
    <script type="module" src="/js/synth-manager.js"></script>

    <!-- Modular Synthesizer Modules -->
    <script type="module" src="/js/synths/tb303.js"></script>
    <script type="module" src="/js/synths/tr808.js"></script>
    <script type="module" src="/js/synths/arp2600.js"></script>
    <script type="module" src="/js/synths/string-machine.js"></script>

    <!-- Audio Recorder Module -->
    <script type="module">
        import AudioRecorder from '/js/audio-recorder.js';
        
        let audioRecorder = null;
        let recorderLevelInterval = null;
        let recorderTimeInterval = null;
        let recorderStartTime = null;
        
        // Initialize recorder when audio context is ready
        window.initRecorder = async function() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            
            if (!audioRecorder) {
                audioRecorder = new AudioRecorder(audioContext);
            }
            
            const result = await audioRecorder.initializeRecording();
            
            if (result.success) {
                document.getElementById('recorderInitBtn').disabled = true;
                document.getElementById('recorderStartBtn').disabled = false;
                document.getElementById('recorderStatusText').textContent = 'Microphone Ready ‚úì';
                
                // Start level monitoring
                recorderLevelInterval = setInterval(() => {
                    const level = audioRecorder.getInputLevel();
                    const percentage = Math.min(level * 100, 100);
                    document.getElementById('recorderLevelBar').style.width = percentage + '%';
                }, 50);
                
                showToast('‚úì Microphone initialized successfully', 'success');
            } else {
                showToast('‚úó ' + result.message, 'error');
            }
        };
        
        window.startRecording = async function() {
            const bpm = parseInt(document.getElementById('recorderBPM').value) || technoBPM;
            const beatsPerBar = parseInt(document.getElementById('recorderTimeSig').value);
            const quantize = document.getElementById('recorderQuantize').checked;
            const metronome = document.getElementById('recorderMetronome').checked;
            
            audioRecorder.metronomeEnabled = metronome;
            
            const result = await audioRecorder.startRecording({
                bpm,
                beatsPerBar,
                quantize,
                sequencer: technoIsPlaying ? { isPlaying: true } : null
            });
            
            if (result.success) {
                document.getElementById('recorderStartBtn').disabled = true;
                document.getElementById('recorderPauseBtn').disabled = false;
                document.getElementById('recorderStopBtn').disabled = false;
                document.getElementById('recorderStatus').style.borderColor = '#FF1493';
                document.getElementById('recorderStatus').style.animation = 'pulse 1s infinite';
                document.getElementById('recorderStatusText').textContent = '‚è∫ RECORDING...';
                
                recorderStartTime = Date.now();
                recorderTimeInterval = setInterval(updateRecorderTime, 100);
                
                showToast('‚è∫ Recording started', 'info');
            }
        };
        
        window.pauseRecording = function() {
            const result = audioRecorder.pauseRecording();
            if (result.success) {
                const btn = document.getElementById('recorderPauseBtn');
                btn.textContent = '‚ñ∂ Resume';
                btn.onclick = resumeRecording;
                document.getElementById('recorderStatusText').textContent = '‚è∏ PAUSED';
                showToast('‚è∏ Recording paused', 'info');
            }
        };
        
        window.resumeRecording = function() {
            const result = audioRecorder.resumeRecording();
            if (result.success) {
                const btn = document.getElementById('recorderPauseBtn');
                btn.textContent = '‚è∏ Pause';
                btn.onclick = pauseRecording;
                document.getElementById('recorderStatusText').textContent = '‚è∫ RECORDING...';
                showToast('‚ñ∂ Recording resumed', 'info');
            }
        };
        
        window.stopRecording = function() {
            const result = audioRecorder.stopRecording();
            if (result.success) {
                clearInterval(recorderTimeInterval);
                document.getElementById('recorderStartBtn').disabled = false;
                document.getElementById('recorderPauseBtn').disabled = true;
                document.getElementById('recorderStopBtn').disabled = true;
                document.getElementById('recorderStatus').style.borderColor = 'var(--accent-cyan)';
                document.getElementById('recorderStatus').style.animation = 'none';
                document.getElementById('recorderStatusText').textContent = 'Recording Saved ‚úì';
                document.getElementById('recorderTime').textContent = '00:00:00';
                document.getElementById('recorderBeatInfo').textContent = '';
                
                showToast('‚úì Recording saved!', 'success');
            }
        };
        
        function updateRecorderTime() {
            const elapsed = (Date.now() - recorderStartTime) / 1000;
            const hours = Math.floor(elapsed / 3600);
            const minutes = Math.floor((elapsed % 3600) / 60);
            const seconds = Math.floor(elapsed % 60);
            
            const timeStr = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            document.getElementById('recorderTime').textContent = timeStr;
            
            // Update beat info
            const bpm = parseInt(document.getElementById('recorderBPM').value) || technoBPM;
            const beatsPerBar = parseInt(document.getElementById('recorderTimeSig').value);
            const beatDuration = 60 / bpm;
            const currentBeat = Math.floor(elapsed / beatDuration) % beatsPerBar;
            const currentBar = Math.floor(elapsed / (beatDuration * beatsPerBar));
            
            document.getElementById('recorderBeatInfo').textContent = `Bar ${currentBar + 1} | Beat ${currentBeat + 1}`;
        }
        
        window.playRecording = async function(id) {
            const result = await audioRecorder.playRecording(id, {
                volume: 1.0,
                quantize: true,
                sequencer: technoIsPlaying ? { isPlaying: true } : null,
                bpm: technoBPM
            });
            if (result.success) {
                showToast('‚ñ∂ Playing recording', 'info');
            }
        };
        
        window.stopPlayback = function(id) {
            audioRecorder.stopPlayback(id);
            showToast('‚èπ Playback stopped', 'info');
        };
        
        window.downloadRecording = function(id) {
            audioRecorder.exportRecording(id);
            showToast('üíæ Downloading recording', 'info');
        };
        
        window.deleteRecording = function(id) {
            if (confirm('Delete this recording?')) {
                audioRecorder.deleteRecording(id);
                loadRecordingsList();
                showToast('üóëÔ∏è Recording deleted', 'info');
            }
        };
        
        function loadRecordingsList() {
            if (!audioRecorder) return;
            
            const recordings = audioRecorder.getAllRecordings();
            const container = document.getElementById('recordingsList');
            
            if (recordings.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.5);">
                        <div style="font-size: 3em; margin-bottom: 15px;">üéôÔ∏è</div>
                        <h4>No Recordings Yet</h4>
                        <p>Start recording to see your tracks here</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = recordings.map(recording => `
                <div style="background: rgba(0,0,0,0.5); padding: 20px; border-radius: 12px; border-left: 4px solid var(--accent-primary);">
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 20px; align-items: center;">
                        <div>
                            <h4 style="color: var(--accent-secondary); margin-bottom: 10px;">${recording.name}</h4>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap; font-size: 0.9em;">
                                <span style="background: rgba(57,255,20,0.2); padding: 4px 10px; border-radius: 6px; border: 1px solid var(--accent-primary);">
                                    ‚è± ${formatDuration(recording.duration)}
                                </span>
                                <span style="background: rgba(255,107,53,0.2); padding: 4px 10px; border-radius: 6px; border: 1px solid var(--accent-secondary);">
                                    üéµ ${recording.bpm} BPM
                                </span>
                                <span style="background: rgba(0,255,255,0.2); padding: 4px 10px; border-radius: 6px; border: 1px solid var(--accent-cyan);">
                                    üìä ${recording.bars} bars
                                </span>
                                ${recording.quantized ? '<span style="background: rgba(255,215,0,0.2); padding: 4px 10px; border-radius: 6px; border: 1px solid var(--accent-gold);">üéØ Quantized</span>' : ''}
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-small" onclick="playRecording(${recording.id})" title="Play">
                                ‚ñ∂Ô∏è
                            </button>
                            <button class="btn btn-small btn-cyan" onclick="downloadRecording(${recording.id})" title="Download">
                                üíæ
                            </button>
                            <button class="btn btn-small" onclick="deleteRecording(${recording.id})" title="Delete" style="background: #FF1493;">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function formatDuration(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${String(secs).padStart(2, '0')}`;
        }
        
        // Listen for recording complete events
        window.addEventListener('recordingComplete', (e) => {
            loadRecordingsList();
            showToast('‚úì Recording saved: ' + e.detail.name, 'success');
        });
        
        // Sync BPM with techno creator
        window.addEventListener('DOMContentLoaded', () => {
            const bpmInput = document.getElementById('recorderBPM');
            if (bpmInput) {
                bpmInput.value = technoBPM || 135;
            }
        });
    </script>

    <!-- Theme Manager Script -->
    <script src="/js/theme-manager.js"></script>
    <script>
        // Initialize theme manager
        const themeManager = new ThemeManager({
            toggleButtonId: 'theme-toggle',
            showToast: true
        });
        themeManager.init();
        
        // String Machine Functions
        function loadStringPreset(presetName) {
            if (window.synthManager && window.synthManager.loadStringMachinePreset) {
                window.synthManager.loadStringMachinePreset(presetName);
                showTechnoNotification(`üéª Loaded: ${presetName.replace(/_/g, ' ').toUpperCase()}`);
                console.log('üéª String preset loaded:', presetName);
            }
        }
        
        function updateStringSection(section, enabled) {
            if (window.synthManager && window.synthManager.getStringMachine) {
                const strings = window.synthManager.getStringMachine();
                strings.setSection(section, enabled);
                console.log(`üéª ${section}: ${enabled ? 'ON' : 'OFF'}`);
            }
        }
        
        function updateStringEnvelope() {
            const attack = parseFloat(document.getElementById('stringAttack').value);
            const release = parseFloat(document.getElementById('stringRelease').value);
            document.getElementById('stringAttackVal').textContent = attack.toFixed(2) + 's';
            document.getElementById('stringReleaseVal').textContent = release.toFixed(2) + 's';
            
            if (window.synthManager && window.synthManager.getStringMachine) {
                const strings = window.synthManager.getStringMachine();
                strings.setEnvelope(attack, release);
            }
        }
        
        function updateStringChorus() {
            const depth = parseFloat(document.getElementById('stringChorus').value);
            document.getElementById('stringChorusVal').textContent = Math.round(depth * 100) + '%';
            
            if (window.synthManager && window.synthManager.getStringMachine) {
                const strings = window.synthManager.getStringMachine();
                strings.setChorus(true, depth);
            }
        }
        
        function updateStringReverb() {
            const mix = parseFloat(document.getElementById('stringReverb').value);
            document.getElementById('stringReverbVal').textContent = Math.round(mix * 100) + '%';
            
            if (window.synthManager && window.synthManager.getStringMachine) {
                const strings = window.synthManager.getStringMachine();
                strings.setReverb(true, undefined, mix);
            }
        }
        
        function updateStringVolume() {
            const volume = parseFloat(document.getElementById('stringVolume').value);
            document.getElementById('stringVolumeVal').textContent = Math.round(volume * 100) + '%';
            
            if (window.synthManager && window.synthManager.getStringMachine) {
                const strings = window.synthManager.getStringMachine();
                strings.setVolume(volume);
            }
        }
        
        function toggleStringModulation(enabled) {
            const amount = parseFloat(document.getElementById('stringModAmount').value);
            
            if (window.synthManager) {
                window.synthManager.modulateARP2600WithStrings(enabled, amount);
                showTechnoNotification(enabled ? 'üîó ARP-2600 modulation enabled' : '‚ùå Modulation disabled');
            }
        }
        
        function updateStringModAmount() {
            const amount = parseFloat(document.getElementById('stringModAmount').value);
            document.getElementById('stringModAmountVal').textContent = Math.round(amount * 100) + '%';
            
            const enabled = document.getElementById('enableStringMod').checked;
            if (enabled && window.synthManager) {
                window.synthManager.modulateARP2600WithStrings(true, amount);
            }
        }
        
        function playStringChord(chordName) {
            if (!window.synthManager) {
                console.error('Synth Manager not initialized');
                return;
            }
            
            // Chord definitions (frequencies in Hz)
            const chords = {
                'Cm': [130.81, 155.56, 196.00],  // C3, Eb3, G3
                'Am': [110.00, 130.81, 164.81],  // A2, C3, E3
                'Dm': [146.83, 174.61, 220.00],  // D3, F3, A3
                'C': [130.81, 164.81, 196.00],   // C3, E3, G3
                'F': [174.61, 220.00, 261.63],   // F3, A3, C4
                'G': [196.00, 246.94, 293.66]    // G3, B3, D4
            };
            
            const frequencies = chords[chordName];
            if (frequencies) {
                window.synthManager.playStringChord(frequencies, 3.0, 0.7);
                showTechnoNotification(`üéª Playing: ${chordName} chord`);
            }
        }
        
        function playStringProgression() {
            if (!window.synthManager) return;
            
            // Play a simple progression: Cm ‚Üí Am ‚Üí Dm ‚Üí G
            const progression = ['Cm', 'Am', 'Dm', 'G'];
            let delay = 0;
            
            progression.forEach((chord, index) => {
                setTimeout(() => {
                    playStringChord(chord);
                }, delay);
                delay += 3000; // 3 seconds per chord
            });
            
            showTechnoNotification('üéµ Playing chord progression');
        }
        
        // Wait for synth manager to initialize
        document.addEventListener('DOMContentLoaded', async () => {
            if (window.synthManager) {
                await window.synthManager.init();
                console.log('üéπ Synth Manager ready in Techno Creator');
                
                // Log available presets
                console.log('üì¶ TB-303 Presets:', Object.keys(window.synthManager.getTB303Presets()));
                console.log('üì¶ TR-808 Presets:', Object.keys(window.synthManager.getTR808Presets()));
                console.log('üì¶ ARP-2600 Presets:', Object.keys(window.synthManager.getARP2600Presets()));
                console.log('üì¶ String Machine Presets:', Object.keys(window.synthManager.getStringMachinePresets()));
            }
        });
    </script>

</body>
</html>

