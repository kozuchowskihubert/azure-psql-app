<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Welcome to HAOS.fm</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: #0A0A0A;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      position: relative;
      color: #F4E8D8;
    }

    /* Noise texture overlay */
    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iMzAwIj48ZmlsdGVyIGlkPSJhIj48ZmVUdXJidWxlbmNlIGJhc2VGcmVxdWVuY3k9Ii43NSIgc3RpdGNoVGlsZXM9InN0aXRjaCIgdHlwZT0iZnJhY3RhbE5vaXNlIi8+PGZlQ29sb3JNYXRyaXggdHlwZT0ic2F0dXJhdGUiIHZhbHVlcz0iMCIvPjwvZmlsdGVyPjxwYXRoIGQ9Ik0wIDBoMzAwdjMwMEgweiIgZmlsdGVyPSJ1cmwoI2EpIiBvcGFjaXR5PSIuMDUiLz48L3N2Zz4=');
      opacity: 0.03;
      mix-blend-mode: overlay;
      pointer-events: none;
      z-index: 9999;
    }

    /* Background glows */
    .bg-glow {
      position: fixed;
      width: 500px;
      height: 500px;
      border-radius: 50%;
      filter: blur(140px);
      opacity: 0.15;
      animation: float 8s ease-in-out infinite;
      pointer-events: none;
      z-index: 0;
    }

    .bg-glow.orange { 
      background: #FF6B35; 
      top: -150px; 
      left: -100px;
    }
    
    .bg-glow.gold { 
      background: #D4AF37; 
      bottom: -150px; 
      right: -100px; 
      animation-delay: -4s; 
    }
    
    .bg-glow.cyan { 
      background: #00D9FF; 
      top: 50%; 
      left: 50%; 
      transform: translate(-50%, -50%); 
      animation-delay: -2s; 
      opacity: 0.08; 
    }

    @keyframes float {
      0%, 100% { transform: translate(0, 0); }
      50% { transform: translate(30px, -30px); }
    }

    /* Main container */
    .container {
      position: relative;
      z-index: 10;
      text-align: center;
      max-width: 700px;
      padding: 60px 50px;
      background: rgba(10, 10, 10, 0.85);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 107, 53, 0.2);
      border-radius: 20px;
      box-shadow: 
        0 20px 60px rgba(0, 0, 0, 0.5),
        0 0 40px rgba(255, 107, 53, 0.1);
      animation: fadeInUp 0.8s ease-out;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Success icon */
    .success-icon {
      width: 100px;
      height: 100px;
      margin: 0 auto 30px;
      background: linear-gradient(135deg, #FF6B35, #D4AF37);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 50px;
      color: #0A0A0A;
      box-shadow: 0 10px 40px rgba(255, 107, 53, 0.4);
      animation: scaleIn 0.6s ease-out 0.2s both;
    }

    @keyframes scaleIn {
      from {
        transform: scale(0) rotate(-180deg);
        opacity: 0;
      }
      to {
        transform: scale(1) rotate(0deg);
        opacity: 1;
      }
    }

    /* Title */
    h1 {
      font-family: 'Bebas Neue', Arial, sans-serif;
      font-size: 3.5rem;
      font-weight: normal;
      margin-bottom: 15px;
      background: linear-gradient(135deg, #FF6B35, #D4AF37);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: 3px;
      animation: fadeInUp 0.8s ease-out 0.4s both;
    }

    /* Subtitle */
    .subtitle {
      font-size: 1.1rem;
      color: rgba(244, 232, 216, 0.7);
      margin-bottom: 30px;
      font-weight: 300;
      animation: fadeInUp 0.8s ease-out 0.5s both;
    }

    /* User email */
    .user-email {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 15px 30px;
      background: rgba(255, 107, 53, 0.1);
      border: 1px solid rgba(255, 107, 53, 0.3);
      border-radius: 50px;
      color: #F4E8D8;
      font-size: 1rem;
      margin-bottom: 40px;
      backdrop-filter: blur(10px);
      animation: fadeInUp 0.8s ease-out 0.6s both;
    }

    .user-email i {
      color: #FF6B35;
      font-size: 1.2rem;
    }

    /* Features grid */
    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
      animation: fadeInUp 0.8s ease-out 0.7s both;
    }

    .feature-item {
      padding: 25px 20px;
      background: rgba(255, 107, 53, 0.05);
      border: 1px solid rgba(255, 107, 53, 0.1);
      border-radius: 15px;
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
      text-align: center;
    }

    .feature-item:hover {
      background: rgba(255, 107, 53, 0.1);
      border-color: rgba(255, 107, 53, 0.3);
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(255, 107, 53, 0.2);
    }

    .feature-item i {
      display: block;
      color: #FF6B35;
      font-size: 2rem;
      margin-bottom: 12px;
    }

    .feature-title {
      font-weight: 600;
      margin-bottom: 5px;
      color: #F4E8D8;
      font-size: 0.95rem;
    }

    .feature-desc {
      font-size: 0.85rem;
      color: rgba(244, 232, 216, 0.6);
    }

    /* Status message */
    .status {
      margin: 30px 0 20px;
      padding: 0;
      color: rgba(244, 232, 216, 0.6);
      font-size: 0.95rem;
      font-weight: 400;
      animation: fadeInUp 0.8s ease-out 0.8s both;
    }

    .loading-dots {
      display: inline-block;
    }

    .loading-dots span {
      animation: blink 1.4s infinite;
      animation-fill-mode: both;
    }

    .loading-dots span:nth-child(2) {
      animation-delay: 0.2s;
    }

    .loading-dots span:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes blink {
      0%, 80%, 100% { opacity: 0; }
      40% { opacity: 1; }
    }

    /* Progress bar */
    .progress-container {
      width: 100%;
      height: 3px;
      background: rgba(255, 107, 53, 0.1);
      border-radius: 3px;
      overflow: hidden;
      margin-bottom: 25px;
      animation: fadeInUp 0.8s ease-out 0.9s both;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #FF6B35, #D4AF37);
      width: 0%;
      animation: progressAnimation 3s ease-out forwards;
      box-shadow: 0 0 15px rgba(255, 107, 53, 0.5);
    }

    @keyframes progressAnimation {
      to { width: 100%; }
    }

    /* Skip button */
    .skip-btn {
      background: linear-gradient(135deg, #FF6B35, #D4AF37);
      border: none;
      color: #0A0A0A;
      padding: 14px 40px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      border-radius: 50px;
      font-family: 'Inter', sans-serif;
      transition: all 0.3s ease;
      box-shadow: 0 5px 20px rgba(255, 107, 53, 0.3);
      animation: fadeInUp 0.8s ease-out 1s both;
    }

    .skip-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 30px rgba(255, 107, 53, 0.5);
    }

    .skip-btn:active {
      transform: translateY(0);
    }

    /* Logo section */
    .logo-section {
      margin-top: 30px;
      padding-top: 30px;
      border-top: 1px solid rgba(255, 107, 53, 0.1);
      animation: fadeInUp 0.8s ease-out 1.1s both;
    }

    .logo-text {
      font-family: 'Bebas Neue', Arial, sans-serif;
      font-size: 1.5rem;
      letter-spacing: 3px;
      background: linear-gradient(135deg, #FF6B35, #D4AF37);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 8px;
    }

    .tagline {
      font-size: 0.85rem;
      color: rgba(244, 232, 216, 0.5);
      font-weight: 300;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .container {
        margin: 20px;
        padding: 30px 20px;
      }

      h1 {
        font-size: 24px;
      }

      .success-icon {
        font-size: 60px;
      }
    }
  </style>
</head>
<body>
  <!-- Background glows -->
  <div class="bg-glow orange"></div>
  <div class="bg-glow gold"></div>
  <div class="bg-glow cyan"></div>

  <!-- Main content -->
  <div class="container">
    <div class="success-icon">
      <i class="fas fa-check"></i>
    </div>

    <h1>WELCOME TO HAOS</h1>
    <div class="subtitle">Your creative journey begins now</div>

    <div class="user-email" id="userEmail">
      <i class="fas fa-user-circle"></i>
      <span>Loading...</span>
    </div>

    <div class="status" style="margin-bottom: 30px; font-style: italic; color: rgba(244, 232, 216, 0.8);">
      "Every sound you create is a step toward musical mastery"
    </div>

    <div class="features">
      <div class="feature-item">
        <i class="fas fa-sliders"></i>
        <div class="feature-title">Modular Synthesis</div>
        <div class="feature-desc">Create unique sounds</div>
      </div>
      <div class="feature-item">
        <i class="fas fa-users"></i>
        <div class="feature-title">Collaborate</div>
        <div class="feature-desc">Work with artists</div>
      </div>
      <div class="feature-item">
        <i class="fas fa-cloud-arrow-up"></i>
        <div class="feature-title">Cloud Saves</div>
        <div class="feature-desc">Access anywhere</div>
      </div>
    </div>

    <div class="status">
      Redirecting to your dashboard<span class="loading-dots"><span>.</span><span>.</span><span>.</span></span>
    </div>

    <div class="progress-container">
      <div class="progress-bar"></div>
    </div>

    <button class="skip-btn" onclick="redirect()">
      Go to Dashboard <i class="fas fa-arrow-right"></i>
    </button>

    <div class="logo-section">
      <div class="logo-text">HAOS.FM</div>
      <div class="tagline">Where Sound Meets Innovation</div>
    </div>
  </div>

  <!-- Load OAuth handler first -->
  <script src="/js/oauth-redirect-handler.js"></script>

  <script>
    // Debug: Log what we received
    console.log('[Welcome] Page loaded');
    console.log('[Welcome] Current URL:', window.location.href);
    console.log('[Welcome] URL params:', window.location.search);
    console.log('[Welcome] localStorage haos_token:', localStorage.getItem('haos_token') ? 'EXISTS' : 'MISSING');
    console.log('[Welcome] localStorage haos_user:', localStorage.getItem('haos_user'));
    console.log('[Welcome] Cookies:', document.cookie);

    // Extract user display name from URL or localStorage
    function getUserDisplayName() {
      try {
        // Try to get from localStorage first
        const userData = localStorage.getItem('haos_user');
        if (userData) {
          const user = JSON.parse(userData);
          // Prefer display name over email
          return user.name || user.display_name || user.email?.split('@')[0] || 'User';
        }

        // Fallback to URL params
        const urlParams = new URLSearchParams(window.location.search);
        const name = urlParams.get('name');
        if (name) {
          return name;
        }

        return 'User';
      } catch (e) {
        console.error('Error getting user display name:', e);
        return 'User';
      }
    }

    // Display user name
    const emailEl = document.getElementById('userEmail');
    const userName = getUserDisplayName();
    emailEl.innerHTML = `<i class="fas fa-user-circle"></i> <span>${userName}</span>`;

    // Auto-redirect function
    function redirect() {
      // Set flag to indicate OAuth redirect
      localStorage.setItem('oauth_redirect', 'true');
      localStorage.setItem('oauth_redirect_time', Date.now().toString());
      
      // Debug: Log what we have before redirect
      console.log('[Welcome] Redirecting with:');
      console.log('  - haos_token:', !!localStorage.getItem('haos_token'));
      console.log('  - haos_user:', localStorage.getItem('haos_user'));
      console.log('  - cookies:', document.cookie);
      
      // Redirect to Profile tab in account page with oauth flag
      window.location.href = '/account.html?tab=profile&from=oauth';
    }

    // Auto-redirect after 3 seconds
    setTimeout(redirect, 3000);

    // Allow Enter key to skip
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        redirect();
      }
    });

    // Terminal effect
    console.log('%c[HAOS.fm] Neural link established', 'color: #0f0; font-weight: bold;');
    console.log('%c[SYSTEM] User authenticated successfully', 'color: #0a0;');
    console.log('%c[REDIRECT] Transferring to neural interface...', 'color: #0f0;');
  </script>
</body>
</html>
